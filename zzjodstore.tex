\section{\texttt{jodstore} Source Code}

\begin{JODGroupHeader}
\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB.*jodstore c{-}{-} storage object class: extension of (jod).}
\CommentTok{NB.}
\CommentTok{NB. Hides the underlying database/file system used to store}
\CommentTok{NB. dictionary objects. Replacing this class is all that\textquotesingle{}s}
\CommentTok{NB. required to change the dictionary storage system.}
\CommentTok{NB.}
\CommentTok{NB. Verb interface:}
\CommentTok{NB.   bchecknames  checks backup name patterns}
\CommentTok{NB.   bgetdicdoc   get backup versions of the dictionary document}
\CommentTok{NB.   bgetexplain  get backup versions of short object explanations}
\CommentTok{NB.   bgetgstext   get backup versions of group/suite headers}
\CommentTok{NB.   bgetobjects  get objects from backups}
\CommentTok{NB.   bnlsearch    searches put dictionary backup name lists for simple character list patterns}
\CommentTok{NB.   bnums        returns unique backup ordered list of dictionary backup numbers}
\CommentTok{NB.   checkopen    checks if any dictionary is open}
\CommentTok{NB.   checkpath    checks current path against dictionary path}
\CommentTok{NB.   checkput     checks if first path dictionary is a put dictionary}
\CommentTok{NB.   closedict    closes dictionaries}
\CommentTok{NB.   createst     initializes storage objects}
\CommentTok{NB.   defwords     define words}
\CommentTok{NB.   delstuff     delete objects}
\CommentTok{NB.   didstats     dictionary statistics and path information}
\CommentTok{NB.   dnlsearch    search for name patterns}
\CommentTok{NB.   getdocument  get object documentation}
\CommentTok{NB.   getexplain   get short object explanations}
\CommentTok{NB.   getgstext    get group and suite script text}
\CommentTok{NB.   getntstamp   get name, creation and last put timestamps}
\CommentTok{NB.   getobjects   get objects}
\CommentTok{NB.   getrefs      get references}
\CommentTok{NB.   gslistnl     group and suite name lists}
\CommentTok{NB.   inputdict    test for objects in put dictionary}
\CommentTok{NB.   invappend    append inverted data}
\CommentTok{NB.   invdelete    delete inverted data}
\CommentTok{NB.   invfetch     fetch inverted data}
\CommentTok{NB.   invreplace   update inverted data}
\CommentTok{NB.   newregdict   create new or register dictionary}
\CommentTok{NB.   opendict     open a dictionary}
\CommentTok{NB.   pathnl       path name lists}
\CommentTok{NB.   putexplain   store short object explanations}
\CommentTok{NB.   putgs        store groups and suites}
\CommentTok{NB.   putntstamp   store name, creation and last put timestamps}
\CommentTok{NB.   puttable     store (name,text) and (name,class,text) tables}
\CommentTok{NB.   puttexts     store object documentation and group/suite texts}
\CommentTok{NB.   putwords     store words}
\CommentTok{NB.   putwordxrs   store word global references}
\CommentTok{NB.}
\CommentTok{NB. Notes:}
\CommentTok{NB.   Error messages (jodstore range 050{-}149)}

\NormalTok{coclass  }\StringTok{\textquotesingle{}ajodstore\textquotesingle{}}
\NormalTok{coinsert }\StringTok{\textquotesingle{}ajod\textquotesingle{}}

\CommentTok{NB.*dependents x{-}{-} JODstore dependent defintions}

\NormalTok{CNMARK}\AlertTok{=:}\index{CNMARK@\texttt{CNMARK}} \DecValTok{0}      \CommentTok{NB. file component: count and timestamp mark}
\NormalTok{CNLIST}\AlertTok{=:}\index{CNLIST@\texttt{CNLIST}} \DecValTok{4}      \CommentTok{NB. file component: main object index list}
\NormalTok{CNCOMPS}\AlertTok{=:}\index{CNCOMPS@\texttt{CNCOMPS}} \DecValTok{5}     \CommentTok{NB. file component: main object component list}

\CommentTok{NB. main directory file component list}
\NormalTok{CNDIR}\AlertTok{=:}\index{CNDIR@\texttt{CNDIR}}\NormalTok{ CNMARK}\KeywordTok{,}\NormalTok{CNLIST}\KeywordTok{,}\NormalTok{CNCOMPS}

\NormalTok{CNCLASS}\AlertTok{=:}\index{CNCLASS@\texttt{CNCLASS}} \DecValTok{6}     \CommentTok{NB. file component: word name class or macro type}
\NormalTok{CNCREATION}\AlertTok{=:}\index{CNCREATION@\texttt{CNCREATION}} \DecValTok{8}  \CommentTok{NB. file component: when object was first created}
\NormalTok{CNDICDOC}\AlertTok{=:}\index{CNDICDOC@\texttt{CNDICDOC}} \DecValTok{2}    \CommentTok{NB. file component: dictionary documentation {-} (regd)}
\NormalTok{CNEXPLAIN}\AlertTok{=:}\index{CNEXPLAIN@\texttt{CNEXPLAIN}} \DecValTok{11}  \CommentTok{NB. file component: short explanations}
\NormalTok{CNPARMS}\AlertTok{=:}\index{CNPARMS@\texttt{CNPARMS}} \DecValTok{3}     \CommentTok{NB. file component: dictionary parameters}
\NormalTok{CNPUTDATE}\AlertTok{=:}\index{CNPUTDATE@\texttt{CNPUTDATE}} \DecValTok{7}   \CommentTok{NB. file component: last time object was (put)}
\NormalTok{CNREF}\AlertTok{=:}\index{CNREF@\texttt{CNREF}} \DecValTok{5}\KeywordTok{+i.}\DecValTok{2} \DecValTok{2} \CommentTok{NB. reference component table}
\NormalTok{CNRPATH}\AlertTok{=:}\index{CNRPATH@\texttt{CNRPATH}} \DecValTok{19}    \CommentTok{NB. file component: reference path {-} (didnum) list}
\NormalTok{CNSIZE}\AlertTok{=:}\index{CNSIZE@\texttt{CNSIZE}} \DecValTok{9}      \CommentTok{NB. file component: size of object in bytes}

\CommentTok{NB. inverted group and suite data file components}
\NormalTok{INVGROUPS}\AlertTok{=:}\index{INVGROUPS@\texttt{INVGROUPS}}\NormalTok{  CNPUTDATE}\KeywordTok{,}\NormalTok{CNCREATION}\KeywordTok{,}\NormalTok{CNEXPLAIN}
\NormalTok{INVSUITES}\AlertTok{=:}\index{INVSUITES@\texttt{INVSUITES}}\NormalTok{  INVGROUPS}

\CommentTok{NB. inverted macro and word data file components}
\NormalTok{INVMACROS}\AlertTok{=:}\index{INVMACROS@\texttt{INVMACROS}}\NormalTok{  CNCLASS}\KeywordTok{,}\NormalTok{CNPUTDATE}\KeywordTok{,}\NormalTok{CNCREATION}\KeywordTok{,}\NormalTok{CNSIZE}\KeywordTok{,}\NormalTok{CNEXPLAIN}
\NormalTok{INVWORDS}\AlertTok{=:}\index{INVWORDS@\texttt{INVWORDS}}\NormalTok{   INVMACROS}

\CommentTok{NB. inverted test data}
\NormalTok{INVTESTS}\AlertTok{=:}\index{INVTESTS@\texttt{INVTESTS}}\NormalTok{  CNPUTDATE}\KeywordTok{,}\NormalTok{CNCREATION}\KeywordTok{,}\NormalTok{CNSIZE}\KeywordTok{,}\NormalTok{CNEXPLAIN}

\CommentTok{NB. name.n or name.name separator character}
\NormalTok{NDOT}\AlertTok{=:}\index{NDOT@\texttt{NDOT}} \StringTok{\textquotesingle{}.\textquotesingle{}}

\CommentTok{NB. trim right (trailing) path delimiters !(*)=. PATHDEL}
\NormalTok{rpdtrim}\AlertTok{=:}\index{rpdtrim@\texttt{rpdtrim}} \KeywordTok{]} \KeywordTok{\#\textasciitilde{}} \KeywordTok{[:} \KeywordTok{{-}.} \KeywordTok{[:} \KeywordTok{*./\textbackslash{}.}\NormalTok{ PATHDEL}\KeywordTok{"}\NormalTok{\_ }\KeywordTok{=} \KeywordTok{]}

\CommentTok{NB. split backup name pattern cl}
\NormalTok{splitbname}\AlertTok{=:}\index{splitbname@\texttt{splitbname}}  \RegionMarkerTok{(}\NormalTok{NDOT}\KeywordTok{\&}\NormalTok{beforestr }\KeywordTok{;}\NormalTok{ NDOT}\KeywordTok{\&}\NormalTok{afterstr}\RegionMarkerTok{)}

\CommentTok{NB.*enddependents}
\CommentTok{NB.*end{-}header}
\end{Highlighting}
\end{Shaded}
\end{JODGroupHeader}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. initial documentation list: latex ; html ; text}
\NormalTok{DOCINIT}\AlertTok{=:}\index{DOCINIT@\texttt{DOCINIT}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{}   \textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR050}\AlertTok{=:}\index{ERR050@\texttt{ERR050}} \StringTok{\textquotesingle{}no dictionaries open\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR051}\AlertTok{=:}\index{ERR051@\texttt{ERR051}} \StringTok{\textquotesingle{}not a put dictionary {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR052}\AlertTok{=:}\index{ERR052@\texttt{ERR052}} \StringTok{\textquotesingle{}unable to initialize {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR053}\AlertTok{=:}\index{ERR053@\texttt{ERR053}} \StringTok{\textquotesingle{}word(s) do not exist {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR054}\AlertTok{=:}\index{ERR054@\texttt{ERR054}} \StringTok{\textquotesingle{}unable to load directory\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR055}\AlertTok{=:}\index{ERR055@\texttt{ERR055}} \StringTok{\textquotesingle{}directory{-}data inconsistency\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR056}\AlertTok{=:}\index{ERR056@\texttt{ERR056}} \StringTok{\textquotesingle{}jfile replace failure\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR057}\AlertTok{=:}\index{ERR057@\texttt{ERR057}} \StringTok{\textquotesingle{}directory update failure\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR058}\AlertTok{=:}\index{ERR058@\texttt{ERR058}} \StringTok{\textquotesingle{}jfile append failure\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR059}\AlertTok{=:}\index{ERR059@\texttt{ERR059}} \StringTok{\textquotesingle{}full rooted path required\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR060}\AlertTok{=:}\index{ERR060@\texttt{ERR060}} \StringTok{\textquotesingle{}unable to create directory {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR061}\AlertTok{=:}\index{ERR061@\texttt{ERR061}} \StringTok{\textquotesingle{}invalid dictionary name;path[;documentation]\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR062}\AlertTok{=:}\index{ERR062@\texttt{ERR062}} \StringTok{\textquotesingle{}invalid characters in name\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR063}\AlertTok{=:}\index{ERR063@\texttt{ERR063}} \StringTok{\textquotesingle{}invalid characters in path\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR064}\AlertTok{=:}\index{ERR064@\texttt{ERR064}} \StringTok{\textquotesingle{}target drive is required\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR065}\AlertTok{=:}\index{ERR065@\texttt{ERR065}} \StringTok{\textquotesingle{}not enough space on drive/volume {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR066}\AlertTok{=:}\index{ERR066@\texttt{ERR066}} \StringTok{\textquotesingle{}dictionary name in use\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR067}\AlertTok{=:}\index{ERR067@\texttt{ERR067}} \StringTok{\textquotesingle{}unable to create subdirectories\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR068}\AlertTok{=:}\index{ERR068@\texttt{ERR068}} \StringTok{\textquotesingle{}unable to setup dictionary file(s)\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR069}\AlertTok{=:}\index{ERR069@\texttt{ERR069}} \StringTok{\textquotesingle{}error updating master\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR070}\AlertTok{=:}\index{ERR070@\texttt{ERR070}} \StringTok{\textquotesingle{}request exceeds open limit\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR071}\AlertTok{=:}\index{ERR071@\texttt{ERR071}} \StringTok{\textquotesingle{}already open {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR072}\AlertTok{=:}\index{ERR072@\texttt{ERR072}} \StringTok{\textquotesingle{}another task opened read/write {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR073}\AlertTok{=:}\index{ERR073@\texttt{ERR073}} \StringTok{\textquotesingle{}missing dictionary file(s) {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR074}\AlertTok{=:}\index{ERR074@\texttt{ERR074}} \StringTok{\textquotesingle{}cannot read dictionary parameters {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR075}\AlertTok{=:}\index{ERR075@\texttt{ERR075}} \StringTok{\textquotesingle{}unable to open directory {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR076}\AlertTok{=:}\index{ERR076@\texttt{ERR076}} \StringTok{\textquotesingle{}master{-}dictionary inconsistency {-} try (dpset) {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR077}\AlertTok{=:}\index{ERR077@\texttt{ERR077}} \StringTok{\textquotesingle{}unable to update master\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR079}\AlertTok{=:}\index{ERR079@\texttt{ERR079}} \StringTok{\textquotesingle{}unable to load references\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR080}\AlertTok{=:}\index{ERR080@\texttt{ERR080}} \StringTok{\textquotesingle{}not open {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR081}\AlertTok{=:}\index{ERR081@\texttt{ERR081}} \StringTok{\textquotesingle{}path mismatch\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR082}\AlertTok{=:}\index{ERR082@\texttt{ERR082}} \StringTok{\textquotesingle{}unable to set reference path\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR083}\AlertTok{=:}\index{ERR083@\texttt{ERR083}} \StringTok{\textquotesingle{}not on path {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR084}\AlertTok{=:}\index{ERR084@\texttt{ERR084}} \StringTok{\textquotesingle{}unable to read data\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR085}\AlertTok{=:}\index{ERR085@\texttt{ERR085}} \StringTok{\textquotesingle{}words(s) not defined {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR086}\AlertTok{=:}\index{ERR086@\texttt{ERR086}} \StringTok{\textquotesingle{}not in put dictionary {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR087}\AlertTok{=:}\index{ERR087@\texttt{ERR087}} \StringTok{\textquotesingle{}nothing in put dictionary\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR088}\AlertTok{=:}\index{ERR088@\texttt{ERR088}} \StringTok{\textquotesingle{}jfile read failure\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR089}\AlertTok{=:}\index{ERR089@\texttt{ERR089}} \StringTok{\textquotesingle{}text(s) to long\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR090}\AlertTok{=:}\index{ERR090@\texttt{ERR090}} \StringTok{\textquotesingle{}file offset invalid\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR091}\AlertTok{=:}\index{ERR091@\texttt{ERR091}} \StringTok{\textquotesingle{}definition failure\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR092}\AlertTok{=:}\index{ERR092@\texttt{ERR092}} \StringTok{\textquotesingle{}duplicate dictionary id number\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR093}\AlertTok{=:}\index{ERR093@\texttt{ERR093}} \StringTok{\textquotesingle{}directory damaged\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR094}\AlertTok{=:}\index{ERR094@\texttt{ERR094}} \StringTok{\textquotesingle{}exceeds locale symbol table size {-} no words defined\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR095}\AlertTok{=:}\index{ERR095@\texttt{ERR095}} \StringTok{\textquotesingle{}dictionary file attributes do not allow read/write {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR096}\AlertTok{=:}\index{ERR096@\texttt{ERR096}} \StringTok{\textquotesingle{}linux/unix dictionary paths must be / rooted {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR097}\AlertTok{=:}\index{ERR097@\texttt{ERR097}} \StringTok{\textquotesingle{}invalid dictionary document must be character list\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR098}\AlertTok{=:}\index{ERR098@\texttt{ERR098}} \StringTok{\textquotesingle{}master/dictionary file path mismatch {-} name/DIDNUM {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR099}\AlertTok{=:}\index{ERR099@\texttt{ERR099}} \StringTok{\textquotesingle{}invalid name/creation/lastput table\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR100}\AlertTok{=:}\index{ERR100@\texttt{ERR100}} \StringTok{\textquotesingle{}name/creation/lastput length mismatch\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR101}\AlertTok{=:}\index{ERR101@\texttt{ERR101}} \StringTok{\textquotesingle{}invalid date(s) name/creation/lastput table\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR102}\AlertTok{=:}\index{ERR102@\texttt{ERR102}} \StringTok{\textquotesingle{}timestamp table shape invalid\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR103}\AlertTok{=:}\index{ERR103@\texttt{ERR103}} \StringTok{\textquotesingle{}no backup(s) to restore or search\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR104}\AlertTok{=:}\index{ERR104@\texttt{ERR104}} \StringTok{\textquotesingle{}no registered dictionaries\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR105}\AlertTok{=:}\index{ERR105@\texttt{ERR105}} \StringTok{\textquotesingle{}unreadable or missing backup timestamp\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR106}\AlertTok{=:}\index{ERR106@\texttt{ERR106}} \StringTok{\textquotesingle{}invalid backup number(s)\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR107}\AlertTok{=:}\index{ERR107@\texttt{ERR107}} \StringTok{\textquotesingle{}not in backup(s) {-}> \textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. directory and reserved components in *.ijf files}
\NormalTok{OFFSET}\AlertTok{=:}\index{OFFSET@\texttt{OFFSET}} \DecValTok{39}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK050}\AlertTok{=:}\index{OK050@\texttt{OK050}} \StringTok{\textquotesingle{}dictionary created {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK051}\AlertTok{=:}\index{OK051@\texttt{OK051}} \StringTok{\textquotesingle{} word(s) put in {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK052}\AlertTok{=:}\index{OK052@\texttt{OK052}} \StringTok{\textquotesingle{}opened (\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK054}\AlertTok{=:}\index{OK054@\texttt{OK054}} \StringTok{\textquotesingle{}closed {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK055}\AlertTok{=:}\index{OK055@\texttt{OK055}} \StringTok{\textquotesingle{} explanation(s) put in {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK056}\AlertTok{=:}\index{OK056@\texttt{OK056}} \StringTok{\textquotesingle{} references put in {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK057}\AlertTok{=:}\index{OK057@\texttt{OK057}} \StringTok{\textquotesingle{}(s) put in {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK058}\AlertTok{=:}\index{OK058@\texttt{OK058}} \StringTok{\textquotesingle{}dictionary registered {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK059}\AlertTok{=:}\index{OK059@\texttt{OK059}} \StringTok{\textquotesingle{}put in {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK060}\AlertTok{=:}\index{OK060@\texttt{OK060}} \StringTok{\textquotesingle{} word(s) defined\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK061}\AlertTok{=:}\index{OK061@\texttt{OK061}} \StringTok{\textquotesingle{}(s) deleted from {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK062}\AlertTok{=:}\index{OK062@\texttt{OK062}} \StringTok{\textquotesingle{}dictionary document updated {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK063}\AlertTok{=:}\index{OK063@\texttt{OK063}} \StringTok{\textquotesingle{}(DOCUMENTDICT = 0) {-} dictionary document not updated {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK064}\AlertTok{=:}\index{OK064@\texttt{OK064}} \StringTok{\textquotesingle{}) timestamps updated {-} (\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK065}\AlertTok{=:}\index{OK065@\texttt{OK065}} \StringTok{\textquotesingle{}) not in put {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. path report title}
\NormalTok{PATHTIT}\AlertTok{=:}\index{PATHTIT@\texttt{PATHTIT}} \StringTok{\textquotesingle{}Path*\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. visible read status text}
\NormalTok{READSTATS}\AlertTok{=:}\index{READSTATS@\texttt{READSTATS}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} ro rw\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. retains string (y) after last occurrence of (x)}
\NormalTok{afterlaststr}\AlertTok{=:}\index{afterlaststr@\texttt{afterlaststr}} \KeywordTok{]} \KeywordTok{\}.\textasciitilde{}} \KeywordTok{\#@[} \KeywordTok{+} \DecValTok{1}\KeywordTok{\&}\RegionMarkerTok{(}\KeywordTok{i:\textasciitilde{}}\RegionMarkerTok{)}\KeywordTok{@}\RegionMarkerTok{(}\KeywordTok{[} \KeywordTok{E.} \KeywordTok{]}\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. contains string in lists of list of names}
\NormalTok{allnlctn}\AlertTok{=:}\index{allnlctn@\texttt{allnlctn}} \KeywordTok{[} \KeywordTok{/:\textasciitilde{}@:}\NormalTok{nlctn}\KeywordTok{\&.>} \KeywordTok{[:} \KeywordTok{<} \KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. match prefixes in lists of lists of names {-} (pathnl) related}
\NormalTok{allnlpfx}\AlertTok{=:}\index{allnlpfx@\texttt{allnlpfx}} \KeywordTok{[} \KeywordTok{/:\textasciitilde{}@:}\NormalTok{nlpfx}\KeywordTok{\&.>} \KeywordTok{[:} \KeywordTok{<} \KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. match suffixes in lists of lists of names}
\NormalTok{allnlsfx}\AlertTok{=:}\index{allnlsfx@\texttt{allnlsfx}} \KeywordTok{[} \KeywordTok{/:\textasciitilde{}@:}\NormalTok{nlsfx}\KeywordTok{\&.>} \KeywordTok{[:} \KeywordTok{<} \KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{apptable}\AlertTok{=:}\index{apptable@\texttt{apptable}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*apptable v{-}{-} appends (name,text) and (name,class,text) tables to file.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  bl apptable bt}

\StringTok{\textquotesingle{}ttype ixn cnn fp DL\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}  \CommentTok{NB. directory object !(*)=. DL}
\NormalTok{sizes}\KeywordTok{=.} \KeywordTok{\#\&>} \KeywordTok{\{:"}\DecValTok{1} \KeywordTok{y}         \CommentTok{NB. sizes}
\NormalTok{pf}\KeywordTok{=.}\NormalTok{ PUTFACTOR}\DecValTok{\_\_}\NormalTok{DL}

\CommentTok{NB. words and macros have class or type}
\KeywordTok{if.}\NormalTok{ wmt}\KeywordTok{=.}\NormalTok{ ttype }\KeywordTok{e.}\NormalTok{ WORD}\KeywordTok{,}\NormalTok{MACRO }\KeywordTok{do.}\NormalTok{ class }\KeywordTok{=.} \KeywordTok{;} \DecValTok{1} \KeywordTok{\{"}\DecValTok{1} \KeywordTok{y} \KeywordTok{end.}

\NormalTok{texts}\KeywordTok{=.} \KeywordTok{y}
\NormalTok{cnall}\KeywordTok{=.} \KeywordTok{i.}\DecValTok{0}
\KeywordTok{y=.} \KeywordTok{\{."}\DecValTok{1} \KeywordTok{y}   \CommentTok{NB. no longer required}

\KeywordTok{while.} \KeywordTok{\#}\NormalTok{texts }\KeywordTok{do.}
\NormalTok{  cnt}\KeywordTok{=.}\NormalTok{ pf }\KeywordTok{<.} \KeywordTok{\#}\NormalTok{texts}
\NormalTok{  tn}\KeywordTok{=.}\NormalTok{  cnt }\KeywordTok{\{.}\NormalTok{ texts}

\NormalTok{  un0}\KeywordTok{=.} \KeywordTok{<"}\DecValTok{1}\NormalTok{ tn}
\NormalTok{  un1}\KeywordTok{=.} \KeywordTok{<"}\DecValTok{1} \RegionMarkerTok{(}\KeywordTok{\{."}\DecValTok{1}\NormalTok{ tn}\RegionMarkerTok{)} \KeywordTok{,"}\DecValTok{0} \DecValTok{1}\NormalTok{ DOCINIT}

  \KeywordTok{if.}\NormalTok{ badappend cn}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{,}\NormalTok{ un0 }\KeywordTok{,.}\NormalTok{ un1}\RegionMarkerTok{)}\NormalTok{ jappend fp }\KeywordTok{do.}
\NormalTok{    jderr ERR058 }\KeywordTok{return.}  \CommentTok{NB. errmsg: append failure}
  \KeywordTok{else.}
\NormalTok{    cnall}\KeywordTok{=.}\NormalTok{ cnall }\KeywordTok{,}\NormalTok{ fod cn}
  \KeywordTok{end.}

\NormalTok{  texts}\KeywordTok{=.}\NormalTok{ cnt }\KeywordTok{\}.}\NormalTok{ texts}
\KeywordTok{end.}

\CommentTok{NB. append directory and inverted lists}
\NormalTok{msg}\KeywordTok{=.}\NormalTok{ ERR057  }\CommentTok{NB. errmsg: directory update failure}
\KeywordTok{if.} \RegionMarkerTok{(}\NormalTok{tc}\KeywordTok{=.} \KeywordTok{\#y}\RegionMarkerTok{)} \KeywordTok{\textasciitilde{}:} \KeywordTok{\#}\NormalTok{cnall }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{return.} \KeywordTok{end.}

\NormalTok{stamp}\KeywordTok{=.}\NormalTok{ tc}\KeywordTok{\#}\NormalTok{nowfd now }\StringTok{\textquotesingle{}\textquotesingle{}}
\NormalTok{un0}\KeywordTok{=.}\NormalTok{ stamp}\KeywordTok{;}\NormalTok{stamp}\KeywordTok{;}\NormalTok{sizes}\KeywordTok{;<}\NormalTok{tc}\KeywordTok{\#a:}
\NormalTok{un1}\KeywordTok{=.}\NormalTok{ CNPUTDATE}\KeywordTok{,}\NormalTok{CNCREATION}\KeywordTok{,}\NormalTok{CNSIZE}\KeywordTok{,}\NormalTok{CNEXPLAIN}

\KeywordTok{if.}\NormalTok{ wmt }\KeywordTok{do.}
\NormalTok{  dropnc}\DecValTok{\_\_}\NormalTok{DL ttype  }\CommentTok{NB. force class reload}
\NormalTok{  un0}\KeywordTok{=.}\NormalTok{ class}\KeywordTok{;}\NormalTok{un0}
\NormalTok{  un1}\KeywordTok{=.}\NormalTok{ CNCLASS}\KeywordTok{,}\NormalTok{un1}
\KeywordTok{end.}

\KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{ un0 invappend fp}\KeywordTok{;}\NormalTok{un1 }\KeywordTok{do.}\NormalTok{ msg}
\KeywordTok{else.}
  \CommentTok{NB. update directory}
  \KeywordTok{y=.}    \RegionMarkerTok{(}\KeywordTok{".}\NormalTok{ixn}\RegionMarkerTok{)} \KeywordTok{,} \KeywordTok{y}
\NormalTok{  cnall}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{".}\NormalTok{cnn}\RegionMarkerTok{)} \KeywordTok{,}\NormalTok{ cnall}
  \KeywordTok{if.}\NormalTok{ badrc }\RegionMarkerTok{(}\NormalTok{ttype}\KeywordTok{,}\NormalTok{fp}\RegionMarkerTok{)}\NormalTok{ savedir}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{y;}\NormalTok{cnall }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{else.}\NormalTok{ ok tc }\KeywordTok{end.}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{appwords}\AlertTok{=:}\index{appwords@\texttt{appwords}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*appwords v{-}{-} appends new words in blocks of (PUTFACTOR).}

\StringTok{\textquotesingle{}loc DL\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}  \CommentTok{NB. directory object !(*)=. DL}
\NormalTok{wp}\KeywordTok{=.}\NormalTok{ WP}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{[}\NormalTok{ pf}\KeywordTok{=.}\NormalTok{ PUTFACTOR}\DecValTok{\_\_}\NormalTok{DL}
\NormalTok{names}\KeywordTok{=.} \KeywordTok{y}
\NormalTok{lnames}\KeywordTok{=.} \KeywordTok{y} \KeywordTok{,\&.>}\NormalTok{ locsfx loc}
\NormalTok{size}\KeywordTok{=.}\NormalTok{ class}\KeywordTok{=.}\NormalTok{ cnall}\KeywordTok{=.} \KeywordTok{i.}\DecValTok{0}

\KeywordTok{while.} \KeywordTok{\#}\NormalTok{names }\KeywordTok{do.}
\NormalTok{  cnt}\KeywordTok{=.}\NormalTok{ pf }\KeywordTok{<.} \KeywordTok{\#}\NormalTok{names}
\NormalTok{  wn}\KeywordTok{=.}\NormalTok{  cnt }\KeywordTok{\{.}\NormalTok{ names }\KeywordTok{[}\NormalTok{ lwn}\KeywordTok{=.}\NormalTok{ cnt }\KeywordTok{\{.}\NormalTok{ lnames}
\NormalTok{  val}\KeywordTok{=.}\NormalTok{ wrep}\KeywordTok{\&.>}\NormalTok{ lwn   }\CommentTok{NB. word values}
\NormalTok{  bsz}\KeywordTok{=.} \KeywordTok{\#\&>}\NormalTok{ val       }\CommentTok{NB. NIMP word byte sizes (size testing)}
\NormalTok{  bnc}\KeywordTok{=.}\NormalTok{ nc lwn}
\NormalTok{  un0}\KeywordTok{=.} \KeywordTok{<"}\DecValTok{1}\NormalTok{ wn }\KeywordTok{,.} \RegionMarkerTok{(}\KeywordTok{<"}\DecValTok{0}\NormalTok{ bnc}\RegionMarkerTok{)} \KeywordTok{,.}\NormalTok{ val}
\NormalTok{  un1}\KeywordTok{=.} \KeywordTok{<"}\DecValTok{1}\NormalTok{ wn }\KeywordTok{,"}\DecValTok{0} \DecValTok{1}\NormalTok{ DOCINIT}

  \CommentTok{NB. append words}
  \KeywordTok{if.}\NormalTok{ badappend cn}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{,}\NormalTok{ un0 }\KeywordTok{,.}\NormalTok{ un1}\RegionMarkerTok{)}\NormalTok{ jappend wp }\KeywordTok{do.}
\NormalTok{    jderr ERR058 }\KeywordTok{return.}  \CommentTok{NB. errmsg: append failure}
  \KeywordTok{else.}
\NormalTok{    cnall}\KeywordTok{=.}\NormalTok{ cnall }\KeywordTok{,}\NormalTok{ fod cn}
\NormalTok{    size}\KeywordTok{=.}\NormalTok{  size }\KeywordTok{,}\NormalTok{ bsz}
\NormalTok{    class}\KeywordTok{=.}\NormalTok{ class }\KeywordTok{,}\NormalTok{ bnc}
  \KeywordTok{end.}

\NormalTok{  names }\KeywordTok{=.}\NormalTok{ cnt }\KeywordTok{\}.}\NormalTok{ names }\KeywordTok{[}\NormalTok{ lnames }\KeywordTok{=.}\NormalTok{ cnt }\KeywordTok{\}.}\NormalTok{ lnames}
\KeywordTok{end.}

\CommentTok{NB. append directory and inverted lists}
\NormalTok{msg}\KeywordTok{=.}\NormalTok{ ERR057  }\CommentTok{NB. errmsg: directory update failure}
\KeywordTok{if.} \RegionMarkerTok{(}\KeywordTok{\#y}\RegionMarkerTok{)} \KeywordTok{\textasciitilde{}:} \KeywordTok{\#}\NormalTok{cnall }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{wc}\KeywordTok{=.} \KeywordTok{\#y}  \CommentTok{NB. number of words}

\NormalTok{stamp}\KeywordTok{=.}\NormalTok{ wc}\KeywordTok{\#}\NormalTok{nowfd now }\StringTok{\textquotesingle{}\textquotesingle{}}
\NormalTok{un0}\KeywordTok{=.}\NormalTok{ class}\KeywordTok{;}\NormalTok{stamp}\KeywordTok{;}\NormalTok{stamp}\KeywordTok{;}\NormalTok{size}\KeywordTok{;<}\NormalTok{wc}\KeywordTok{\#a:}
\NormalTok{un1}\KeywordTok{=.}\NormalTok{ CNCLASS}\KeywordTok{,}\NormalTok{CNPUTDATE}\KeywordTok{,}\NormalTok{CNCREATION}\KeywordTok{,}\NormalTok{CNSIZE}\KeywordTok{,}\NormalTok{CNEXPLAIN }\CommentTok{NB. NIMP word append}
\KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{ un0 invappend wp}\KeywordTok{;}\NormalTok{un1 }\KeywordTok{do.}\NormalTok{ msg}
\KeywordTok{else.}
  \CommentTok{NB. update word directory}
  \KeywordTok{y=.}\NormalTok{    WORDIX}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{,} \KeywordTok{y}
\NormalTok{  cnall}\KeywordTok{=.}\NormalTok{ WORDCN}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{,}\NormalTok{ cnall}
  \KeywordTok{if.}\NormalTok{ badrc }\RegionMarkerTok{(}\NormalTok{WORD}\KeywordTok{,}\NormalTok{wp}\RegionMarkerTok{)}\NormalTok{ savedir}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{y;}\NormalTok{cnall }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{else.}\NormalTok{ ok wc }\KeywordTok{end.}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{backupdates}\AlertTok{=:}\index{backupdates@\texttt{backupdates}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*backupdates v{-}{-} scans put dictionary backup files and returns}
\CommentTok{NB. backup dates.}
\CommentTok{NB.}
\CommentTok{NB. This  verb  attempts  to   read  component  index  1  of  put}
\CommentTok{NB. dictionary  (jwords)  backup files.  The resulting data takes}
\CommentTok{NB. these possible forms.}
\CommentTok{NB.}
\CommentTok{NB. verbatim:}
\CommentTok{NB.}
\CommentTok{NB.   1. bnum,timestamp {-} pack count and timestamp}
\CommentTok{NB.   2. bnum,0         {-} pack count and 0}
\CommentTok{NB.   3. \_1\textasciigrave{}            {-} jread error {-} probably an older unreadable binary}
\CommentTok{NB.   4. \_2             {-} trapped jread error {-} serious problemos}
\CommentTok{NB.}
\CommentTok{NB. dyad:  bt =. blObj backupdates ilBnums}
\CommentTok{NB.}
\CommentTok{NB.   NB. DL is put dictionary object}
\CommentTok{NB.   NB. bnums is a list of put dictionary backup numbers}
\CommentTok{NB.}
\CommentTok{NB.   DL backupdates bnums}

\CommentTok{NB. HARDCODE: component 1}
\NormalTok{uv}\KeywordTok{=.} \KeywordTok{>}\NormalTok{jread}\KeywordTok{"}\DecValTok{1} \RegionMarkerTok{(}\KeywordTok{<}\DecValTok{1}\RegionMarkerTok{)} \KeywordTok{,.\textasciitilde{}}  \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{BAK\_\_}\KeywordTok{x}\RegionMarkerTok{)} \KeywordTok{,\&.>} \RegionMarkerTok{(}\KeywordTok{":\&.>} \KeywordTok{<"}\DecValTok{0} \KeywordTok{y}\RegionMarkerTok{)} \KeywordTok{,\&.>} \DecValTok{0}\KeywordTok{\{}\NormalTok{JDFILES}
\NormalTok{bstamps}\KeywordTok{=.} \KeywordTok{\}."}\DecValTok{1}\NormalTok{ uv }\KeywordTok{[}\NormalTok{ bn}\KeywordTok{=.} \DecValTok{0} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ uv}

\CommentTok{NB. format timestamps}
\NormalTok{bstamps}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<"}\DecValTok{0}\NormalTok{ bn}\RegionMarkerTok{)} \KeywordTok{,.} \KeywordTok{<"}\DecValTok{1}\NormalTok{ tstamp}\KeywordTok{"}\DecValTok{1}\NormalTok{ bstamps}

\CommentTok{NB. errmsg: unreadable or missing backup timestamp}
\NormalTok{bstamps}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{ERR105}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{<}\RegionMarkerTok{(}\KeywordTok{I.} \DecValTok{0}\KeywordTok{>}\NormalTok{bn}\RegionMarkerTok{)}\KeywordTok{;}\DecValTok{1}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ bstamps}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. bad jfile components {-} first names do not match list}
\NormalTok{badcn}\AlertTok{=:}\index{badcn@\texttt{badcn}} \KeywordTok{[:} \KeywordTok{{-}.} \KeywordTok{[} \KeywordTok{{-}:} \KeywordTok{[:} \KeywordTok{\{.\&>} \KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bchecknames}\AlertTok{=:}\index{bchecknames@\texttt{bchecknames}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*bchecknames v{-}{-} checks backup name patterns.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  ilObjBn bchecknames blclBnames}
\CommentTok{NB.}
\CommentTok{NB.   NB. valid ordered put dictionary backup numbers}
\CommentTok{NB.   bn=. rv\_ajod\_ checkback\_\_ST\_\_JODobj \_1\{0\{DPATH\_\_ST\_\_JODobj}
\CommentTok{NB.}
\CommentTok{NB.   NB. first item of (x) is a dictionary object code}
\CommentTok{NB.   (WORD,bn) bchecknames\_\_ST\_\_JODobj <;.\_1\textquotesingle{} booo hhh re.12 bx.14 er.99\textquotesingle{}}
\CommentTok{NB.}
\CommentTok{NB.   NB. names are not required for the special DICTIONARY case}
\CommentTok{NB.   (DICTIONARY,bn) bchecknames\_\_ST\_\_JODobj <;.\_1\textquotesingle{} .71 .73 .65\textquotesingle{}}

\CommentTok{NB. errmsg: invalid name pattern(s)}
\KeywordTok{if.} \KeywordTok{+./}\NormalTok{ badcl}\KeywordTok{\&>} \KeywordTok{y} \KeywordTok{do.}\NormalTok{ jderr ERR010 }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. split backup name patterns}
\NormalTok{nbk}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{splitbname}\KeywordTok{\&>} \KeywordTok{y}\RegionMarkerTok{)} \KeywordTok{{-}.\&.>} \StringTok{\textquotesingle{} \textquotesingle{}}

\CommentTok{NB. if backup number is absent use most recent}
\NormalTok{nbk}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<":}\DecValTok{1}\KeywordTok{\{x}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{<}\RegionMarkerTok{(}\KeywordTok{I.} \DecValTok{0} \KeywordTok{=} \KeywordTok{\#\&>} \DecValTok{1} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ nbk}\RegionMarkerTok{)}\KeywordTok{;}\DecValTok{1}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ nbk}

\CommentTok{NB. names must be valid}
\KeywordTok{if.}\NormalTok{ DICTIONARY }\KeywordTok{=} \DecValTok{0}\KeywordTok{\{x} \KeywordTok{do.}\NormalTok{ bnm}\KeywordTok{=.} \DecValTok{0} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ nbk}
\KeywordTok{elseif.}\NormalTok{ badrc bnm}\KeywordTok{=.}\NormalTok{ checknames }\DecValTok{0} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ nbk }\KeywordTok{do.}\NormalTok{ bnm }\KeywordTok{return.}
\KeywordTok{elseif.do.}\NormalTok{ bnm}\KeywordTok{=.} \KeywordTok{\}.}\NormalTok{bnm}
\KeywordTok{end.}

\CommentTok{NB. backup numbers must be valid}
\KeywordTok{if.} \DecValTok{0} \KeywordTok{e.} \RegionMarkerTok{(}\DecValTok{1} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ nbk}\RegionMarkerTok{)} \KeywordTok{*./@e.\&>} \KeywordTok{<}\NormalTok{DIGITS }\KeywordTok{do.}\NormalTok{ jderr ERR106 }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{bn}\KeywordTok{=.} \KeywordTok{,} \DecValTok{\_1}\KeywordTok{\&".\&>} \DecValTok{1} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ nbk}

\CommentTok{NB. errmsg: invalid backup number(s)}
\KeywordTok{if.} \DecValTok{0} \KeywordTok{e.}\NormalTok{ bn }\KeywordTok{e.} \KeywordTok{x} \KeywordTok{do.}\NormalTok{ jderr ERR106 }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. return unique checked names and backup numbers}
\NormalTok{ok }\KeywordTok{<\textasciitilde{}.}\NormalTok{bnm }\KeywordTok{,.} \KeywordTok{<"}\DecValTok{0}\NormalTok{ bn}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bgetdicdoc}\AlertTok{=:}\index{bgetdicdoc@\texttt{bgetdicdoc}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*bgetdicdoc v{-}{-} get backup versions of the dictionary document.}
\CommentTok{NB.}
\CommentTok{NB. monad:  bgetdicdoc btNameBn}

\CommentTok{NB. there is only one document per dictionary unique}
\CommentTok{NB. dictionary backup numbers insure no redundant file reads}
\NormalTok{bn}\KeywordTok{=.} \KeywordTok{\textasciitilde{}.}\DecValTok{1} \KeywordTok{\{"}\DecValTok{1} \KeywordTok{y}

\CommentTok{NB. put dictionary object  !(*)=. doj}
\NormalTok{doj}\KeywordTok{=.} \KeywordTok{\{:\{.}\NormalTok{DPATH}

\CommentTok{NB. dictionary document results combine dictionary name}
\CommentTok{NB. with backup numbers to differentiate versions}
\CommentTok{NB. NOTE: the resulting label may not be a valid J name}
\CommentTok{NB. unless the JOD dictionary name is a valid J name.}
\NormalTok{ro}\KeywordTok{=.} \RegionMarkerTok{((}\KeywordTok{<}\NormalTok{DNAME\_\_doj}\RegionMarkerTok{)} \KeywordTok{,\&.>} \StringTok{\textquotesingle{}\_\textquotesingle{}} \KeywordTok{,\&.>} \KeywordTok{":\&.>}\NormalTok{ bn}\RegionMarkerTok{)} \KeywordTok{,.} \KeywordTok{a:}

\CommentTok{NB. backup path and file suffix}
\StringTok{\textquotesingle{}pth fsx\textquotesingle{}}\KeywordTok{=.}\NormalTok{ bpathsfx WORD}

\NormalTok{ubn}\KeywordTok{=.} \KeywordTok{;}\NormalTok{bn}
\KeywordTok{for\_bob.}\NormalTok{ ubn }\KeywordTok{do.}

\NormalTok{  fn}\KeywordTok{=.}\NormalTok{ pth}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{":}\NormalTok{bob}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{fsx }\CommentTok{NB. backup file}

  \CommentTok{NB. read document component}
  \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread fn}\KeywordTok{;}\NormalTok{CNDICDOC }\KeywordTok{do.}\NormalTok{ jderr ERR088 }\KeywordTok{return.} \KeywordTok{end.}

  \CommentTok{NB. update results}
\NormalTok{  ro}\KeywordTok{=.}\NormalTok{ dat }\RegionMarkerTok{(}\KeywordTok{<}\RegionMarkerTok{(}\KeywordTok{I.}\NormalTok{ bob}\KeywordTok{=}\NormalTok{ubn}\RegionMarkerTok{)}\KeywordTok{;}\DecValTok{1}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ ro}

\KeywordTok{end.}

\CommentTok{NB. insure any empty documents have literal datatype}
\NormalTok{ok }\KeywordTok{<}\NormalTok{btextlit ro}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bgetexplain}\AlertTok{=:}\index{bgetexplain@\texttt{bgetexplain}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*bgetexplain v{-}{-} get short explanations from backups.}
\CommentTok{NB.}
\CommentTok{NB. dyad: il bgetexplain btNameBn}

\CommentTok{NB. object names}
\NormalTok{nnm}\KeywordTok{=.} \DecValTok{0} \KeywordTok{\{"}\DecValTok{1} \KeywordTok{y} \KeywordTok{[}\NormalTok{ obj}\KeywordTok{=.} \DecValTok{0}\KeywordTok{\{x}

\CommentTok{NB. results are boxed name literal value tables}
\NormalTok{ro}\KeywordTok{=.}\NormalTok{ nnm }\KeywordTok{,.} \KeywordTok{<,}\StringTok{\textquotesingle{}\textquotesingle{}}

\StringTok{\textquotesingle{}pth fsx\textquotesingle{}}\KeywordTok{=.}\NormalTok{ bpathsfx obj}

\CommentTok{NB. fetch backup objects by backup number {-} optimizes file reads}
\NormalTok{cpm}\KeywordTok{=.}\NormalTok{ CNLIST}\KeywordTok{,}\NormalTok{CNEXPLAIN}
\NormalTok{ubn}\KeywordTok{=.} \KeywordTok{\textasciitilde{}.}\NormalTok{bn}\KeywordTok{=.} \KeywordTok{;} \DecValTok{1} \KeywordTok{\{"}\DecValTok{1} \KeywordTok{y}
\KeywordTok{for\_bob.}\NormalTok{ ubn }\KeywordTok{do.}

\NormalTok{  fn}\KeywordTok{=.}\NormalTok{ pth}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{":}\NormalTok{bob}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{fsx }\CommentTok{NB. backup file}

  \CommentTok{NB. read backup explanations errmsg: read failure}
  \KeywordTok{if.}\NormalTok{ badjr }\StringTok{\textquotesingle{}ixn sex\textquotesingle{}}\KeywordTok{=.}\NormalTok{ jread fn}\KeywordTok{;}\NormalTok{cpm }\KeywordTok{do.}\NormalTok{ jderr ERR088 }\KeywordTok{return.} \KeywordTok{end.}

  \CommentTok{NB. explanations must exist in backup(s) errmsg: not in backups {-}>}
\NormalTok{  sn}\KeywordTok{=.}\NormalTok{ nnm }\KeywordTok{\{\textasciitilde{}}\NormalTok{ rx}\KeywordTok{=.} \KeywordTok{I.}\NormalTok{ bob}\KeywordTok{=}\NormalTok{bn}
  \KeywordTok{if.} \DecValTok{0} \KeywordTok{e.}\NormalTok{ uv}\KeywordTok{=.}\NormalTok{ sn }\KeywordTok{e.}\NormalTok{ ixn }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR107}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\NormalTok{sn }\KeywordTok{\#\textasciitilde{}} \KeywordTok{{-}.}\NormalTok{uv}\RegionMarkerTok{)} \KeywordTok{,\&.>} \KeywordTok{<}\NormalTok{NDOT}\KeywordTok{,":}\NormalTok{bob }\KeywordTok{return.} \KeywordTok{end.}

  \CommentTok{NB. update results}
\NormalTok{  ro}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{sex }\KeywordTok{\{\textasciitilde{}}\NormalTok{ ixn }\KeywordTok{i.}\NormalTok{ sn}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{rx}\KeywordTok{;}\DecValTok{1}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ ro}

  \CommentTok{NB. distinquish object names with backup number suffix}
\NormalTok{  ro}\KeywordTok{=.} \RegionMarkerTok{(((}\KeywordTok{<}\NormalTok{rx}\KeywordTok{;}\DecValTok{0}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{ro}\RegionMarkerTok{)} \KeywordTok{,\&.>} \KeywordTok{<}\StringTok{\textquotesingle{}\_\textquotesingle{}}\KeywordTok{,":}\NormalTok{bob}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{rx}\KeywordTok{;}\DecValTok{0}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ ro}

\KeywordTok{end.}

\CommentTok{NB. insure any empty explanations have literal datatype}
\NormalTok{ok }\KeywordTok{<}\NormalTok{btextlit ro}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bgetgstext}\AlertTok{=:}\index{bgetgstext@\texttt{bgetgstext}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*bgetgstext v{-}{-} get backup versions of group/suite headers.}
\CommentTok{NB.}
\CommentTok{NB. dyad: il bgetobjects btNameBn}

\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{x,}\DecValTok{0}\RegionMarkerTok{)}\NormalTok{ bgetobjects }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{else.}\NormalTok{ ok }\KeywordTok{<}\DecValTok{0} \DecValTok{1} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ rv uv }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bgetobjects}\AlertTok{=:}\index{bgetobjects@\texttt{bgetobjects}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*bgetobjects v{-}{-} get objects from backups.}
\CommentTok{NB.}
\CommentTok{NB. dyad: il bgetobjects btNameBn}

\CommentTok{NB. object code, offset and names}
\NormalTok{nnm}\KeywordTok{=.} \DecValTok{0} \KeywordTok{\{"}\DecValTok{1} \KeywordTok{y} \KeywordTok{[} \StringTok{\textquotesingle{}obj offset\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}

\CommentTok{NB. HARDCODE: 2 indicates fetching group/suite list(s)}
\NormalTok{offset}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{bgslist}\KeywordTok{=.}\NormalTok{ offset}\KeywordTok{=}\DecValTok{2}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{offset}\KeywordTok{,}\DecValTok{0}

\CommentTok{NB. results are boxed name value tables}
\CommentTok{NB. words \& macro have three columns}
\NormalTok{ro}\KeywordTok{=.}\NormalTok{ nnm }\KeywordTok{,"}\DecValTok{0} \DecValTok{1} \RegionMarkerTok{(}\DecValTok{1} \KeywordTok{+} \RegionMarkerTok{(}\NormalTok{offset}\KeywordTok{=}\DecValTok{0}\RegionMarkerTok{)} \KeywordTok{*}\NormalTok{ obj }\KeywordTok{e.}\NormalTok{ WORD}\KeywordTok{,}\NormalTok{MACRO}\RegionMarkerTok{)}\KeywordTok{$a:}

\CommentTok{NB. HARDCODE: result columns}
\NormalTok{cols}\KeywordTok{=.} \DecValTok{0} \DecValTok{\_1}
\KeywordTok{if.} \RegionMarkerTok{(}\DecValTok{0}\KeywordTok{=}\NormalTok{offset}\RegionMarkerTok{)} \KeywordTok{*.} \KeywordTok{{-}.}\NormalTok{bgslist }\KeywordTok{do.}\NormalTok{ cols}\KeywordTok{=.} \KeywordTok{i.} \KeywordTok{\{:$}\NormalTok{ro }\KeywordTok{end.}

\CommentTok{NB. backup path and file suffix}
\StringTok{\textquotesingle{}pth fsx\textquotesingle{}}\KeywordTok{=.}\NormalTok{ bpathsfx obj}

\CommentTok{NB. fetch backup objects by backup number {-} optimizes file reads}
\NormalTok{cpm}\KeywordTok{=.}\NormalTok{ CNLIST}\KeywordTok{,}\NormalTok{CNCOMPS}
\NormalTok{ubn}\KeywordTok{=.} \KeywordTok{\textasciitilde{}.}\NormalTok{bn}\KeywordTok{=.} \KeywordTok{;} \DecValTok{1} \KeywordTok{\{"}\DecValTok{1} \KeywordTok{y}
\KeywordTok{for\_bob.}\NormalTok{ ubn }\KeywordTok{do.}

\NormalTok{  fn}\KeywordTok{=.}\NormalTok{ pth}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{":}\NormalTok{bob}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{fsx }\CommentTok{NB. backup file}

  \CommentTok{NB. read backup directory index  errmsg: read failure}
  \KeywordTok{if.}\NormalTok{ badjr }\StringTok{\textquotesingle{}ixn ixc\textquotesingle{}}\KeywordTok{=.}\NormalTok{ jread fn}\KeywordTok{;}\NormalTok{cpm }\KeywordTok{do.}\NormalTok{ jderr ERR088 }\KeywordTok{return.} \KeywordTok{end.}

  \CommentTok{NB. objects must exist in backup(s) errmsg: not in backups {-}>}
\NormalTok{  sn}\KeywordTok{=.}\NormalTok{ nnm }\KeywordTok{\{\textasciitilde{}}\NormalTok{ rx}\KeywordTok{=.} \KeywordTok{I.}\NormalTok{ bob}\KeywordTok{=}\NormalTok{bn}
  \KeywordTok{if.} \DecValTok{0} \KeywordTok{e.}\NormalTok{ uv}\KeywordTok{=.}\NormalTok{ sn }\KeywordTok{e.}\NormalTok{ ixn }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR107}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\NormalTok{sn }\KeywordTok{\#\textasciitilde{}} \KeywordTok{{-}.}\NormalTok{uv}\RegionMarkerTok{)} \KeywordTok{,\&.>} \KeywordTok{<}\NormalTok{NDOT}\KeywordTok{,":}\NormalTok{bob }\KeywordTok{return.} \KeywordTok{end.}

  \CommentTok{NB. read object components}
  \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread fn}\KeywordTok{;}\NormalTok{offset}\KeywordTok{+}\RegionMarkerTok{(}\NormalTok{ixn }\KeywordTok{i.}\NormalTok{ sn}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{ixc }\KeywordTok{do.}\NormalTok{ jderr ERR088 }\KeywordTok{return.} \KeywordTok{end.}

  \CommentTok{NB. update results}
\NormalTok{  ro}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{cols }\KeywordTok{\{"}\DecValTok{1} \KeywordTok{>}\NormalTok{dat}\RegionMarkerTok{)}\NormalTok{ rx}\KeywordTok{\}}\NormalTok{ ro}

  \CommentTok{NB. distinquish object names with backup number suffix}
\NormalTok{  ro}\KeywordTok{=.} \RegionMarkerTok{(((}\KeywordTok{<}\NormalTok{rx}\KeywordTok{;}\DecValTok{0}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{ro}\RegionMarkerTok{)} \KeywordTok{,\&.>} \KeywordTok{<}\StringTok{\textquotesingle{}\_\textquotesingle{}}\KeywordTok{,":}\NormalTok{bob}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{rx}\KeywordTok{;}\DecValTok{0}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ ro}

\KeywordTok{end.}

\CommentTok{NB. for nonwords insure any empty texts have literal datatype}
\KeywordTok{if.}\NormalTok{ obj}\KeywordTok{\textasciitilde{}:}\NormalTok{WORD }\KeywordTok{do.}\NormalTok{ ro}\KeywordTok{=.}\NormalTok{ btextlit ro }\KeywordTok{end.}

\NormalTok{ok }\KeywordTok{<}\NormalTok{ro  }\CommentTok{NB. return object table}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bnlsearch}\AlertTok{=:}\index{bnlsearch@\texttt{bnlsearch}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*bnlsearch  v{-}{-} searches put dictionary backup name  lists for}
\CommentTok{NB. simple character list patterns.}
\CommentTok{NB.}
\CommentTok{NB. dyad: ilObjOptNc bnlsearch clPattern}

\CommentTok{NB. at most one \textquotesingle{}.\textquotesingle{} character errmsg: invalid name pattern}
\KeywordTok{if.} \DecValTok{1} \KeywordTok{<} \KeywordTok{+/} \KeywordTok{y} \KeywordTok{e.}\NormalTok{ NDOT }\KeywordTok{do.}\NormalTok{ jderr ERR010 }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. maintains argument compatibility with (dnl)}
\NormalTok{bv}\KeywordTok{=.}\NormalTok{ DEFAULT }\KeywordTok{\textasciitilde{}:} \DecValTok{2}\KeywordTok{\{x}
\KeywordTok{if.}\NormalTok{ bv }\KeywordTok{*.} \RegionMarkerTok{(}\DecValTok{0}\KeywordTok{\{x}\RegionMarkerTok{)} \KeywordTok{e.}\NormalTok{ TEST}\KeywordTok{,}\NormalTok{GROUP}\KeywordTok{,}\NormalTok{SUITE }\KeywordTok{do.}\NormalTok{ jderr ERR001 }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. put dictionary directory object}
\NormalTok{DL}\KeywordTok{=.} \KeywordTok{\{:}\DecValTok{0}\KeywordTok{\{}\NormalTok{DPATH}

\CommentTok{NB. extant backup numbers errmsg: no backup(s) to restore or search}
\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ checkback DL }\KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ bn}\KeywordTok{=.}\NormalTok{ rv uv }\KeywordTok{end.}

\CommentTok{NB. search name pattern and requested backup}
\StringTok{\textquotesingle{}pat rbk\textquotesingle{}}\KeywordTok{=.}\NormalTok{ splitbname }\KeywordTok{y}

\CommentTok{NB. use most recent backup if none specified}
\KeywordTok{if.}\NormalTok{     isempty rbk           }\KeywordTok{do.}\NormalTok{ rbk}\KeywordTok{=.} \KeywordTok{\{.}\NormalTok{bn}
\KeywordTok{elseif.} \DecValTok{0} \KeywordTok{e.}\NormalTok{ rbk }\KeywordTok{e.}\NormalTok{ DIGITS    }\KeywordTok{do.}\NormalTok{ jderr ERR010 }\KeywordTok{return.}
\KeywordTok{elseif.} \KeywordTok{{-}.}\RegionMarkerTok{(}\NormalTok{rbk}\KeywordTok{=.} \KeywordTok{".}\NormalTok{rbk}\RegionMarkerTok{)} \KeywordTok{e.}\NormalTok{ bn }\KeywordTok{do.}\NormalTok{ jderr ERR103 }\KeywordTok{return.}
\KeywordTok{end.}

\CommentTok{NB. nonempty patterns must be valid J names without embedded locales}
\KeywordTok{if.} \KeywordTok{\#}\NormalTok{uv}\KeywordTok{=.}\NormalTok{ pat }\KeywordTok{{-}.} \StringTok{\textquotesingle{} \textquotesingle{}} \KeywordTok{do.}
  \KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ checknames pat }\KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{end.}
\KeywordTok{end.}

\NormalTok{bdot}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{,}\NormalTok{NDOT}\RegionMarkerTok{)}\KeywordTok{{-}:}\NormalTok{alltrim }\KeywordTok{y}

\KeywordTok{if.}\NormalTok{ bdot }\KeywordTok{*.}\NormalTok{ INPUT}\KeywordTok{=\{.x} \KeywordTok{do.}

  \CommentTok{NB. show pack/backup dates}
\NormalTok{  ok }\KeywordTok{<}\NormalTok{DL backupdates bn}

\KeywordTok{elseif.}\NormalTok{ bdot }\KeywordTok{do.}

  \CommentTok{NB. return backup suffixes}
\NormalTok{  dot}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{0}\KeywordTok{<\#}\NormalTok{bn}\RegionMarkerTok{)}\KeywordTok{\{}\StringTok{\textquotesingle{}\textquotesingle{}}\KeywordTok{;}\NormalTok{NDOT}
\NormalTok{  ok dot }\KeywordTok{,\&.>} \StringTok{\textquotesingle{}r<0>0.d\textquotesingle{}} \DecValTok{8}\KeywordTok{!:}\DecValTok{0}\NormalTok{ bn}

\KeywordTok{elseif.}\NormalTok{ bfile}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\{.x}\RegionMarkerTok{)}\NormalTok{ dbakf}\DecValTok{\_\_}\NormalTok{DL rbk}
        \CommentTok{NB. errmsg: jfile read failure}

\NormalTok{  badjr uv}\KeywordTok{=.}\NormalTok{ jread bfile}\KeywordTok{;}\RegionMarkerTok{(}\DecValTok{1}\KeywordTok{\{}\NormalTok{CNDIR}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{CNCLASS }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR088}\KeywordTok{,}\StringTok{\textquotesingle{} {-}>\textquotesingle{}}\RegionMarkerTok{)}\KeywordTok{,<}\NormalTok{bfile}

\KeywordTok{elseif.}
\NormalTok{        ol}\KeywordTok{=.}\NormalTok{ uv}\KeywordTok{\{}\NormalTok{ol }\KeywordTok{[}\NormalTok{ uv}\KeywordTok{=.} \KeywordTok{/:}\NormalTok{ ol }\KeywordTok{[} \StringTok{\textquotesingle{}ol oc\textquotesingle{}}\KeywordTok{=.}\NormalTok{ uv}
        \CommentTok{NB. reduce object list for words and macros if class specified}
        \KeywordTok{if.}\NormalTok{ bv }\KeywordTok{*.} \RegionMarkerTok{(}\DecValTok{0}\KeywordTok{\{x}\RegionMarkerTok{)} \KeywordTok{e.}\NormalTok{ WORD}\KeywordTok{,}\NormalTok{MACRO }\KeywordTok{do.}\NormalTok{ ol}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{oc }\KeywordTok{=} \DecValTok{2}\KeywordTok{\{x}\RegionMarkerTok{)}\KeywordTok{\#}\NormalTok{ol }\KeywordTok{[}\NormalTok{ oc}\KeywordTok{=.}\NormalTok{ uv}\KeywordTok{\{}\NormalTok{oc }\KeywordTok{end.}

\NormalTok{  isempty pat }\KeywordTok{do.}\NormalTok{ ok ol  }\CommentTok{NB. return sorted last backup name list}

\KeywordTok{elseif.} \DecValTok{0}\KeywordTok{=\#}\NormalTok{ol }\KeywordTok{do.}\NormalTok{ ok ol  }\CommentTok{NB. nothing left to match}
\KeywordTok{elseif.} \KeywordTok{do.}              \CommentTok{NB. match prefix, infix suffix}
  \KeywordTok{select.} \DecValTok{1}\KeywordTok{\{x}
    \KeywordTok{case.} \DecValTok{1} \KeywordTok{do.}\NormalTok{ ok ol nlpfx pat}
    \KeywordTok{case.} \DecValTok{2} \KeywordTok{do.}\NormalTok{ ok ol nlctn pat}
    \KeywordTok{case.} \DecValTok{3} \KeywordTok{do.}\NormalTok{ ok ol nlsfx pat}
    \KeywordTok{case.} \KeywordTok{do.}\NormalTok{ jderr ERR010}
  \KeywordTok{end.}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bnums}\AlertTok{=:}\index{bnums@\texttt{bnums}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*bnums  v{-}{-}  returns unique backup ordered list  of dictionary}
\CommentTok{NB. backup numbers.}
\CommentTok{NB.}
\CommentTok{NB. monad:  il =. bnums clPath}
\CommentTok{NB.}
\CommentTok{NB.   bnums BAK NB. (BAK) directory object noun}

\CommentTok{NB. requires first character of all (JDFILES) to be the same}
\KeywordTok{\textbackslash{}:\textasciitilde{}} \KeywordTok{\textasciitilde{}.} \KeywordTok{,} \KeywordTok{".} \RegionMarkerTok{(}\KeywordTok{\{.;}\NormalTok{JDFILES}\RegionMarkerTok{)}\KeywordTok{\&}\NormalTok{beforestr}\KeywordTok{\&>} \KeywordTok{\{."}\DecValTok{1} \RegionMarkerTok{(}\DecValTok{1}\KeywordTok{!:}\DecValTok{0}\RegionMarkerTok{)} \KeywordTok{<y,}\StringTok{\textquotesingle{}*\textquotesingle{}}\KeywordTok{,}\NormalTok{IJF}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bpathsfx}\AlertTok{=:}\index{bpathsfx@\texttt{bpathsfx}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*bpathsfx v{-}{-} backup file path and file name suffix.}
\CommentTok{NB.}
\CommentTok{NB. monad:  (clPath ; clSfx) =. bpathsfx iaObj}
\CommentTok{NB.}
\CommentTok{NB.   NB. calls in object context}
\CommentTok{NB.   bpathsfx\_\_ST\_\_JODobj WORD\_ajod\_}
\CommentTok{NB.   bpathsfx\_\_ST\_\_JODobj MACRO\_ajod\_}

\NormalTok{doj}\KeywordTok{=.} \KeywordTok{\{:\{.}\NormalTok{DPATH         }\CommentTok{NB. put dictionary object}
\NormalTok{fsx}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{;y\{}\NormalTok{JDFILES}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{IJF  }\CommentTok{NB. backup file name suffix}

\CommentTok{NB. backup file path !(*)=. doj}
\NormalTok{pth}\KeywordTok{=.} \KeywordTok{".} \RegionMarkerTok{(}\KeywordTok{\{.;}\NormalTok{dncn\_\_doj }\KeywordTok{y}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}P\_\_doj\textquotesingle{}}
\NormalTok{pth}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{>:}\NormalTok{pth }\KeywordTok{i:}\NormalTok{ PATHDEL}\RegionMarkerTok{)} \KeywordTok{\{.}\NormalTok{ pth}

\CommentTok{NB. return path and suffix}
\RegionMarkerTok{(}\NormalTok{pth }\KeywordTok{,} \RegionMarkerTok{(}\KeywordTok{;\{:}\NormalTok{JDSDIRS}\RegionMarkerTok{)} \KeywordTok{,}\NormalTok{ PATHDEL}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{fsx}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{btextlit}\AlertTok{=:}\index{btextlit@\texttt{btextlit}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*btextlit v{-}{-} force any empty backup text to literal datatype.}
\CommentTok{NB.}
\CommentTok{NB. To insure that (ed) can always edit  (bget) backup name value}
\CommentTok{NB. tables force any empty texts to a literal dataype. If this is}
\CommentTok{NB. not done the result may  fail the name, value argument  tests}
\CommentTok{NB. of (ed).}
\CommentTok{NB.}
\CommentTok{NB. monad:  bt =. btextlit bt}

\RegionMarkerTok{(}\KeywordTok{<}\StringTok{\textquotesingle{}\textquotesingle{}}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{<}\RegionMarkerTok{(}\KeywordTok{I.} \DecValTok{0} \KeywordTok{=} \KeywordTok{\#\&>} \DecValTok{\_1} \KeywordTok{\{"}\DecValTok{1} \KeywordTok{y}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{\_}\DecValTok{1}\RegionMarkerTok{)}\KeywordTok{\}} \KeywordTok{y}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{checkback}\AlertTok{=:}\index{checkback@\texttt{checkback}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*checkback v{-}{-} return list of put dictionary backup numbers.}
\CommentTok{NB.}
\CommentTok{NB. monad:  ilbn checkback baObj}
\CommentTok{NB.}
\CommentTok{NB.   checkback \{:0\{DPATH}

\CommentTok{NB. extant backup numbers errmsg: no backup(s) to restore or search}
\KeywordTok{if.} \DecValTok{0}\KeywordTok{=\#}\NormalTok{bn}\KeywordTok{=.}\NormalTok{ bnums BAK\_\_}\KeywordTok{y} \KeywordTok{do.}\NormalTok{ jderr ERR103 }\KeywordTok{else.}\NormalTok{ ok bn }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{checkntstamp}\AlertTok{=:}\index{checkntstamp@\texttt{checkntstamp}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*checkntstamp v{-}{-}  checks name, creation  and  last  put  date}
\CommentTok{NB. arrays.}
\CommentTok{NB.}
\CommentTok{NB. The boxed timestamp array fetched  by the \_14 option of (get)}
\CommentTok{NB. is one of the most complex and idiosyncratic JOD results. The}
\CommentTok{NB. layout was  motivated by  the  need  to  serialize  timestamp}
\CommentTok{NB. information so that dump scripts might  preserve the creation}
\CommentTok{NB. and last put date of objects.}
\CommentTok{NB.}
\CommentTok{NB. monad:  checkntstamp btNts}
\CommentTok{NB.}
\CommentTok{NB.   \textquotesingle{}rc nts\textquotesingle{}=. 0 \_14 get \}. dnl \textquotesingle{}\textquotesingle{}}
\CommentTok{NB.   checkntstamp\_\_ST\_\_JODobj nts}

\NormalTok{msg}\KeywordTok{=.}\NormalTok{ ERR099 }\CommentTok{NB. errmsg: invalid name/creation/lastput table}
\KeywordTok{if.}\NormalTok{ badbu }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ jderr msg}
\KeywordTok{elseif.} \KeywordTok{{-}.}\DecValTok{2} \DecValTok{1} \KeywordTok{{-}:} \KeywordTok{$y}      \KeywordTok{do.}\NormalTok{ jderr msg}
\KeywordTok{elseif.}\NormalTok{ badfl uv}\KeywordTok{=.} \KeywordTok{;}\DecValTok{1}\KeywordTok{\{y}  \KeywordTok{do.}\NormalTok{ jderr msg}
\KeywordTok{elseif.} \RegionMarkerTok{(}\DecValTok{2} \KeywordTok{\textasciitilde{}:} \KeywordTok{\#$}\NormalTok{uv}\RegionMarkerTok{)} \KeywordTok{+.} \DecValTok{2} \KeywordTok{\textasciitilde{}:} \KeywordTok{\#}\NormalTok{uv  }\KeywordTok{do.}\NormalTok{ jderr msg}
\CommentTok{NB. errmsg: name creation/lastput length mismatch}
\KeywordTok{elseif.} \KeywordTok{\textasciitilde{}:/} \KeywordTok{\{:@$\&>} \KeywordTok{y}  \KeywordTok{do.}\NormalTok{ jderr ERR100}
\CommentTok{NB. creation must precede or equal last put}
\KeywordTok{elseif.} \DecValTok{0} \KeywordTok{e.} \KeywordTok{<:/}\NormalTok{ uv   }\KeywordTok{do.}\NormalTok{ jderr msg}
\KeywordTok{elseif.}\NormalTok{ badrc tn}\KeywordTok{=.}\NormalTok{ checknames }\KeywordTok{;}\DecValTok{0}\KeywordTok{\{y}  \KeywordTok{do.}\NormalTok{ jderr msg}
\CommentTok{NB. timestamp names must be unique}
\KeywordTok{elseif.}\NormalTok{ badunique tn}\KeywordTok{=.} \KeywordTok{\}.}\NormalTok{tn  }\KeywordTok{do.}\NormalTok{ jderr msg}
\CommentTok{NB. dates are in fractional day yyyymmdd.fd format}
\CommentTok{NB. check that floored numbers are actual Gregorian dates}
\CommentTok{NB. errmsg: invalid date(s) name/creation/lastput table}
\KeywordTok{elseif.} \DecValTok{0} \KeywordTok{e.}\NormalTok{ valdate datefrnum }\KeywordTok{,}\NormalTok{uv  }\KeywordTok{do.}\NormalTok{ jderr ERR101}
\KeywordTok{elseif.do.}\NormalTok{ ok }\KeywordTok{<} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{tn}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{<}\DecValTok{0}\KeywordTok{;}\DecValTok{0}\RegionMarkerTok{)}\KeywordTok{\}} \KeywordTok{y}  \CommentTok{NB. insures deblanked names}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{checkopen}\AlertTok{=:}\index{checkopen@\texttt{checkopen}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*checkopen v{-}{-} are any dictionaries open?}
\CommentTok{NB.}
\CommentTok{NB. monad:  checkopen uuIgnore}

\KeywordTok{if.} \KeywordTok{\#}\NormalTok{DPATH }\KeywordTok{do.}\NormalTok{ OK }\KeywordTok{else.}\NormalTok{ jderr ERR050 }\KeywordTok{end.} \CommentTok{NB. errmsg: no dictionaries open}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{checkpath}\AlertTok{=:}\index{checkpath@\texttt{checkpath}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*checkpath  v{-}{-} returns  ok  if the current  path matches  the}
\CommentTok{NB. current   dictionary\textquotesingle{}s  reference   path.  Path  matching  is}
\CommentTok{NB. critical to the integrity of groups and suites.}
\CommentTok{NB.}
\CommentTok{NB. monad:  checkpath bacl}
\CommentTok{NB.}
\CommentTok{NB.   checkpath <\textquotesingle{}6\textquotesingle{}   NB. directory object reference}

\NormalTok{DL}\KeywordTok{=.} \KeywordTok{y}  \CommentTok{NB. directory object !(*)=. DL}
\NormalTok{rpath}\KeywordTok{=.} \KeywordTok{,}\NormalTok{RPATH}\DecValTok{\_\_}\NormalTok{DL}
\NormalTok{dpath}\KeywordTok{=.} \KeywordTok{,>} \DecValTok{1} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ DPATH}

\KeywordTok{if.} \KeywordTok{\#}\NormalTok{rpath }\KeywordTok{do.}
  \KeywordTok{if.}\NormalTok{ rpath }\KeywordTok{{-}:}\NormalTok{ dpath }\KeywordTok{do.}\NormalTok{ OK }\KeywordTok{else.}\NormalTok{ jderr ERR081 }\KeywordTok{end.} \CommentTok{NB. errmsg: path mismatch}
\KeywordTok{else.}

  \CommentTok{NB. dictionary path empty save current path and return ok}
  \KeywordTok{if.}\NormalTok{ badreps }\RegionMarkerTok{(}\KeywordTok{<}\NormalTok{dpath}\RegionMarkerTok{)}\NormalTok{ jreplace UF}\DecValTok{\_\_}\NormalTok{DL}\KeywordTok{;}\NormalTok{CNRPATH }\KeywordTok{do.}
\NormalTok{    jderr ERR082 }\CommentTok{NB. errmsg: unable to set reference path}
  \KeywordTok{else.}
\NormalTok{    RPATH}\DecValTok{\_\_}\NormalTok{DL}\AlertTok{=:}\index{RPATH\_\_DL@\texttt{RPATH\_\_DL}}\NormalTok{  dpath}
\NormalTok{    OK}
  \KeywordTok{end.}

\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{checkput}\AlertTok{=:}\index{checkput@\texttt{checkput}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*checkput  v{-}{-}  is  the  first  path  dictionary a  read/write}
\CommentTok{NB. dictionary?}
\CommentTok{NB.}
\CommentTok{NB. monad:  checkput uuIgnore}

\KeywordTok{if.} \KeywordTok{\#}\NormalTok{DPATH }\KeywordTok{do.}
\NormalTok{  DL}\KeywordTok{=.} \DecValTok{3}\KeywordTok{\{}\DecValTok{0}\KeywordTok{\{}\NormalTok{DPATH  }\CommentTok{NB. directory object !(*)=. DL}

  \CommentTok{NB. return directory object reference or errmsg: not a put dictionary}
  \KeywordTok{if.}\NormalTok{ RW}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{do.}\NormalTok{ ok DL }\KeywordTok{else.} \RegionMarkerTok{(}\NormalTok{jderr ERR051}\RegionMarkerTok{)}\KeywordTok{,<}\NormalTok{DNAME}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{end.}
\KeywordTok{else.}
\NormalTok{  jderr ERR050}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{closedict}\AlertTok{=:}\index{closedict@\texttt{closedict}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*closedict v{-}{-} closes dictionaries. Dictionary names have been}
\CommentTok{NB. validated prior to calling this verb. Destroys  all directory}
\CommentTok{NB. objects. The state  of directories on file are maintained  by}
\CommentTok{NB. other verbs. So no directory updating is required here.}
\CommentTok{NB.}
\CommentTok{NB. monad:  closedict blclDictionary}
\CommentTok{NB.}
\CommentTok{NB.   closedict \textquotesingle{}d0\textquotesingle{};\textquotesingle{}d1\textquotesingle{}   NB. close di}

\CommentTok{NB. close request seems valid {-} mark master}
\KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{ markmast }\DecValTok{1} \KeywordTok{do.}\NormalTok{ msg }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. destroy open directory objects}
\NormalTok{uv}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\{."}\DecValTok{1}\NormalTok{ DPATH}\RegionMarkerTok{)} \KeywordTok{e.} \KeywordTok{y}
\KeywordTok{if.} \KeywordTok{+./}\NormalTok{uv }\KeywordTok{do.}
\NormalTok{  coerase}\KeywordTok{"}\DecValTok{0}\NormalTok{ uv}\KeywordTok{\#\{:"}\DecValTok{1}\NormalTok{ DPATH}
\NormalTok{  DPATH}\AlertTok{=:}\index{DPATH@\texttt{DPATH}}\NormalTok{  DPATH }\KeywordTok{\#\textasciitilde{}} \KeywordTok{{-}.}\NormalTok{ uv}
\KeywordTok{else.}
  \RegionMarkerTok{(}\NormalTok{jderr ERR080}\RegionMarkerTok{)}\KeywordTok{,<y} \CommentTok{NB. errmsg: not open}
\KeywordTok{end.}

\CommentTok{NB. update master open status and release}
\KeywordTok{x=.} \KeywordTok{>} \KeywordTok{x}
\NormalTok{uv}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{0}\KeywordTok{\{x}\RegionMarkerTok{)} \KeywordTok{i.} \KeywordTok{y}
\KeywordTok{x=.} \KeywordTok{<} \RegionMarkerTok{(}\KeywordTok{<}\DecValTok{0}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{<}\DecValTok{3}\KeywordTok{;}\NormalTok{uv}\RegionMarkerTok{)}\KeywordTok{\}} \KeywordTok{x}
\KeywordTok{if.}\NormalTok{ badreps }\KeywordTok{x}\NormalTok{ jreplace JMASTER}\KeywordTok{;}\NormalTok{CNMFTAB }\KeywordTok{do.}
\NormalTok{  jdmasterr ERR077  }\CommentTok{NB. errmsg: unable to update master}
\KeywordTok{elseif.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{ markmast}\KeywordTok{\textasciitilde{}}\DecValTok{0}  \KeywordTok{do.}\NormalTok{ msg}
\KeywordTok{elseif.} \KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{ok OK054}\RegionMarkerTok{)}\KeywordTok{,y}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{createst}\AlertTok{=:}\index{createst@\texttt{createst}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*createst v{-}{-} storage object creation verb. (y) is the object}
\CommentTok{NB. locale reference returned by (conew).}
\CommentTok{NB.}
\CommentTok{NB. monad: createst uuIgnore}
\CommentTok{NB.}
\CommentTok{NB.   createst\_\_ST ST;MK;UT;<SO}

\CommentTok{NB. object references !(*)=. JOD ST MK UT SO}
\StringTok{\textquotesingle{}JOD ST MK UT SO\textquotesingle{}}\AlertTok{=:}\index{\textquotesingle{}@\texttt{\textquotesingle{}}}  \KeywordTok{y}

\CommentTok{NB. word and macro type/name class codes !(*)=. HASTYPE}
\NormalTok{HASTYPE}\AlertTok{=:}\index{HASTYPE@\texttt{HASTYPE}}  \RegionMarkerTok{(}\KeywordTok{i.} \DecValTok{4}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{MACROTYPE}

\CommentTok{NB. brand storage object with unique id !(*)=. JODOBID}
\NormalTok{saveobid JODOBID}\AlertTok{=:}\index{JODOBID@\texttt{JODOBID}}\NormalTok{  didnum }\DecValTok{0}

\CommentTok{NB. inverted data/code component cross reference !(*)=. INCNXR}
\NormalTok{uv}\KeywordTok{=.}\NormalTok{ CNCLASS}\KeywordTok{,}\NormalTok{CNCREATION}\KeywordTok{,}\NormalTok{CNPUTDATE}\KeywordTok{,}\NormalTok{CNSIZE}
\DecValTok{1} \KeywordTok{[}\NormalTok{ INCNXR}\AlertTok{=:}\index{INCNXR@\texttt{INCNXR}}  \RegionMarkerTok{(}\NormalTok{INCLASS}\KeywordTok{,}\NormalTok{INCREATE}\KeywordTok{,}\NormalTok{INPUT}\KeywordTok{,}\NormalTok{INSIZE}\RegionMarkerTok{)} \KeywordTok{,:}\NormalTok{ uv}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{defwords}\AlertTok{=:}\index{defwords@\texttt{defwords}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*defwords v{-}{-} fetches and defines words.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  bacl defwords blcl}
\CommentTok{NB.}
\CommentTok{NB.   (<\textquotesingle{}base\textquotesingle{}) defwords ;:\textquotesingle{}please define my words\textquotesingle{}}

\KeywordTok{if.}\NormalTok{ badrc }\KeywordTok{y=.}\NormalTok{ checknames }\KeywordTok{y} \KeywordTok{do.} \KeywordTok{y} \KeywordTok{return.} \KeywordTok{end.}
\NormalTok{wrds}\KeywordTok{=.} \KeywordTok{y=.} \KeywordTok{\}.y}

\CommentTok{NB. if all words are not on path get nothing}
\KeywordTok{if.}\NormalTok{ badrc wnl}\KeywordTok{=.}\NormalTok{ pathnl WORD }\KeywordTok{do.}\NormalTok{ wnl }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{wnl}\KeywordTok{=.} \KeywordTok{\}.}\NormalTok{ wnl}

\CommentTok{NB. errmsg: exceeds symbol table limit for locale}
\KeywordTok{if.}\NormalTok{ SYMBOLLIM }\KeywordTok{<:} \KeywordTok{\#}\NormalTok{wnl }\KeywordTok{do.}\NormalTok{ jderr ERR094 }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. remove any empty dictionaries from path}
\NormalTok{b}\KeywordTok{=.}   \DecValTok{0}\KeywordTok{\&<@:\#\&>}\NormalTok{ wnl}
\NormalTok{wnl}\KeywordTok{=.}\NormalTok{ b}\KeywordTok{\#}\NormalTok{wnl }\KeywordTok{[}\NormalTok{ dpath}\KeywordTok{=.}\NormalTok{ b}\KeywordTok{\#}\NormalTok{DPATH}

\KeywordTok{if.} \KeywordTok{*./}\NormalTok{b}\KeywordTok{=.} \KeywordTok{y} \KeywordTok{e.} \KeywordTok{;}\NormalTok{ wnl }\KeywordTok{do.}

\NormalTok{  loc}\KeywordTok{=.}\NormalTok{ locsfx }\KeywordTok{x}

  \CommentTok{NB. run down the path fetching the first word occurrences}
  \KeywordTok{for\_dp.}\NormalTok{ wnl }\KeywordTok{do.}
\NormalTok{    ix}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{dp}\KeywordTok{=.} \KeywordTok{>}\NormalTok{dp}\RegionMarkerTok{)} \KeywordTok{i.} \KeywordTok{y}

    \CommentTok{NB. if any words in current dictionary load them}
    \KeywordTok{if.} \KeywordTok{+./}\NormalTok{wf}\KeywordTok{=.}\NormalTok{ ix}\KeywordTok{<\#}\NormalTok{dp }\KeywordTok{do.}
      \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{wf}\KeywordTok{\#}\NormalTok{ix}\RegionMarkerTok{)}\NormalTok{ loadwords loc}\KeywordTok{,\{:}\NormalTok{dp\_index}\KeywordTok{\{}\NormalTok{dpath }\KeywordTok{do.}
\NormalTok{        msg }\KeywordTok{return.}
      \KeywordTok{end.}

      \CommentTok{NB. remove fetched words from list quit if no more words}
      \KeywordTok{if.} \DecValTok{0}\KeywordTok{=\#y=.} \RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{wf}\RegionMarkerTok{)}\KeywordTok{\#y} \KeywordTok{do.} \KeywordTok{break.} \KeywordTok{end.}
    \KeywordTok{end.}
  \KeywordTok{end.}

  \CommentTok{NB. test name class of fetched words}
  \KeywordTok{if.} \DecValTok{1}\KeywordTok{\&e.}\NormalTok{ b}\KeywordTok{=.} \DecValTok{0}\KeywordTok{\&>}\NormalTok{ nc wrds}\KeywordTok{=.}\NormalTok{ wrds}\KeywordTok{,\&.>}\NormalTok{loc }\KeywordTok{do.}
    \RegionMarkerTok{(}\NormalTok{jderr ERR085}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{b}\KeywordTok{\#}\NormalTok{wrds }\CommentTok{NB. errmsg: words(s) not defined}
  \KeywordTok{else.}
\NormalTok{    ok }\RegionMarkerTok{(}\KeywordTok{":\#}\NormalTok{b}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{OK060}
  \KeywordTok{end.}

\KeywordTok{else.}
  \RegionMarkerTok{(}\NormalTok{jderr ERR083}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{b}\RegionMarkerTok{)}\KeywordTok{\#y} \CommentTok{NB. errmsg: not on path}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{delstuff}\AlertTok{=:}\index{delstuff@\texttt{delstuff}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*delstuff v{-}{-} deletes words, tests, groups, suites and macros}
\CommentTok{NB.}
\CommentTok{NB. dyad:  (iaObject ; il ; bacl) delstuff blcl}
\CommentTok{NB.}
\CommentTok{NB.   cn =. CNPUTDATE,CNCREATION,CNEXPLAIN}
\CommentTok{NB.   (GROUP;cn;<DL) delstuff ;:\textquotesingle{}we groups are toast\textquotesingle{}}

\StringTok{\textquotesingle{}obj cn DL\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}  \CommentTok{NB. directory object !(*)=. DL}

\KeywordTok{if.}\NormalTok{ badrc }\KeywordTok{y=.}\NormalTok{ checknames }\KeywordTok{y} \KeywordTok{do.} \KeywordTok{y}
\KeywordTok{elseif.}\NormalTok{ loaddir}\DecValTok{\_\_}\NormalTok{DL obj }\KeywordTok{do.}
\NormalTok{  jderr ERR054 }\CommentTok{NB. errmsg: unable to load directory}
\KeywordTok{elseif.} \KeywordTok{\#}\NormalTok{ix }\KeywordTok{=.".}\RegionMarkerTok{(}\KeywordTok{>}\NormalTok{dnix}\DecValTok{\_\_}\NormalTok{DL obj}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_\_DL\textquotesingle{}} \KeywordTok{do.}

\NormalTok{  oc}\KeywordTok{=.} \KeywordTok{+/}\NormalTok{b}\KeywordTok{=.}\NormalTok{ ix }\KeywordTok{e.} \KeywordTok{y=.} \KeywordTok{\textasciitilde{}.\}.y}

  \KeywordTok{if.}\NormalTok{ oc }\KeywordTok{\textasciitilde{}:} \KeywordTok{\#y} \KeywordTok{do.}
    \RegionMarkerTok{(}\NormalTok{jderr ERR086}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{{-}.y} \KeywordTok{e.}\NormalTok{ ix}\RegionMarkerTok{)}\KeywordTok{\#y} \CommentTok{NB. errmsg: not in put dictionary}
    \KeywordTok{return.}
  \KeywordTok{end.}

\NormalTok{  list}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{b}\KeywordTok{=.} \KeywordTok{{-}.}\NormalTok{b}\RegionMarkerTok{)}\KeywordTok{\#}\NormalTok{ix}
\NormalTok{  comp}\KeywordTok{=.}\NormalTok{ b}\KeywordTok{\#".}\RegionMarkerTok{(}\NormalTok{in}\KeywordTok{=.} \KeywordTok{>}\NormalTok{dncn}\DecValTok{\_\_}\NormalTok{DL obj}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_\_DL\textquotesingle{}}
\NormalTok{  fp}\KeywordTok{=.}\NormalTok{ dfopen}\DecValTok{\_\_}\NormalTok{DL in}\KeywordTok{=.} \KeywordTok{\{.}\NormalTok{in}

  \CommentTok{NB. remove old inverted data from object}
\NormalTok{  dropinv}\DecValTok{\_\_}\NormalTok{DL }\DecValTok{0}

  \CommentTok{NB. delete from inverted lists and main directory}
  \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{ b invdelete fp}\KeywordTok{;}\NormalTok{cn }\KeywordTok{do.}
\NormalTok{    msg }\KeywordTok{[}\NormalTok{ dfclose}\DecValTok{\_\_}\NormalTok{DL in }\KeywordTok{return.}
  \KeywordTok{elseif.}\NormalTok{ badrc msg}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{obj}\KeywordTok{,}\NormalTok{fp}\RegionMarkerTok{)}\NormalTok{ savedir}\DecValTok{\_\_}\NormalTok{DL list}\KeywordTok{;}\NormalTok{comp }\KeywordTok{do.}
\NormalTok{    msg }\KeywordTok{[}\NormalTok{ dfclose}\DecValTok{\_\_}\NormalTok{DL in }\KeywordTok{return.}
  \KeywordTok{end.}

  \CommentTok{NB. remove any put dictionary word references}
  \KeywordTok{if.}\NormalTok{ WORD}\KeywordTok{=}\NormalTok{obj }\KeywordTok{do.}
    \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{ DL delwordrefs }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ msg }\KeywordTok{[}\NormalTok{ dfclose}\DecValTok{\_\_}\NormalTok{DL in }\KeywordTok{return.} \KeywordTok{end.}
  \KeywordTok{end.}

\NormalTok{  dfclose}\DecValTok{\_\_}\NormalTok{DL in}
\NormalTok{  msg}\KeywordTok{=.} \StringTok{\textquotesingle{} \textquotesingle{}}\KeywordTok{,>}\NormalTok{dnnm}\DecValTok{\_\_}\NormalTok{DL obj}
  \RegionMarkerTok{(}\NormalTok{ok }\RegionMarkerTok{(}\KeywordTok{":}\NormalTok{ oc}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{msg}\KeywordTok{,}\NormalTok{OK061}\RegionMarkerTok{)}\KeywordTok{,<}\NormalTok{DNAME}\DecValTok{\_\_}\NormalTok{DL}

\KeywordTok{elseif.do.}
\NormalTok{  jderr ERR087 }\CommentTok{NB. errmsg: nothing in put dictionary}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{delwordrefs}\AlertTok{=:}\index{delwordrefs@\texttt{delwordrefs}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*delwordrefs  v{-}{-}  deletes  word  references.  Word  reference}
\CommentTok{NB. deletion is required when deleting words to insure that words}
\CommentTok{NB. do not leave  "reference shadows." A reference  shadow occurs}
\CommentTok{NB. when  a  word  with  references  is  deleted and  moved to  a}
\CommentTok{NB. dictionary further down  on the path. The reference reporting}
\CommentTok{NB. mechanism picks  up  the shadow and never fetches the  actual}
\CommentTok{NB. reference list. Words are the  only  JOD  objects with stored}
\CommentTok{NB. references.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  ba delwordrefs blclWords}

\NormalTok{DL}\KeywordTok{=.} \KeywordTok{x} \CommentTok{NB. directory object !(*)=. DL}

\CommentTok{NB. errmsg: unable to load references}
\KeywordTok{if.}\NormalTok{ loadref}\DecValTok{\_\_}\NormalTok{DL WORD }\KeywordTok{do.}\NormalTok{ jderr ERR079}
\KeywordTok{elseif.do.}

  \CommentTok{NB. find any references to deleted words}
\NormalTok{  uv}\KeywordTok{=.}\NormalTok{ WORDREFIX}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{e.} \KeywordTok{y}
  \KeywordTok{if.} \KeywordTok{+./}\NormalTok{uv }\KeywordTok{do.}

\NormalTok{    dfopen}\DecValTok{\_\_}\NormalTok{DL }\StringTok{\textquotesingle{}U\textquotesingle{}}
\NormalTok{    fp}\KeywordTok{=.}\NormalTok{ UP}\DecValTok{\_\_}\NormalTok{DL}

    \CommentTok{NB. remove any references from put dictionary}
\NormalTok{    uv1}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{uv}\KeywordTok{=.} \KeywordTok{{-}.}\NormalTok{uv}\RegionMarkerTok{)}\KeywordTok{\#}\NormalTok{WORDREFIX}\DecValTok{\_\_}\NormalTok{DL}
\NormalTok{    uv2}\KeywordTok{=.}\NormalTok{ uv}\KeywordTok{\#}\NormalTok{WORDREFCN}\DecValTok{\_\_}\NormalTok{DL}

    \CommentTok{NB. update reference directory and close}
    \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{WORD}\KeywordTok{,}\NormalTok{fp}\RegionMarkerTok{)}\NormalTok{ saveref}\DecValTok{\_\_}\NormalTok{DL uv1}\KeywordTok{;}\NormalTok{uv2 }\KeywordTok{do.}\NormalTok{ msg }\KeywordTok{[}\NormalTok{ dfclose}\DecValTok{\_\_}\NormalTok{DL }\StringTok{\textquotesingle{}U\textquotesingle{}} \KeywordTok{return.} \KeywordTok{end.}

\NormalTok{    dfclose}\DecValTok{\_\_}\NormalTok{DL }\StringTok{\textquotesingle{}U\textquotesingle{}}
  \KeywordTok{end.}

\NormalTok{  OK}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{didstats}\AlertTok{=:}\index{didstats@\texttt{didstats}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*didstats v{-}{-} dictionary statistics. Returns a table of object}
\CommentTok{NB. counts and reference paths for each dictionary in path order.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  uuIgnore didstats uuIgnore}

\CommentTok{NB. are any dictionaries open?}
\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ checkopen }\DecValTok{0} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. gerund of directory object (loadstamps) calls}
\NormalTok{ger}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\StringTok{\textquotesingle{}loadstamps\textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ locsfx ol}\KeywordTok{=.} \KeywordTok{\{:"}\DecValTok{1}\NormalTok{ DPATH}
\KeywordTok{if.} \KeywordTok{+./}\RegionMarkerTok{(}\NormalTok{ger }\KeywordTok{\textasciigrave{}:}\DecValTok{0}\RegionMarkerTok{)} \DecValTok{0} \KeywordTok{do.}
\NormalTok{  jderr ERR054  }\CommentTok{NB. errmsg: unable to load directory}
\KeywordTok{else.}
\NormalTok{  dn}\KeywordTok{=.}\NormalTok{ DIRTS\_\_oj }\KeywordTok{[}\NormalTok{ oj}\KeywordTok{=.} \KeywordTok{\{.} \KeywordTok{\{:"}\DecValTok{1}\NormalTok{ DPATH  }\CommentTok{NB. (*)=. oj}
\NormalTok{  hd}\KeywordTok{=.} \StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{;} \StringTok{\textquotesingle{}{-}{-}\textquotesingle{}} \KeywordTok{;}\NormalTok{ HEADNMS\_\_oj}

  \CommentTok{NB. collect values of directory object nouns}
\NormalTok{  uv}\KeywordTok{=.}\RegionMarkerTok{(}\StringTok{\textquotesingle{}RW\textquotesingle{}}\KeywordTok{;}\StringTok{\textquotesingle{}RPATH\textquotesingle{}}\KeywordTok{;}\NormalTok{dn}\RegionMarkerTok{)}\NormalTok{ fullmonty}\KeywordTok{\&><}\NormalTok{ol}
\NormalTok{  rpaths}\KeywordTok{=.} \DecValTok{1}\KeywordTok{\{}\NormalTok{uv }\KeywordTok{[}\NormalTok{ rs}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{;\{.}\NormalTok{uv}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{READSTATS}
\NormalTok{  dt}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\{."}\DecValTok{1}\NormalTok{ DPATH}\RegionMarkerTok{)} \KeywordTok{,.}\NormalTok{ rs }\KeywordTok{,.} \KeywordTok{\{.\&>} \KeywordTok{|:} \DecValTok{2} \KeywordTok{\}.}\NormalTok{ uv}
\NormalTok{  dt}\KeywordTok{=.}\NormalTok{ hd }\KeywordTok{,}\NormalTok{ dt}

  \CommentTok{NB. read master to get as complete a list of names and numbers}
  \CommentTok{NB. as possible. Some (DIDNUM)\textquotesingle{}s may still be missing {-} missing}
  \CommentTok{NB. dictionaries reported as dictionary numbers {-} hey life is cruel!}
  \KeywordTok{if.}\NormalTok{ badjr uv}\KeywordTok{=.}\NormalTok{ jread JMASTER}\KeywordTok{;}\NormalTok{CNMFTAB }\KeywordTok{do.}
\NormalTok{    jderr ERR006 }\KeywordTok{return.} \CommentTok{NB. errmsg: cannot read master}
  \KeywordTok{end.}

\NormalTok{  rb}\KeywordTok{=.} \KeywordTok{<"}\DecValTok{0} \RegionMarkerTok{(}\KeywordTok{\textasciitilde{}.} \KeywordTok{;}\NormalTok{rpaths}\RegionMarkerTok{)} \KeywordTok{{-}.} \KeywordTok{;}\DecValTok{1}\KeywordTok{\{}\NormalTok{uv }\KeywordTok{=.} \KeywordTok{>}\NormalTok{uv}
\NormalTok{  hd}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{0}\KeywordTok{\{}\NormalTok{uv}\RegionMarkerTok{)} \KeywordTok{,} \KeywordTok{":\&.>}\NormalTok{ rb  }\CommentTok{NB. all dictionary names}
\NormalTok{  dn}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{1}\KeywordTok{\{}\NormalTok{uv}\RegionMarkerTok{)} \KeywordTok{,}\NormalTok{ rb        }\CommentTok{NB. dictionary numbers}

  \CommentTok{NB. display formatted paths with each dictionary using current names}
\NormalTok{  rpaths}\KeywordTok{=.} \KeywordTok{;\&.>}\NormalTok{PATHSHOWDEL}\KeywordTok{,L:}\DecValTok{0}\RegionMarkerTok{((}\KeywordTok{<;}\NormalTok{dn}\RegionMarkerTok{)}\KeywordTok{i.\&.>}\NormalTok{rpaths}\RegionMarkerTok{)}\KeywordTok{\{\&.><}\NormalTok{hd}
\NormalTok{  ok }\KeywordTok{<}\NormalTok{dt }\KeywordTok{,.}\NormalTok{ PATHTIT }\KeywordTok{;}\NormalTok{ rpaths}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dnlsearch}\AlertTok{=:}\index{dnlsearch@\texttt{dnlsearch}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*dnlsearch  v{-}{-}  searches  dictionary name  lists  for  simple}
\CommentTok{NB. character list patterns.}
\CommentTok{NB.}
\CommentTok{NB. dyad: ilObjOptNc dnlsearch (clPattern ; clDir)}
\CommentTok{NB.}
\CommentTok{NB.   3 2 7 dnlsearch \textquotesingle{}boo\textquotesingle{}   NB. suite names containing \textquotesingle{}boo\textquotesingle{}}
\CommentTok{NB.   3 \_2 0 dnlsearch \textquotesingle{}boo\textquotesingle{}  NB. nouns with names containing \textquotesingle{}boo\textquotesingle{}}

\NormalTok{mop}\KeywordTok{=.}\NormalTok{ ERR001}
\KeywordTok{if.} \KeywordTok{{-}.}\RegionMarkerTok{(}\NormalTok{second }\KeywordTok{x}\RegionMarkerTok{)} \KeywordTok{e.}\NormalTok{ PATOPS }\KeywordTok{do.}\NormalTok{ jderr mop }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. following code is essentially (pathnl) {-} maintained}
\CommentTok{NB. inline because (pob) and (oj) used elsewhere}
\NormalTok{pob}\KeywordTok{=.} \KeywordTok{\{:"}\DecValTok{1}\NormalTok{ DPATH }\KeywordTok{[}\NormalTok{ dt}\KeywordTok{=.} \KeywordTok{|\{.x}
\KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{ dt loadalldirs pob }\KeywordTok{do.}\NormalTok{ msg }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{nl}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{>}\NormalTok{dnix\_\_oj dt}\RegionMarkerTok{)}\NormalTok{ fullmonty pob }\KeywordTok{[}\NormalTok{ oj}\KeywordTok{=.} \KeywordTok{\{.}\NormalTok{pob  }\CommentTok{NB. (*)=. oj}

\KeywordTok{if.}\NormalTok{ DEFAULT}\KeywordTok{\textasciitilde{}:\{:x} \KeywordTok{do.}
   \CommentTok{NB. object noun !(*)=. HASTYPE}
   \KeywordTok{if.} \RegionMarkerTok{((}\KeywordTok{\{.x}\RegionMarkerTok{)} \KeywordTok{e.}\NormalTok{ WORD}\KeywordTok{,}\NormalTok{MACRO}\RegionMarkerTok{)} \KeywordTok{*.} \RegionMarkerTok{(}\KeywordTok{\{:x}\RegionMarkerTok{)} \KeywordTok{e.}\NormalTok{ HASTYPE }\KeywordTok{do.}
\NormalTok{     ger}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\StringTok{\textquotesingle{}loadnc\textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ locsfx pob}
     \KeywordTok{if.} \KeywordTok{+./}\RegionMarkerTok{(}\NormalTok{ger }\KeywordTok{\textasciigrave{}:}\DecValTok{0}\RegionMarkerTok{)}\NormalTok{ dt }\KeywordTok{do.}
\NormalTok{       jderr ERR054 }\KeywordTok{return.} \CommentTok{NB. errmsg: unable to load directory}
     \KeywordTok{end.}
\NormalTok{     dc}\KeywordTok{=.} \KeywordTok{;\&.>} \RegionMarkerTok{(}\KeywordTok{>}\NormalTok{dnnc\_\_oj dt}\RegionMarkerTok{)}\NormalTok{ fullmonty pob}

     \CommentTok{NB. remove items of (nl) that do not have type (\{:x)}
\NormalTok{     nl}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{dc }\KeywordTok{=\&.>} \KeywordTok{<\{:x}\RegionMarkerTok{)} \KeywordTok{\#\&.>}\NormalTok{ nl}

   \KeywordTok{else.}
\NormalTok{     jderr mop }\KeywordTok{return.}
   \KeywordTok{end.}
\KeywordTok{end.}

\KeywordTok{x=.}\NormalTok{ second }\KeywordTok{x}
\KeywordTok{if.}\NormalTok{ isempty }\KeywordTok{y} \KeywordTok{do.}
  \KeywordTok{if.} \DecValTok{0}\KeywordTok{>x} \KeywordTok{do.}\NormalTok{ ok }\RegionMarkerTok{(}\KeywordTok{/:\textasciitilde{}}\RegionMarkerTok{)}\KeywordTok{\&.>}\NormalTok{ nl }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ ok sortdnub nl }\KeywordTok{end.}
\KeywordTok{elseif.} \KeywordTok{do.}
  \KeywordTok{y=.} \KeywordTok{,y}
  \CommentTok{NB. insure nulls behave}
\NormalTok{  sublists}\KeywordTok{=.} \DecValTok{0}\KeywordTok{>x}
\NormalTok{  shape}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{sublists}\KeywordTok{\#}\DecValTok{0}\RegionMarkerTok{)}\KeywordTok{,}\DecValTok{0}
\NormalTok{  nl}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{shape}\KeywordTok{$}\StringTok{\textquotesingle{}\textquotesingle{}}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{I.} \DecValTok{0}\KeywordTok{=\#\&>}\NormalTok{ nl}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ nl}
  \CommentTok{NB. remove any empties}
  \KeywordTok{if.} \DecValTok{0}\KeywordTok{=\#}\NormalTok{nl}\KeywordTok{=.}\NormalTok{ nl }\KeywordTok{{-}.} \KeywordTok{a:} \KeywordTok{do.}\NormalTok{ ok}\StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{return.} \KeywordTok{end.}
  \KeywordTok{select.} \KeywordTok{|x}
    \KeywordTok{case.} \DecValTok{1} \KeywordTok{do.} \KeywordTok{if.}\NormalTok{ sublists }\KeywordTok{do.}\NormalTok{ ok nl allnlpfx }\KeywordTok{y} \KeywordTok{else.}\NormalTok{ ok nl nubnlpfx }\KeywordTok{y} \KeywordTok{end.}
    \KeywordTok{case.} \DecValTok{2} \KeywordTok{do.} \KeywordTok{if.}\NormalTok{ sublists }\KeywordTok{do.}\NormalTok{ ok nl allnlctn }\KeywordTok{y} \KeywordTok{else.}\NormalTok{ ok nl nubnlctn }\KeywordTok{y} \KeywordTok{end.}
    \KeywordTok{case.} \DecValTok{3} \KeywordTok{do.} \KeywordTok{if.}\NormalTok{ sublists }\KeywordTok{do.}\NormalTok{ ok nl allnlsfx }\KeywordTok{y} \KeywordTok{else.}\NormalTok{ ok nl nubnlsfx }\KeywordTok{y} \KeywordTok{end.}
    \KeywordTok{case.} \KeywordTok{do.}\NormalTok{ jderr mop}
  \KeywordTok{end.}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. select only duplicate names in table based on first column}
\NormalTok{dupnames}\AlertTok{=:}\index{dupnames@\texttt{dupnames}} \KeywordTok{]} \KeywordTok{\#\textasciitilde{}} \RegionMarkerTok{(}\DecValTok{0} \KeywordTok{\{"}\DecValTok{1} \KeywordTok{]}\RegionMarkerTok{)} \KeywordTok{e.} \RegionMarkerTok{(}\DecValTok{0} \KeywordTok{\{"}\DecValTok{1} \KeywordTok{]}\RegionMarkerTok{)} \KeywordTok{\#\textasciitilde{}} \KeywordTok{[:} \KeywordTok{{-}.} \KeywordTok{[:} \KeywordTok{\textasciitilde{}:} \DecValTok{0} \KeywordTok{\{"}\DecValTok{1} \KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{freedisk}\AlertTok{=:}\index{freedisk@\texttt{freedisk}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*freedisk v{-}{-} returns free disk/volume space in bytes.}
\CommentTok{NB.}
\CommentTok{NB. monad:  freedisk clDisk | clLinuxVolume}
\CommentTok{NB.}
\CommentTok{NB.   freedisk \textquotesingle{}c:\textbackslash{}\textquotesingle{}       NB. :\textbackslash{} required for windows}
\CommentTok{NB.   freedisk \textquotesingle{}/sd1/dev\textquotesingle{}  NB. linux file system root {-} null sums all devices}

\CommentTok{NB. NOTE: assume enough space for IOS, Android and unknown?}

\CommentTok{NB. Default behaviour has been changed to not size volumes}
\CommentTok{NB. when FREESPACE is 0. Volume sizing can peform poorly}
\CommentTok{NB. on large network volumes and fail completely on cloud drives.}
\CommentTok{NB. Empty JOD dictionaries are small (<60k) {-} assuming sufficient}
\CommentTok{NB. space is safe in all but extreme circumstances.}
\KeywordTok{if.}     \DecValTok{0}\KeywordTok{=}\NormalTok{FREESPACE      }\KeywordTok{do.} \DecValTok{1}
\KeywordTok{elseif.}\NormalTok{ IFWIN            }\KeywordTok{do.}\NormalTok{ freediskwin }\KeywordTok{y}
\KeywordTok{elseif.}\NormalTok{ UNAME}\KeywordTok{{-}:}\StringTok{\textquotesingle{}Linux\textquotesingle{}}   \KeywordTok{do.}\NormalTok{ freedisklinux }\KeywordTok{y}
\KeywordTok{elseif.}\NormalTok{ IFIOS            }\KeywordTok{do.} \KeywordTok{>:}\NormalTok{FREESPACE}
\KeywordTok{elseif.}\NormalTok{ UNAME}\KeywordTok{{-}:}\StringTok{\textquotesingle{}Darwin\textquotesingle{}}  \KeywordTok{do.}\NormalTok{ freediskmac }\KeywordTok{y}
\KeywordTok{elseif.}\NormalTok{ UNAME}\KeywordTok{{-}:}\StringTok{\textquotesingle{}Android\textquotesingle{}} \KeywordTok{do.} \KeywordTok{>:}\NormalTok{FREESPACE}
\KeywordTok{elseif.do.} \KeywordTok{>:}\NormalTok{FREESPACE}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{freedisklinux}\AlertTok{=:}\index{freedisklinux@\texttt{freedisklinux}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*freedisklinux v{-}{-} bytes free on not \textquotesingle{}none\textquotesingle{} linux volumes.}
\CommentTok{NB.}
\CommentTok{NB. NOTE: NIMP: I don\textquotesingle{}t know how to determine which}
\CommentTok{NB. linux volume the dictionary will be on so I return}
\CommentTok{NB. the minimum of all not \textquotesingle{}none\textquotesingle{} mounted volumes.}
\CommentTok{NB.}
\CommentTok{NB. monad:  fl =. freedisklinux uuIgnore}
\CommentTok{NB.}
\CommentTok{NB.   freedisklinux 0   NB. bytes (possibly floating) free on mounted filesystems}

\CommentTok{NB. linux shell command fetches free 1k blocks {-} expected format is:}
\CommentTok{NB. Filesystem           1K{-}blocks      Used Available Use\% Mounted on}
\CommentTok{NB. /dev/sda1            149301564  11113004 130604408   8\% /}
\CommentTok{NB. none                    764396       648    763748   1\% /dev}
\CommentTok{NB. none                    771004      1364    769640   1\% /dev/shm}
\CommentTok{NB. none                    771004        96    770908   1\% /var/run}
\CommentTok{NB. none                    771004         0    771004   0\% /var/lock}
\NormalTok{txt}\KeywordTok{=.}\NormalTok{ host }\StringTok{\textquotesingle{}df {-}l\textquotesingle{}}

\CommentTok{NB. cut into lines and drop header}
\NormalTok{txt}\KeywordTok{=.} \KeywordTok{\}.} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{2}\NormalTok{ txt}

\CommentTok{NB. remove all \textquotesingle{}none\textquotesingle{} filesystems HARDCODE: length of \textquotesingle{}none\textquotesingle{}}
\CommentTok{NB. NIMP: ignoring empty result {-} hey there}
\CommentTok{NB. has to be at least one mounted filesystem!}
\NormalTok{txt}\KeywordTok{=.}\NormalTok{ txt }\KeywordTok{\#\textasciitilde{}} \KeywordTok{{-}.} \StringTok{\textquotesingle{}none\textquotesingle{}}\KeywordTok{\&{-}:\&>} \DecValTok{4} \KeywordTok{\{.\&.>}\NormalTok{ txt}

\CommentTok{NB. min bytes free using 1000 byte blocks {-} this will}
\CommentTok{NB. underestimate free space and leave a little safety cushion}
\KeywordTok{<./} \DecValTok{1000} \KeywordTok{*} \DecValTok{3} \KeywordTok{\{"}\DecValTok{1} \KeywordTok{]} \DecValTok{\_1}\KeywordTok{\&".\&>}\NormalTok{ txt}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{freediskmac}\AlertTok{=:}\index{freediskmac@\texttt{freediskmac}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*freediskmac v{-}{-} free disk bytes on mac dictionary volume.}
\CommentTok{NB.}
\CommentTok{NB. monad:  iaBytes =. freediskmac clMacVolume}

\CommentTok{NB. NIMP: assume enough space for now}
\KeywordTok{>:}\NormalTok{FREESPACE}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{freediskwin}\AlertTok{=:}\index{freediskwin@\texttt{freediskwin}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*freediskwin v{-}{-} returns free disk/volume space in btyes for win systems}
\CommentTok{NB.}
\CommentTok{NB. monad:  freediskwin clDisk | clLinuxVolume}
\CommentTok{NB.}
\CommentTok{NB.   freediskwin \textquotesingle{}c:\textbackslash{}\textquotesingle{}       NB. :\textbackslash{} required for windows}

\NormalTok{s}\KeywordTok{=.} \StringTok{\textquotesingle{}kernel32 GetDiskFreeSpaceA i *c *i *i *i *i\textquotesingle{}}\NormalTok{ cd }\KeywordTok{y;}\RegionMarkerTok{(}\KeywordTok{,}\DecValTok{0}\RegionMarkerTok{)}\KeywordTok{;}\RegionMarkerTok{(}\KeywordTok{,}\DecValTok{0}\RegionMarkerTok{)}\KeywordTok{;}\RegionMarkerTok{(}\KeywordTok{,}\DecValTok{0}\RegionMarkerTok{)}\KeywordTok{;}\RegionMarkerTok{(}\KeywordTok{,}\DecValTok{0}\RegionMarkerTok{)}
\KeywordTok{*/} \KeywordTok{;} \DecValTok{2} \DecValTok{3} \DecValTok{4} \KeywordTok{\{}\NormalTok{ s}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. returns lists of directory object noun values {-} see long documentation}
\NormalTok{fullmonty}\AlertTok{=:}\index{fullmonty@\texttt{fullmonty}} \KeywordTok{[:} \KeywordTok{".\&.>} \RegionMarkerTok{(}\KeywordTok{[:} \KeywordTok{<} \KeywordTok{[}\RegionMarkerTok{)} \KeywordTok{,\&.>} \KeywordTok{[:}\NormalTok{ locsfx }\KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{getdicdoc}\AlertTok{=:}\index{getdicdoc@\texttt{getdicdoc}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*getdicdoc v{-}{-} fetches put dictionary documentation.}
\CommentTok{NB.}
\CommentTok{NB. monad:  cl =. getdicdoc uuIgnore}

\CommentTok{NB. assumes a put dictionary is open.}
\NormalTok{DL}\KeywordTok{=.} \KeywordTok{\{:\{.}\NormalTok{DPATH  }\CommentTok{NB. directory object !(*)=. DL}
\KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread WP}\DecValTok{\_\_}\NormalTok{DL}\KeywordTok{;}\NormalTok{CNDICDOC }\KeywordTok{do.}\NormalTok{ jderr ERR088 }\CommentTok{NB. errmsg: read failure}
\KeywordTok{else.}
\NormalTok{  ok }\KeywordTok{,>}\NormalTok{dat}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{getdocument}\AlertTok{=:}\index{getdocument@\texttt{getdocument}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*getdocument v{-}{-} get object documentation}
\CommentTok{NB.}
\CommentTok{NB. dyad: iaObject getdocument blcl}

\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{x,}\DecValTok{1}\RegionMarkerTok{)}\NormalTok{ getobjects }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{else.}\NormalTok{ ok }\KeywordTok{<}\DecValTok{0} \DecValTok{3} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ rv uv }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{getexplain}\AlertTok{=:}\index{getexplain@\texttt{getexplain}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*getexplain v{-}{-} gets short explanations.}
\CommentTok{NB.}
\CommentTok{NB. Note: Similar  to (invfetch)  and  (getobjects) but different}
\CommentTok{NB. enough to justify new verb.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaObject getexplain blcl}
\CommentTok{NB.}
\CommentTok{NB.   WORD getexplain ;:\textquotesingle{}you have some explaining to do\textquotesingle{}}

\KeywordTok{if.}\NormalTok{ badrc }\KeywordTok{y=.}\NormalTok{ checknames }\KeywordTok{y} \KeywordTok{do.} \KeywordTok{y} \KeywordTok{return.} \KeywordTok{end.}
\NormalTok{obs}\KeywordTok{=.} \KeywordTok{y=.} \KeywordTok{\}.y}
\KeywordTok{if.}\NormalTok{ badrc tnl}\KeywordTok{=.}\NormalTok{ pathnl }\KeywordTok{x} \KeywordTok{do.}\NormalTok{ tnl }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. remove any empty dictionaries from path}
\NormalTok{tnl}\KeywordTok{=.} \KeywordTok{\}.}\NormalTok{ tnl}
\NormalTok{b}\KeywordTok{=.} \DecValTok{0}\KeywordTok{\&<@:\#\&>}\NormalTok{ tnl}
\NormalTok{tnl}\KeywordTok{=.}\NormalTok{ b}\KeywordTok{\#}\NormalTok{tnl }\KeywordTok{[}\NormalTok{ dpath}\KeywordTok{=.}\NormalTok{ b}\KeywordTok{\#}\NormalTok{DPATH}

\CommentTok{NB. if all objects are not on path get nothing}
\KeywordTok{if.} \KeywordTok{*./}\NormalTok{b}\KeywordTok{=.} \KeywordTok{y} \KeywordTok{e.} \KeywordTok{;}\NormalTok{ tnl }\KeywordTok{do.}

\NormalTok{  DL}\KeywordTok{=.}  \KeywordTok{\{:\{:}\NormalTok{DPATH                  }\CommentTok{NB. any object}
\NormalTok{  fp}\KeywordTok{=.}  \RegionMarkerTok{(}\KeywordTok{\{.>}\NormalTok{dncn}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{\{.x}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}P\_\_DL\textquotesingle{}}  \CommentTok{NB. file pointer}
\NormalTok{  res}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\#}\NormalTok{obs}\RegionMarkerTok{)}\KeywordTok{$a:}                  \CommentTok{NB. result list}

  \CommentTok{NB. run down path}
  \KeywordTok{for\_dp.}\NormalTok{ tnl }\KeywordTok{do.}
\NormalTok{    ix}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{dp}\KeywordTok{=.} \KeywordTok{>}\NormalTok{dp}\RegionMarkerTok{)} \KeywordTok{i.} \KeywordTok{y}

    \CommentTok{NB. get data in current dictionary}
    \KeywordTok{if.} \KeywordTok{+./}\NormalTok{bm}\KeywordTok{=.}\NormalTok{ ix}\KeywordTok{<\#}\NormalTok{dp }\KeywordTok{do.}
\NormalTok{      DL }\KeywordTok{=.} \KeywordTok{\{:}\NormalTok{dp\_index}\KeywordTok{\{}\NormalTok{dpath  }\CommentTok{NB. directory object !(*)=. DL}
      \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread }\RegionMarkerTok{(}\KeywordTok{".}\NormalTok{fp}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{CNEXPLAIN }\KeywordTok{do.}
\NormalTok{        jderr ERR088 }\KeywordTok{return.} \CommentTok{NB. errmsg: read failure}
      \KeywordTok{end.}
\NormalTok{      dat}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{bm}\KeywordTok{\#}\NormalTok{ix}\RegionMarkerTok{)}\KeywordTok{\{>}\NormalTok{dat}

      \CommentTok{NB. merge data into final result order matters here}
\NormalTok{      res}\KeywordTok{=.}\NormalTok{ dat }\RegionMarkerTok{(}\NormalTok{obs }\KeywordTok{i.}\NormalTok{ bm}\KeywordTok{\#y}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ res}

      \CommentTok{NB. remove fetched objects from list quit if no more}
      \KeywordTok{if.} \DecValTok{0}\KeywordTok{=\#y=.} \RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{bm}\RegionMarkerTok{)}\KeywordTok{\#y} \KeywordTok{do.} \KeywordTok{break.} \KeywordTok{end.}
    \KeywordTok{end.}
  \KeywordTok{end.}

  \CommentTok{NB. return objects in requested order}
\NormalTok{  ok }\KeywordTok{<}\NormalTok{obs }\KeywordTok{,.}\NormalTok{ res}

\KeywordTok{else.}
  \RegionMarkerTok{(}\NormalTok{jderr ERR083}\RegionMarkerTok{)}\KeywordTok{,y} \KeywordTok{\#\textasciitilde{}} \KeywordTok{{-}.}\NormalTok{ b  }\CommentTok{NB. errmsg: not on path}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{getgstext}\AlertTok{=:}\index{getgstext@\texttt{getgstext}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*getgstext v{-}{-} get group and suite text.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaObject getgstext blcl}

\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{x,}\DecValTok{0}\RegionMarkerTok{)}\NormalTok{ getobjects }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{else.}\NormalTok{ ok }\KeywordTok{<}\DecValTok{0} \DecValTok{1} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ rv uv }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{getntstamp}\AlertTok{=:}\index{getntstamp@\texttt{getntstamp}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*getntstamp v{-}{-} get name, creation and last put timestamps.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaDcode getntstamp blcl}
\CommentTok{NB.}
\CommentTok{NB.    1 getntstamp\_\_ST\_\_JODobj \}. 1 revo  \textquotesingle{}\textquotesingle{}}

\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{x,}\NormalTok{INCREATE}\KeywordTok{,}\NormalTok{INPUT}\RegionMarkerTok{)}\NormalTok{ invfetch }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{else.}\NormalTok{ ok }\KeywordTok{<}\RegionMarkerTok{(}\KeywordTok{<y}\RegionMarkerTok{)} \KeywordTok{,:} \DecValTok{1}\KeywordTok{\{}\NormalTok{uv }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{getobjects}\AlertTok{=:}\index{getobjects@\texttt{getobjects}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*getobjects  v{-}{-} fetches object names and values. A successful}
\CommentTok{NB. result  is  a  boxed  table. Column  0 holds  names remaining}
\CommentTok{NB. columns hold types and values. If there  is no  type or  name}
\CommentTok{NB. class only two columns are returned.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  il getobjects blcl}
\CommentTok{NB.}
\CommentTok{NB.   NB. 2 columns (name,value)}
\CommentTok{NB.   (TEST,0) getobjects ;:\textquotesingle{}some test names ehh\textquotesingle{}}
\CommentTok{NB.}
\CommentTok{NB.   NB. 3 columns (name,class,value)}
\CommentTok{NB.   (WORD,0) getobjects ;:\textquotesingle{}words are us\textquotesingle{}}

\KeywordTok{if.}\NormalTok{ badrc }\KeywordTok{y=.}\NormalTok{checknames }\KeywordTok{y} \KeywordTok{do.} \KeywordTok{y} \KeywordTok{return.} \KeywordTok{end.}
\NormalTok{ord}\KeywordTok{=.} \KeywordTok{y=.} \KeywordTok{\}.y}

\StringTok{\textquotesingle{}obj offset\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}
\KeywordTok{if.}\NormalTok{ badrc onl}\KeywordTok{=.}\NormalTok{ pathnl obj }\KeywordTok{do.}\NormalTok{ onl }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. remove any empty dictionaries from path}
\NormalTok{onl}\KeywordTok{=.} \KeywordTok{\}.}\NormalTok{ onl}
\NormalTok{b}\KeywordTok{=.} \DecValTok{0}\KeywordTok{\&<@:\#\&>}\NormalTok{ onl}
\NormalTok{onl}\KeywordTok{=.}\NormalTok{ b}\KeywordTok{\#}\NormalTok{onl }\KeywordTok{[}\NormalTok{ dpath }\KeywordTok{=.}\NormalTok{ b}\KeywordTok{\#}\NormalTok{DPATH}
\NormalTok{val}\KeywordTok{=.} \DecValTok{0} \DecValTok{0}\KeywordTok{$}\StringTok{\textquotesingle{}\textquotesingle{}}

\CommentTok{NB. if all objects are not on path get nothing}
\KeywordTok{if.} \KeywordTok{*./}\NormalTok{b}\KeywordTok{=.} \KeywordTok{y} \KeywordTok{e.} \KeywordTok{;}\NormalTok{ onl }\KeywordTok{do.}

\NormalTok{  doj}\KeywordTok{=.} \KeywordTok{\{:} \KeywordTok{\{.}\NormalTok{dpath            }\CommentTok{NB. any directory object}
\NormalTok{  cnn}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{uv}\KeywordTok{=.} \KeywordTok{>}\NormalTok{dncn\_\_doj obj}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_\_DL\textquotesingle{}}  \CommentTok{NB. object component noun name}
\NormalTok{  fp}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\{.}\NormalTok{uv}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}P\_\_DL\textquotesingle{}}         \CommentTok{NB. file pointer noun name}

  \CommentTok{NB. run down the path fetching first occurrences}
  \KeywordTok{for\_dp.}\NormalTok{ onl }\KeywordTok{do.}
\NormalTok{    ix}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{dp}\KeywordTok{=.} \KeywordTok{>}\NormalTok{dp}\RegionMarkerTok{)} \KeywordTok{i.} \KeywordTok{y}

    \CommentTok{NB. NIMP GETFACTOR not used yet}
    \CommentTok{NB. get any objects in current dictionary}
    \KeywordTok{if.} \KeywordTok{+./}\NormalTok{wf}\KeywordTok{=.}\NormalTok{ ix}\KeywordTok{<\#}\NormalTok{dp }\KeywordTok{do.}
\NormalTok{      DL}\KeywordTok{=.} \KeywordTok{\{:}\NormalTok{dp\_index}\KeywordTok{\{}\NormalTok{dpath  }\CommentTok{NB. directory object !(*)=. DL}
      \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread }\RegionMarkerTok{(}\KeywordTok{".}\NormalTok{fp}\RegionMarkerTok{)}\KeywordTok{;}\RegionMarkerTok{(}\NormalTok{wf}\KeywordTok{\#}\NormalTok{ix}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{offset}\KeywordTok{+".}\NormalTok{cnn }\KeywordTok{do.}
\NormalTok{        jderr ERR088 }\KeywordTok{return.} \CommentTok{NB. errmsg: read failure}
      \KeywordTok{end.}
\NormalTok{      val}\KeywordTok{=.}\NormalTok{ val }\KeywordTok{,} \KeywordTok{>}\NormalTok{dat}

      \CommentTok{NB. remove fetched objects from list quit if no more objects}
      \KeywordTok{if.} \DecValTok{0}\KeywordTok{=\#y=.} \RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{wf}\RegionMarkerTok{)}\KeywordTok{\#y} \KeywordTok{do.} \KeywordTok{break.} \KeywordTok{end.}
    \KeywordTok{end.}
  \KeywordTok{end.}

  \CommentTok{NB. insure objects are returned in requested order}
\NormalTok{  val}\KeywordTok{=.} \RegionMarkerTok{((}\KeywordTok{\{."}\DecValTok{1}\NormalTok{ val}\RegionMarkerTok{)} \KeywordTok{i.}\NormalTok{ ord}\RegionMarkerTok{)} \KeywordTok{\{}\NormalTok{ val}
\NormalTok{  ok }\KeywordTok{<}\NormalTok{val}

\KeywordTok{else.}
  \RegionMarkerTok{(}\NormalTok{jderr ERR083}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{b}\RegionMarkerTok{)}\KeywordTok{\#y} \CommentTok{NB. errmsg: not on path}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{getrefs}\AlertTok{=:}\index{getrefs@\texttt{getrefs}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*getrefs  v{-}{-} fetches reference lists. A  successful result is}
\CommentTok{NB. an OK  boxed table of  boxed  character lists. Column 0 holds}
\CommentTok{NB. names  and column  1  holds  boxed reference lists. Currently}
\CommentTok{NB. only words have stored  references  but  this verb  has  been}
\CommentTok{NB. coded to  allow  for additional  reference types  as the need}
\CommentTok{NB. arises.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaObject getrefs blcl}
\CommentTok{NB.}
\CommentTok{NB.   WORD getrefs ;:\textquotesingle{}get our references please\textquotesingle{}}

\KeywordTok{if.}\NormalTok{ badrc }\KeywordTok{y=.}\NormalTok{checknames }\KeywordTok{y} \KeywordTok{do.} \KeywordTok{y} \KeywordTok{return.} \KeywordTok{end.}
\KeywordTok{y=.} \KeywordTok{\}.y}

\CommentTok{NB. if all objects are not on path get nothing}
\KeywordTok{if.}\NormalTok{ badrc onl}\KeywordTok{=.}\NormalTok{ pathnl }\KeywordTok{x} \KeywordTok{do.}\NormalTok{ onl }\KeywordTok{return.} \KeywordTok{end.}
\KeywordTok{if.} \DecValTok{0} \KeywordTok{e.}\NormalTok{ b}\KeywordTok{=.} \KeywordTok{y} \KeywordTok{e.} \KeywordTok{;} \KeywordTok{\}.}\NormalTok{onl }\KeywordTok{do.}
  \RegionMarkerTok{(}\NormalTok{jderr ERR083}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{b}\RegionMarkerTok{)}\KeywordTok{\#y} \KeywordTok{return.}  \CommentTok{NB. errmsg: not on path}
\KeywordTok{end.}

\CommentTok{NB. reference table}
\NormalTok{rft }\KeywordTok{=.} \KeywordTok{i.} \DecValTok{0} \DecValTok{0}

\CommentTok{NB. objects with stored references}
\KeywordTok{if.}\NormalTok{ badrc onl}\KeywordTok{=.}\NormalTok{ pathref }\KeywordTok{x} \KeywordTok{do.}\NormalTok{ onl }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. remove dictionaries with no references from path}
\NormalTok{onl}\KeywordTok{=.} \KeywordTok{\}.}\NormalTok{ onl}
\NormalTok{b}\KeywordTok{=.} \DecValTok{0}\KeywordTok{\&<@:\#\&>}\NormalTok{ onl}
\NormalTok{onl}\KeywordTok{=.}\NormalTok{ b}\KeywordTok{\#}\NormalTok{onl }\KeywordTok{[}\NormalTok{ dpath }\KeywordTok{=.}\NormalTok{ b}\KeywordTok{\#}\NormalTok{DPATH}

\CommentTok{NB. if any stored references get them}
\KeywordTok{if.} \KeywordTok{\#}\NormalTok{dpath }\KeywordTok{do.}

  \CommentTok{NB. reference component noun name in directory object}
\NormalTok{  DL}\KeywordTok{=.} \KeywordTok{\{:\{.}\NormalTok{ dpath}
\NormalTok{  cnn}\KeywordTok{=.} \KeywordTok{>}\DecValTok{0}\NormalTok{ dnrn}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{x}

  \CommentTok{NB. run down the path fetching the first occurrences}
  \KeywordTok{for\_dp.}\NormalTok{ onl }\KeywordTok{do.}
\NormalTok{    rix}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{dp}\KeywordTok{=.} \KeywordTok{>}\NormalTok{dp}\RegionMarkerTok{)} \KeywordTok{i.} \KeywordTok{y}

    \CommentTok{NB. NIMP GETFACTOR not used yet}
    \CommentTok{NB. if any references in current dictionary get them}
    \KeywordTok{if.} \KeywordTok{+./}\NormalTok{rf}\KeywordTok{=.}\NormalTok{ rix}\KeywordTok{<\#}\NormalTok{dp }\KeywordTok{do.}
\NormalTok{      DL}\KeywordTok{=.} \KeywordTok{\{:}\NormalTok{dp\_index}\KeywordTok{\{}\NormalTok{dpath  }\CommentTok{NB. directory object !(*)=. DL}
      \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread UF}\DecValTok{\_\_}\NormalTok{DL}\KeywordTok{;}\RegionMarkerTok{(}\NormalTok{rf}\KeywordTok{\#}\NormalTok{rix}\RegionMarkerTok{)}\KeywordTok{\{".}\NormalTok{cnn}\KeywordTok{,}\StringTok{\textquotesingle{}\_\_DL\textquotesingle{}} \KeywordTok{do.}
\NormalTok{        jderr ERR088 }\KeywordTok{return.}  \CommentTok{NB. errmsg: read failure}
      \KeywordTok{end.}
\NormalTok{      rft}\KeywordTok{=.}\NormalTok{ rft }\KeywordTok{,} \KeywordTok{>}\NormalTok{dat}

      \CommentTok{NB. remove names with fetched references from list quit if no more}
      \KeywordTok{if.} \DecValTok{0}\KeywordTok{=\#y=.} \RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{rf}\RegionMarkerTok{)}\KeywordTok{\#y} \KeywordTok{do.} \KeywordTok{break.} \KeywordTok{end.}
    \KeywordTok{end.}
  \KeywordTok{end.}
\KeywordTok{end.}

\CommentTok{NB. any remaining objects currently have no stored references}
\KeywordTok{if.} \KeywordTok{\#y} \KeywordTok{do.}\NormalTok{ ok }\KeywordTok{<}\NormalTok{rft }\KeywordTok{,} \RegionMarkerTok{(}\KeywordTok{y} \KeywordTok{,"}\DecValTok{0} \DecValTok{1} \KeywordTok{<x}\RegionMarkerTok{)}\KeywordTok{,.<}\StringTok{\textquotesingle{}\textquotesingle{}}\KeywordTok{;}\StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{else.}\NormalTok{ ok }\KeywordTok{<}\NormalTok{rft }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gslistnl}\AlertTok{=:}\index{gslistnl@\texttt{gslistnl}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*gslistnl v{-}{-} returns  a group or  suite name list.  Prior  to}
\CommentTok{NB. calling this verb a  dictionary  must be  open  and  the (x)}
\CommentTok{NB. object code argument validated. The name list returned is the}
\CommentTok{NB. first one found on the current path.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaObject gslistnl clName}
\CommentTok{NB.}
\CommentTok{NB.  GROUP gslistnl \textquotesingle{}groupname\textquotesingle{}}

\KeywordTok{if.}\NormalTok{ badrc path}\KeywordTok{=.}\NormalTok{ pathnl }\KeywordTok{x} \KeywordTok{do.}\NormalTok{ path }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{uv}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{path}\KeywordTok{=.} \KeywordTok{\}.}\NormalTok{path}\RegionMarkerTok{)}\NormalTok{ fopix }\KeywordTok{y}

\KeywordTok{if.}\NormalTok{ uv}\KeywordTok{=\#}\NormalTok{path }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR083}\RegionMarkerTok{)}\KeywordTok{,<y} \KeywordTok{return.} \KeywordTok{end.} \CommentTok{NB. errmsg: not on path}

\NormalTok{uv}\KeywordTok{=.} \KeywordTok{\{:}\NormalTok{uv}\KeywordTok{\{}\NormalTok{DPATH  }\CommentTok{NB. directory object reference (*)=. uv}

\NormalTok{cn}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{".}\RegionMarkerTok{(}\NormalTok{ln}\KeywordTok{=.} \KeywordTok{>}\NormalTok{dnix\_\_uv }\KeywordTok{x}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_\_uv\textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{i.} \KeywordTok{<y}
\NormalTok{cn}\KeywordTok{=.}\NormalTok{ cn }\KeywordTok{\{} \KeywordTok{".}\RegionMarkerTok{(}\KeywordTok{>}\NormalTok{dncn\_\_uv }\KeywordTok{x}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_\_uv\textquotesingle{}}    \CommentTok{NB. file component of list}

\KeywordTok{if.}\NormalTok{ badjr cn}\KeywordTok{=.}\NormalTok{ jread }\RegionMarkerTok{(}\KeywordTok{".}\RegionMarkerTok{(}\KeywordTok{\{.}\NormalTok{ln}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}P\_\_uv\textquotesingle{}}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{cn }\KeywordTok{do.}
\NormalTok{  jderr ERR084 }\CommentTok{NB. errmsg: unable to read data}
\KeywordTok{else.}
\NormalTok{  ok }\KeywordTok{>\{:>}\NormalTok{cn  }\CommentTok{NB. stored list is unique and sorted}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{inputdict}\AlertTok{=:}\index{inputdict@\texttt{inputdict}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*inputdict v{-}{-} tests for objects in put dictionary}
\CommentTok{NB.}
\CommentTok{NB. dyad:  (iaObject ;< ba) inputdict blcl}
\CommentTok{NB.}
\CommentTok{NB.  (WORD;<DL) inputdict ;:\textquotesingle{}are we in put dictionary\textquotesingle{}}

\StringTok{\textquotesingle{}obj DL\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}  \CommentTok{NB. directory object !(*)=. DL}

\CommentTok{NB. errmsg: unable to load directory}
\KeywordTok{if.}\NormalTok{ loaddir}\DecValTok{\_\_}\NormalTok{DL obj }\KeywordTok{do.}\NormalTok{ jderr ERR054}
\KeywordTok{elseif.}\NormalTok{ ix}\KeywordTok{=.} \KeywordTok{".}\RegionMarkerTok{(}\KeywordTok{>}\NormalTok{dnix}\DecValTok{\_\_}\NormalTok{DL obj}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_\_DL\textquotesingle{}}
  \KeywordTok{*./}\NormalTok{b}\KeywordTok{=.} \KeywordTok{y} \KeywordTok{e.}\NormalTok{ ix }\KeywordTok{do.}\NormalTok{ OK}
\KeywordTok{elseif.do.}
  \RegionMarkerTok{(}\NormalTok{jderr ERR086}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{b}\RegionMarkerTok{)}\KeywordTok{\#y} \CommentTok{NB. errmsg: not in put dictionary}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{invappend}\AlertTok{=:}\index{invappend@\texttt{invappend}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*invappend v{-}{-} appends items to inverted data lists.  The (x)}
\CommentTok{NB. argument is a boxed list append  list. (y)  is  a boxed list}
\CommentTok{NB. containing a file pointer and inverted component numbers.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  blul invappend blul}
\CommentTok{NB.}
\CommentTok{NB.   apps invappend WF\_\_DL ; CNCLASS,CNPUTDATE,CNSIZE}

\NormalTok{msg}\KeywordTok{=.}\NormalTok{ ERR057  }\CommentTok{NB. errmsg: directory update failure}

\CommentTok{NB. file pointer \& component list}
\StringTok{\textquotesingle{}fp cmpl\textquotesingle{}}\KeywordTok{=.} \KeywordTok{y}
\KeywordTok{if.} \RegionMarkerTok{(}\KeywordTok{\#x}\RegionMarkerTok{)}\KeywordTok{\textasciitilde{}:\#}\NormalTok{cmpl }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{rc}\KeywordTok{=.} \KeywordTok{i.}\DecValTok{0}

\CommentTok{NB. get the total number of expected elements from 0 component}
\KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread fp}\KeywordTok{;}\NormalTok{CNMARK }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{oldlen}\KeywordTok{=.} \KeywordTok{>\{.>}\NormalTok{dat}

\CommentTok{NB. loop for maximum safety and space savings}
\KeywordTok{for\_cn.}\NormalTok{ cmpl }\KeywordTok{do.}

  \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread fp}\KeywordTok{;}\NormalTok{cn }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{  dat}\KeywordTok{=.} \KeywordTok{>}\NormalTok{dat}

  \CommentTok{NB. all inverted list lengths must match expected}
  \KeywordTok{if.}\NormalTok{ oldlen }\KeywordTok{\textasciitilde{}:} \KeywordTok{\#}\NormalTok{dat }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{return.} \KeywordTok{end.}

\NormalTok{  dat}\KeywordTok{=.}\NormalTok{ dat }\KeywordTok{,} \KeywordTok{>}\NormalTok{cn\_index}\KeywordTok{\{x}
\NormalTok{  rc}\KeywordTok{=.}\NormalTok{ rc}\KeywordTok{,} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{dat}\RegionMarkerTok{)}\NormalTok{ jreplace fp }\KeywordTok{;}\NormalTok{ cn}
\KeywordTok{end.}

\CommentTok{NB. test replacements for errors}
\KeywordTok{if.}\NormalTok{ badreps rc }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{else.}\NormalTok{ OK }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{invdelete}\AlertTok{=:}\index{invdelete@\texttt{invdelete}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*invdelete v{-}{-}  deletes items  from  inverted data lists.  The}
\CommentTok{NB. (x)  argument  is a mask list. (y) consists of a boxed list}
\CommentTok{NB. containing a file pointer and inverted component numbers.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  pl invdelete blul}
\CommentTok{NB.}
\CommentTok{NB.   mask invdelete WF\_\_DL ; CNCLASS,CNPUTDATE,CNCREATION,CNSIZE}

\CommentTok{NB. file pointer \& component list}
\StringTok{\textquotesingle{}fp cmpl\textquotesingle{}}\KeywordTok{=.} \KeywordTok{y}
\NormalTok{msg}\KeywordTok{=.}\NormalTok{ ERR057  }\CommentTok{NB. errmsg: directory update failure}
\NormalTok{rc}\KeywordTok{=.} \KeywordTok{i.}\DecValTok{0} \KeywordTok{[}\NormalTok{ len}\KeywordTok{=.} \KeywordTok{\#x}

\CommentTok{NB. get the total number of expected elements from 0 component}
\KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread fp}\KeywordTok{;}\NormalTok{CNMARK }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{oldlen}\KeywordTok{=.} \KeywordTok{>\{.>}\NormalTok{dat}

\CommentTok{NB. loop for maximum safety and space savings}
\KeywordTok{for\_cn.}\NormalTok{ cmpl }\KeywordTok{do.}

  \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread fp}\KeywordTok{;}\NormalTok{cn }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{  dat}\KeywordTok{=.} \KeywordTok{>}\NormalTok{dat}

  \CommentTok{NB. all inverted list lengths must match expected}
  \KeywordTok{if.}\NormalTok{ oldlen }\KeywordTok{\textasciitilde{}:} \KeywordTok{\#}\NormalTok{dat }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{return.} \KeywordTok{end.}

\NormalTok{  rc}\KeywordTok{=.}\NormalTok{ rc}\KeywordTok{,} \RegionMarkerTok{(}\KeywordTok{<x\#}\NormalTok{dat}\RegionMarkerTok{)}\NormalTok{ jreplace fp}\KeywordTok{;}\NormalTok{cn}
\KeywordTok{end.}

\CommentTok{NB. test replacements for errors}
\KeywordTok{if.}\NormalTok{ badreps rc }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{else.}\NormalTok{ OK }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{invfetch}\AlertTok{=:}\index{invfetch@\texttt{invfetch}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*invfetch  v{-}{-}  reads  inverted   numerical  data  lists  from}
\CommentTok{NB. dictionary  files.  Assumes  the  (x)   argument   has  been}
\CommentTok{NB. validated prior to calling.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  ilDcodes invfetch blcl}
\CommentTok{NB.}
\CommentTok{NB.   NB. first code is JOD object code}
\CommentTok{NB.   0 12 13 14 15 invfetch\_\_ST\_\_JODobj \}. dnl\textquotesingle{}\textquotesingle{}}
\CommentTok{NB.   2 13 14  invfetch\_\_ST\_\_JODobj \}. 2 dnl\textquotesingle{}\textquotesingle{}}
\CommentTok{NB.   (SUITE\_ajod\_,INCREATE\_ajod\_,INPUT\_ajod\_) invfetch\_\_ST\_\_JODobj \}. SUITE\_ajod\_ dnl\textquotesingle{}\textquotesingle{}}

\KeywordTok{if.}\NormalTok{ badrc }\KeywordTok{y=.}\NormalTok{ checknames }\KeywordTok{y} \KeywordTok{do.} \KeywordTok{y} \KeywordTok{return.} \KeywordTok{end.}
\NormalTok{obs}\KeywordTok{=.} \KeywordTok{y=.} \KeywordTok{\}.y}
\KeywordTok{if.}\NormalTok{ badrc tnl}\KeywordTok{=.}\NormalTok{ pathnl }\KeywordTok{\{.x} \KeywordTok{do.}\NormalTok{ tnl }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. remove any empty dictionaries from path}
\NormalTok{tnl}\KeywordTok{=.} \KeywordTok{\}.}\NormalTok{ tnl}
\NormalTok{b}\KeywordTok{=.} \DecValTok{0}\KeywordTok{\&<@:\#\&>}\NormalTok{ tnl}
\NormalTok{tnl}\KeywordTok{=.}\NormalTok{ b}\KeywordTok{\#}\NormalTok{tnl }\KeywordTok{[}\NormalTok{ dpath}\KeywordTok{=.}\NormalTok{ b}\KeywordTok{\#}\NormalTok{DPATH}

\CommentTok{NB. if all objects are not on path get nothing}
\KeywordTok{if.} \KeywordTok{*./}\NormalTok{b}\KeywordTok{=.} \KeywordTok{y} \KeywordTok{e.} \KeywordTok{;}\NormalTok{ tnl }\KeywordTok{do.}

  \CommentTok{NB. map external codes to inverted data components}
\NormalTok{  cninv}\KeywordTok{=.} \RegionMarkerTok{((}\DecValTok{0}\KeywordTok{\{}\NormalTok{INCNXR}\RegionMarkerTok{)} \KeywordTok{i.} \KeywordTok{\}.x}\RegionMarkerTok{)} \KeywordTok{\{} \DecValTok{1}\KeywordTok{\{}\NormalTok{INCNXR   }\CommentTok{NB. object noun !(*)=. INCNXR}
\NormalTok{  DL}\KeywordTok{=.}    \KeywordTok{\{:\{:}\NormalTok{DPATH                  }\CommentTok{NB. any object}
\NormalTok{  fp}\KeywordTok{=.}    \RegionMarkerTok{(}\KeywordTok{\{.>}\NormalTok{dncn}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{\{.x}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}P\_\_DL\textquotesingle{}}  \CommentTok{NB. file pointer}
\NormalTok{  res}\KeywordTok{=.}   \RegionMarkerTok{((}\KeywordTok{\#}\NormalTok{cninv}\RegionMarkerTok{)}\KeywordTok{,\#}\NormalTok{obs}\RegionMarkerTok{)}\KeywordTok{$}\DecValTok{0}          \CommentTok{NB. result table}

  \CommentTok{NB. run down path}
  \KeywordTok{for\_dp.}\NormalTok{ tnl }\KeywordTok{do.}
\NormalTok{    ix}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{dp}\KeywordTok{=.} \KeywordTok{>}\NormalTok{dp}\RegionMarkerTok{)} \KeywordTok{i.} \KeywordTok{y}

    \CommentTok{NB. get data in current dictionary}
    \KeywordTok{if.} \KeywordTok{+./}\NormalTok{bm}\KeywordTok{=.}\NormalTok{ ix}\KeywordTok{<\#}\NormalTok{dp }\KeywordTok{do.}
\NormalTok{      DL }\KeywordTok{=.} \KeywordTok{\{:}\NormalTok{dp\_index}\KeywordTok{\{}\NormalTok{dpath  }\CommentTok{NB. directory object !(*)=. DL}
      \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread }\RegionMarkerTok{(}\KeywordTok{".}\NormalTok{fp}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{cninv }\KeywordTok{do.}
\NormalTok{        jderr ERR088 }\KeywordTok{return.} \CommentTok{NB. errmsg: read failure}
      \KeywordTok{end.}
\NormalTok{      dat}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{bm}\KeywordTok{\#}\NormalTok{ix}\RegionMarkerTok{)} \KeywordTok{\{"}\DecValTok{1} \KeywordTok{>}\NormalTok{ dat}

      \CommentTok{NB. merge data into final result order matters here}
\NormalTok{      res}\KeywordTok{=.}\NormalTok{ dat }\RegionMarkerTok{(}\KeywordTok{<a:;}\NormalTok{obs }\KeywordTok{i.}\NormalTok{ bm}\KeywordTok{\#y}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ res}

      \CommentTok{NB. remove fetched objects from list quit if no more}
      \KeywordTok{if.} \DecValTok{0}\KeywordTok{=\#y=.} \RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{bm}\RegionMarkerTok{)}\KeywordTok{\#y} \KeywordTok{do.} \KeywordTok{break.} \KeywordTok{end.}
    \KeywordTok{end.}
  \KeywordTok{end.}

  \CommentTok{NB. returns a list when only one item otherwise table}
\NormalTok{  ok }\KeywordTok{<} \KeywordTok{]\textasciigrave{},@.}\RegionMarkerTok{(}\DecValTok{1}\KeywordTok{\&=@:\#}\RegionMarkerTok{)}\NormalTok{ res}

\KeywordTok{else.}
  \RegionMarkerTok{(}\NormalTok{jderr ERR083}\RegionMarkerTok{)}\KeywordTok{,y} \KeywordTok{\#\textasciitilde{}} \KeywordTok{{-}.}\NormalTok{ b  }\CommentTok{NB. errmsg: not on path}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{invreplace}\AlertTok{=:}\index{invreplace@\texttt{invreplace}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*invreplace v{-}{-} replaces  items  from inverted data lists. The}
\CommentTok{NB. (x) argument is a boxed list of positions and  replacements.}
\CommentTok{NB. (y) is a  boxed list containing a file pointer and  inverted}
\CommentTok{NB. component numbers.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  blul invreplace blul}
\CommentTok{NB.}
\CommentTok{NB.   (pos;reps) invreplace WF\_\_DL ; CNCLASS,CNPUTDATE,CNSIZE}

\NormalTok{msg}\KeywordTok{=.}\NormalTok{ ERR057  }\CommentTok{NB. errmsg: directory update failure}

\CommentTok{NB. file pointer \& component list}
\StringTok{\textquotesingle{}fp cmpl\textquotesingle{}}\KeywordTok{=.}  \KeywordTok{y}
\StringTok{\textquotesingle{}pos repl\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}
\KeywordTok{if.} \RegionMarkerTok{(}\KeywordTok{\#}\NormalTok{repl}\RegionMarkerTok{)}\KeywordTok{\textasciitilde{}:\#}\NormalTok{cmpl }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{rc}\KeywordTok{=.} \KeywordTok{i.}\DecValTok{0}

\CommentTok{NB. replacements do not change the length of inverted lists}
\CommentTok{NB. get the total number of elements from 0 component}
\KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread fp}\KeywordTok{;}\NormalTok{CNMARK }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{len}\KeywordTok{=.} \KeywordTok{>\{.>}\NormalTok{dat}

\CommentTok{NB. loop for maximum safety and space savings}
\KeywordTok{for\_cn.}\NormalTok{ cmpl }\KeywordTok{do.}

  \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread fp}\KeywordTok{;}\NormalTok{cn }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{  dat}\KeywordTok{=.} \KeywordTok{>}\NormalTok{dat}

  \CommentTok{NB. all inverted list lengths must match}
  \KeywordTok{if.}\NormalTok{ len }\KeywordTok{\textasciitilde{}:} \KeywordTok{\#}\NormalTok{dat }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{return.} \KeywordTok{end.}

\NormalTok{  dat}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{>}\NormalTok{cn\_index}\KeywordTok{\{}\NormalTok{repl}\RegionMarkerTok{)}\NormalTok{ pos}\KeywordTok{\}}\NormalTok{ dat}
\NormalTok{  rc}\KeywordTok{=.}\NormalTok{ rc}\KeywordTok{,} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{dat}\RegionMarkerTok{)}\NormalTok{ jreplace fp }\KeywordTok{;}\NormalTok{ cn}
\KeywordTok{end.}

\CommentTok{NB. test replacements for errors}
\KeywordTok{if.}\NormalTok{ badreps rc }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{else.}\NormalTok{ OK }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. 1 if dictionary is a library}
\NormalTok{islib}\AlertTok{=:}\index{islib@\texttt{islib}} \StringTok{\textquotesingle{}*\textquotesingle{}}\KeywordTok{"}\NormalTok{\_ }\KeywordTok{=} \KeywordTok{[:} \KeywordTok{\{.} \KeywordTok{[:} \KeywordTok{>} \KeywordTok{\{.}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iswriteable}\AlertTok{=:}\index{iswriteable@\texttt{iswriteable}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*iswriteable  v{-}{-}  tests  a blcl of full  path file  names for}
\CommentTok{NB. writeablity.}
\CommentTok{NB.}
\CommentTok{NB. This verb takes  a list of full path file names and tests the}
\CommentTok{NB. read/write status of  the files.  The  result is boolean list}
\CommentTok{NB. with 1 denoting "writeable" and 0 denoting "not{-}writeable."}
\CommentTok{NB.}
\CommentTok{NB. monad:  pl =. iswriteable blclPathFile}

\KeywordTok{if.}\NormalTok{ IFWIN }\KeywordTok{do.}\NormalTok{ iswriteablewin }\KeywordTok{y} \KeywordTok{else.}\NormalTok{ iswriteablelinux }\KeywordTok{y} \KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iswriteablelinux}\AlertTok{=:}\index{iswriteablelinux@\texttt{iswriteablelinux}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*iswriteablelinux  v{-}{-} tests a blcl of full path  linux  files}
\CommentTok{NB. for writeablity.}
\CommentTok{NB.}
\CommentTok{NB. monad:  pl =. iswriteablelinux blclPathFile}

\CommentTok{NB. NIMP: check linux file read/write/access status}
\CommentTok{NB. NIMP: returns all 1\textquotesingle{}s for now}
\RegionMarkerTok{(}\KeywordTok{\#,y}\RegionMarkerTok{)}\KeywordTok{\#}\DecValTok{1}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. tests permissions/attributes of a blcl of full path file names for writeablity}
\NormalTok{iswriteablewin}\AlertTok{=:}\index{iswriteablewin@\texttt{iswriteablewin}} \StringTok{\textquotesingle{}w{-}\textquotesingle{}}\KeywordTok{"}\NormalTok{\_ }\KeywordTok{{-}:"}\DecValTok{1} \KeywordTok{[:} \KeywordTok{]} \DecValTok{1} \DecValTok{3}\KeywordTok{"}\NormalTok{\_ }\KeywordTok{\{"}\DecValTok{1} \KeywordTok{[:} \KeywordTok{;"}\DecValTok{1} \KeywordTok{[:} \KeywordTok{]} \KeywordTok{\_2:} \KeywordTok{\{."}\DecValTok{1} \KeywordTok{[:} \KeywordTok{>} \KeywordTok{[:} \KeywordTok{,\&}\RegionMarkerTok{(}\DecValTok{1}\KeywordTok{!:}\DecValTok{0}\RegionMarkerTok{)}\KeywordTok{\&.>} \KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{jdatcreate}\AlertTok{=:}\index{jdatcreate@\texttt{jdatcreate}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*jdatcreate v{-}{-} creates an empty dictionary data file. (y) is}
\CommentTok{NB. a path and (x) is a file name}
\CommentTok{NB.}
\CommentTok{NB. dyad:  clFile jdatcreate clPath}
\CommentTok{NB.}
\CommentTok{NB.   \textquotesingle{}jtests\textquotesingle{} jdatcreate \textquotesingle{}c:\textbackslash{}temp\textbackslash{}jdict2a\textbackslash{}\textquotesingle{}}
\CommentTok{NB.   \textquotesingle{}jgroups\textquotesingle{} jdatcreate \textquotesingle{}c:\textbackslash{}blanks are cool\textbackslash{}jdict 2a\textbackslash{}\textquotesingle{}}

\NormalTok{fn}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{alltrim }\KeywordTok{y}\RegionMarkerTok{)} \KeywordTok{,} \KeywordTok{x} \KeywordTok{{-}.} \StringTok{\textquotesingle{} \textquotesingle{}}
\NormalTok{msg}\KeywordTok{=.}\NormalTok{ ERR052 }\CommentTok{NB. errmsg: unable to initialize}

\KeywordTok{if.}     \KeywordTok{{-}.}\NormalTok{jcreate fn }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr msg}\RegionMarkerTok{)}\KeywordTok{,<}\NormalTok{fn}
\KeywordTok{elseif.}\NormalTok{ c}\KeywordTok{=.} \KeywordTok{<} \DecValTok{0} \KeywordTok{;}\NormalTok{ t}\KeywordTok{=.}\NormalTok{ now }\StringTok{\textquotesingle{}\textquotesingle{}}        \CommentTok{NB. length and directory stamp}
\NormalTok{        c}\KeywordTok{=.}\NormalTok{ c }\KeywordTok{,} \KeywordTok{<}\StringTok{\textquotesingle{}\textquotesingle{}}                 \CommentTok{NB. c1 RESERVED}
\NormalTok{        badappend c}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{c }\KeywordTok{,} \RegionMarkerTok{(}\NormalTok{OFFSET}\KeywordTok{{-}\#}\NormalTok{c}\RegionMarkerTok{)} \KeywordTok{\#} \KeywordTok{a:}\RegionMarkerTok{)}\NormalTok{ jappend fn }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr msg}\RegionMarkerTok{)}\KeywordTok{,<}\NormalTok{fn}
\KeywordTok{elseif.} \KeywordTok{do.}
\NormalTok{ ok }\KeywordTok{\{:}\NormalTok{ c  }\CommentTok{NB. return last component}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{jwordscreate}\AlertTok{=:}\index{jwordscreate@\texttt{jwordscreate}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*jwordscreate v{-}{-} creates an empty word file. (y) argument is}
\CommentTok{NB. a  fully  qualified  file  name.  (x)  is  a  boxed list  of}
\CommentTok{NB. dictionary  creation  parameters.  The  target  directory  is}
\CommentTok{NB. assumed to exist. Result is a return code and message.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  blParms jwordscreate clFile}
\CommentTok{NB.}
\CommentTok{NB.  (doc;parms) jwordscreate \textquotesingle{}c:\textbackslash{}temp\textbackslash{}jdict2a\textbackslash{}jwords\textquotesingle{} NB. no extension}

\NormalTok{msg}\KeywordTok{=.}\NormalTok{ ERR052 }\CommentTok{NB. errmsg: unable to initialize}

\KeywordTok{if.}     \KeywordTok{{-}.}\NormalTok{jcreate }\KeywordTok{y}  \KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr msg}\RegionMarkerTok{)}\KeywordTok{,<y}
\KeywordTok{elseif.}\NormalTok{ c}\KeywordTok{=.} \KeywordTok{<} \DecValTok{0} \KeywordTok{;}\NormalTok{ t}\KeywordTok{=.}\NormalTok{ now }\StringTok{\textquotesingle{}\textquotesingle{}}        \CommentTok{NB. c0 length and directory stamp}
\NormalTok{        c}\KeywordTok{=.}\NormalTok{ c }\KeywordTok{,} \KeywordTok{<}\StringTok{\textquotesingle{}\textquotesingle{}}                 \CommentTok{NB. c1 RESERVED}
\NormalTok{        c}\KeywordTok{=.}\NormalTok{ c }\KeywordTok{,} \DecValTok{0}\KeywordTok{\{x}                 \CommentTok{NB. c2 this dictionary\textquotesingle{}s documentation}
\NormalTok{        c}\KeywordTok{=.}\NormalTok{ c }\KeywordTok{,} \KeywordTok{<\}.} \KeywordTok{x}               \CommentTok{NB. c3 dictionary parameters}
\NormalTok{        badappend c}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{c }\KeywordTok{,} \RegionMarkerTok{(}\NormalTok{OFFSET}\KeywordTok{{-}\#}\NormalTok{c}\RegionMarkerTok{)} \KeywordTok{\#} \KeywordTok{a:}\RegionMarkerTok{)}\NormalTok{ jappend }\KeywordTok{y} \KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr msg}\RegionMarkerTok{)}\KeywordTok{,<y}
\KeywordTok{elseif.} \KeywordTok{do.}
\NormalTok{ ok }\KeywordTok{\{:}\NormalTok{ c  }\CommentTok{NB. return last component}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{loadalldirs}\AlertTok{=:}\index{loadalldirs@\texttt{loadalldirs}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*loadalldirs v{-}{-} loads all (x) directories for each open (y)}
\CommentTok{NB. dictionary.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaObject loadalldirs blcl}
\CommentTok{NB.}
\CommentTok{NB.   WORD loadalldirs \{:"1 DPATH}

\KeywordTok{x=.} \KeywordTok{|x}
\KeywordTok{for\_oj.} \KeywordTok{y} \KeywordTok{do.}
  \KeywordTok{if.}\NormalTok{ loaddir\_\_oj }\KeywordTok{x} \KeywordTok{do.}
\NormalTok{    jderr ERR054 }\KeywordTok{return.} \CommentTok{NB. errmsg: unable to load directory}
  \KeywordTok{end.}
\KeywordTok{end.}
\NormalTok{OK}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{loadallrefs}\AlertTok{=:}\index{loadallrefs@\texttt{loadallrefs}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*loadallrefs v{-}{-} loads all references for (y) dictionary.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaObject loadallrefs blcl}
\CommentTok{NB.}
\CommentTok{NB.   WORD loadallrefs \{:"1 DPATH}

\KeywordTok{for\_oj.} \KeywordTok{y} \KeywordTok{do.}
  \KeywordTok{if.}\NormalTok{ loadref\_\_oj }\KeywordTok{x} \KeywordTok{do.}
\NormalTok{    jderr ERR079 }\KeywordTok{return.} \CommentTok{NB. errmsg: unable to load references}
  \KeywordTok{end.}
\KeywordTok{end.}
\NormalTok{OK}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{loadwords}\AlertTok{=:}\index{loadwords@\texttt{loadwords}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*loadwords v{-}{-} loads dictionary words into target locales.}

\NormalTok{DL}\KeywordTok{=.} \KeywordTok{\{:} \KeywordTok{y}  \CommentTok{NB. obfuscate (/:)=: directory object !(*)=. DL}

\CommentTok{NB. NIMP GETFACTOR not used yet}
\CommentTok{NB. read words and determine name class}
\KeywordTok{if.}\NormalTok{ badjr wu}\KeywordTok{=.}\NormalTok{ jread WF}\DecValTok{\_\_}\NormalTok{DL}\KeywordTok{;x\{}\NormalTok{WORDCN}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{do.}
\NormalTok{  jderr ERR088  }\CommentTok{NB. errmsg: read failure}
\KeywordTok{else.}
\NormalTok{  bu}\KeywordTok{=.}   \DecValTok{0} \KeywordTok{\textasciitilde{}:} \KeywordTok{;} \DecValTok{1}\KeywordTok{\&\{\&>}\NormalTok{ wu}
\NormalTok{  loc}\KeywordTok{=.} \KeywordTok{>\{.} \KeywordTok{y}  \CommentTok{NB. target locale}

  \CommentTok{NB. define words that are not nouns}
  \CommentTok{NB. NIMP may be able to speed things up by switching}
  \CommentTok{NB. to target locale in top of script and then switching}
  \CommentTok{NB. back to current {-} eliminates need to hard wire target locale}
  \CommentTok{NB. to each word.}

  \KeywordTok{try.}
    \KeywordTok{if.} \KeywordTok{\#}\NormalTok{vu}\KeywordTok{=.}\NormalTok{ bu}\KeywordTok{\#}\NormalTok{wu }\KeywordTok{do.}
      \DecValTok{0}\KeywordTok{!:}\DecValTok{0}  \KeywordTok{;} \RegionMarkerTok{((}\KeywordTok{\{.\&>}\NormalTok{ vu}\RegionMarkerTok{)} \KeywordTok{,\&.>} \KeywordTok{<}\NormalTok{loc}\KeywordTok{,}\StringTok{\textquotesingle{}=:\textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{,\&.>} \RegionMarkerTok{(}\KeywordTok{\{:\&>}\NormalTok{ vu}\RegionMarkerTok{)} \KeywordTok{,\&.>} \KeywordTok{<}\NormalTok{LF}
    \KeywordTok{end.}

    \CommentTok{NB. define nouns {-} override mixed assignments (<:)=:}
    \KeywordTok{if.} \KeywordTok{\#}\NormalTok{nu}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{bu}\RegionMarkerTok{)}\KeywordTok{\#}\NormalTok{wu }\KeywordTok{do.}
\NormalTok{      vu}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\{.\&>}\NormalTok{ nu}\RegionMarkerTok{)} \KeywordTok{,\&.>} \KeywordTok{<}\NormalTok{loc}
      \RegionMarkerTok{(}\NormalTok{vu}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}  \RegionMarkerTok{(}\DecValTok{3}\KeywordTok{!:}\DecValTok{2}\RegionMarkerTok{)}\KeywordTok{\&.>} \KeywordTok{\{:\&>}\NormalTok{ nu}
    \KeywordTok{end.}
  \KeywordTok{catch.}\NormalTok{ jderr ERR091 }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{  OK}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mainddir}\AlertTok{=:}\index{mainddir@\texttt{mainddir}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*mainddir v{-}{-}  creates  the main  dictionary  directory from a}
\CommentTok{NB. path.}
\CommentTok{NB.}
\CommentTok{NB. monad:  mainddir clPath}
\CommentTok{NB.}
\CommentTok{NB.   mainddir \textquotesingle{}c:\textbackslash{}go\textbackslash{}ahead\textbackslash{}create\textbackslash{}my\textbackslash{}directory\textquotesingle{}}

\CommentTok{NB.\#ASSERT 0 < \#y.}
\KeywordTok{y=.}  \RegionMarkerTok{(}\KeywordTok{{-}}\NormalTok{PATHDEL}\KeywordTok{=\{:} \KeywordTok{y}\RegionMarkerTok{)} \KeywordTok{\}.} \KeywordTok{y} \KeywordTok{,}\NormalTok{ PATHDEL}
\NormalTok{drv}\KeywordTok{=.}\NormalTok{ alltrim }\RegionMarkerTok{(}\KeywordTok{,\&}\StringTok{\textquotesingle{}:\textquotesingle{}}\KeywordTok{\textasciigrave{}]@.}\RegionMarkerTok{(}\DecValTok{0}\KeywordTok{\&=@:\#}\RegionMarkerTok{))}\NormalTok{ justdrv }\KeywordTok{y}

\CommentTok{NB. standard path format}
\NormalTok{sp}\KeywordTok{=.}\NormalTok{ alltrim justpath }\KeywordTok{y}
\KeywordTok{y=.}\NormalTok{ drv}\KeywordTok{,}\NormalTok{sp}\KeywordTok{,}\NormalTok{PATHDEL}

\CommentTok{NB. path must begin with (PATHDEL) to force user to}
\CommentTok{NB. think carefully about where dictionary is placed}
\KeywordTok{if.}\NormalTok{ PATHDEL}\KeywordTok{\textasciitilde{}:\{.}\NormalTok{ sp}\KeywordTok{,}\StringTok{\textquotesingle{} \textquotesingle{}} \KeywordTok{do.}
\NormalTok{  jderr ERR059 }\CommentTok{NB. errmsg: full rooted path required}
  \KeywordTok{return.}
\KeywordTok{end.}

\CommentTok{NB. subpath list with any drive attached}
\NormalTok{sp}\KeywordTok{=.} \KeywordTok{;\&.>} \KeywordTok{<"}\DecValTok{1} \KeywordTok{,/\textbackslash{}} \KeywordTok{<;.}\DecValTok{1}\NormalTok{ sp}
\NormalTok{sp}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{drv}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ sp}

\CommentTok{NB. attempt to create last directory on path}
\KeywordTok{if.} \DecValTok{1}\KeywordTok{=}\NormalTok{makedir }\KeywordTok{\{:}\NormalTok{ sp }\KeywordTok{do.}\NormalTok{ ok }\KeywordTok{y}

\CommentTok{NB. upon failure run down paths attempting to create all}
\CommentTok{NB. intermediate directories {-} many operations will}
\CommentTok{NB. typically fail because some intermediates will exist}
\KeywordTok{elseif.}\NormalTok{ makedir}\KeywordTok{"}\DecValTok{0} \KeywordTok{\}:}\NormalTok{ sp}
        \DecValTok{1}\KeywordTok{=}\NormalTok{makedir }\KeywordTok{\{:}\NormalTok{ sp }\KeywordTok{do.}\NormalTok{ ok }\KeywordTok{y}
\KeywordTok{elseif.} \KeywordTok{do.}
  \RegionMarkerTok{(}\NormalTok{jderr ERR060}\RegionMarkerTok{)}\KeywordTok{,<y} \CommentTok{NB. errmsg: unable to create directory}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mnlsearch}\AlertTok{=:}\index{mnlsearch@\texttt{mnlsearch}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*mnlsearch v{-}{-} master name list search.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  ilOpt mnlsearch clNamePattern}

\CommentTok{NB. ERR006 cannot read master}
\KeywordTok{if.}\NormalTok{ badjr d}\KeywordTok{=.} \KeywordTok{>}\NormalTok{jread }\RegionMarkerTok{(}\NormalTok{JMASTER}\KeywordTok{,}\NormalTok{IJF}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{CNMFTAB }\KeywordTok{do.}\NormalTok{ jderr ERR006 }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. ERR104 no registered dictionaries}
\KeywordTok{if.} \DecValTok{0} \KeywordTok{e.} \KeywordTok{$}\NormalTok{d }\KeywordTok{do.}\NormalTok{ jderr ERR104 }\KeywordTok{return.} \KeywordTok{end.}
\KeywordTok{if.}\NormalTok{ fex f}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{tslash2}\KeywordTok{\&.>} \DecValTok{2}\KeywordTok{\{}\NormalTok{d}\RegionMarkerTok{)} \KeywordTok{,\&.>} \KeywordTok{<}\RegionMarkerTok{(}\KeywordTok{;}\RegionMarkerTok{(}\DecValTok{0}\KeywordTok{\{x}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{JDFILES}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{IJF }\KeywordTok{do.}
\NormalTok{  r}\KeywordTok{=.} \DecValTok{0} \DecValTok{2}\KeywordTok{$<}\StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{[} \KeywordTok{y=.} \KeywordTok{,y}
\NormalTok{  g}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<:} \KeywordTok{|}\DecValTok{1}\KeywordTok{\{x}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{nlpfx}\KeywordTok{\textasciigrave{}}\NormalTok{nlctn}\KeywordTok{\textasciigrave{}}\NormalTok{nlsfx}

  \CommentTok{NB. read class if not default and WORD or MACRO}
\NormalTok{  b}\KeywordTok{=.} \RegionMarkerTok{((}\DecValTok{0}\KeywordTok{\{x}\RegionMarkerTok{)} \KeywordTok{e.}\NormalTok{ WORD}\KeywordTok{,}\NormalTok{MACRO}\RegionMarkerTok{)} \KeywordTok{*.}\NormalTok{ DEFAULT }\KeywordTok{\textasciitilde{}:} \DecValTok{2}\KeywordTok{\{x}

  \KeywordTok{for\_i.} \KeywordTok{i.\#}\NormalTok{f }\KeywordTok{do.}
\NormalTok{    o}\KeywordTok{=.}\NormalTok{ i}\KeywordTok{\{}\NormalTok{f }\KeywordTok{[} \KeywordTok{n=.}\NormalTok{ i}\KeywordTok{\{}\DecValTok{0}\KeywordTok{\{}\NormalTok{d}

    \CommentTok{NB. ERR088  jfile read failure}
    \KeywordTok{if.}\NormalTok{ badjr p}\KeywordTok{=.} \KeywordTok{>}\NormalTok{jread o}\KeywordTok{;}\NormalTok{CNLIST }\KeywordTok{do.}\NormalTok{ jderr ERR088 }\KeywordTok{return.} \KeywordTok{end.}
    \KeywordTok{if.}\NormalTok{ b }\KeywordTok{do.}
      \KeywordTok{if.}\NormalTok{ badjr s}\KeywordTok{=.} \KeywordTok{>}\NormalTok{jread o}\KeywordTok{;}\NormalTok{CNCLASS }\KeywordTok{do.}\NormalTok{ jderr ERR088 }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{      p}\KeywordTok{=.}\NormalTok{ p }\KeywordTok{\#\textasciitilde{}}\NormalTok{ s }\KeywordTok{=} \DecValTok{2}\KeywordTok{\{x}
    \KeywordTok{end.}

    \KeywordTok{if.} \DecValTok{0}\KeywordTok{=\#}\NormalTok{p }\KeywordTok{do.} \KeywordTok{continue.} \KeywordTok{end.}
\NormalTok{    r}\KeywordTok{=.}\NormalTok{ r }\KeywordTok{,} \RegionMarkerTok{(}\NormalTok{p }\RegionMarkerTok{(}\NormalTok{g }\KeywordTok{\textasciigrave{}:} \DecValTok{6}\RegionMarkerTok{)} \KeywordTok{y}\RegionMarkerTok{)} \KeywordTok{,.} \KeywordTok{n}
  \KeywordTok{end.}
\NormalTok{  r}\KeywordTok{=.} \KeywordTok{/:\textasciitilde{}}\NormalTok{ r}
  \KeywordTok{if.} \DecValTok{0} \KeywordTok{>} \DecValTok{1}\KeywordTok{\{x} \KeywordTok{do.}\NormalTok{ ok }\KeywordTok{<}\NormalTok{dupnames r }\KeywordTok{else.}\NormalTok{ ok }\KeywordTok{<}\NormalTok{r }\KeywordTok{end.}
\KeywordTok{else.}
\NormalTok{  b}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{1:@}\RegionMarkerTok{(}\DecValTok{1}\KeywordTok{!:}\DecValTok{4}\RegionMarkerTok{)} \KeywordTok{::0:}\RegionMarkerTok{)}\NormalTok{ f}
  \RegionMarkerTok{(}\NormalTok{jderr ERR073}\RegionMarkerTok{)} \KeywordTok{,}\NormalTok{ f }\KeywordTok{\#\textasciitilde{}} \KeywordTok{{-}.}\NormalTok{ b}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newdparms}\AlertTok{=:}\index{newdparms@\texttt{newdparms}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*newdparms  v{-}{-}  sets  the dictionary  parameters  for  a  new}
\CommentTok{NB. dictionary.}
\CommentTok{NB.}
\CommentTok{NB. monad:  newdparms bluu}
\CommentTok{NB.}
\CommentTok{NB.   newdparms sd;dp;dname;dn;path}

\CommentTok{NB. subdirectories, parameters, name, unique number and path}
\StringTok{\textquotesingle{}sd dp name dn path\textquotesingle{}}\KeywordTok{=.} \KeywordTok{y}

\CommentTok{NB. name, number, creation, last dump, [paths], J version, J system}
\NormalTok{uv}\KeywordTok{=.}\NormalTok{ name }\KeywordTok{;}\NormalTok{ dn }\KeywordTok{;} \RegionMarkerTok{(}\NormalTok{now }\StringTok{\textquotesingle{}\textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{;} \RegionMarkerTok{(}\DecValTok{6}\KeywordTok{\#}\DecValTok{0}\RegionMarkerTok{)} \KeywordTok{;} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{path}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ sd }\KeywordTok{,\&.>}\NormalTok{ PATHDEL}
\NormalTok{uv}\KeywordTok{=.}\NormalTok{ uv }\KeywordTok{,} \RegionMarkerTok{(}\DecValTok{9}\KeywordTok{!:}\DecValTok{14}\StringTok{\textquotesingle{}\textquotesingle{}}\RegionMarkerTok{)}\KeywordTok{;}\DecValTok{9}\KeywordTok{!:}\DecValTok{12} \StringTok{\textquotesingle{}\textquotesingle{}}

\CommentTok{NB. dictionary number path context {-} empty until references created}
\NormalTok{uv}\KeywordTok{=.}\NormalTok{ uv }\KeywordTok{,} \KeywordTok{<i.}\DecValTok{0}

\CommentTok{NB. reduce user parameter table to names and values}
\NormalTok{uv }\KeywordTok{,} \KeywordTok{<} \KeywordTok{|:} \DecValTok{0} \DecValTok{2} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ dp}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newregdict}\AlertTok{=:}\index{newregdict@\texttt{newregdict}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*newregdict v{-}{-} creates a new dictionary  or registers an extant}
\CommentTok{NB. dictionary.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaOptions newregdict (clDictionary ; clPathroot)}
\CommentTok{NB.}
\CommentTok{NB.   NB. register extant dictinary}
\CommentTok{NB.   0 newregdict \textquotesingle{}dictionary name\textquotesingle{};\textquotesingle{}c:\textbackslash{}where\textbackslash{}it\textbackslash{}lives\textquotesingle{} NB. drive required}
\CommentTok{NB.}
\CommentTok{NB.   NB. create new dictionary}
\CommentTok{NB.   1 newregdict \textquotesingle{}new name\textquotesingle{};\textquotesingle{}c:\textbackslash{}new\textbackslash{}location\textquotesingle{}}

\NormalTok{mf}\KeywordTok{=.}\NormalTok{  JMASTER  }\CommentTok{NB. master file}
\NormalTok{msg}\KeywordTok{=.}\NormalTok{ ERR061   }\CommentTok{NB. errmsg: invalid dictionary name;path[;documentation]}

\KeywordTok{if.} \RegionMarkerTok{(}\NormalTok{badbu }\KeywordTok{y}\RegionMarkerTok{)} \KeywordTok{+.} \DecValTok{1}\KeywordTok{\textasciitilde{}:\#$} \KeywordTok{y}  \KeywordTok{do.}\NormalTok{ jderr msg}
\KeywordTok{elseif.} \RegionMarkerTok{(}\DecValTok{3}\KeywordTok{<\#y}\RegionMarkerTok{)} \KeywordTok{+.} \DecValTok{2}\KeywordTok{>\#y}    \KeywordTok{do.}\NormalTok{ jderr msg}
\KeywordTok{elseif.} \KeywordTok{+./}\NormalTok{badcl}\KeywordTok{\&>} \KeywordTok{y}      \KeywordTok{do.}\NormalTok{ jderr msg}
\KeywordTok{elseif.do.}

  \CommentTok{NB. names and paths cannot be empty {-} sorry}
  \StringTok{\textquotesingle{}name path doc\textquotesingle{}}\KeywordTok{=.} \DecValTok{3}\KeywordTok{\{.y,<}\StringTok{\textquotesingle{}\textquotesingle{}}
\NormalTok{  name}\KeywordTok{=.}\NormalTok{ alltrim name }\KeywordTok{[}\NormalTok{ path}\KeywordTok{=.}\NormalTok{ hostsep alltrim path}
  \KeywordTok{if.} \DecValTok{0}\KeywordTok{\&e.} \RegionMarkerTok{(}\KeywordTok{\#}\NormalTok{name}\RegionMarkerTok{)}\KeywordTok{,\#}\NormalTok{path }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{return.} \KeywordTok{end.}

  \CommentTok{NB. restrict dictionary name and path characters}
  \KeywordTok{if.} \DecValTok{0}\KeywordTok{\&e.}\NormalTok{ name }\KeywordTok{e.} \StringTok{\textquotesingle{} \textquotesingle{}}\KeywordTok{,}\NormalTok{ALPHA }\KeywordTok{do.}
\NormalTok{    jderr ERR062 }\KeywordTok{return.} \CommentTok{NB. errmsg: invalid characters in name}
  \KeywordTok{elseif.} \DecValTok{0}\KeywordTok{\&e.}\NormalTok{ path }\KeywordTok{e.}\NormalTok{ PATHCHRS}\KeywordTok{,}\NormalTok{ALPHA }\KeywordTok{do.}
\NormalTok{    jderr ERR063 }\KeywordTok{return.} \CommentTok{NB. errmsg: invalid characters in path}
  \KeywordTok{end.}

  \KeywordTok{if.}\NormalTok{ IFWIN }\KeywordTok{do.}
    \CommentTok{NB. check for UNC paths}
    \KeywordTok{if.} \RegionMarkerTok{(}\DecValTok{2}\KeywordTok{\#}\NormalTok{PATHDEL}\RegionMarkerTok{)} \KeywordTok{{-}:} \DecValTok{2}\KeywordTok{\{.}\NormalTok{path }\KeywordTok{do.}
      \CommentTok{NB. insure UNC paths are terminated}
\NormalTok{      path}\KeywordTok{=.}\NormalTok{ path}\KeywordTok{,}\RegionMarkerTok{(}\NormalTok{PATHDEL}\KeywordTok{=\{:}\NormalTok{path}\RegionMarkerTok{)}\KeywordTok{\}.}\NormalTok{PATHDEL}

      \CommentTok{NB. NIMP: NOTE: (freedisk)\textquotesingle{}ing windows network drives (more}
      \CommentTok{NB. than once) is time consuming and typically unnecesary!}
      \CommentTok{NB. These volumes are often huge and JOD empty dictionaries}
      \CommentTok{NB. are tiny {-} hence we ASSUME sufficient space. The following}
      \CommentTok{NB. commented code tests UNC volumes.}

\NormalTok{      disk}\KeywordTok{=.}\StringTok{\textquotesingle{}\textquotesingle{}} \CommentTok{NB. empty disk suppresses space testing}

      \CommentTok{NB. test if the maximum size of subpaths exceeds threshold}
      \CommentTok{NB. depends on (freedisk) returning zero for invalid paths}
      \CommentTok{NB. omit root \textbackslash{}\textbackslash{} and last nonexistant path}
      \CommentTok{NB. if. 0=\#uv=. \_1 \}. 2 \}.;\&.> <"1 ,/\textbackslash{} <;.2 path do.}
      \CommentTok{NB.   (jderr ERR065),<path return. NB. errmsg: not enough space on drive}
      \CommentTok{NB. end.}
      \CommentTok{NB. if. (>./freedisk\&> uv) < FREESPACE do. (jderr ERR065),<path return. end.}
    \KeywordTok{else.}
      \CommentTok{NB. check for windows drive letter (required) and}
      \CommentTok{NB. determine if there is enough space on the target drive}
      \CommentTok{NB. errmsg: target drive is required}
      \KeywordTok{if.}\NormalTok{ isempty tdrv}\KeywordTok{=.}\NormalTok{ justdrv path }\KeywordTok{do.}\NormalTok{ jderr ERR064  }\KeywordTok{return.} \KeywordTok{end.}

      \CommentTok{NB. windows drive letters}
\NormalTok{      disk}\KeywordTok{=.}\NormalTok{ tdrv}\KeywordTok{,}\StringTok{\textquotesingle{}:\textquotesingle{}}\KeywordTok{,}\NormalTok{PATHDEL}
    \KeywordTok{end.}
  \KeywordTok{else.}
    \CommentTok{NB. require rooted linux paths}
    \KeywordTok{if.}\NormalTok{ PATHDEL }\KeywordTok{\textasciitilde{}:} \KeywordTok{\{.}\NormalTok{path }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR096}\RegionMarkerTok{)}\KeywordTok{,<}\NormalTok{path }\KeywordTok{return.} \KeywordTok{end.}

    \CommentTok{NB. NIMP: how does one determine the volume name for a given}
    \CommentTok{NB. fully qualified linux file that resides on said volume?}
\NormalTok{    disk}\KeywordTok{=.}\NormalTok{ path}
  \KeywordTok{end.}

  \KeywordTok{if.} \RegionMarkerTok{(}\KeywordTok{x=}\DecValTok{1}\RegionMarkerTok{)} \KeywordTok{*.} \DecValTok{0}\KeywordTok{<\#}\NormalTok{disk }\KeywordTok{do.} \CommentTok{NB. HARDCODE (x) option}
\NormalTok{    bytes}\KeywordTok{=.}\NormalTok{ freedisk disk}
    \CommentTok{NB. errmsg: not enough space}
    \KeywordTok{if.}\NormalTok{ bytes }\KeywordTok{<}\NormalTok{ FREESPACE }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR065}\RegionMarkerTok{)}\KeywordTok{,<}\NormalTok{disk }\KeywordTok{return.} \KeywordTok{end.}
  \KeywordTok{end.}

  \CommentTok{NB. attempt to read master}
  \KeywordTok{if.}\NormalTok{ badjr uv}\KeywordTok{=.}\NormalTok{ jread mf}\KeywordTok{;}\NormalTok{CNMFTAB}\KeywordTok{,}\NormalTok{CNMFPARMS}\KeywordTok{,}\NormalTok{CNMFDLOG }\KeywordTok{do.}
\NormalTok{    jderr ERR006 }\KeywordTok{return.} \CommentTok{NB. errmsg: cannot read master}
  \KeywordTok{end.}

  \CommentTok{NB. mark master {-} this verb updates if successful}
  \CommentTok{NB. all error calls should use (jdmasterr) until}
  \CommentTok{NB. the master is cleared at the end of this verb}
  \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{ markmast }\DecValTok{1} \KeywordTok{do.}\NormalTok{ msg }\KeywordTok{return.} \KeywordTok{end.}

  \CommentTok{NB. master table, dictionary parameters, number log}
  \StringTok{\textquotesingle{}mdt dpt dlg\textquotesingle{}}\KeywordTok{=.}\NormalTok{ uv}
  \CommentTok{NB. errmsg: dictionary name in use}
  \KeywordTok{if.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{name}\RegionMarkerTok{)} \KeywordTok{e.} \DecValTok{0}\KeywordTok{\{}\NormalTok{mdt }\KeywordTok{do.}\NormalTok{ jdmasterr ERR066 }\KeywordTok{return.} \KeywordTok{end.}

  \KeywordTok{if.} \KeywordTok{x=}\DecValTok{1} \KeywordTok{do.}
    \CommentTok{NB. attempt to create main root directory}
    \KeywordTok{if.}\NormalTok{ badrc path}\KeywordTok{=.}\NormalTok{ mainddir path }\KeywordTok{do.}\NormalTok{ path }\KeywordTok{[}\NormalTok{ markmast}\KeywordTok{\textasciitilde{}}\DecValTok{0} \KeywordTok{return.} \KeywordTok{end.}

    \CommentTok{NB. attempt to create standard subdirectories}
\NormalTok{    path}\KeywordTok{=.} \KeywordTok{\{:}\NormalTok{ path}
    \KeywordTok{if.} \DecValTok{0}\KeywordTok{\&e.}\NormalTok{ uv}\KeywordTok{=.}\NormalTok{ makedir}\KeywordTok{"}\DecValTok{0}\NormalTok{ path }\KeywordTok{,\&.>}\NormalTok{ JDSDIRS }\KeywordTok{do.}
\NormalTok{      jdmasterr ERR067 }\KeywordTok{return.} \CommentTok{NB. errmsg: unable to create subdirectories}
    \KeywordTok{end.}
\NormalTok{    path}\KeywordTok{=.} \KeywordTok{>}\NormalTok{ path}

\NormalTok{    dn}\KeywordTok{=.}\NormalTok{ didnum }\DecValTok{0}   \CommentTok{NB. unique dictionary number}
\NormalTok{    uv}\KeywordTok{=.}\NormalTok{ newdparms JDSDIRS}\KeywordTok{;}\NormalTok{dpt}\KeywordTok{;}\NormalTok{name}\KeywordTok{;}\NormalTok{dn}\KeywordTok{;}\NormalTok{path}

    \CommentTok{NB. create empty dictionary files}
\NormalTok{    uv}\KeywordTok{=.} \KeywordTok{<}\RegionMarkerTok{(}\NormalTok{doc}\KeywordTok{;}\NormalTok{uv}\RegionMarkerTok{)}\NormalTok{ jwordscreate path}\KeywordTok{,>}\DecValTok{0}\KeywordTok{\{}\NormalTok{JDFILES}
\NormalTok{    uv}\KeywordTok{=.}\NormalTok{ uv }\KeywordTok{,} \RegionMarkerTok{(}\KeywordTok{\}.}\NormalTok{JDFILES}\RegionMarkerTok{)}\NormalTok{ jdatcreate}\KeywordTok{\&.>} \KeywordTok{<}\NormalTok{path}
    \KeywordTok{if.} \DecValTok{0}\KeywordTok{\&e.} \KeywordTok{;\{.\&>}\NormalTok{ uv }\KeywordTok{do.}
\NormalTok{      jdmasterr ERR068 }\KeywordTok{return.} \CommentTok{NB. errmsg: unable to setup dictionary file(s)}
    \KeywordTok{end.}
\NormalTok{    newmdt}\KeywordTok{=.}\NormalTok{ mdt}\KeywordTok{,.}\NormalTok{name}\KeywordTok{;}\NormalTok{dn}\KeywordTok{;}\NormalTok{path}\KeywordTok{;}\DecValTok{0}
\NormalTok{    okm}\KeywordTok{=.}\NormalTok{OK050}
  \KeywordTok{else.}
\NormalTok{    path}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{{-}}\NormalTok{PATHDEL}\KeywordTok{=\{:}\NormalTok{path}\RegionMarkerTok{)} \KeywordTok{\}.}\NormalTok{ path}\KeywordTok{,}\NormalTok{PATHDEL}

    \CommentTok{NB. test existence of dictionary files}
\NormalTok{    fn}\KeywordTok{=.}\NormalTok{ JDFILES }\KeywordTok{,\&.>} \KeywordTok{<}\NormalTok{IJF}
    \KeywordTok{if.} \DecValTok{1} \KeywordTok{e.}\NormalTok{ uv}\KeywordTok{=.} \KeywordTok{{-}.}\NormalTok{ fex}\KeywordTok{"}\DecValTok{1}\NormalTok{ dcfiles}\KeywordTok{=.} \KeywordTok{<@:;"}\DecValTok{1} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{path}\RegionMarkerTok{)} \KeywordTok{,"}\DecValTok{0} \KeywordTok{/}\NormalTok{ fn }\KeywordTok{do.}
      \RegionMarkerTok{(}\NormalTok{jdmasterr ERR073}\RegionMarkerTok{)}\KeywordTok{,<}\NormalTok{name }\KeywordTok{return.} \CommentTok{NB. errmsg: missing dictionary file(s)}
    \KeywordTok{end.}

    \CommentTok{NB. NIMP should run under a trap here to protect}
    \CommentTok{NB. against files that appear to be dictionary but are not}

    \CommentTok{NB. read dictionary parameter table and documentation}
    \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread }\RegionMarkerTok{(}\NormalTok{file}\KeywordTok{=.}\NormalTok{ path}\KeywordTok{,>\{.}\NormalTok{JDFILES}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{CNPARMS}\KeywordTok{,}\NormalTok{CNDICDOC }\KeywordTok{do.}
\NormalTok{      jdmasterr ERR088 }\KeywordTok{return.} \CommentTok{NB. errmsg: jfile read failure}
    \KeywordTok{end.}

    \CommentTok{NB. dictionary parameters and unique id}
    \StringTok{\textquotesingle{}dpt olddoc\textquotesingle{}}\KeywordTok{=.}\NormalTok{ dat}
\NormalTok{    dn}\KeywordTok{=.} \DecValTok{1} \KeywordTok{\{::}\NormalTok{ dpt}

    \CommentTok{NB. didnum\textquotesingle{}s must be unique}
    \CommentTok{NB. errmsg: duplicate dictionary id number}
    \KeywordTok{if.}\NormalTok{ dn }\KeywordTok{e.} \KeywordTok{;} \DecValTok{1}\KeywordTok{\{}\NormalTok{mdt }\KeywordTok{do.}\NormalTok{ jdmasterr ERR092 }\KeywordTok{return.} \KeywordTok{end.}

    \CommentTok{NB. if not a libary adjust dictionary paths, name and documentation}
    \KeywordTok{if.} \KeywordTok{{-}.}\NormalTok{islib dpt }\KeywordTok{do.}

      \CommentTok{NB. test dictionary file attributes {-} we must be able to read/write}
      \KeywordTok{if.} \DecValTok{0} \KeywordTok{e.}\NormalTok{ iswriteable dcfiles }\KeywordTok{do.}
        \CommentTok{NB. errmsg: dictionary file attributes do not allow read/write}
\NormalTok{        jdmasterr ERR095 }\KeywordTok{return.}
      \KeywordTok{end.}

\NormalTok{      dpt}\KeywordTok{=.} \RegionMarkerTok{((}\KeywordTok{<}\NormalTok{path}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ JDSDIRS }\KeywordTok{,\&.>}\NormalTok{ PATHDEL}\RegionMarkerTok{)}\NormalTok{ PARMDIRS}\KeywordTok{\}}\NormalTok{ dpt}
\NormalTok{      dpt}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{name}\RegionMarkerTok{)} \DecValTok{0}\KeywordTok{\}}\NormalTok{ dpt}
\NormalTok{      doc}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{*\#}\NormalTok{doc}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{olddoc}\KeywordTok{;}\NormalTok{doc}
      \KeywordTok{if.}\NormalTok{ badreps }\RegionMarkerTok{(}\NormalTok{dpt}\KeywordTok{;}\NormalTok{doc}\RegionMarkerTok{)}\NormalTok{ jreplace file}\KeywordTok{;}\NormalTok{CNPARMS}\KeywordTok{,}\NormalTok{CNDICDOC }\KeywordTok{do.}
\NormalTok{        jdmasterr ERR056  }\CommentTok{NB. errmsg: jfile replace failure}
      \KeywordTok{end.}
    \KeywordTok{end.}

\NormalTok{    newmdt}\KeywordTok{=.}\NormalTok{ mdt}\KeywordTok{,.}\NormalTok{name}\KeywordTok{;}\NormalTok{dn}\KeywordTok{;}\NormalTok{path}\KeywordTok{;}\DecValTok{0}
\NormalTok{    okm}\KeywordTok{=.}\NormalTok{ OK058}
  \KeywordTok{end.}

  \CommentTok{NB. update master dictionary table+backup, didnum log, open status}
\NormalTok{  uv}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{newmdt}\KeywordTok{;}\NormalTok{mdt}\KeywordTok{;}\NormalTok{dlg}\KeywordTok{,}\NormalTok{dn}\RegionMarkerTok{)}\NormalTok{ jreplace mf}\KeywordTok{;}\NormalTok{CNMFTAB}\KeywordTok{,}\NormalTok{CNMFTABBCK}\KeywordTok{,}\NormalTok{CNMFDLOG}
  \KeywordTok{if.} \DecValTok{0}\KeywordTok{\&>} \KeywordTok{<./}\NormalTok{uv }\KeywordTok{do.}\NormalTok{ jdmasterr ERR069 }\KeywordTok{return.} \KeywordTok{end.} \CommentTok{NB. errmsg: error updating master}

  \CommentTok{NB. free master file for other tasks}
  \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{ markmast}\KeywordTok{\textasciitilde{}}\DecValTok{0} \KeywordTok{do.}\NormalTok{ msg }\KeywordTok{return.} \KeywordTok{end.}

\NormalTok{  ok okm}\KeywordTok{;}\NormalTok{name}\KeywordTok{;}\NormalTok{jpathsep path}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. names containing substring: (;:\textquotesingle{}cats bats\textquotesingle{}) nlctn \textquotesingle{}at\textquotesingle{}}
\NormalTok{nlctn}\AlertTok{=:}\index{nlctn@\texttt{nlctn}} \RegionMarkerTok{(}\KeywordTok{[:} \KeywordTok{I.} \KeywordTok{[:} \KeywordTok{+./"}\DecValTok{1} \RegionMarkerTok{(}\KeywordTok{[:} \KeywordTok{,:} \KeywordTok{]}\RegionMarkerTok{)} \KeywordTok{E.} \KeywordTok{[:} \KeywordTok{>} \KeywordTok{[}\RegionMarkerTok{)} \KeywordTok{\{} \KeywordTok{[}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. match prefixes (optimize for large lists): (;:\textquotesingle{}he bo boat\textquotesingle{}) nlpfx \textquotesingle{}bo\textquotesingle{}}
\NormalTok{nlpfx}\AlertTok{=:}\index{nlpfx@\texttt{nlpfx}} \KeywordTok{[} \KeywordTok{\#\textasciitilde{}} \RegionMarkerTok{(}\KeywordTok{[:} \KeywordTok{<} \KeywordTok{[:} \KeywordTok{,} \KeywordTok{]}\RegionMarkerTok{)} \KeywordTok{{-}:\&>} \RegionMarkerTok{(}\KeywordTok{[:} \KeywordTok{\#} \KeywordTok{[:} \KeywordTok{,} \KeywordTok{]}\RegionMarkerTok{)} \KeywordTok{\{.\&.>} \KeywordTok{[}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. match name suffixes: (;:\textquotesingle{}yada yada yo\textquotesingle{}) nlsfx \textquotesingle{}da\textquotesingle{}}
\NormalTok{nlsfx}\AlertTok{=:}\index{nlsfx@\texttt{nlsfx}} \KeywordTok{[} \KeywordTok{\#\textasciitilde{}} \RegionMarkerTok{(}\KeywordTok{[:} \KeywordTok{<} \KeywordTok{[:} \KeywordTok{,} \KeywordTok{]}\RegionMarkerTok{)} \KeywordTok{{-}:\&>} \RegionMarkerTok{(}\KeywordTok{[:} \KeywordTok{{-}} \KeywordTok{[:} \KeywordTok{\#} \KeywordTok{[:} \KeywordTok{,} \KeywordTok{]}\RegionMarkerTok{)} \KeywordTok{\{.\&.>} \KeywordTok{[}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. containing pattern in raised and nubbed}
\NormalTok{nubnlctn}\AlertTok{=:}\index{nubnlctn@\texttt{nubnlctn}} \RegionMarkerTok{(}\KeywordTok{[:}\NormalTok{ sortdnub }\KeywordTok{[}\RegionMarkerTok{)}\NormalTok{ nlctn }\KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. match prefixes in raised and nubbed}
\NormalTok{nubnlpfx}\AlertTok{=:}\index{nubnlpfx@\texttt{nubnlpfx}} \RegionMarkerTok{(}\KeywordTok{[:}\NormalTok{ sortdnub }\KeywordTok{[}\RegionMarkerTok{)}\NormalTok{ nlpfx }\KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. match suffixes in raised and nubbed}
\NormalTok{nubnlsfx}\AlertTok{=:}\index{nubnlsfx@\texttt{nubnlsfx}} \RegionMarkerTok{(}\KeywordTok{[:}\NormalTok{ sortdnub }\KeywordTok{[}\RegionMarkerTok{)}\NormalTok{ nlsfx }\KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{opendict}\AlertTok{=:}\index{opendict@\texttt{opendict}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*opendict v{-}{-} opens dictionaries. Dictionary names and  master}
\CommentTok{NB. table  have been  validated prior  to calling this verb.  The}
\CommentTok{NB. dictionary  system  does  not  leave   files  open  as   this}
\CommentTok{NB. significantly decreases crash  resistence. Instead the master}
\CommentTok{NB. dictionay table is marked with 1 when dictionaries are opened}
\CommentTok{NB. read/write.  Only one task can open a  dictionary read/write.}
\CommentTok{NB. Many tasks can open the same dictionary read/only.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  blclDictionary opendict (iaOption ; btMdt)}
\CommentTok{NB.}
\CommentTok{NB.   (\textquotesingle{}d0\textquotesingle{};\textquotesingle{}d1\textquotesingle{}) opendict 1;jread JMASTER;CNMFTAB NB. open di r/w}

\CommentTok{NB. quit if open limit exceeded {-} limits the number of directory objects}
\CommentTok{NB. errmsg: request exceeds open limit}
\KeywordTok{if.}\NormalTok{ DPLIMIT}\KeywordTok{<}\RegionMarkerTok{(}\KeywordTok{\#x}\RegionMarkerTok{)}\KeywordTok{+\#}\NormalTok{DPATH }\KeywordTok{do.}\NormalTok{ jderr ERR070 }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. if any dictionary is already on the path quit with error}
\NormalTok{uv}\KeywordTok{=.} \KeywordTok{x} \KeywordTok{e.} \KeywordTok{\{."}\DecValTok{1}\NormalTok{ DPATH}
\KeywordTok{if.} \DecValTok{1} \KeywordTok{e.}\NormalTok{ uv }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR071}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{uv}\KeywordTok{\#x} \KeywordTok{return.} \KeywordTok{end.} \CommentTok{NB. errmsg: already open}

\CommentTok{NB. open status and master dictionary table}
\StringTok{\textquotesingle{}os mdt\textquotesingle{}}\KeywordTok{=.} \KeywordTok{y}

\CommentTok{NB. get locations of dictionaries to open}
\NormalTok{pd}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{0}\KeywordTok{\{}\NormalTok{mdt}\RegionMarkerTok{)} \KeywordTok{i.} \KeywordTok{x}
\NormalTok{ld}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\DecValTok{2}\KeywordTok{;}\NormalTok{pd}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{mdt}

\CommentTok{NB. if any dictionary is already open read/write quit with error}
\CommentTok{NB. note: because other tasks may have a dictionary open read/write}
\CommentTok{NB. it does not appear on the path of this task {-} HARDCODE: rs code}
\NormalTok{rs}\KeywordTok{=.} \DecValTok{0} \KeywordTok{<} \KeywordTok{;} \RegionMarkerTok{(}\KeywordTok{<}\DecValTok{3}\KeywordTok{;}\NormalTok{pd}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{mdt}
\CommentTok{NB. errmsg: another task opened read/write}
\KeywordTok{if.} \DecValTok{1} \KeywordTok{e.}\NormalTok{ rs }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR072}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\DecValTok{1}\KeywordTok{=}\NormalTok{rs}\RegionMarkerTok{)}\KeywordTok{\#x} \KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. standard files with extension}
\NormalTok{fn}\KeywordTok{=.}\NormalTok{ JDFILES }\KeywordTok{,\&.>} \KeywordTok{<}\NormalTok{IJF}

\CommentTok{NB. test existence of alleged dictionary files}
\KeywordTok{if.} \DecValTok{1} \KeywordTok{e.}\NormalTok{ uv}\KeywordTok{=.} \KeywordTok{{-}.}\NormalTok{ fex}\KeywordTok{"}\DecValTok{1}\NormalTok{ dcfiles}\KeywordTok{=.} \KeywordTok{<@:;"}\DecValTok{1}\NormalTok{  ld }\KeywordTok{,"}\DecValTok{0} \KeywordTok{/}\NormalTok{ fn }\KeywordTok{do.}
  \RegionMarkerTok{(}\NormalTok{jderr ERR073}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{uv}\KeywordTok{\#x} \KeywordTok{return.} \CommentTok{NB. errmsg: missing dictionary file(s)}
\KeywordTok{end.}

\CommentTok{NB. open request seems valid {-} mark master}
\KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{ markmast }\DecValTok{1} \KeywordTok{do.}\NormalTok{ msg }\KeywordTok{return.} \KeywordTok{end.}

\NormalTok{dpath}\KeywordTok{=.}\NormalTok{ DPATH}
\NormalTok{libstatus}\KeywordTok{=.} \KeywordTok{i.}\DecValTok{0}

\KeywordTok{for\_dp.}\NormalTok{ ld }\KeywordTok{do.}  \CommentTok{NB. depends on (\#x)=(\#pd)=\#ld}

   \CommentTok{NB. get dictionary parameters}
   \KeywordTok{if.}\NormalTok{ badjr pdp}\KeywordTok{=.}\NormalTok{ jread }\RegionMarkerTok{(}\KeywordTok{;}\NormalTok{dp}\KeywordTok{,\{.}\NormalTok{fn}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{CNPARMS }\KeywordTok{do.}
     \CommentTok{NB. errmsg: cannot read dictionary parameters}
     \RegionMarkerTok{(}\NormalTok{jdmasterr ERR074}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{dp\_index}\KeywordTok{\{x} \KeywordTok{return.}
   \KeywordTok{end.}

   \CommentTok{NB. master table didnum must match current dictionary didnum}
   \KeywordTok{if.} \RegionMarkerTok{((}\KeywordTok{<}\DecValTok{1}\KeywordTok{;}\NormalTok{dp\_index}\KeywordTok{\{}\NormalTok{pd}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{mdt}\RegionMarkerTok{)} \KeywordTok{{-}:} \DecValTok{1}\KeywordTok{\{>}\NormalTok{pdp }\KeywordTok{do.}

     \CommentTok{NB. is the master path a prefix of stored dictionary paths?}
     \CommentTok{NB. assumes: all subdir path prefixes are the same {-} this}
     \CommentTok{NB. is true for dictionaries created by (newd)}
\NormalTok{     nppfx}\KeywordTok{=.} \KeywordTok{{-}.}\DecValTok{0}\KeywordTok{\{}\RegionMarkerTok{(}\KeywordTok{;}\NormalTok{dp}\RegionMarkerTok{)} \KeywordTok{E.} \KeywordTok{;}\RegionMarkerTok{(}\DecValTok{0}\KeywordTok{\{}\NormalTok{PARMDIRS}\RegionMarkerTok{)}\KeywordTok{\{>}\NormalTok{pdp}

     \KeywordTok{if.}\NormalTok{ nppfx }\KeywordTok{*.}\NormalTok{ islib }\KeywordTok{>}\NormalTok{pdp }\KeywordTok{do.}
       \CommentTok{NB. remap paths for libraries if necessary {-} allows LAN file sharing}
       \CommentTok{NB. of libraries for many users/tasks with different access paths}
       \CommentTok{NB. WARNING: if these directories are on locked down LAN volumes}
       \CommentTok{NB. JOD commands like: make\textquotesingle{}\textquotesingle{} may return cannot write errors}
\NormalTok{       pdp}\KeywordTok{=.} \KeywordTok{>}\NormalTok{pdp}
\NormalTok{       npth}\KeywordTok{=.}\NormalTok{ PATHDEL }\KeywordTok{,\&.>\textasciitilde{}}\NormalTok{ dp }\KeywordTok{,\&.>}\NormalTok{ PATHDEL}\KeywordTok{\&}\NormalTok{afterlaststr}\KeywordTok{\&.>}\NormalTok{ rpdtrim}\KeywordTok{\&.>}\NormalTok{ PARMDIRS}\KeywordTok{\{}\NormalTok{pdp}
\NormalTok{       pdp}\KeywordTok{=.} \KeywordTok{<}\NormalTok{npth PARMDIRS}\KeywordTok{\}}\NormalTok{pdp}
     \KeywordTok{else.}
       \CommentTok{NB. master/stored dictionary paths must match for read/write}
       \KeywordTok{if.}\NormalTok{ nppfx }\KeywordTok{do.}
         \KeywordTok{if.} \KeywordTok{\#}\NormalTok{dpath}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\{:"}\DecValTok{1}\NormalTok{ dpath}\RegionMarkerTok{)} \KeywordTok{{-}.} \KeywordTok{\{:"}\DecValTok{1}\NormalTok{ DPATH }\KeywordTok{do.}\NormalTok{ coerase}\KeywordTok{"}\DecValTok{0}\NormalTok{ dpath }\KeywordTok{end.}
         \CommentTok{NB. errmsg: master/dictionary file path mismatch {-} have owner set READONLY name/DIDNUM {-}>}
         \RegionMarkerTok{(}\NormalTok{jdmasterr ERR098}\RegionMarkerTok{)}\KeywordTok{,}\DecValTok{0} \DecValTok{1}\KeywordTok{\{>}\NormalTok{pdp }\KeywordTok{return.}
       \KeywordTok{end.}

       \CommentTok{NB. for read/write dictionaries (not{-}libraries) insure}
       \CommentTok{NB. the dictionary file permissions/attributes allow writing}
       \KeywordTok{if.} \DecValTok{0} \KeywordTok{e.}\NormalTok{ iswriteable dp\_index}\KeywordTok{\{}\NormalTok{dcfiles }\KeywordTok{do.}
         \KeywordTok{if.} \KeywordTok{\#}\NormalTok{dpath}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\{:"}\DecValTok{1}\NormalTok{ dpath}\RegionMarkerTok{)} \KeywordTok{{-}.} \KeywordTok{\{:"}\DecValTok{1}\NormalTok{ DPATH }\KeywordTok{do.}\NormalTok{ coerase}\KeywordTok{"}\DecValTok{0}\NormalTok{ dpath }\KeywordTok{end.}
         \CommentTok{NB. errmsg: dictionary file attributes do not allow read/write {-}>}
         \RegionMarkerTok{(}\NormalTok{jdmasterr ERR095}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{dp\_index}\KeywordTok{\{x} \KeywordTok{return.}
       \KeywordTok{end.}
     \KeywordTok{end.}

     \CommentTok{NB. create new directory object}
\NormalTok{     DL}\KeywordTok{=.}\NormalTok{ conew }\StringTok{\textquotesingle{}ajoddob\textquotesingle{}}
\NormalTok{     name}\KeywordTok{=.}\NormalTok{ dp\_index}\KeywordTok{\{x}
     \KeywordTok{if.}\NormalTok{ createdl}\DecValTok{\_\_}\NormalTok{DL nppfx}\KeywordTok{;}\NormalTok{name}\KeywordTok{;}\NormalTok{dp}\KeywordTok{;}\NormalTok{os}\KeywordTok{;}\NormalTok{pdp }\KeywordTok{do.}
       \CommentTok{NB. append to path copy}
\NormalTok{       dpath}\KeywordTok{=.}\NormalTok{ dpath }\KeywordTok{,} \RegionMarkerTok{(}\KeywordTok{a:} \KeywordTok{,\textasciitilde{}}\NormalTok{ name }\KeywordTok{,} \DecValTok{1}\KeywordTok{\{>}\NormalTok{pdp}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{DL}
       \CommentTok{NB. are we a read only library?}
\NormalTok{       libstatus}\KeywordTok{=.}\NormalTok{ libstatus}\KeywordTok{,}\NormalTok{LIBSTATUS}\DecValTok{\_\_}\NormalTok{DL}
     \KeywordTok{else.}
       \KeywordTok{if.} \KeywordTok{\#}\NormalTok{dpath}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\{:"}\DecValTok{1}\NormalTok{ dpath}\RegionMarkerTok{)} \KeywordTok{{-}.} \KeywordTok{\{:"}\DecValTok{1}\NormalTok{ DPATH }\KeywordTok{do.}\NormalTok{ coerase}\KeywordTok{"}\DecValTok{0}\NormalTok{ dpath }\KeywordTok{end.}
       \RegionMarkerTok{(}\NormalTok{jdmasterr ERR075}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{dp\_index}\KeywordTok{\{x} \CommentTok{NB. errmsg: unable to open directory}
       \KeywordTok{return.}
     \KeywordTok{end.}

   \KeywordTok{else.}

     \CommentTok{NB. destroy any directory objects opened before inconsistency}
     \KeywordTok{if.} \KeywordTok{\#}\NormalTok{dpath}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\{:"}\DecValTok{1}\NormalTok{ dpath}\RegionMarkerTok{)} \KeywordTok{{-}.} \KeywordTok{\{:"}\DecValTok{1}\NormalTok{ DPATH }\KeywordTok{do.}\NormalTok{ coerase}\KeywordTok{"}\DecValTok{0}\NormalTok{ dpath }\KeywordTok{end.}
     \RegionMarkerTok{(}\NormalTok{jdmasterr ERR076}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{dp\_index}\KeywordTok{\{x}   \CommentTok{NB. errmsg: master{-}dictionary inconsistency}
     \KeywordTok{return.}

   \KeywordTok{end.}
\KeywordTok{end.}

\CommentTok{NB. update master read/write status and release}
\CommentTok{NB. read/write dictionaries are marked with unique}
\CommentTok{NB. id and read/only dictionaries are marked with 0}
\NormalTok{DPATH}\AlertTok{=:}\index{DPATH@\texttt{DPATH}}\NormalTok{  dpath}
\CommentTok{NB. do not mark any library (read/only) dictionaries open}
\NormalTok{pd}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{libstatus}\RegionMarkerTok{)}\KeywordTok{\#}\NormalTok{pd}
\NormalTok{mdt}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{JODOBID }\KeywordTok{*} \DecValTok{1}\KeywordTok{=}\NormalTok{os}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{<}\DecValTok{3}\KeywordTok{;}\NormalTok{pd}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ mdt     }\CommentTok{NB. object noun !(*)=. JODOBID}
\KeywordTok{if.}\NormalTok{ badreps }\RegionMarkerTok{(}\KeywordTok{<}\NormalTok{mdt}\RegionMarkerTok{)}\NormalTok{ jreplace JMASTER}\KeywordTok{;}\NormalTok{CNMFTAB }\KeywordTok{do.}
\NormalTok{  jdmasterr ERR077 }\CommentTok{NB. errmsg: unable to update master}
\KeywordTok{elseif.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{ markmast}\KeywordTok{\textasciitilde{}}\DecValTok{0}  \KeywordTok{do.}\NormalTok{ msg  }\CommentTok{NB. HARDCODE: r/w codes}
\KeywordTok{elseif.}\NormalTok{ os }\KeywordTok{e.} \DecValTok{1} \DecValTok{2} \KeywordTok{do.}
\NormalTok{  uv}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{1}\KeywordTok{=}\NormalTok{os}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{rs}\KeywordTok{=.} \StringTok{\textquotesingle{}/\textquotesingle{}} \KeywordTok{,\&.>}\NormalTok{ READSTATS    }\CommentTok{NB. read/only and read/write strings}
  \RegionMarkerTok{(}\NormalTok{ok OK052}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{\}.;}\NormalTok{libstatus}\KeywordTok{\{}\RegionMarkerTok{(}\NormalTok{uv}\KeywordTok{,}\DecValTok{0}\KeywordTok{\{}\NormalTok{rs}\RegionMarkerTok{))}\KeywordTok{,}\StringTok{\textquotesingle{}) {-}>\textquotesingle{}}\RegionMarkerTok{)}\KeywordTok{,x}
\KeywordTok{elseif.do.}\NormalTok{ jderr ERR001}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pathnl}\AlertTok{=:}\index{pathnl@\texttt{pathnl}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*pathnl v{-}{-} returns a complete path order list of objects (y).}
\CommentTok{NB.}
\CommentTok{NB. monad:  pathnl iaObject}
\CommentTok{NB.}
\CommentTok{NB.   pathnl WORD  NB. all words on current path}

\NormalTok{pob}\KeywordTok{=.} \KeywordTok{\{:"}\DecValTok{1}\NormalTok{ DPATH}
\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \KeywordTok{y}\NormalTok{ loadalldirs pob }\KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{ok }\RegionMarkerTok{(}\KeywordTok{>}\NormalTok{dnix\_\_uv }\KeywordTok{y}\RegionMarkerTok{)}\NormalTok{ fullmonty pob }\KeywordTok{[}\NormalTok{ uv}\KeywordTok{=.} \KeywordTok{\{.}\NormalTok{pob}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pathref}\AlertTok{=:}\index{pathref@\texttt{pathref}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*pathref  v{-}{-} returns a complete path  order list  of  objects}
\CommentTok{NB. with reference lists.  Currently only words have stored}
\CommentTok{NB. references but more may be added as the need arises.}
\CommentTok{NB.}
\CommentTok{NB. monad:  pathref iaObject}
\CommentTok{NB.}
\CommentTok{NB.   pathref WORD  NB. all words on current path with stored references}

\NormalTok{pob}\KeywordTok{=.} \KeywordTok{\{:"}\DecValTok{1}\NormalTok{ DPATH}
\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \KeywordTok{y}\NormalTok{ loadallrefs pob }\KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{ok }\RegionMarkerTok{(}\KeywordTok{>}\NormalTok{dnrn\_\_uv }\KeywordTok{y}\RegionMarkerTok{)}\NormalTok{ fullmonty pob }\KeywordTok{[}\NormalTok{ uv}\KeywordTok{=.} \KeywordTok{\{.}\NormalTok{pob}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{putdicdoc}\AlertTok{=:}\index{putdicdoc@\texttt{putdicdoc}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*putdicdoc v{-}{-} writes put dictionary documentation.}
\CommentTok{NB.}
\CommentTok{NB. monad:  putdicdoc clDoc}

\CommentTok{NB. assumes a put dictionary is open}
\KeywordTok{if.}\NormalTok{ badcl }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ jderr ERR097 }\CommentTok{NB. errmsg: invalid dictionary document must be character list}
\KeywordTok{else.}
\NormalTok{  DL}\KeywordTok{=.} \KeywordTok{\{:\{.}\NormalTok{DPATH  }\CommentTok{NB. directory object !(*)=. DL}

  \CommentTok{NB. Whether the put dictionary document is stored depends on the}
  \CommentTok{NB. value of the "new" dictionary parameter DOCUMENTDICT.}
\NormalTok{  dictdoc}\KeywordTok{=.} \DecValTok{1}
  \KeywordTok{if.} \DecValTok{0}\KeywordTok{=}\NormalTok{nc}\KeywordTok{<}\StringTok{\textquotesingle{}DOCUMENTDICT\textquotesingle{}}   \KeywordTok{do.}\NormalTok{ dictdoc}\KeywordTok{=.} \DecValTok{1}\KeywordTok{=}\NormalTok{DOCUMENTDICT}
  \KeywordTok{elseif.}
    \CommentTok{NB. if setting exists in put dictionary directory use it}
    \DecValTok{0}\KeywordTok{=}\NormalTok{nc}\KeywordTok{<}\StringTok{\textquotesingle{}DOCUMENTDICT\_\_DL\textquotesingle{}} \KeywordTok{do.}\NormalTok{ dictdoc}\KeywordTok{=.} \DecValTok{1}\KeywordTok{=}\NormalTok{DOCUMENTDICT}\DecValTok{\_\_}\NormalTok{DL}
  \KeywordTok{end.}

  \CommentTok{NB. remind user DOCUMENTDICT is off}
  \KeywordTok{if.} \KeywordTok{{-}.}\NormalTok{dictdoc }\KeywordTok{do.}\NormalTok{ ok OK063}\KeywordTok{;}\NormalTok{DNAME}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{return.} \KeywordTok{end.}

  \KeywordTok{if.}\NormalTok{ badreps }\RegionMarkerTok{(}\KeywordTok{<y}\RegionMarkerTok{)}\NormalTok{ jreplace WP}\DecValTok{\_\_}\NormalTok{DL}\KeywordTok{;}\NormalTok{CNDICDOC }\KeywordTok{do.}\NormalTok{ jderr ERR056 }\CommentTok{NB. errmsg: replace failure}
  \KeywordTok{else.}
\NormalTok{    ok OK062}\KeywordTok{;}\NormalTok{DNAME}\DecValTok{\_\_}\NormalTok{DL}
  \KeywordTok{end.}

\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{putexplain}\AlertTok{=:}\index{putexplain@\texttt{putexplain}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*putexplain v{-}{-} stores short object explanation text.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  (iaObject ;< ba) putexplain bt|blcl}

\CommentTok{NB. validate explain texts}
\KeywordTok{if.}\NormalTok{ badrc }\KeywordTok{y=.}\NormalTok{ checknttab }\KeywordTok{y} \KeywordTok{do.} \KeywordTok{y} \KeywordTok{return.} \KeywordTok{else.} \KeywordTok{y=.}\NormalTok{ rv }\KeywordTok{y} \KeywordTok{end.}
\KeywordTok{if.} \KeywordTok{+/.}\NormalTok{MAXEXPLAIN }\KeywordTok{<} \KeywordTok{\#\&>} \KeywordTok{\{:"}\DecValTok{1} \KeywordTok{y} \KeywordTok{do.}\NormalTok{ jderr ERR089 }\KeywordTok{return.} \KeywordTok{end.}  \CommentTok{NB. errmsg: text(s) to long}

\StringTok{\textquotesingle{}obj DL\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}  \CommentTok{NB. directory object !(*)=. DL}

\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \KeywordTok{x}\NormalTok{ inputdict }\KeywordTok{\{."}\DecValTok{1} \KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{else.}

\NormalTok{  ix}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{>}\NormalTok{dnix}\DecValTok{\_\_}\NormalTok{DL obj}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_\_DL\textquotesingle{}}      \CommentTok{NB. directory object noun name}
\NormalTok{  fp}\KeywordTok{=.} \KeywordTok{".}\RegionMarkerTok{(}\KeywordTok{\{.>}\NormalTok{dncn}\DecValTok{\_\_}\NormalTok{DL obj}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}P\_\_DL\textquotesingle{}} \CommentTok{NB. file pointer}

\NormalTok{  pos}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{".}\NormalTok{ix}\RegionMarkerTok{)} \KeywordTok{i.} \KeywordTok{\{."}\DecValTok{1} \KeywordTok{y}           \CommentTok{NB. inverted list replacement positions}

  \CommentTok{NB. objects exist in put dictionary update explain text}
  \KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{pos}\KeywordTok{;<<\{:"}\DecValTok{1} \KeywordTok{y}\RegionMarkerTok{)}\NormalTok{ invreplace fp}\KeywordTok{;}\NormalTok{CNEXPLAIN }\KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{end.}

\NormalTok{  uv}\KeywordTok{=.} \StringTok{\textquotesingle{} \textquotesingle{}}\KeywordTok{,>}\NormalTok{dnnm}\DecValTok{\_\_}\NormalTok{DL obj}
\NormalTok{  ok }\RegionMarkerTok{((}\KeywordTok{":\#}\NormalTok{pos}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{uv}\KeywordTok{,}\NormalTok{OK055}\RegionMarkerTok{)} \KeywordTok{;}\NormalTok{ DNAME}\DecValTok{\_\_}\NormalTok{DL}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{putgs}\AlertTok{=:}\index{putgs@\texttt{putgs}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*putgs  v{-}{-}  stores  dictionary groups  and  suites.  Prior to}
\CommentTok{NB. calling this verb  names, path and put dictionary status have}
\CommentTok{NB. been validated.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  (bacl ; ia ; ia) putgs blcl}
\CommentTok{NB.}
\CommentTok{NB.   ((<\textquotesingle{}6\textquotesingle{});WORD;GROUP) putgs ;: \textquotesingle{}group and members\textquotesingle{}}

\StringTok{\textquotesingle{}DL code gtype\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}  \CommentTok{NB. directory object !(*)=. DL}

\KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{ pathnl code }\KeywordTok{do.}\NormalTok{ msg }\KeywordTok{return.} \KeywordTok{end.}
\KeywordTok{y=.} \KeywordTok{/:\textasciitilde{}} \KeywordTok{\textasciitilde{}.} \KeywordTok{\}.} \KeywordTok{y} \KeywordTok{[}\NormalTok{ gn}\KeywordTok{=.} \KeywordTok{\{.} \KeywordTok{y}
\KeywordTok{if.} \KeywordTok{*./}\NormalTok{b}\KeywordTok{=.} \KeywordTok{y} \KeywordTok{e.} \KeywordTok{;} \KeywordTok{\}.}\NormalTok{ msg }\KeywordTok{do.}

  \CommentTok{NB. change/create group {-}{-} insure group directory is ready}
  \KeywordTok{if.}\NormalTok{ loaddir}\DecValTok{\_\_}\NormalTok{DL gtype }\KeywordTok{do.}
\NormalTok{    jderr ERR054  }\CommentTok{NB. errmsg: unable to load directory}
  \KeywordTok{elseif.} \KeywordTok{do.}

    \CommentTok{NB. depends on first char of index list matching (cP\_DL) nouns}
\NormalTok{    fc}\KeywordTok{=.} \KeywordTok{\{.}\NormalTok{ ix}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{>}\NormalTok{dnix}\DecValTok{\_\_}\NormalTok{DL gtype}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_\_DL\textquotesingle{}}
\NormalTok{    cn}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{>}\NormalTok{dncn}\DecValTok{\_\_}\NormalTok{DL gtype}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_\_DL\textquotesingle{}}

    \CommentTok{NB. groups/suites are either new or replacements}
\NormalTok{    uv}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{".}\NormalTok{ix}\RegionMarkerTok{)} \KeywordTok{i.}\NormalTok{ gn}
\NormalTok{    dfopen}\DecValTok{\_\_}\NormalTok{DL fc}
\NormalTok{    gp}\KeywordTok{=.} \KeywordTok{".}\NormalTok{fc}\KeywordTok{,}\StringTok{\textquotesingle{}P\_\_DL\textquotesingle{}}

    \KeywordTok{if.}\NormalTok{ uv}\KeywordTok{=\#".}\NormalTok{ix }\KeywordTok{do.}

      \CommentTok{NB. group is new {-} create}

      \CommentTok{NB. EDGE CONDITION?? if another group with the same}
      \CommentTok{NB. name exists on the path copy the group/suite text}
      \CommentTok{NB. of that group to this new group.  Use of this system has shown}
      \CommentTok{NB. that this is desirable behaviour because of the common}
      \CommentTok{NB. practice of "regrouping" in the put dictionary new versions}
      \CommentTok{NB. of the same group that are deeper on the path.}
      \KeywordTok{if.} \KeywordTok{+./}\NormalTok{uv}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{gn}\RegionMarkerTok{)} \KeywordTok{e.\&>} \KeywordTok{\}.}\NormalTok{ pathnl gtype }\KeywordTok{do.}
        \KeywordTok{if.}\NormalTok{ badrc uv2}\KeywordTok{=.}\NormalTok{ gtype getgstext gn }\KeywordTok{do.}\NormalTok{ uv2 }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ uv}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{1}\KeywordTok{;}\DecValTok{0} \DecValTok{1}\RegionMarkerTok{)}\KeywordTok{\{::}\NormalTok{uv2 }\KeywordTok{end.}
      \KeywordTok{else.}
\NormalTok{        uv}\KeywordTok{=.} \StringTok{\textquotesingle{}\textquotesingle{}} \CommentTok{NB. default script is empty}
      \KeywordTok{end.}

\NormalTok{      gdat}\KeywordTok{=.} \KeywordTok{<}\NormalTok{gn }\KeywordTok{,}\NormalTok{ uv }\KeywordTok{;} \KeywordTok{<} \KeywordTok{y}       \CommentTok{NB. (cn)   name, script, contents}
\NormalTok{      gdat}\KeywordTok{=.}\NormalTok{ gdat }\KeywordTok{,} \KeywordTok{<}\NormalTok{gn }\KeywordTok{,} \DecValTok{3}\KeywordTok{$<}\StringTok{\textquotesingle{}\textquotesingle{}}   \CommentTok{NB. (cn+1) name, latex, html, text, et cetera}

      \CommentTok{NB. append group}
      \KeywordTok{if.}\NormalTok{ badappend apcn }\KeywordTok{=.}\NormalTok{ gdat jappend gp }\KeywordTok{do.}
\NormalTok{        jderr ERR058 }\KeywordTok{[}\NormalTok{ dfclose}\DecValTok{\_\_}\NormalTok{DL fc }\KeywordTok{return.}  \CommentTok{NB. errmsg: append failure}
      \KeywordTok{end.}

\NormalTok{      stamp}\KeywordTok{=.}\NormalTok{ nowfd now }\StringTok{\textquotesingle{}\textquotesingle{}}
\NormalTok{      uv}\KeywordTok{=.}\NormalTok{  stamp}\KeywordTok{;}\NormalTok{stamp}\KeywordTok{;<a:}
\NormalTok{      uv2}\KeywordTok{=.}\NormalTok{ CNPUTDATE}\KeywordTok{,}\NormalTok{CNCREATION}\KeywordTok{,}\NormalTok{CNEXPLAIN }\CommentTok{NB. NIMP group append}
      \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{uv invappend gp}\KeywordTok{;}\NormalTok{uv2 }\KeywordTok{do.}\NormalTok{ msg}
      \KeywordTok{else.}
        \CommentTok{NB. update directory}
\NormalTok{        uv}\KeywordTok{=.}  \RegionMarkerTok{(}\KeywordTok{".}\NormalTok{ix}\RegionMarkerTok{)} \KeywordTok{,}\NormalTok{ gn}
\NormalTok{        uv2}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{".}\NormalTok{cn}\RegionMarkerTok{)} \KeywordTok{,} \KeywordTok{\{.}\NormalTok{ apcn}
        \KeywordTok{if.}\NormalTok{ badrc }\RegionMarkerTok{(}\NormalTok{gtype}\KeywordTok{,}\NormalTok{gp}\RegionMarkerTok{)}\NormalTok{ savedir}\DecValTok{\_\_}\NormalTok{DL uv}\KeywordTok{;}\NormalTok{uv2 }\KeywordTok{do.}
\NormalTok{          jderr msg }\KeywordTok{[}\NormalTok{ dfclose}\DecValTok{\_\_}\NormalTok{DL fc }\KeywordTok{return.}
        \KeywordTok{else.}

          \CommentTok{NB. stamp good directory change}
          \RegionMarkerTok{(}\KeywordTok{<}\RegionMarkerTok{(}\KeywordTok{\#".}\NormalTok{ix}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{now }\StringTok{\textquotesingle{}\textquotesingle{}}\RegionMarkerTok{)}\NormalTok{ jreplace gp}\KeywordTok{;}\NormalTok{CNMARK}
        \KeywordTok{end.}
      \KeywordTok{end.}

    \KeywordTok{else.}

      \CommentTok{NB. group exists {-} update}
\NormalTok{      apcn}\KeywordTok{=.}\NormalTok{ uv }\KeywordTok{\{} \KeywordTok{".}\NormalTok{cn}
      \KeywordTok{if.}\NormalTok{ badjr uv2}\KeywordTok{=.}\NormalTok{ jread gp}\KeywordTok{;}\NormalTok{apcn }\KeywordTok{do.}
\NormalTok{        jderr ERR088 }\KeywordTok{[}\NormalTok{ dfclose}\DecValTok{\_\_}\NormalTok{DL fc }\KeywordTok{return.}  \CommentTok{NB. errmsg: read failure}
      \KeywordTok{elseif.}\NormalTok{ gn }\KeywordTok{{-}:} \DecValTok{0} \KeywordTok{\{>}\NormalTok{uv2 }\KeywordTok{do.}

        \CommentTok{NB. update group list {-} group script is not changed}
        \KeywordTok{if.}\NormalTok{ badreps }\RegionMarkerTok{(}\KeywordTok{<}\RegionMarkerTok{(}\KeywordTok{\}:>}\NormalTok{uv2}\RegionMarkerTok{)}\KeywordTok{,<y}\RegionMarkerTok{)}\NormalTok{ jreplace gp}\KeywordTok{;}\NormalTok{apcn }\KeywordTok{do.}
\NormalTok{          jderr ERR056 }\KeywordTok{[}\NormalTok{ dfclose}\DecValTok{\_\_}\NormalTok{DL fc }\KeywordTok{return.}  \CommentTok{NB. errmsg: replace failure}
        \KeywordTok{end.}

\NormalTok{        uv2}\KeywordTok{=.}\NormalTok{ uv}\KeywordTok{;}\NormalTok{nowfd now }\StringTok{\textquotesingle{}\textquotesingle{}}
        \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{uv2 invreplace gp}\KeywordTok{;}\NormalTok{CNPUTDATE }\KeywordTok{do.}\NormalTok{ msg }\KeywordTok{return.} \KeywordTok{end.}

      \KeywordTok{elseif.do.}
\NormalTok{        jderr ERR055 }\KeywordTok{return.} \CommentTok{NB. errmsg: directory{-}data inconsistency}
      \KeywordTok{end.}
    \KeywordTok{end.}

\NormalTok{    dfclose}\DecValTok{\_\_}\NormalTok{DL fc}
\NormalTok{    uv}\KeywordTok{=.} \KeywordTok{,>}\NormalTok{dnnm}\DecValTok{\_\_}\NormalTok{DL gtype}
\NormalTok{    ok}\RegionMarkerTok{(}\NormalTok{uv}\KeywordTok{,}\StringTok{\textquotesingle{} <\textquotesingle{}}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{>}\NormalTok{gn}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}> \textquotesingle{}}\KeywordTok{,}\NormalTok{OK059}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{DNAME}\DecValTok{\_\_}\NormalTok{DL}
  \KeywordTok{end.}

\KeywordTok{else.}
  \RegionMarkerTok{(}\NormalTok{jderr ERR083}\RegionMarkerTok{)}\KeywordTok{,y} \KeywordTok{\#\textasciitilde{}} \KeywordTok{{-}.}\NormalTok{ b  }\CommentTok{NB. errmsg: not on path}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{putntstamp}\AlertTok{=:}\index{putntstamp@\texttt{putntstamp}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*putntstamp v{-}{-} store name, creation and last put timestamps.}
\CommentTok{NB.}
\CommentTok{NB. dyad: (iaObject ;< ba) putntstamp btNts}
\CommentTok{NB.}
\CommentTok{NB.   \textquotesingle{}rc nts\textquotesingle{}=: 0 \_14 get \}. revo \textquotesingle{}\textquotesingle{}}
\CommentTok{NB.   DL=: \{:\{:DPATH\_\_ST\_\_JODobj}
\CommentTok{NB.   (WORD;<DL) putntstamp\_\_ST\_\_JODobj nts}

\CommentTok{NB. validate name/creation/lastput array}
\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ checkntstamp }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ uv}\KeywordTok{=.}\NormalTok{ rv uv }\KeywordTok{end.}

\CommentTok{NB. directory object !(*)=. DL}
\StringTok{\textquotesingle{}obj DL\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}

\CommentTok{NB. timestamp names must exist on current path:  errmsg: not on path {-}>}
\NormalTok{tn}\KeywordTok{=.} \KeywordTok{;}\DecValTok{0}\KeywordTok{\{}\NormalTok{uv }\KeywordTok{[}\NormalTok{ pn}\KeywordTok{=.} \KeywordTok{;} \KeywordTok{\}.}\NormalTok{ pathnl obj}
\KeywordTok{if.} \DecValTok{0} \KeywordTok{e.}\NormalTok{ bm}\KeywordTok{=.}\NormalTok{ tn }\KeywordTok{e.}\NormalTok{ pn }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR083}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{bm}\RegionMarkerTok{)}\KeywordTok{\#}\NormalTok{tn }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. get current timestamps and object index}
\KeywordTok{if.}\NormalTok{ badrc cts}\KeywordTok{=.}\NormalTok{ gettstamps}\DecValTok{\_\_}\NormalTok{DL obj }\KeywordTok{do.}\NormalTok{ cts }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ cts}\KeywordTok{=.}\NormalTok{ rv cts }\KeywordTok{end.}
\NormalTok{oix}\KeywordTok{=.} \KeywordTok{".}\RegionMarkerTok{(}\KeywordTok{>}\NormalTok{dnix}\DecValTok{\_\_}\NormalTok{DL obj}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_\_DL\textquotesingle{}}

\NormalTok{pos}\KeywordTok{=.}\NormalTok{ oix }\KeywordTok{i.}\NormalTok{ tn           }\CommentTok{NB. timestamp name positions in index}
\NormalTok{pix}\KeywordTok{=.}\NormalTok{ pos }\KeywordTok{{-}.} \KeywordTok{\#}\NormalTok{oix         }\CommentTok{NB. put dictionary name positions}
\NormalTok{npn}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{I.}\NormalTok{ pos }\KeywordTok{=} \KeywordTok{\#}\NormalTok{oix}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{tn  }\CommentTok{NB. names that are not in put dictionary}
\NormalTok{ppn}\KeywordTok{=.}\NormalTok{ pix}\KeywordTok{\{}\NormalTok{oix             }\CommentTok{NB. names that are in put dictionary}

\CommentTok{NB. update put dictionary timestamps {-} insure shape is unchanged}
\NormalTok{scts}\KeywordTok{=.} \KeywordTok{$}\NormalTok{cts}
\NormalTok{cts}\KeywordTok{=.} \RegionMarkerTok{((}\NormalTok{tn }\KeywordTok{i.}\NormalTok{ ppn}\RegionMarkerTok{)} \KeywordTok{\{"}\DecValTok{1} \KeywordTok{;}\DecValTok{1}\KeywordTok{\{}\NormalTok{uv}\RegionMarkerTok{)}\NormalTok{ pix}\KeywordTok{\}"}\DecValTok{1}\NormalTok{ cts}
\KeywordTok{if.} \KeywordTok{{-}.}\NormalTok{scts }\KeywordTok{{-}:} \KeywordTok{$}\NormalTok{cts }\KeywordTok{do.}\NormalTok{ jderr ERR102 }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. attempt to save changes}
\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ obj puttstamps}\DecValTok{\_\_}\NormalTok{DL cts }\KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{else.}
\NormalTok{  ok }\RegionMarkerTok{(}\StringTok{\textquotesingle{}(\textquotesingle{}}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{":\#}\NormalTok{ppn}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{OK064}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{":\#}\NormalTok{npn}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{OK065}\RegionMarkerTok{)}\KeywordTok{;}\RegionMarkerTok{(}\KeywordTok{<}\NormalTok{ppn}\RegionMarkerTok{)}\KeywordTok{,<}\NormalTok{npn}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{puttable}\AlertTok{=:}\index{puttable@\texttt{puttable}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*puttable v{-}{-} stores (name,text) and (name,type,value) tables.}
\CommentTok{NB. Used  to  store tests,  macros, and word tables. Result  is a}
\CommentTok{NB. return code and message. Note: the directory object reference}
\CommentTok{NB. (DL) has been set before calling this verb.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  (iaObj ; bacl) puttexts btNameScript|btNameTypeValue}
\CommentTok{NB.}
\CommentTok{NB.   (TEST;<DL) puttable (\textquotesingle{}name1\textquotesingle{};\textquotesingle{}name2\textquotesingle{}) ,. \textquotesingle{}script...\textquotesingle{};\textquotesingle{}script...\textquotesingle{}}

\StringTok{\textquotesingle{}code DL\textquotesingle{}} \KeywordTok{=.} \KeywordTok{x}  \CommentTok{NB. directory object !(*)=. DL}

\KeywordTok{if.}\NormalTok{ loaddir}\DecValTok{\_\_}\NormalTok{DL code }\KeywordTok{do.}
\NormalTok{  jderr ERR054  }\CommentTok{NB. errmsg: unable to load directory}
\KeywordTok{else.}
  \KeywordTok{y=.} \KeywordTok{>\{:y}

  \CommentTok{NB. depends on first char of index list matching (cP\_DL) nouns}
\NormalTok{  fc}\KeywordTok{=.} \KeywordTok{\{.}\NormalTok{ ixn }\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{>}\NormalTok{dnix}\DecValTok{\_\_}\NormalTok{DL code}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_\_DL\textquotesingle{}}
\NormalTok{  cnn}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{>}\NormalTok{dncn}\DecValTok{\_\_}\NormalTok{DL code}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_\_DL\textquotesingle{}}

  \CommentTok{NB. either new or replacements}
\NormalTok{  uv}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{".}\NormalTok{ixn}\RegionMarkerTok{)} \KeywordTok{i.} \KeywordTok{\{."}\DecValTok{1} \KeywordTok{y}
\NormalTok{  b}\KeywordTok{=.}\NormalTok{  uv }\KeywordTok{=} \KeywordTok{\#".}\NormalTok{ixn}
\NormalTok{  pc}\KeywordTok{=.} \DecValTok{0}

  \CommentTok{NB. replace (will not change key directory lists)}
\NormalTok{  dfopen}\DecValTok{\_\_}\NormalTok{DL fc}
\NormalTok{  fp}\KeywordTok{=.} \KeywordTok{".}\NormalTok{fc}\KeywordTok{,}\StringTok{\textquotesingle{}P\_\_DL\textquotesingle{}}

  \KeywordTok{if.} \DecValTok{0} \KeywordTok{e.}\NormalTok{ b }\KeywordTok{do.}
    \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{code}\KeywordTok{;}\NormalTok{ixn}\KeywordTok{;}\NormalTok{cnn}\KeywordTok{;}\NormalTok{fp}\KeywordTok{;<}\NormalTok{DL}\RegionMarkerTok{)}\NormalTok{ rplctable }\RegionMarkerTok{(}\KeywordTok{<}\RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{b}\RegionMarkerTok{)}\KeywordTok{\#y}\RegionMarkerTok{)}\KeywordTok{,<}\RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{b}\RegionMarkerTok{)}\KeywordTok{\#}\NormalTok{uv }\KeywordTok{do.}
\NormalTok{      msg }\KeywordTok{[}\NormalTok{ dfclose}\DecValTok{\_\_}\NormalTok{DL fc }\KeywordTok{return.}
    \KeywordTok{end.}
\NormalTok{    pc}\KeywordTok{=.}\NormalTok{ pc }\KeywordTok{+}\NormalTok{ rv msg}
  \KeywordTok{end.}

  \CommentTok{NB. append (always appends to key directory lists)}
  \KeywordTok{if.} \DecValTok{1} \KeywordTok{e.}\NormalTok{ b }\KeywordTok{do.}
    \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{code}\KeywordTok{;}\NormalTok{ixn}\KeywordTok{;}\NormalTok{cnn}\KeywordTok{;}\NormalTok{fp}\KeywordTok{;<}\NormalTok{DL}\RegionMarkerTok{)}\NormalTok{ apptable b}\KeywordTok{\#y} \KeywordTok{do.}
\NormalTok{      msg }\KeywordTok{[}\NormalTok{ dfclose}\DecValTok{\_\_}\NormalTok{DL fc }\KeywordTok{return.}
    \KeywordTok{end.}
\NormalTok{    pc}\KeywordTok{=.}\NormalTok{ pc }\KeywordTok{+}\NormalTok{ rv msg}

    \CommentTok{NB. stamp good directory change}
    \RegionMarkerTok{(}\KeywordTok{<}\RegionMarkerTok{(}\KeywordTok{\#".}\NormalTok{ixn}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{now }\StringTok{\textquotesingle{}\textquotesingle{}}\RegionMarkerTok{)}\NormalTok{ jreplace fp}\KeywordTok{;}\NormalTok{CNMARK}
  \KeywordTok{end.}
\NormalTok{  dfclose}\DecValTok{\_\_}\NormalTok{DL fc}

\NormalTok{  uv}\KeywordTok{=.} \StringTok{\textquotesingle{} \textquotesingle{}}\KeywordTok{,,>}\NormalTok{dnnm}\DecValTok{\_\_}\NormalTok{DL code}
\NormalTok{  ok }\RegionMarkerTok{((}\KeywordTok{":}\NormalTok{pc}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{uv}\KeywordTok{,}\NormalTok{OK057}\RegionMarkerTok{)} \KeywordTok{;}\NormalTok{ DNAME}\DecValTok{\_\_}\NormalTok{DL}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{puttexts}\AlertTok{=:}\index{puttexts@\texttt{puttexts}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*puttexts  v{-}{-}  stores  object  documentation and  group/suite}
\CommentTok{NB. texts.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  (iaObject ; iaOffset ;< ba) puttexts bt|blcl}

\CommentTok{NB. validate texts}
\KeywordTok{if.}\NormalTok{ badrc }\KeywordTok{y=.}\NormalTok{ checknttab }\KeywordTok{y} \KeywordTok{do.} \KeywordTok{y} \KeywordTok{return.} \KeywordTok{else.} \KeywordTok{y=.}\NormalTok{ rv }\KeywordTok{y} \KeywordTok{end.}

\StringTok{\textquotesingle{}obj offset DL\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}  \CommentTok{NB. directory object !(*)=. DL}

\KeywordTok{if.} \KeywordTok{{-}.}\NormalTok{offset }\KeywordTok{e.} \DecValTok{0} \DecValTok{1} \KeywordTok{do.}\NormalTok{ jderr ERR090  }\CommentTok{NB. errmsg: file offset invalid}
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{obj}\KeywordTok{;<}\NormalTok{DL}\RegionMarkerTok{)}\NormalTok{ inputdict }\KeywordTok{\{."}\DecValTok{1} \KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.do.}

\NormalTok{  ix}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{>}\NormalTok{dnix}\DecValTok{\_\_}\NormalTok{DL obj}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_\_DL\textquotesingle{}}   \CommentTok{NB. directory object index noun}
\NormalTok{  cn}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{>}\NormalTok{dncn}\DecValTok{\_\_}\NormalTok{DL obj}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_\_DL\textquotesingle{}}   \CommentTok{NB. directory object component name}
\NormalTok{  fp}\KeywordTok{=.} \KeywordTok{".}\RegionMarkerTok{(}\KeywordTok{\{.}\NormalTok{cn}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}P\_\_DL\textquotesingle{}}         \CommentTok{NB. file pointer}

  \CommentTok{NB. text components}
\NormalTok{  rcn}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{".}\NormalTok{ix}\RegionMarkerTok{)} \KeywordTok{i.}\NormalTok{ uv}\KeywordTok{=.} \KeywordTok{\{."}\DecValTok{1} \KeywordTok{y}
\NormalTok{  rcn}\KeywordTok{=.}\NormalTok{ offset }\KeywordTok{+}\NormalTok{ rcn}\KeywordTok{\{".}\NormalTok{cn}

  \CommentTok{NB. read components and test contents}
\NormalTok{  dat}\KeywordTok{=.}\NormalTok{ jread fp}\KeywordTok{;}\NormalTok{rcn}
  \KeywordTok{if.}\NormalTok{ uv badcn dat }\KeywordTok{do.}
\NormalTok{    jderr ERR055 }\KeywordTok{return.}  \CommentTok{NB. errmsg: directory{-}data inconsistency}
  \KeywordTok{end.}

\NormalTok{  dat}\KeywordTok{=.} \KeywordTok{>}\NormalTok{dat  }\CommentTok{NB. HARDCODE: group/suite index 1, document index 3}
\NormalTok{  dat}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\{:"}\DecValTok{1} \KeywordTok{y}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{<a:;}\NormalTok{offset}\KeywordTok{\{}\DecValTok{1} \DecValTok{3}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ dat}

  \KeywordTok{if.}\NormalTok{ badreps }\RegionMarkerTok{(}\KeywordTok{<"}\DecValTok{1}\NormalTok{ dat}\RegionMarkerTok{)}\NormalTok{ jreplace fp}\KeywordTok{;}\NormalTok{rcn }\KeywordTok{do.}
\NormalTok{    jderr ERR056 }\KeywordTok{return.}  \CommentTok{NB. errmsg: replace failure}
  \KeywordTok{end.}

\NormalTok{  uv}\KeywordTok{=.} \StringTok{\textquotesingle{} \textquotesingle{}}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{>}\NormalTok{dnnm}\DecValTok{\_\_}\NormalTok{DL obj}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{} \textquotesingle{}}
\NormalTok{  ok }\RegionMarkerTok{((}\KeywordTok{":\#}\NormalTok{rcn}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{uv}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{>}\NormalTok{offset}\KeywordTok{\{}\StringTok{\textquotesingle{}text\textquotesingle{}}\KeywordTok{;}\StringTok{\textquotesingle{}document\textquotesingle{}}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{OK057}\RegionMarkerTok{)} \KeywordTok{;}\NormalTok{ DNAME}\DecValTok{\_\_}\NormalTok{DL}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{putwords}\AlertTok{=:}\index{putwords@\texttt{putwords}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*putwords v{-}{-} stores  words  in the  words  file.  Result is a}
\CommentTok{NB. return code and message.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  (cl ; baObj) putwords blclWords}
\CommentTok{NB.}
\CommentTok{NB.   (\textquotesingle{}locale\textquotesingle{};<<\textquotesingle{}2\textquotesingle{}) putwords \textquotesingle{}words\textquotesingle{};\textquotesingle{}are\textquotesingle{};\textquotesingle{}us\textquotesingle{}}

\KeywordTok{if.}\NormalTok{     badrc uv}\KeywordTok{=.}\NormalTok{ checknames }\KeywordTok{y}  \KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.} \KeywordTok{y=.} \KeywordTok{\textasciitilde{}.\}.}\NormalTok{uv      }\CommentTok{NB. unique deblanked names}
        \StringTok{\textquotesingle{}loc DL\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}    \CommentTok{NB. source locale and directory object !(*)=. DL}
\NormalTok{        b}\KeywordTok{=.}\NormalTok{ wex uv}\KeywordTok{=.} \KeywordTok{y} \KeywordTok{,\&.>}\NormalTok{ locsfx loc  }\CommentTok{NB. do words exist}
        \DecValTok{0} \KeywordTok{e.}\NormalTok{ b  }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR053}\RegionMarkerTok{)} \KeywordTok{,} \RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{b}\RegionMarkerTok{)}\KeywordTok{\#}\NormalTok{uv  }\CommentTok{NB. errmsg: word(s) do not exist}
\CommentTok{NB. insure word directory is ready}
\KeywordTok{elseif.}\NormalTok{ loaddir}\DecValTok{\_\_}\NormalTok{DL  WORD }\KeywordTok{do.}
\NormalTok{  jderr ERR054 }\CommentTok{NB. errmsg: unable to load directory}
\KeywordTok{elseif.} \KeywordTok{do.}

  \CommentTok{NB. words are either new or replacements}
\NormalTok{  uv}\KeywordTok{=.}\NormalTok{ WORDIX}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{i.} \KeywordTok{y}
\NormalTok{  b}\KeywordTok{=.}\NormalTok{  uv }\KeywordTok{=} \KeywordTok{\#}\NormalTok{WORDIX}\DecValTok{\_\_}\NormalTok{DL}
\NormalTok{  pc}\KeywordTok{=.} \DecValTok{0}

\NormalTok{  dfopen}\DecValTok{\_\_}\NormalTok{DL }\StringTok{\textquotesingle{}W\textquotesingle{}}
  \CommentTok{NB. replace words (will not change key directory lists)}
  \KeywordTok{if.} \DecValTok{0} \KeywordTok{e.}\NormalTok{ b }\KeywordTok{do.}
\NormalTok{    dropnc}\DecValTok{\_\_}\NormalTok{DL WORD  }\CommentTok{NB. replacements can change word class}
    \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.} \KeywordTok{x}\NormalTok{ rplcwords }\RegionMarkerTok{(}\KeywordTok{<}\RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{b}\RegionMarkerTok{)}\KeywordTok{\#y}\RegionMarkerTok{)}\KeywordTok{,<}\RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{b}\RegionMarkerTok{)}\KeywordTok{\#}\NormalTok{uv }\KeywordTok{do.}
\NormalTok{      msg }\KeywordTok{[}\NormalTok{ dfclose}\DecValTok{\_\_}\NormalTok{DL }\StringTok{\textquotesingle{}W\textquotesingle{}} \KeywordTok{return.}
    \KeywordTok{end.}
\NormalTok{    pc }\KeywordTok{=.}\NormalTok{ pc }\KeywordTok{+}\NormalTok{ rv msg}
  \KeywordTok{end.}

  \CommentTok{NB. append new words (always appends to key directory lists)}
  \KeywordTok{if.} \DecValTok{1} \KeywordTok{e.}\NormalTok{ b }\KeywordTok{do.}
\NormalTok{    dropnc}\DecValTok{\_\_}\NormalTok{DL WORD  }\CommentTok{NB. new words {-} force reload of name class if necessary}
    \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.} \KeywordTok{x}\NormalTok{ appwords b}\KeywordTok{\#y} \KeywordTok{do.}\NormalTok{ msg }\KeywordTok{[}\NormalTok{ dfclose}\DecValTok{\_\_}\NormalTok{DL }\StringTok{\textquotesingle{}W\textquotesingle{}} \KeywordTok{return.} \KeywordTok{end.}
\NormalTok{    pc}\KeywordTok{=.}\NormalTok{ pc }\KeywordTok{+}\NormalTok{ rv msg}

    \CommentTok{NB. stamp good directory change}
    \RegionMarkerTok{(}\KeywordTok{<}\RegionMarkerTok{(}\KeywordTok{\#}\NormalTok{WORDIX}\DecValTok{\_\_}\NormalTok{DL}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{now }\StringTok{\textquotesingle{}\textquotesingle{}}\RegionMarkerTok{)}\NormalTok{ jreplace WP}\DecValTok{\_\_}\NormalTok{DL}\KeywordTok{;}\NormalTok{CNMARK}
  \KeywordTok{end.}
\NormalTok{  dfclose}\DecValTok{\_\_}\NormalTok{DL }\StringTok{\textquotesingle{}W\textquotesingle{}}

\NormalTok{  ok }\RegionMarkerTok{((}\KeywordTok{":}\NormalTok{pc}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{OK051}\RegionMarkerTok{)} \KeywordTok{;}\NormalTok{ DNAME}\DecValTok{\_\_}\NormalTok{DL}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{putwordxrs}\AlertTok{=:}\index{putwordxrs@\texttt{putwordxrs}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*putwordxrs v{-}{-} stores global word references}
\CommentTok{NB.}
\CommentTok{NB. dyad:  (cl ;< ba) putwordxrs blcl}

\StringTok{\textquotesingle{}name DL\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x} \CommentTok{NB. directory object !(*)=. DL}

\CommentTok{NB. check path prior to storing or changing references}
\KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{ checkpath DL }\KeywordTok{do.}\NormalTok{ msg}
\KeywordTok{elseif.}\NormalTok{ loadref}\DecValTok{\_\_}\NormalTok{DL WORD }\KeywordTok{do.}\NormalTok{ jderr ERR079  }\CommentTok{NB. errmsg: unable to load references}
\KeywordTok{elseif.do.}

  \CommentTok{NB. word references are either new or replacements}
\NormalTok{  pos}\KeywordTok{=.}\NormalTok{ WORDREFIX}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{i.} \KeywordTok{<}\NormalTok{name}
\NormalTok{  b}\KeywordTok{=.}\NormalTok{ pos }\KeywordTok{=} \KeywordTok{\#}\NormalTok{WORDREFIX}\DecValTok{\_\_}\NormalTok{DL}

  \CommentTok{NB. categorize references and test for path existence}
  \KeywordTok{if.} \KeywordTok{\#y=.}\NormalTok{catrefs }\KeywordTok{y} \KeywordTok{do.}
    \KeywordTok{if.}\NormalTok{ badrc uv3}\KeywordTok{=.}\NormalTok{ pathnl WORD }\KeywordTok{do.}\NormalTok{ uv3 }\KeywordTok{return.} \KeywordTok{end.}
    \KeywordTok{if.} \DecValTok{0} \KeywordTok{e.}\NormalTok{ uv2}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{uv}\KeywordTok{=.} \DecValTok{0}\KeywordTok{\{::y}\RegionMarkerTok{)} \KeywordTok{e.} \KeywordTok{;\}.}\NormalTok{uv3 }\KeywordTok{do.}
      \RegionMarkerTok{(}\NormalTok{jderr ERR083}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{uv }\KeywordTok{\#\textasciitilde{}} \KeywordTok{{-}.}\NormalTok{uv2 }\KeywordTok{return.}  \CommentTok{NB. errmsg: not on path}
    \KeywordTok{end.}
  \KeywordTok{end.}

\NormalTok{  dfopen}\DecValTok{\_\_}\NormalTok{DL }\StringTok{\textquotesingle{}U\textquotesingle{}}
\NormalTok{  fp}\KeywordTok{=.}\NormalTok{ UP}\DecValTok{\_\_}\NormalTok{DL}

\NormalTok{  uv3}\KeywordTok{=.} \DecValTok{0}
  \KeywordTok{if.}\NormalTok{ b }\KeywordTok{do.}
    \CommentTok{NB. append new references}
    \CommentTok{NB. append only non{-}null lists}
    \KeywordTok{if.} \KeywordTok{\#y} \KeywordTok{do.}
      \CommentTok{NB. append reference list}
      \KeywordTok{y=.} \KeywordTok{<}\NormalTok{name}\KeywordTok{;}\NormalTok{WORD}\KeywordTok{;<y}
      \KeywordTok{if.}\NormalTok{ badappend cn}\KeywordTok{=.} \KeywordTok{y}\NormalTok{ jappend fp }\KeywordTok{do.}
\NormalTok{        jderr ERR058 }\KeywordTok{[}\NormalTok{ dfclose}\DecValTok{\_\_}\NormalTok{DL }\StringTok{\textquotesingle{}U\textquotesingle{}} \KeywordTok{return.}  \CommentTok{NB. errmsg: append failure}
      \KeywordTok{end.}
\NormalTok{      uv}\KeywordTok{=.}\NormalTok{  WORDREFIX}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{,} \KeywordTok{<}\NormalTok{name}
\NormalTok{      uv2}\KeywordTok{=.}\NormalTok{ WORDREFCN}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{,}\NormalTok{ cn}
\NormalTok{      uv3}\KeywordTok{=.} \DecValTok{1}
    \KeywordTok{end.}
  \KeywordTok{else.}
    \CommentTok{NB. replace references (removing nulls if necessary)}
    \CommentTok{NB. NIMP directory{-}data consistency check}
    \KeywordTok{if.} \KeywordTok{\#y} \KeywordTok{do.}
      \CommentTok{NB. non{-}null replacement list}
      \KeywordTok{y=.} \KeywordTok{<}\NormalTok{name}\KeywordTok{;}\NormalTok{WORD}\KeywordTok{;<y}
      \KeywordTok{if.}\NormalTok{ badreps }\KeywordTok{y}\NormalTok{ jreplace fp}\KeywordTok{;}\NormalTok{pos}\KeywordTok{\{}\NormalTok{WORDREFCN}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{do.}
\NormalTok{        jderr ERR056 }\KeywordTok{[}\NormalTok{ dfclose}\DecValTok{\_\_}\NormalTok{DL }\StringTok{\textquotesingle{}U\textquotesingle{}} \KeywordTok{return.}  \CommentTok{NB. errmsg: replace failure}
      \KeywordTok{end.}
    \KeywordTok{else.}
      \CommentTok{NB. replacement has no references remove from directory}
\NormalTok{      uv3}\KeywordTok{=.} \DecValTok{0}\NormalTok{ pos}\KeywordTok{\}} \RegionMarkerTok{(}\KeywordTok{\#}\NormalTok{WORDREFIX}\DecValTok{\_\_}\NormalTok{DL}\RegionMarkerTok{)}\KeywordTok{\#}\DecValTok{1}
\NormalTok{      uv}\KeywordTok{=.}\NormalTok{  uv3}\KeywordTok{\#}\NormalTok{WORDREFIX}\DecValTok{\_\_}\NormalTok{DL}
\NormalTok{      uv2}\KeywordTok{=.}\NormalTok{ uv3}\KeywordTok{\#}\NormalTok{WORDREFCN}\DecValTok{\_\_}\NormalTok{DL}
\NormalTok{      uv3}\KeywordTok{=.} \DecValTok{1}
    \KeywordTok{end.}
  \KeywordTok{end.}

  \CommentTok{NB. update reference directory and close}
  \KeywordTok{if.}\NormalTok{ uv3 }\KeywordTok{do.}
    \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{WORD}\KeywordTok{,}\NormalTok{fp}\RegionMarkerTok{)}\NormalTok{ saveref}\DecValTok{\_\_}\NormalTok{DL uv}\KeywordTok{;}\NormalTok{uv2 }\KeywordTok{do.}\NormalTok{ msg }\KeywordTok{[}\NormalTok{ dfclose}\DecValTok{\_\_}\NormalTok{DL }\StringTok{\textquotesingle{}U\textquotesingle{}} \KeywordTok{return.} \KeywordTok{end.}
  \KeywordTok{end.}
\NormalTok{  dfclose}\DecValTok{\_\_}\NormalTok{DL }\StringTok{\textquotesingle{}U\textquotesingle{}}

\NormalTok{  ok }\RegionMarkerTok{(}\StringTok{\textquotesingle{}<\textquotesingle{}}\KeywordTok{,}\NormalTok{name}\KeywordTok{,}\StringTok{\textquotesingle{}>\textquotesingle{}}\KeywordTok{,}\NormalTok{OK056}\RegionMarkerTok{)} \KeywordTok{;}\NormalTok{ DNAME}\DecValTok{\_\_}\NormalTok{DL}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rplctable}\AlertTok{=:}\index{rplctable@\texttt{rplctable}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*rplctable v{-}{-} replaces (name,text) and (name,type,value) tables to file.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  bl rplctable (btTable ,< ilPositions)}

\StringTok{\textquotesingle{}ttype ixn cnn fp DL\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}  \CommentTok{NB. directory object !(*)=. DL}
\KeywordTok{y=.} \DecValTok{0} \KeywordTok{[} \StringTok{\textquotesingle{}tab pos\textquotesingle{}}\KeywordTok{=.} \KeywordTok{y}

\NormalTok{sizes}\KeywordTok{=.} \KeywordTok{\#\&>} \KeywordTok{\{:"}\DecValTok{1}\NormalTok{ tab}
\NormalTok{tc}\KeywordTok{=.} \KeywordTok{\#}\NormalTok{tab }\KeywordTok{[}\NormalTok{ cn}\KeywordTok{=.}\NormalTok{ pos}\KeywordTok{\{".}\NormalTok{cnn}
\NormalTok{pf}\KeywordTok{=.}\NormalTok{ PUTFACTOR}\DecValTok{\_\_}\NormalTok{DL}

\CommentTok{NB. for words and macros record class/type}
\KeywordTok{if.}\NormalTok{ wmt}\KeywordTok{=.}\NormalTok{ ttype }\KeywordTok{e.}\NormalTok{ WORD}\KeywordTok{,}\NormalTok{MACRO }\KeywordTok{do.}
\NormalTok{  class}\KeywordTok{=.} \KeywordTok{;} \DecValTok{1} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ tab}
\KeywordTok{end.}

\KeywordTok{while.} \KeywordTok{\#}\NormalTok{tab }\KeywordTok{do.}
\NormalTok{  cnt}\KeywordTok{=.}\NormalTok{ pf }\KeywordTok{<.} \KeywordTok{\#}\NormalTok{tab}
\NormalTok{  tn}\KeywordTok{=.}\NormalTok{  cnt}\KeywordTok{\{.}\NormalTok{tab }\KeywordTok{[}\NormalTok{ rcn}\KeywordTok{=.}\NormalTok{ cnt}\KeywordTok{\{.}\NormalTok{cn}

  \CommentTok{NB. read components and test contents}
\NormalTok{  dat}\KeywordTok{=.}\NormalTok{ jread fp}\KeywordTok{;}\NormalTok{rcn}
  \KeywordTok{if.} \RegionMarkerTok{(}\KeywordTok{\{."}\DecValTok{1}\NormalTok{ tn}\RegionMarkerTok{)}\NormalTok{ badcn dat }\KeywordTok{do.}
\NormalTok{    jderr ERR055 }\KeywordTok{return.}  \CommentTok{NB. errmsg: directory{-}data inconsistency}
  \KeywordTok{end.}

  \CommentTok{NB. replace}
  \KeywordTok{if.}\NormalTok{ badreps }\RegionMarkerTok{(}\KeywordTok{<"}\DecValTok{1}\NormalTok{ tn}\RegionMarkerTok{)}\NormalTok{ jreplace fp}\KeywordTok{;}\NormalTok{rcn }\KeywordTok{do.}
\NormalTok{    jderr ERR056 }\KeywordTok{return.}  \CommentTok{NB. errmsg: replace failure}
  \KeywordTok{end.}

\NormalTok{  tab}\KeywordTok{=.}\NormalTok{ cnt}\KeywordTok{\}.}\NormalTok{tab }\KeywordTok{[}\NormalTok{ cn}\KeywordTok{=.}\NormalTok{ cnt}\KeywordTok{\}.}\NormalTok{cn}
\KeywordTok{end.}

\CommentTok{NB. set up replacements}
\KeywordTok{if.}\NormalTok{ wmt }\KeywordTok{do.}
\NormalTok{  dropnc}\DecValTok{\_\_}\NormalTok{DL ttype }\CommentTok{NB. replacements can change class/type}
\NormalTok{  invcmps}\KeywordTok{=.}\NormalTok{ CNCLASS}\KeywordTok{,}\NormalTok{CNPUTDATE}\KeywordTok{,}\NormalTok{CNSIZE}
\NormalTok{  reps}\KeywordTok{=.}\NormalTok{ pos}\KeywordTok{;<}\NormalTok{class}\KeywordTok{;}\RegionMarkerTok{(}\NormalTok{tc}\KeywordTok{\#}\NormalTok{nowfd now }\StringTok{\textquotesingle{}\textquotesingle{}}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{sizes}
\KeywordTok{else.}
\NormalTok{  invcmps}\KeywordTok{=.}\NormalTok{ CNPUTDATE}\KeywordTok{,}\NormalTok{CNSIZE}
\NormalTok{  reps}\KeywordTok{=.}\NormalTok{ pos}\KeywordTok{;<}\RegionMarkerTok{(}\NormalTok{tc}\KeywordTok{\#}\NormalTok{nowfd now }\StringTok{\textquotesingle{}\textquotesingle{}}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{sizes}
\KeywordTok{end.}

\KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{ reps invreplace fp}\KeywordTok{;}\NormalTok{invcmps }\KeywordTok{do.}\NormalTok{ msg }\KeywordTok{else.}\NormalTok{ ok tc }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rplcwords}\AlertTok{=:}\index{rplcwords@\texttt{rplcwords}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*rplcwords v{-}{-} replaces extant words.}

\StringTok{\textquotesingle{}loc DL\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}  \CommentTok{NB. directory object !(*)=. DL}
\StringTok{\textquotesingle{}names pos\textquotesingle{}}\KeywordTok{=.} \KeywordTok{y}
\NormalTok{cn}\KeywordTok{=.}\NormalTok{ pos}\KeywordTok{\{}\NormalTok{WORDCN}\DecValTok{\_\_}\NormalTok{DL}
\NormalTok{wc}\KeywordTok{=.} \KeywordTok{\#}\NormalTok{pos}

\NormalTok{wp}\KeywordTok{=.}\NormalTok{ WP}\DecValTok{\_\_}\NormalTok{DL }\KeywordTok{[}\NormalTok{ pf}\KeywordTok{=.}\NormalTok{ PUTFACTOR}\DecValTok{\_\_}\NormalTok{DL}
\NormalTok{lnames}\KeywordTok{=.}\NormalTok{ names }\KeywordTok{,\&.>}\NormalTok{ locsfx loc}
\NormalTok{size}\KeywordTok{=.}\NormalTok{ class}\KeywordTok{=.} \KeywordTok{i.}\DecValTok{0}

\KeywordTok{while.} \KeywordTok{\#}\NormalTok{names }\KeywordTok{do.}
\NormalTok{  cnt}\KeywordTok{=.}\NormalTok{ pf }\KeywordTok{<.} \KeywordTok{\#}\NormalTok{names}
\NormalTok{  wn}\KeywordTok{=.}\NormalTok{ cnt}\KeywordTok{\{.}\NormalTok{names }\KeywordTok{[}\NormalTok{ lwn}\KeywordTok{=.}\NormalTok{ cnt}\KeywordTok{\{.}\NormalTok{lnames }\KeywordTok{[}\NormalTok{ rcn}\KeywordTok{=.}\NormalTok{ cnt}\KeywordTok{\{.}\NormalTok{cn}

  \CommentTok{NB. read components and test contents {-} this slows things}
  \CommentTok{NB. down but significantly improves database hygiene}
\NormalTok{  dat}\KeywordTok{=.}\NormalTok{ jread WP}\DecValTok{\_\_}\NormalTok{DL}\KeywordTok{;}\NormalTok{rcn}
  \KeywordTok{if.}\NormalTok{ wn badcn dat }\KeywordTok{do.}
\NormalTok{    jderr ERR055  }\CommentTok{NB. errmsg: directory{-}data inconsistency}
  \KeywordTok{end.}

\NormalTok{  val}\KeywordTok{=.}\NormalTok{ wrep}\KeywordTok{\&.>}\NormalTok{ lwn   }\CommentTok{NB. word values}
\NormalTok{  bsz}\KeywordTok{=.} \KeywordTok{\#\&>}\NormalTok{ val       }\CommentTok{NB. NIMP word byte sizes (size test)}
\NormalTok{  bnc}\KeywordTok{=.}\NormalTok{ nc lwn        }\CommentTok{NB. word name class}
\NormalTok{  val}\KeywordTok{=.} \KeywordTok{,} \KeywordTok{<"}\DecValTok{1}\NormalTok{ wn }\KeywordTok{,.} \RegionMarkerTok{(}\KeywordTok{<"}\DecValTok{0}\NormalTok{ bnc}\RegionMarkerTok{)} \KeywordTok{,.}\NormalTok{ val}

  \CommentTok{NB. replace words}
  \KeywordTok{if.}\NormalTok{ badreps val jreplace wp}\KeywordTok{;}\NormalTok{rcn }\KeywordTok{do.}
\NormalTok{    jderr ERR056  }\CommentTok{NB. errmsg: replace failure}
  \KeywordTok{else.}
\NormalTok{    size}\KeywordTok{=.}\NormalTok{ size }\KeywordTok{,}\NormalTok{ bsz}
\NormalTok{    class}\KeywordTok{=.}\NormalTok{ class }\KeywordTok{,}\NormalTok{ bnc}
  \KeywordTok{end.}

\NormalTok{  names}\KeywordTok{=.}\NormalTok{ cnt}\KeywordTok{\}.}\NormalTok{names }\KeywordTok{[}\NormalTok{ lnames}\KeywordTok{=.}\NormalTok{ cnt}\KeywordTok{\}.}\NormalTok{lnames }\KeywordTok{[}\NormalTok{ cn}\KeywordTok{=.}\NormalTok{ cnt}\KeywordTok{\}.}\NormalTok{cn}
\KeywordTok{end.}

\NormalTok{msg}\KeywordTok{=.}\NormalTok{ ERR057  }\CommentTok{NB. errmsg: directory update failure}
\KeywordTok{if.}\NormalTok{ wc }\KeywordTok{\textasciitilde{}:} \KeywordTok{\#}\NormalTok{size }\KeywordTok{do.}\NormalTok{ jderr msg }\KeywordTok{return.} \KeywordTok{end.}

\NormalTok{reps}\KeywordTok{=.}\NormalTok{ pos}\KeywordTok{;<}\NormalTok{class}\KeywordTok{;}\RegionMarkerTok{(}\NormalTok{wc}\KeywordTok{\#}\NormalTok{nowfd now }\StringTok{\textquotesingle{}\textquotesingle{}}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{size}
\KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{reps invreplace wp}\KeywordTok{;}\NormalTok{CNCLASS}\KeywordTok{,}\NormalTok{CNPUTDATE}\KeywordTok{,}\NormalTok{CNSIZE }\KeywordTok{do.}\NormalTok{ msg }\KeywordTok{else.}\NormalTok{ ok wc }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. raise, nub and sort blblcl name lists}
\NormalTok{sortdnub}\AlertTok{=:}\index{sortdnub@\texttt{sortdnub}} \KeywordTok{[:} \KeywordTok{/:\textasciitilde{}} \KeywordTok{[:} \KeywordTok{\textasciitilde{}.} \KeywordTok{;}
\end{Highlighting}
\end{Shaded}
