\section{\texttt{jodmake} Source Code}

\begin{JODGroupHeader}
\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. *jodmake c{-}{-} script making \& code manipulation: extension of (jod).}
\CommentTok{NB.}
\CommentTok{NB. This subclass defines utilities for making scripts from}
\CommentTok{NB. groups and suites.  It also contains code for analyzing}
\CommentTok{NB. name references in J words.}
\CommentTok{NB.}
\CommentTok{NB. Interface nouns \& verbs:}
\CommentTok{NB.   getallts      gets all timestamps}
\CommentTok{NB.   makedump      dumps objects on path to put dump directory}
\CommentTok{NB.   makegs        make group and suite scripts}
\CommentTok{NB.   namecats      classifies names in J code}
\CommentTok{NB.   putallts      puts all timestamps {-} see (getallts)}
\CommentTok{NB.   wttext        word and test text}
\CommentTok{NB.   wrdglobals    extracts global names from J code}
\CommentTok{NB.}
\CommentTok{NB. Notes:}
\CommentTok{NB.   Error messages (jodmake range 150{-}199)}

\NormalTok{coclass }\StringTok{\textquotesingle{}ajodmake\textquotesingle{}}
\NormalTok{coinsert  }\StringTok{\textquotesingle{}ajod\textquotesingle{}}

\CommentTok{NB.*dependents x{-}{-} objects with definition dependencies}

\CommentTok{NB. tags JOD dump script rebuild commands}
\NormalTok{DUMPTAG}\AlertTok{=:}\index{DUMPTAG@\texttt{DUMPTAG}} \StringTok{\textquotesingle{} NB.\{*JOD*\}\textquotesingle{}}

\CommentTok{NB. large text wrap temporary noun name and line width}
\NormalTok{WRAPTMPWID}\AlertTok{=:}\index{WRAPTMPWID@\texttt{WRAPTMPWID}} \StringTok{\textquotesingle{}zz\textquotesingle{}}\KeywordTok{;}\DecValTok{67}

\CommentTok{NB. expression that clears scratch object}
\NormalTok{SOCLEAR}\AlertTok{=:}\index{SOCLEAR@\texttt{SOCLEAR}} \StringTok{\textquotesingle{}".soclear\textquotesingle{}}\KeywordTok{,}\NormalTok{DUMPTAG}

\CommentTok{NB. expression that rebuilds groups and suites from scatch object data}
\NormalTok{SOGRP}\AlertTok{=:}\index{SOGRP@\texttt{SOGRP}} \StringTok{\textquotesingle{} grp\&> ". ". \textquotesingle{}\textquotesingle{}\textquotesingle{}}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{>\{.}\NormalTok{WRAPTMPWID}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_\textquotesingle{}\textquotesingle{},SOLOCALE,\textquotesingle{}\textquotesingle{}\_\textquotesingle{}\textquotesingle{} [ cocurrent \textquotesingle{}\textquotesingle{}base\textquotesingle{}\textquotesingle{}\textquotesingle{}}\KeywordTok{,}\NormalTok{DUMPTAG}

\CommentTok{NB. expression that stores words in the scratch object in JOD}
\NormalTok{SOPUT}\AlertTok{=:}\index{SOPUT@\texttt{SOPUT}} \StringTok{\textquotesingle{}soput ".\textquotesingle{}\textquotesingle{}nl\_\textquotesingle{}\textquotesingle{},SOLOCALE,\textquotesingle{}\textquotesingle{}\_ i.4\textquotesingle{}\textquotesingle{} [ cocurrent \textquotesingle{}\textquotesingle{}base\textquotesingle{}\textquotesingle{}\textquotesingle{}}\KeywordTok{,}\NormalTok{DUMPTAG}

\CommentTok{NB. expression that stores (name,text) tables in scratch object}
\NormalTok{SOPUTTEXT}\AlertTok{=:}\index{SOPUTTEXT@\texttt{SOPUTTEXT}} \StringTok{\textquotesingle{} put ". ".\textquotesingle{}\textquotesingle{}\textquotesingle{}}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{>\{.}\NormalTok{WRAPTMPWID}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_\textquotesingle{}\textquotesingle{},SOLOCALE,\textquotesingle{}\textquotesingle{}\_\textquotesingle{}\textquotesingle{} [ cocurrent \textquotesingle{}\textquotesingle{}base\textquotesingle{}\textquotesingle{}\textquotesingle{}}\KeywordTok{,}\NormalTok{DUMPTAG}

\CommentTok{NB. expression that switches to numbered scratch locale}
\NormalTok{SOSWITCH}\AlertTok{=:}\index{SOSWITCH@\texttt{SOSWITCH}} \StringTok{\textquotesingle{}cocurrent SO\_\_JODobj\textquotesingle{}}\KeywordTok{,}\NormalTok{DUMPTAG}

\CommentTok{NB.*enddependents}


\CommentTok{NB.*end{-}header}
\end{Highlighting}
\end{Shaded}
\end{JODGroupHeader}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DUMPMSG0}\AlertTok{=:}\index{DUMPMSG0@\texttt{DUMPMSG0}} \StringTok{\textquotesingle{}NB. JOD dictionary dump: \textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DUMPMSG1}\AlertTok{=:}\index{DUMPMSG1@\texttt{DUMPMSG1}} \StringTok{\textquotesingle{}Names \& DidNums on current path\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. should appear as quoted text when displayed}
\NormalTok{DUMPMSG2}\AlertTok{=:}\index{DUMPMSG2@\texttt{DUMPMSG2}} \StringTok{\textquotesingle{}\textquotesingle{}\textquotesingle{}NB. end{-}of{-}JOD{-}dump{-}file regenerate cross references with:  0 globs\&> \}. revo \textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{} \textquotesingle{}\textquotesingle{}\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. version prefix text for JOD dumps}
\NormalTok{DUMPMSG3}\AlertTok{=:}\index{DUMPMSG3@\texttt{DUMPMSG3}} \StringTok{\textquotesingle{}NB. Generated with JOD version\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. J version that created this dumpfile}
\NormalTok{DUMPMSG4}\AlertTok{=:}\index{DUMPMSG4@\texttt{DUMPMSG4}} \StringTok{\textquotesingle{}NB. J version: \textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0150}\AlertTok{=:}\index{ERR0150@\texttt{ERR0150}} \StringTok{\textquotesingle{}confused declarations {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0151}\AlertTok{=:}\index{ERR0151@\texttt{ERR0151}} \StringTok{\textquotesingle{}word syntax\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0152}\AlertTok{=:}\index{ERR0152@\texttt{ERR0152}} \StringTok{\textquotesingle{}no definition {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0153}\AlertTok{=:}\index{ERR0153@\texttt{ERR0153}} \StringTok{\textquotesingle{}file write failure\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0154}\AlertTok{=:}\index{ERR0154@\texttt{ERR0154}} \StringTok{\textquotesingle{}invalid group/suite name\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0155}\AlertTok{=:}\index{ERR0155@\texttt{ERR0155}} \StringTok{\textquotesingle{}unable to append to dumpfile {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0156}\AlertTok{=:}\index{ERR0156@\texttt{ERR0156}} \StringTok{\textquotesingle{}unable to create dumpfile {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0157}\AlertTok{=:}\index{ERR0157@\texttt{ERR0157}} \StringTok{\textquotesingle{}directory{-}component name class inconsistency {-}{-} dump aborted {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0158}\AlertTok{=:}\index{ERR0158@\texttt{ERR0158}} \StringTok{\textquotesingle{}invalid fully qualified dump file name\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0159}\AlertTok{=:}\index{ERR0159@\texttt{ERR0159}} \StringTok{\textquotesingle{}mixed assignments {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0160}\AlertTok{=:}\index{ERR0160@\texttt{ERR0160}} \StringTok{\textquotesingle{}invalid object timestamp table\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. multiplicative factor for small text dumps}
\NormalTok{EXPLAINFAC}\AlertTok{=:}\index{EXPLAINFAC@\texttt{EXPLAINFAC}} \DecValTok{10}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. first table of valid single line explicit headers}
\NormalTok{EXPPFX0}\AlertTok{=:}\index{EXPPFX0@\texttt{EXPPFX0}} \DecValTok{4} \DecValTok{5}\KeywordTok{$}\StringTok{\textquotesingle{}1 : \textquotesingle{}\textquotesingle{}2 : \textquotesingle{}\textquotesingle{}3 : \textquotesingle{}\textquotesingle{}4 : \textquotesingle{}\textquotesingle{}\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. second table of valid single line explicit headers}
\NormalTok{EXPPFX1}\AlertTok{=:}\index{EXPPFX1@\texttt{EXPPFX1}} \DecValTok{3} \DecValTok{8}\KeywordTok{$}\StringTok{\textquotesingle{}3 : (\textquotesingle{}\textquotesingle{}:\textquotesingle{}\textquotesingle{}3 : (,\textquotesingle{}\textquotesingle{}:4 : (,\textquotesingle{}\textquotesingle{}:\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. report labels for reference case of (globs)}
\NormalTok{GLOBCATS}\AlertTok{=:}\index{GLOBCATS@\texttt{GLOBCATS}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} Global Local (*)=: (*)=. for.\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. string marking end of class header}
\NormalTok{HEADEND}\AlertTok{=:}\index{HEADEND@\texttt{HEADEND}} \StringTok{\textquotesingle{}NB.*end{-}header\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. explict J argument names}
\NormalTok{JARGS}\AlertTok{=:}\index{JARGS@\texttt{JARGS}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} x y u v m n $:\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. mixed assignment override tag}
\NormalTok{MIXEDOVER}\AlertTok{=:}\index{MIXEDOVER@\texttt{MIXEDOVER}} \StringTok{\textquotesingle{}(<:)=:\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK0150}\AlertTok{=:}\index{OK0150@\texttt{OK0150}} \StringTok{\textquotesingle{}file saved {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK0151}\AlertTok{=:}\index{OK0151@\texttt{OK0151}} \StringTok{\textquotesingle{}object(s) on path dumped {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. portable box drawing characters}
\NormalTok{PORTCHARS}\AlertTok{=:}\index{PORTCHARS@\texttt{PORTCHARS}} \KeywordTok{,:}\StringTok{\textquotesingle{}+++++++++|{-}\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. name of monadic identity verb that displays and passes argument}
\NormalTok{SOPASS}\AlertTok{=:}\index{SOPASS@\texttt{SOPASS}} \StringTok{\textquotesingle{}showpass \textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{btclfrcl}\AlertTok{=:}\index{btclfrcl@\texttt{btclfrcl}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*btclfrcl v{-}{-} inverse of clfrbtcl.}
\CommentTok{NB.}
\CommentTok{NB. monad:  btcl =. btclfrcl cl}

\CommentTok{NB. length of prefix}
\NormalTok{len}\KeywordTok{=.} \KeywordTok{".}\RegionMarkerTok{(}\NormalTok{pos}\KeywordTok{=.} \KeywordTok{y} \KeywordTok{i.} \StringTok{\textquotesingle{} \textquotesingle{}}\RegionMarkerTok{)}\KeywordTok{\{.} \KeywordTok{y}
\KeywordTok{y=.} \RegionMarkerTok{(}\KeywordTok{>:}\NormalTok{pos}\RegionMarkerTok{)} \KeywordTok{\}.} \KeywordTok{y}

\CommentTok{NB. prefix and shape of bt}
\NormalTok{shp}\KeywordTok{=.} \DecValTok{2} \KeywordTok{\{.}\NormalTok{ pfx}\KeywordTok{=.} \KeywordTok{".}\NormalTok{ len }\KeywordTok{\{.} \KeywordTok{y}
\NormalTok{pfx}\KeywordTok{=.} \DecValTok{2} \KeywordTok{\}.}\NormalTok{ pfx}
\NormalTok{tab}\KeywordTok{=.}\NormalTok{ len }\KeywordTok{\}.} \KeywordTok{y}

\KeywordTok{if.} \KeywordTok{\#}\NormalTok{tab }\KeywordTok{do.}
\NormalTok{  zm}\KeywordTok{=.} \DecValTok{0}\KeywordTok{<}\NormalTok{pfx}
\NormalTok{  bm}\KeywordTok{=.} \DecValTok{0} \KeywordTok{\#\textasciitilde{}} \KeywordTok{\#}\NormalTok{tab}
\NormalTok{  ri}\KeywordTok{=.} \KeywordTok{\}:}\DecValTok{0}\KeywordTok{,+/\textbackslash{}}\NormalTok{zm}\KeywordTok{\#}\NormalTok{pfx}
\NormalTok{  bm}\KeywordTok{=.} \DecValTok{1}\NormalTok{ ri }\KeywordTok{\}}\NormalTok{ bm}
\NormalTok{  shp }\KeywordTok{$}\NormalTok{ zm }\KeywordTok{\#\^{}:}\NormalTok{\_}\DecValTok{1}\NormalTok{ bm }\KeywordTok{<;.}\DecValTok{1}\NormalTok{ tab}
\KeywordTok{else.}
\NormalTok{  shp}\KeywordTok{$<}\StringTok{\textquotesingle{}\textquotesingle{}}  \CommentTok{NB. all nulls}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{clearso}\AlertTok{=:}\index{clearso@\texttt{clearso}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*clearso v{-}{-} empty scratch object.}
\CommentTok{NB.}
\CommentTok{NB. monad:  clearso uuIgnore}

\KeywordTok{if.} \KeywordTok{\#}\NormalTok{s}\KeywordTok{=.}\NormalTok{ nl}\DecValTok{\_\_}\NormalTok{SO }\KeywordTok{i.}\DecValTok{4} \KeywordTok{do.} \RegionMarkerTok{(}\DecValTok{4}\KeywordTok{!:}\DecValTok{55}\RegionMarkerTok{)}\NormalTok{ s }\KeywordTok{,\&.>}\NormalTok{ locsfx SO }\KeywordTok{end.}  \CommentTok{NB. !(*)=. SO}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{clfrbtcl}\AlertTok{=:}\index{clfrbtcl@\texttt{clfrbtcl}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*clfrbtcl v{-}{-} btcl to encoded cl.}
\CommentTok{NB.}
\CommentTok{NB. This verb  converts a boxed table of character lists to a  cl}
\CommentTok{NB. representation that can be used  to recreate the boxed table.}
\CommentTok{NB. It  is used instead of (5!:5) for btcl as (5!:5)  generates a}
\CommentTok{NB. large  a.   index  representation  for  character  data  when}
\CommentTok{NB. selected "control" characters are present.}
\CommentTok{NB.}
\CommentTok{NB. monad:  cl =. clfrbtcl btcl}

\CommentTok{NB. shape and lengths of all char lists}
\NormalTok{sp}\KeywordTok{=.} \KeywordTok{$} \KeywordTok{y}
\NormalTok{lc}\KeywordTok{=.} \KeywordTok{,} \KeywordTok{\#\&>} \KeywordTok{y}

\CommentTok{NB. first number is length of prefix}
\NormalTok{pfx}\KeywordTok{=.} \KeywordTok{":}\NormalTok{sp}\KeywordTok{,}\NormalTok{lc}
\RegionMarkerTok{(}\KeywordTok{":$}\NormalTok{pfx}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{} \textquotesingle{}}\KeywordTok{,}\NormalTok{pfx}\KeywordTok{,} \KeywordTok{;y}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{createmk}\AlertTok{=:}\index{createmk@\texttt{createmk}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*createmk v{-}{-} initializes maker objects}
\CommentTok{NB.}
\CommentTok{NB. monad:  createmk blObrefs}
\CommentTok{NB.}
\CommentTok{NB.   createmk\_\_MK JOD;ST;MK;UT;<SO}

\CommentTok{NB. object references !(*)=. JOD ST MK UT SO}
\StringTok{\textquotesingle{}JOD ST MK UT SO\textquotesingle{}}\AlertTok{=:}\index{\textquotesingle{}@\texttt{\textquotesingle{}}}  \KeywordTok{y}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dec85}\AlertTok{=:}\index{dec85@\texttt{dec85}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dec85  v{-}{-} decodes ASCII85  (name,text)  and (name,code,text)}
\CommentTok{NB. tables.}
\CommentTok{NB.}
\CommentTok{NB. monad:  cl55=. dec85 cl}

\NormalTok{tab}\KeywordTok{=.}\NormalTok{ fromascii85 }\KeywordTok{y}
\NormalTok{tab}\KeywordTok{=.}\NormalTok{ btclfrcl tab}

\CommentTok{NB. there are two types of tables in JOD (name,text) and (name,code,text)}
\KeywordTok{assert.} \RegionMarkerTok{(}\KeywordTok{\{:$}\NormalTok{tab}\RegionMarkerTok{)} \KeywordTok{e.} \DecValTok{2} \DecValTok{3}

\KeywordTok{if.} \DecValTok{3}\KeywordTok{=\{:$}\NormalTok{tab }\KeywordTok{do.}
  \CommentTok{NB. codes must be integers in JOD name,code,text tables}
\NormalTok{  codes}\KeywordTok{=.} \KeywordTok{<a:;}\DecValTok{1}
\NormalTok{  val}\KeywordTok{=.} \KeywordTok{".\&.>}\NormalTok{ codes }\KeywordTok{\{}\NormalTok{ tab}
\NormalTok{  tab}\KeywordTok{=.}\NormalTok{ val codes }\KeywordTok{\}}\NormalTok{ tab}
\KeywordTok{end.}

\CommentTok{NB. put commands are expecting (5!:5) strings}
\DecValTok{5}\KeywordTok{!:}\DecValTok{5} \KeywordTok{<}\StringTok{\textquotesingle{}tab\textquotesingle{}}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dumpdictdoc}\AlertTok{=:}\index{dumpdictdoc@\texttt{dumpdictdoc}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dumpdictdoc  v{-}{-} appends  dictionary  documentation  text  to}
\CommentTok{NB. dumpfile.}
\CommentTok{NB.}
\CommentTok{NB. monad:  dumpdictdoc clPathFile}
\CommentTok{NB.}
\CommentTok{NB.   dumpdictdoc \textquotesingle{}c:\textbackslash{}go\textbackslash{}ahead\textbackslash{}dump\textbackslash{}my\textbackslash{}dictionary.ijs\textquotesingle{}}

\CommentTok{NB. cannot fetch document or document is empty}
\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ DICTIONARY get }\StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR0155}\RegionMarkerTok{)}\KeywordTok{,<y} \KeywordTok{return.} \KeywordTok{end.}
\KeywordTok{if.} \DecValTok{0}\KeywordTok{=\#}\NormalTok{uv}\KeywordTok{=.} \KeywordTok{>}\DecValTok{1}\KeywordTok{\{}\NormalTok{uv }\KeywordTok{do.}\NormalTok{ OK }\KeywordTok{return.} \KeywordTok{end.}

\NormalTok{tag}\KeywordTok{=.}\NormalTok{ DUMPTAG}\KeywordTok{,}\NormalTok{LF}
\NormalTok{putso}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{2}\KeywordTok{\#}\NormalTok{LF}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{SOSWITCH}\KeywordTok{,}\NormalTok{LF}

\CommentTok{NB. expression to store dictionary documentation text in scratch locale}
\NormalTok{soputdoc}\KeywordTok{=.}\NormalTok{ SOPASS}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{":}\NormalTok{DICTIONARY}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{} put >1\{,".".\textquotesingle{}\textquotesingle{}zz\_\textquotesingle{}\textquotesingle{},SOLOCALE,\textquotesingle{}\textquotesingle{}\_\textquotesingle{}\textquotesingle{} [ cocurrent \textquotesingle{}\textquotesingle{}base\textquotesingle{}\textquotesingle{} \textquotesingle{}}\KeywordTok{,}\NormalTok{tag}

\CommentTok{NB. format document text for dump}
\NormalTok{dicdoc}\KeywordTok{=.}\NormalTok{ putso}\KeywordTok{,}\NormalTok{WRAPTMPWID fmtdumptext }\KeywordTok{,:}\StringTok{\textquotesingle{}\textquotesingle{}}\KeywordTok{;}\NormalTok{uv}
\NormalTok{dicdoc}\KeywordTok{=.}\NormalTok{ dicdoc}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{soputdoc}\KeywordTok{,}\NormalTok{SOCLEAR}\KeywordTok{,}\DecValTok{2}\KeywordTok{\#}\NormalTok{LF}

\CommentTok{NB. append dictionary documentation error msg: unable to append to dumpfile}
\KeywordTok{if.} \DecValTok{\_1} \KeywordTok{{-}:} \RegionMarkerTok{(}\NormalTok{toHOST dicdoc}\RegionMarkerTok{)}\NormalTok{ fap }\KeywordTok{<y} \KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR0155}\RegionMarkerTok{)}\KeywordTok{,<y} \KeywordTok{else.}\NormalTok{ OK }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dumpdoc}\AlertTok{=:}\index{dumpdoc@\texttt{dumpdoc}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*dumpdoc v{-}{-} dumps object documentation text.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  (iaBlksize ; iaObject ; clPathfile) dumpdoc blclNames}
\CommentTok{NB.}
\CommentTok{NB.   (0;50;\textquotesingle{}c:\textbackslash{}dump\textbackslash{}on\textbackslash{}me.ijs\textquotesingle{}) dumpdoc ;:\textquotesingle{}word name list\textquotesingle{}}

\CommentTok{NB. block size, object, output file}
\StringTok{\textquotesingle{}blk obj out\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}

\CommentTok{NB. append short and long object documentation {-} short documents are small}
\CommentTok{NB. hence we process in blocks (EXPLAINFAC) times larger than the dump block}
\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{((}\NormalTok{EXPLAINFAC}\KeywordTok{*}\NormalTok{blk}\RegionMarkerTok{)}\KeywordTok{;}\RegionMarkerTok{(}\NormalTok{obj}\KeywordTok{,}\NormalTok{EXPLAIN}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{out}\RegionMarkerTok{)}\NormalTok{ dumptext }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{blk}\KeywordTok{;}\RegionMarkerTok{(}\NormalTok{obj}\KeywordTok{,}\NormalTok{DOCUMENT}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{out}\RegionMarkerTok{)}\NormalTok{ dumptext }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.do.}\NormalTok{ OK}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dumpgs}\AlertTok{=:}\index{dumpgs@\texttt{dumpgs}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*dumpgs v{-}{-} dump groups and suites on path.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaBlksizeObject dumpgs clPathFile}
\CommentTok{NB.}
\CommentTok{NB.   (50,GROUP) dumpgs \textquotesingle{}c:\textbackslash{}dump\textbackslash{}your\textbackslash{}groups.ijs\textquotesingle{}}

\StringTok{\textquotesingle{}dmp obj\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}
\NormalTok{putso}\KeywordTok{=.}\NormalTok{ LF}\KeywordTok{,}\NormalTok{SOSWITCH}\KeywordTok{,}\NormalTok{LF}
\NormalTok{cmd}\KeywordTok{=.}\NormalTok{ SOPASS}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{":}\NormalTok{obj}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{SOGRP}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{SOCLEAR}\KeywordTok{,}\NormalTok{LF}
\NormalTok{out}\KeywordTok{=.} \KeywordTok{<y}

\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ obj dnl }\StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.} \KeywordTok{a:} \KeywordTok{e.}\NormalTok{ uv          }\KeywordTok{do.}\NormalTok{ OK  }\CommentTok{NB. no groups or suites}
\KeywordTok{elseif.do.}

\NormalTok{  uv}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{{-}}\NormalTok{dmp}\RegionMarkerTok{)} \KeywordTok{<\textbackslash{}}\NormalTok{ uv}\KeywordTok{=.\}.}\NormalTok{uv}
  \KeywordTok{for\_blk.}\NormalTok{ uv }\KeywordTok{do.}

    \CommentTok{NB. get blblcl of all objects in groups/suites}
\NormalTok{    gnames}\KeywordTok{=.}\NormalTok{ obj grp}\KeywordTok{\&.>} \KeywordTok{>}\NormalTok{blk}

    \CommentTok{NB. check all return codes error msg: unable to dump group/suite list(s)}
    \KeywordTok{if.} \DecValTok{0} \KeywordTok{e.} \KeywordTok{\{.\&>}\NormalTok{ gnames }\KeywordTok{do.}\NormalTok{ jderr ERR0157 }\KeywordTok{return.} \KeywordTok{end.}

    \CommentTok{NB. remove return codes, attach group/suite names and format as text}
\NormalTok{    gnames}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<"}\DecValTok{0} \KeywordTok{>}\NormalTok{blk}\RegionMarkerTok{)} \KeywordTok{,\&.>} \KeywordTok{\}.\&.>}\NormalTok{ gnames}
\NormalTok{    gnames}\KeywordTok{=.} \DecValTok{5}\KeywordTok{!:}\DecValTok{5} \KeywordTok{<}\StringTok{\textquotesingle{}gnames\textquotesingle{}}

    \CommentTok{NB. append if any text}
    \KeywordTok{if.} \KeywordTok{\#}\NormalTok{gnames}\KeywordTok{=.}\NormalTok{ WRAPTMPWID wraplinear gnames }\KeywordTok{do.}
\NormalTok{      gnames}\KeywordTok{=.}\NormalTok{ toHOST putso}\KeywordTok{,}\NormalTok{gnames}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{cmd}
      \KeywordTok{if.} \DecValTok{\_1} \KeywordTok{{-}:}\NormalTok{ gnames fap out }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR0155}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{out }\KeywordTok{return.} \KeywordTok{end.}
    \KeywordTok{end.}

  \KeywordTok{end.}

  \CommentTok{NB. dump group/suite header scripts}
  \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{dmp}\KeywordTok{;}\NormalTok{obj}\KeywordTok{;y}\RegionMarkerTok{)}\NormalTok{ dumptext }\KeywordTok{;}\NormalTok{uv }\KeywordTok{do.}\NormalTok{ msg }\KeywordTok{return.} \KeywordTok{end.}

  \CommentTok{NB. dump group/suite documentation}
  \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{dmp}\KeywordTok{;}\NormalTok{obj}\KeywordTok{;y}\RegionMarkerTok{)}\NormalTok{ dumpdoc }\KeywordTok{;}\NormalTok{uv }\KeywordTok{do.}\NormalTok{ msg }\KeywordTok{return.} \KeywordTok{end.}
\KeywordTok{end.}
\NormalTok{OK}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dumpheader}\AlertTok{=:}\index{dumpheader@\texttt{dumpheader}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dumpheader  v{-}{-}  creates  the  dumpfile  and  writes   header}
\CommentTok{NB. information.}
\CommentTok{NB.}
\CommentTok{NB. monad:  dumpheader clPathFile}
\CommentTok{NB.}
\CommentTok{NB.   dumpheader \textquotesingle{}c:\textbackslash{}go\textbackslash{}ahead\textbackslash{}dump\textbackslash{}my\textbackslash{}dictionary.ijs\textquotesingle{}}

\CommentTok{NB. error msg: unable to create dumpfile}
\KeywordTok{if.} \DecValTok{\_1} \KeywordTok{{-}:} \StringTok{\textquotesingle{}\textquotesingle{}} \RegionMarkerTok{(}\NormalTok{write }\KeywordTok{::} \KeywordTok{\_1:}\RegionMarkerTok{)} \KeywordTok{y} \KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR0156}\RegionMarkerTok{)}\KeywordTok{,<y} \KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. make box characters portable}
\DecValTok{9}\KeywordTok{!:}\DecValTok{7} \KeywordTok{,}\NormalTok{ PORTCHARS }\KeywordTok{[}\NormalTok{ curchars}\KeywordTok{=.} \KeywordTok{,} \DecValTok{9}\KeywordTok{!:}\DecValTok{6} \StringTok{\textquotesingle{}\textquotesingle{}}

\CommentTok{NB. format header text}
\NormalTok{head}\KeywordTok{=.}\NormalTok{ DUMPMSG0 }\KeywordTok{,}\NormalTok{ tstamp }\StringTok{\textquotesingle{}\textquotesingle{}}
\NormalTok{head}\KeywordTok{=.}\NormalTok{ head}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{DUMPMSG3 }\KeywordTok{,} \KeywordTok{;}\RegionMarkerTok{(}\KeywordTok{<}\StringTok{\textquotesingle{}; \textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{,\&.>} \KeywordTok{":\&.>}\NormalTok{JODVMD}
\NormalTok{head}\KeywordTok{=.}\NormalTok{ head}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{DUMPMSG4 }\KeywordTok{,} \KeywordTok{":} \KeywordTok{,} \DecValTok{9}\KeywordTok{!:}\DecValTok{14} \StringTok{\textquotesingle{}\textquotesingle{}}
\NormalTok{head}\KeywordTok{=.}\NormalTok{ head}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{ctl }\StringTok{\textquotesingle{}NB. \textquotesingle{}}\KeywordTok{,"}\DecValTok{1} \StringTok{\textquotesingle{} \textquotesingle{}} \KeywordTok{,}\NormalTok{ DUMPMSG1 }\KeywordTok{,} \KeywordTok{":} \DecValTok{0} \DecValTok{1} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ DPATH}\DecValTok{\_\_}\NormalTok{ST}
\NormalTok{head}\KeywordTok{=.}\NormalTok{ head}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{LF}

\CommentTok{NB. reset box characters}
\DecValTok{9}\KeywordTok{!:}\DecValTok{7}\NormalTok{ curchars}

\CommentTok{NB. set up J environment to process script {-} assumes that}
\CommentTok{NB. JOD is loaded and that a target put dictionary is open}
\NormalTok{tag}\KeywordTok{=.}\NormalTok{ DUMPTAG}\KeywordTok{,}\NormalTok{LF}

\CommentTok{NB. retain white space}
\NormalTok{head}\KeywordTok{=.}\NormalTok{ head}\KeywordTok{,}\StringTok{\textquotesingle{}9!:41 [ 1\textquotesingle{}}\KeywordTok{,}\NormalTok{tag}

\NormalTok{head}\KeywordTok{=.}\NormalTok{ head}\KeywordTok{,}\StringTok{\textquotesingle{}cocurrent \textquotesingle{}\textquotesingle{}base\textquotesingle{}\textquotesingle{}\textquotesingle{}}\KeywordTok{,}\NormalTok{tag}
\NormalTok{head}\KeywordTok{=.}\NormalTok{ head}\KeywordTok{,}\StringTok{\textquotesingle{}sonl\_z\_=: \textquotesingle{}\textquotesingle{}sonl\_\_MK\_\_JODobj i.4\textquotesingle{}\textquotesingle{}\textquotesingle{}}\KeywordTok{,}\NormalTok{tag}
\NormalTok{head}\KeywordTok{=.}\NormalTok{ head}\KeywordTok{,} \RegionMarkerTok{(}\NormalTok{SOPASS}\KeywordTok{{-}.}\StringTok{\textquotesingle{} \textquotesingle{}}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_z\_=:] [ 1!:2\&2\textquotesingle{}}\KeywordTok{,}\NormalTok{tag}
\NormalTok{head}\KeywordTok{=.}\NormalTok{ head}\KeywordTok{,}\StringTok{\textquotesingle{}SOLOCALE\_z\_=:":>SO\_\_JODobj\textquotesingle{}}\KeywordTok{,}\NormalTok{tag}
\NormalTok{head}\KeywordTok{=.}\NormalTok{ head}\KeywordTok{,}\StringTok{\textquotesingle{}soput\_z\_=:SOLOCALE\&put\textquotesingle{}}\KeywordTok{,}\NormalTok{tag}
\NormalTok{head}\KeywordTok{=.}\NormalTok{ head}\KeywordTok{,}\StringTok{\textquotesingle{}soclear\_z\_=: \textquotesingle{}\textquotesingle{}0 0 $ clearso\_\_MK\_\_JODobj 0\textquotesingle{}\textquotesingle{}\textquotesingle{}}\KeywordTok{,}\NormalTok{tag}

\CommentTok{NB. append header error msg: unable to append to dumpfile}
\KeywordTok{if.} \DecValTok{\_1} \KeywordTok{{-}:} \RegionMarkerTok{(}\NormalTok{toHOST head}\RegionMarkerTok{)}\NormalTok{ fap }\KeywordTok{<y} \KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR0155}\RegionMarkerTok{)}\KeywordTok{,<y} \KeywordTok{else.}\NormalTok{ OK }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dumpntstamps}\AlertTok{=:}\index{dumpntstamps@\texttt{dumpntstamps}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*dumpntstamps v{-}{-} appends object timestamps text to dumpfile.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  paRag dumpntstamps clPathFile}
\CommentTok{NB.}
\CommentTok{NB.   1 dumpntstamps\textquotesingle{}c:\textbackslash{}go\textbackslash{}ahead\textbackslash{}dump\textbackslash{}my\textbackslash{}dictionary.ijs\textquotesingle{}}

\KeywordTok{if.} \KeywordTok{x} \KeywordTok{do.}

  \CommentTok{NB. fetch all object timestamps}
  \KeywordTok{if.}\NormalTok{ badrc ots}\KeywordTok{=.}\NormalTok{ getallts }\DecValTok{0} \KeywordTok{do.}\NormalTok{ ots }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ ots}\KeywordTok{=.}\NormalTok{ rv ots }\KeywordTok{end.}

  \CommentTok{NB. if no objects exist dump nothing}
  \KeywordTok{if.} \DecValTok{0} \KeywordTok{=} \KeywordTok{>./} \KeywordTok{,} \KeywordTok{\#\&>} \RegionMarkerTok{(}\DecValTok{0} \DecValTok{1}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{ots }\KeywordTok{do.}\NormalTok{ OK }\KeywordTok{return.} \KeywordTok{end.}

\NormalTok{  tag}\KeywordTok{=.}\NormalTok{ DUMPTAG}\KeywordTok{,}\NormalTok{LF}
\NormalTok{  putso}\KeywordTok{=.}\NormalTok{ LF}\KeywordTok{,}\NormalTok{SOSWITCH}\KeywordTok{,}\NormalTok{LF}

  \CommentTok{NB. make sure older versions of JOD can execute dumps with timestamps without errors.}
\NormalTok{  putup}\KeywordTok{=.} \StringTok{\textquotesingle{}cocurrent \textquotesingle{}\textquotesingle{}base\textquotesingle{}\textquotesingle{} \textquotesingle{}}\KeywordTok{,}\NormalTok{tag}
\NormalTok{  putup}\KeywordTok{=.}\NormalTok{ putup}\KeywordTok{,} \StringTok{\textquotesingle{}puttstamps\_ijod\_=: (((1;\textquotesingle{}\textquotesingle{}upgrade JOD\textquotesingle{}\textquotesingle{})"\_)\textasciigrave{}putallts\_\_MK\_\_JODobj)@.(3 = (4!:0)<\textquotesingle{}}\NormalTok{\textquotesingle{}putallt}
\RegionMarkerTok{)}\KeywordTok{=.}\RegionMarkerTok{)}\KeywordTok{=.}\NormalTok{s}\DecValTok{\_\_}\NormalTok{MK}\DecValTok{\_\_}\NormalTok{JODobj}\StringTok{\textquotesingle{}\textquotesingle{}}\RegionMarkerTok{)}\NormalTok{\textquotesingle{}}\KeywordTok{,}\NormalTok{tag}

  \CommentTok{NB. expression to store timestamps from text in scratch object}
\NormalTok{  soputts}\KeywordTok{=.}\NormalTok{ putup}\KeywordTok{,}\NormalTok{SOPASS}\KeywordTok{,}\StringTok{\textquotesingle{}puttstamps ".".\textquotesingle{}\textquotesingle{}zz\_\textquotesingle{}\textquotesingle{},SOLOCALE,\textquotesingle{}\textquotesingle{}\_\textquotesingle{}\textquotesingle{} [ cocurrent \textquotesingle{}\textquotesingle{}base\textquotesingle{}\textquotesingle{} \textquotesingle{}}\KeywordTok{,}\NormalTok{tag}

  \CommentTok{NB. text in scratch object}
\NormalTok{  tstext}\KeywordTok{=.}\NormalTok{ putso}\KeywordTok{,}\RegionMarkerTok{(}\NormalTok{WRAPTMPWID}\KeywordTok{,}\RegionMarkerTok{(}\NormalTok{getascii85 }\DecValTok{0}\RegionMarkerTok{)}\KeywordTok{;<}\DecValTok{1}\RegionMarkerTok{)}\NormalTok{ wraplinear }\DecValTok{5}\KeywordTok{!:}\DecValTok{5} \KeywordTok{<}\StringTok{\textquotesingle{}ots\textquotesingle{}}
\NormalTok{  tstext}\KeywordTok{=.}\NormalTok{ tstext}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{soputts}\KeywordTok{,}\NormalTok{SOCLEAR}\KeywordTok{,}\DecValTok{2}\KeywordTok{\#}\NormalTok{LF}

  \CommentTok{NB. write to test file}
  \CommentTok{NB. (toHOST tstext) write jpath \textquotesingle{}\textasciitilde{}temp/dumpnts.ijs\textquotesingle{}}

  \CommentTok{NB. append timestamps msg: unable to append to dumpfile}
  \KeywordTok{if.} \DecValTok{\_1} \KeywordTok{{-}:} \RegionMarkerTok{(}\NormalTok{toHOST tstext}\RegionMarkerTok{)}\NormalTok{ fap }\KeywordTok{<y} \KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR0155}\RegionMarkerTok{)}\KeywordTok{,<y} \KeywordTok{else.}\NormalTok{ OK }\KeywordTok{end.}
\KeywordTok{else.}
\NormalTok{  OK}
\KeywordTok{end.}
\RegionMarkerTok{)}

\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dumptext}\AlertTok{=:}\index{dumptext@\texttt{dumptext}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*dumptext v{-}{-} appends text tables to dump file.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  (iaBlksize ; ilObjCode ; clPathFile) dumptext blclNames}
\CommentTok{NB.}
\CommentTok{NB.  (50;1 8;\textquotesingle{}c:\textbackslash{}temp\textbackslash{}dump.ijs\textquotesingle{}) dumptext ;:\textquotesingle{}test case names\textquotesingle{}}

\CommentTok{NB. block size, object \& option code, output file}
\StringTok{\textquotesingle{}bsize noc out\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}
\NormalTok{out}\KeywordTok{=.<}\NormalTok{out}
\NormalTok{bnames}\KeywordTok{=.}\RegionMarkerTok{(}\KeywordTok{{-}}\NormalTok{bsize}\RegionMarkerTok{)} \KeywordTok{<\textbackslash{}} \KeywordTok{y}
\NormalTok{putso}\KeywordTok{=.}\NormalTok{ LF}\KeywordTok{,}\NormalTok{SOSWITCH}\KeywordTok{,}\NormalTok{LF}

\CommentTok{NB. reload command for object}
\NormalTok{cmd}\KeywordTok{=.}\NormalTok{ SOPASS}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{":}\NormalTok{noc}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{SOPUTTEXT}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{SOCLEAR}\KeywordTok{,}\NormalTok{LF}

\CommentTok{NB. dump text in blocks}
\KeywordTok{for\_blk.}\NormalTok{ bnames }\KeywordTok{do.}
  \KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ noc get }\KeywordTok{>}\NormalTok{blk }\KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ uv}\KeywordTok{=.}\NormalTok{ rv uv }\KeywordTok{end.}

  \CommentTok{NB. append only when we have text}
  \KeywordTok{if.} \KeywordTok{\#}\NormalTok{uv}\KeywordTok{=.}\NormalTok{ WRAPTMPWID fmtdumptext uv }\KeywordTok{do.}
\NormalTok{    uv}\KeywordTok{=.}\NormalTok{ toHOST putso}\KeywordTok{,}\NormalTok{uv}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{cmd}
    \CommentTok{NB. error msg: unable to append to dumpfile}
    \KeywordTok{if.} \DecValTok{\_1} \KeywordTok{{-}:}\NormalTok{ uv fap out }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR0155}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{out }\KeywordTok{return.} \KeywordTok{end.}
  \KeywordTok{end.}

\KeywordTok{end.}
\NormalTok{OK}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dumptm}\AlertTok{=:}\index{dumptm@\texttt{dumptm}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*dumptm v{-}{-} dumps test cases and macros on path.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  ilBlksizeObject dumptm clPathFile}
\CommentTok{NB.}
\CommentTok{NB.   50 1 dumptm \textquotesingle{}c:\textbackslash{}dump\textbackslash{}on\textbackslash{}me.ijs\textquotesingle{}}

\StringTok{\textquotesingle{}blk obj\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}

\KeywordTok{if.}\NormalTok{ badrc uv0}\KeywordTok{=.}\NormalTok{ obj dnl }\StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{do.}\NormalTok{ uv0  }\KeywordTok{return.} \KeywordTok{end.}
\KeywordTok{if.} \KeywordTok{a:} \KeywordTok{e.}\NormalTok{ uv0 }\KeywordTok{do.}\NormalTok{ OK }\KeywordTok{return.} \KeywordTok{end.} \CommentTok{NB. no test cases or macros}

\KeywordTok{if.} \KeywordTok{\#}\NormalTok{uv0}\KeywordTok{=.} \KeywordTok{\}.}\NormalTok{uv0 }\KeywordTok{do.}
  \KeywordTok{if.}\NormalTok{ badrc uv1}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{blk}\KeywordTok{;}\NormalTok{obj}\KeywordTok{;y}\RegionMarkerTok{)}\NormalTok{ dumptext uv0 }\KeywordTok{do.}\NormalTok{ uv1 }\KeywordTok{return.} \KeywordTok{end.}
  \KeywordTok{if.}\NormalTok{ badrc uv1}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{blk}\KeywordTok{;}\NormalTok{obj}\KeywordTok{;y}\RegionMarkerTok{)}\NormalTok{ dumpdoc uv0  }\KeywordTok{do.}\NormalTok{ uv1 }\KeywordTok{return.} \KeywordTok{end.}
\KeywordTok{end.}
\NormalTok{OK}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dumptrailer}\AlertTok{=:}\index{dumptrailer@\texttt{dumptrailer}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dumptrailer v{-}{-} appends terminal text to dumpfile.}
\CommentTok{NB.}
\CommentTok{NB. monad:  dumptrailer clPathFile}
\CommentTok{NB.}
\CommentTok{NB.   dumptrailer \textquotesingle{}c:\textbackslash{}go\textbackslash{}ahead\textbackslash{}dump\textbackslash{}my\textbackslash{}dictionary.ijs\textquotesingle{}}

\NormalTok{tag}\KeywordTok{=.}\NormalTok{ DUMPTAG}\KeywordTok{,}\NormalTok{LF}
\NormalTok{tail}\KeywordTok{=.}\NormalTok{ LF}\KeywordTok{,}\StringTok{\textquotesingle{}cocurrent \textquotesingle{}\textquotesingle{}base\textquotesingle{}\textquotesingle{}\textquotesingle{}}\KeywordTok{,}\NormalTok{tag}
\NormalTok{tail}\KeywordTok{=.}\NormalTok{ tail}\KeywordTok{,}\StringTok{\textquotesingle{}0 0$(4!:55);:\textquotesingle{}\textquotesingle{}sonl\_z\_ SOLOCALE\_z\_ soput\_z\_ soclear\_z\_\textquotesingle{}\textquotesingle{}\textquotesingle{}}\KeywordTok{,}\NormalTok{tag}
\NormalTok{tail}\KeywordTok{=.}\NormalTok{ tail}\KeywordTok{,}\NormalTok{SOPASS}\KeywordTok{,}\NormalTok{DUMPMSG2}\KeywordTok{,}\NormalTok{tag}

\CommentTok{NB. append trailer error msg: unable to append to dumpfile}
\KeywordTok{if.} \DecValTok{\_1} \KeywordTok{{-}:} \RegionMarkerTok{(}\NormalTok{toHOST tail}\RegionMarkerTok{)}\NormalTok{ fap }\KeywordTok{<y} \KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR0155}\RegionMarkerTok{)}\KeywordTok{,<y} \KeywordTok{else.}\NormalTok{ OK }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dumpwords}\AlertTok{=:}\index{dumpwords@\texttt{dumpwords}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*dumpwords v{-}{-} dumps path words to an ASCII script file. Nouns}
\CommentTok{NB. are dumped first in alphabetic order and then remaining words}
\CommentTok{NB. are dumped in alphabetic order.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaBlockSize dumpwords clPathFile}
\CommentTok{NB.}
\CommentTok{NB.   50 dumpwords \textquotesingle{}c:\textbackslash{}j405\textbackslash{}addons\textbackslash{}jod\textbackslash{}joddev\textbackslash{}dump\textbackslash{}joddev.ijs\textquotesingle{}}

\CommentTok{NB. dump all nouns}
\KeywordTok{if.}\NormalTok{ badrc nouns}\KeywordTok{=.}\NormalTok{ did }\DecValTok{0} \KeywordTok{do.}\NormalTok{ nouns }\KeywordTok{return.}
\KeywordTok{else.}
  \KeywordTok{if.} \DecValTok{2}\KeywordTok{=\#}\NormalTok{nouns }\KeywordTok{do.} \CommentTok{NB. HARDCODE 2}
    \CommentTok{NB. only one dictionary on the path {-} common case}
    \KeywordTok{if.}\NormalTok{ badrc nouns}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{WORD}\KeywordTok{,}\DecValTok{1}\KeywordTok{,}\NormalTok{WORD}\RegionMarkerTok{)}\NormalTok{ dnl }\StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{do.}\NormalTok{ nouns }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ nouns}\KeywordTok{=.} \KeywordTok{\}.}\NormalTok{ nouns }\KeywordTok{end.}
  \KeywordTok{else.}
    \CommentTok{NB. more than one dictionary on path {-} requires deeper look to determine}
    \CommentTok{NB. whether a path order fetched word is a noun or something else}
    \KeywordTok{if.}\NormalTok{ badrc nouns}\KeywordTok{=.} \DecValTok{0} \DecValTok{\_1} \DecValTok{0}\NormalTok{ dnl }\StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{do.}\NormalTok{ nouns }\KeywordTok{return.} \KeywordTok{end.}
    \KeywordTok{if.}\NormalTok{ badrc other}\KeywordTok{=.} \DecValTok{0} \DecValTok{\_1}\NormalTok{ dnl }\StringTok{\textquotesingle{}\textquotesingle{}}   \KeywordTok{do.}\NormalTok{ other }\KeywordTok{return.} \KeywordTok{end.}

\NormalTok{    other}\KeywordTok{=.} \KeywordTok{\}.}\NormalTok{other}
\NormalTok{    nouns}\KeywordTok{=.} \KeywordTok{\}.}\NormalTok{nouns}
\NormalTok{    other}\KeywordTok{=.}\NormalTok{ other }\KeywordTok{{-}.\&.>}\NormalTok{ nouns}

    \CommentTok{NB. sorted list of nouns that will be retrieved in path order}
\NormalTok{    nouns}\KeywordTok{=.} \KeywordTok{/:\textasciitilde{}} \KeywordTok{\textasciitilde{}.} \KeywordTok{;}\NormalTok{ nouns }\KeywordTok{{-}.\&.>} \KeywordTok{\textasciitilde{}.@:;\&.>} \KeywordTok{<"}\DecValTok{1} \KeywordTok{,\textbackslash{}}\NormalTok{ other}

  \KeywordTok{end.}
\KeywordTok{end.}

\NormalTok{putclr}\KeywordTok{=.}\NormalTok{ LF}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{SOPASS}\KeywordTok{,}\NormalTok{SOPUT}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{SOCLEAR}
\NormalTok{putso}\KeywordTok{=.}\NormalTok{ LF}\KeywordTok{,}\NormalTok{SOSWITCH}\KeywordTok{,}\NormalTok{LF}
\NormalTok{noc}\KeywordTok{=.}\NormalTok{ WORD}\KeywordTok{,}\DecValTok{0}
\NormalTok{out}\KeywordTok{=.} \KeywordTok{<y}
\NormalTok{space}\KeywordTok{=.} \DecValTok{2}           \CommentTok{NB. generates one blank line between objects}
\NormalTok{wnc}\KeywordTok{=.}\NormalTok{ WORD}\KeywordTok{,}\NormalTok{INCLASS  }\CommentTok{NB. word name class code}

\KeywordTok{if.} \RegionMarkerTok{(}\DecValTok{0}\KeywordTok{<\#}\NormalTok{nouns}\RegionMarkerTok{)} \KeywordTok{*.} \KeywordTok{{-}.} \KeywordTok{a:} \KeywordTok{e.}\NormalTok{ nouns }\KeywordTok{do.}
  \KeywordTok{if.}\NormalTok{ badrc wnc}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{WORD}\KeywordTok{,}\NormalTok{INCLASS}\RegionMarkerTok{)}\NormalTok{ invfetch}\DecValTok{\_\_}\NormalTok{ST nouns }\KeywordTok{do.}\NormalTok{ wnc }\KeywordTok{return.}
  \KeywordTok{else.}\NormalTok{ wnc}\KeywordTok{=.}\RegionMarkerTok{(}\KeywordTok{{-}x}\RegionMarkerTok{)} \KeywordTok{<\textbackslash{}}\NormalTok{ rv wnc}
  \KeywordTok{end.}
\NormalTok{  names}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{{-}x}\RegionMarkerTok{)} \KeywordTok{<\textbackslash{}}\NormalTok{ nouns}
  \KeywordTok{for\_blk.}\NormalTok{ names }\KeywordTok{do.}

    \CommentTok{NB. get block of nouns}
    \KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ noc getobjects}\DecValTok{\_\_}\NormalTok{ST }\KeywordTok{>}\NormalTok{blk }\KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ uv}\KeywordTok{=.}\NormalTok{ rv uv }\KeywordTok{end.}

    \CommentTok{NB. check component{-}directory name class for consistency {-} classes must}
    \CommentTok{NB. be consistent to insure that the dump script can properly reload}
    \KeywordTok{if.} \DecValTok{1} \KeywordTok{e.}\NormalTok{ mask}\KeywordTok{=.{-}.}\RegionMarkerTok{(}\KeywordTok{>}\NormalTok{blk\_index}\KeywordTok{\{}\NormalTok{wnc}\RegionMarkerTok{)} \KeywordTok{=} \KeywordTok{;} \DecValTok{1} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ uv }\KeywordTok{do.}
      \CommentTok{NB. error msg: directory{-}component name class inconsistency {-}{-} dump aborted}
      \RegionMarkerTok{(}\NormalTok{jderr ERR0157}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{mask}\KeywordTok{\#}\DecValTok{0}\KeywordTok{\{"}\DecValTok{1}\NormalTok{ uv }\KeywordTok{return.}
    \KeywordTok{end.}

    \CommentTok{NB. convert to linear representations}
    \CommentTok{NB. NIMP not wrapping large binaries}
    \KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \DecValTok{0}\NormalTok{ nounlrep uv }\KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ uv}\KeywordTok{=.}\NormalTok{rv uv }\KeywordTok{end.}
\NormalTok{    uv}\KeywordTok{=.}\NormalTok{ space jscript jscriptdefs uv}

    \CommentTok{NB. insert JOD commands to reload}
\NormalTok{    uv}\KeywordTok{=.}\NormalTok{ toHOST putso}\KeywordTok{,}\NormalTok{uv}\KeywordTok{,}\NormalTok{putclr}

    \CommentTok{NB. append to file}
    \KeywordTok{if.} \DecValTok{\_1} \KeywordTok{{-}:}\NormalTok{ uv fap out }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR0155}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{out }\KeywordTok{return.} \KeywordTok{end.}
  \KeywordTok{end.}
\KeywordTok{end.}

\CommentTok{NB. append all remaining words that are stored as text}
\KeywordTok{if.}\NormalTok{ badrc names}\KeywordTok{=.}\NormalTok{ dnl }\StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{do.}\NormalTok{ names }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ vnc}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{names}\KeywordTok{=.} \KeywordTok{\}.}\NormalTok{names }\KeywordTok{{-}.} \KeywordTok{a:}\RegionMarkerTok{)} \KeywordTok{{-}.}\NormalTok{ nouns }\KeywordTok{end.}
\NormalTok{nouns}\KeywordTok{=.}\DecValTok{0}

\KeywordTok{if.} \KeywordTok{\#}\NormalTok{vnc }\KeywordTok{do.}
  \KeywordTok{if.}\NormalTok{ badrc wnc}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{WORD}\KeywordTok{,}\NormalTok{INCLASS}\RegionMarkerTok{)}\NormalTok{ invfetch}\DecValTok{\_\_}\NormalTok{ST vnc }\KeywordTok{do.}\NormalTok{ wnc }\KeywordTok{return.}
  \KeywordTok{else.}\NormalTok{ wnc}\KeywordTok{=.}\RegionMarkerTok{(}\KeywordTok{{-}x}\RegionMarkerTok{)} \KeywordTok{<\textbackslash{}}\NormalTok{ rv wnc}
  \KeywordTok{end.}
\NormalTok{  vnc}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{{-}x}\RegionMarkerTok{)} \KeywordTok{<\textbackslash{}}\NormalTok{ vnc}
  \KeywordTok{for\_blk.}\NormalTok{ vnc }\KeywordTok{do.}
    \KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ noc getobjects}\DecValTok{\_\_}\NormalTok{ST }\KeywordTok{>}\NormalTok{blk }\KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ uv}\KeywordTok{=.}\NormalTok{ rv uv }\KeywordTok{end.}
    \KeywordTok{if.} \DecValTok{1} \KeywordTok{e.}\NormalTok{ mask}\KeywordTok{=.{-}.}\RegionMarkerTok{(}\KeywordTok{>}\NormalTok{blk\_index}\KeywordTok{\{}\NormalTok{wnc}\RegionMarkerTok{)} \KeywordTok{=} \KeywordTok{;} \DecValTok{1} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ uv }\KeywordTok{do.}
      \RegionMarkerTok{(}\NormalTok{jderr ERR0157}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{mask}\KeywordTok{\#}\DecValTok{0}\KeywordTok{\{"}\DecValTok{1}\NormalTok{ uv }\KeywordTok{return.}
    \KeywordTok{end.}
\NormalTok{    uv}\KeywordTok{=.}\NormalTok{ space jscript jscriptdefs uv}
\NormalTok{    uv}\KeywordTok{=.}\NormalTok{ toHOST putso}\KeywordTok{,}\NormalTok{uv}\KeywordTok{,}\NormalTok{putclr}
    \KeywordTok{if.} \DecValTok{\_1} \KeywordTok{{-}:}\NormalTok{ uv fap out }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR0155}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{out }\KeywordTok{return.} \KeywordTok{end.}
  \KeywordTok{end.}
\KeywordTok{end.}

\CommentTok{NB. dump word documentation}
\KeywordTok{if.} \KeywordTok{{-}.} \KeywordTok{a:} \KeywordTok{e.}\NormalTok{ names }\KeywordTok{do.} \RegionMarkerTok{(}\KeywordTok{x;}\NormalTok{WORD}\KeywordTok{;}\NormalTok{out}\RegionMarkerTok{)}\NormalTok{ dumpdoc names }\KeywordTok{else.}\NormalTok{ OK }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{extscopes}\AlertTok{=:}\index{extscopes@\texttt{extscopes}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*extscopes  v{-}{-}  handles  exceptions  to  normal  J assignment}
\CommentTok{NB. scoping rules. The exceptions are:}
\CommentTok{NB.}
\CommentTok{NB. monad:  extscopes blclParsed}
\CommentTok{NB.}
\CommentTok{NB.   \textquotesingle{}quoted locals\textquotesingle{}=.}
\CommentTok{NB.   \textquotesingle{}\textasciigrave{}acr locals\textquotesingle{}=.}
\CommentTok{NB.   \textquotesingle{}quoted globals\textquotesingle{}=:}
\CommentTok{NB.   \textquotesingle{}\textasciigrave{}acr globlas\textquotesingle{}=:}
\CommentTok{NB.}
\CommentTok{NB.   for\_loopvar. x do.}
\CommentTok{NB.       $ loopvar        NB. implict for. local references}
\CommentTok{NB.       loopvar\_index}
\CommentTok{NB.   end.}

\CommentTok{NB. get any quoted assignments from syntactically correct code}
\NormalTok{qlocs}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\}.@:\}:}\RegionMarkerTok{)} \KeywordTok{\&.>} \KeywordTok{u} \KeywordTok{\#\textasciitilde{}} \StringTok{\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}} \KeywordTok{=} \KeywordTok{\{.\&>} \KeywordTok{u=.} \KeywordTok{y} \KeywordTok{\#\textasciitilde{}} \DecValTok{1}\KeywordTok{|.y} \KeywordTok{=} \KeywordTok{<}\StringTok{\textquotesingle{}=.\textquotesingle{}}
\NormalTok{qgbls}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\}.@:\}:}\RegionMarkerTok{)} \KeywordTok{\&.>} \KeywordTok{u} \KeywordTok{\#\textasciitilde{}} \StringTok{\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}} \KeywordTok{=} \KeywordTok{\{.\&>} \KeywordTok{u=.} \KeywordTok{y} \KeywordTok{\#\textasciitilde{}} \DecValTok{1}\KeywordTok{|.y} \KeywordTok{=} \KeywordTok{<}\StringTok{\textquotesingle{}=:\textquotesingle{}}
\KeywordTok{if.} \KeywordTok{\#}\NormalTok{qlocs }\KeywordTok{do.}\NormalTok{ qlocs}\KeywordTok{=.}\NormalTok{ jnfrblcl }\KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \KeywordTok{;} \StringTok{\textquotesingle{} \textquotesingle{}} \KeywordTok{,\&.>}\NormalTok{ qlocs }\KeywordTok{{-}.\&.>} \StringTok{\textquotesingle{}\textasciigrave{}\textquotesingle{}} \KeywordTok{end.}
\KeywordTok{if.} \KeywordTok{\#}\NormalTok{qgbls }\KeywordTok{do.}\NormalTok{ qgbls}\KeywordTok{=.}\NormalTok{ jnfrblcl }\KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \KeywordTok{;} \StringTok{\textquotesingle{} \textquotesingle{}} \KeywordTok{,\&.>}\NormalTok{ qgbls }\KeywordTok{{-}.\&.>} \StringTok{\textquotesingle{}\textasciigrave{}\textquotesingle{}} \KeywordTok{end.}

\CommentTok{NB. get any implicit for. locals}
\NormalTok{flocs}\KeywordTok{=.} \StringTok{\textquotesingle{}\textquotesingle{}}
\KeywordTok{if.} \KeywordTok{+./} \KeywordTok{u=.} \RegionMarkerTok{((}\DecValTok{4}\KeywordTok{\&\{.\&.>} \KeywordTok{y}\RegionMarkerTok{)} \KeywordTok{e.} \KeywordTok{<}\StringTok{\textquotesingle{}for\_\textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{*.} \StringTok{\textquotesingle{}.\textquotesingle{}} \KeywordTok{=} \KeywordTok{\{:\&>} \KeywordTok{y} \KeywordTok{do.}
  \KeywordTok{u=.} \RegionMarkerTok{(}\DecValTok{4}\KeywordTok{\&\}.@:\}:}\RegionMarkerTok{)}\KeywordTok{\&.>} \KeywordTok{u} \KeywordTok{\#} \KeywordTok{y}
  \KeywordTok{u=.} \KeywordTok{u} \KeywordTok{,} \KeywordTok{u} \KeywordTok{,\&.>} \KeywordTok{<}\StringTok{\textquotesingle{}\_index\textquotesingle{}}  \CommentTok{NB. possible implicits}
\NormalTok{  flocs}\KeywordTok{=.} \KeywordTok{,} \KeywordTok{y} \KeywordTok{\#\textasciitilde{}} \KeywordTok{y} \KeywordTok{e.} \KeywordTok{u}
\KeywordTok{end.}

\RegionMarkerTok{(}\KeywordTok{<}\NormalTok{qgbls}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{<}\NormalTok{qlocs}\KeywordTok{,}\NormalTok{flocs}\RegionMarkerTok{)}\KeywordTok{,<}\NormalTok{flocs}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. direct file append with error trap}
\NormalTok{fap}\AlertTok{=:}\index{fap@\texttt{fap}} \DecValTok{1}\KeywordTok{!:}\DecValTok{3} \KeywordTok{::}\RegionMarkerTok{(}\KeywordTok{\_1:}\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fmtdumptext}\AlertTok{=:}\index{fmtdumptext@\texttt{fmtdumptext}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*fmtdumptext  v{-}{-}  formats  (name,text)  tables  for  dumping.}
\CommentTok{NB. Result is a J script character list or null.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  (clName ; iaWidth) fmtdumptext btNameText}
\CommentTok{NB.}
\CommentTok{NB.   (\textquotesingle{}z\textquotesingle{};67) fmtdumptext 1 pick 0 8 get \}. dnl \textquotesingle{}\textquotesingle{}}

\CommentTok{NB. remove null entries}
\KeywordTok{if.} \KeywordTok{\#}\NormalTok{text}\KeywordTok{=.} \KeywordTok{y} \KeywordTok{\#\textasciitilde{}} \DecValTok{0} \KeywordTok{<} \KeywordTok{\#\&>} \KeywordTok{\{:"}\DecValTok{1} \KeywordTok{y} \KeywordTok{do.}

\NormalTok{  ascii85}\KeywordTok{=.}\NormalTok{ getascii85 }\DecValTok{0}

  \CommentTok{NB. The (5!:5) representation will produce}
  \CommentTok{NB. a large a. index representation when any}
  \CommentTok{NB. unprintable characters are present.  To get}
  \CommentTok{NB. a compact representation for ASCII85 5!:5 must}
  \CommentTok{NB. be replaced in this context}
  \KeywordTok{if.}\NormalTok{ ascii85 }\KeywordTok{do.}\NormalTok{ text}\KeywordTok{=.}\NormalTok{ clfrbtcl }\KeywordTok{":\&.>}\NormalTok{ text }\KeywordTok{else.}\NormalTok{ text}\KeywordTok{=.} \DecValTok{5}\KeywordTok{!:}\DecValTok{5} \KeywordTok{<}\StringTok{\textquotesingle{}text\textquotesingle{}} \KeywordTok{end.}

  \RegionMarkerTok{(}\KeywordTok{x,<}\NormalTok{ascii85}\RegionMarkerTok{)}\NormalTok{ wraplinear text}
\KeywordTok{else.}
  \StringTok{\textquotesingle{}\textquotesingle{}}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fromascii85}\AlertTok{=:}\index{fromascii85@\texttt{fromascii85}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*fromascii85 v{-}{-} decode ASCII85 representation.}
\CommentTok{NB.}
\CommentTok{NB. Inverse of (toascii85).}
\CommentTok{NB.}
\CommentTok{NB. monad:  cl =. fromascii85 clA85}

\NormalTok{r}\KeywordTok{=.} \KeywordTok{,y}
\NormalTok{r}\KeywordTok{=.} \KeywordTok{a.i.}\NormalTok{r}
\NormalTok{r}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{r }\KeywordTok{>} \DecValTok{32}\RegionMarkerTok{)} \KeywordTok{\#}\NormalTok{ r}
\NormalTok{r}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{2} \KeywordTok{*} \RegionMarkerTok{(}\KeywordTok{a.i.}\StringTok{\textquotesingle{}<\textasciitilde{}\textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{{-}:} \DecValTok{2} \KeywordTok{\{.}\NormalTok{ r}\RegionMarkerTok{)} \KeywordTok{\}.}\NormalTok{ r}
\NormalTok{r}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{{-}}\DecValTok{2} \KeywordTok{*} \RegionMarkerTok{(}\KeywordTok{a.i.}\StringTok{\textquotesingle{}\textasciitilde{}>\textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{{-}:} \DecValTok{\_2} \KeywordTok{\{.}\NormalTok{ r}\RegionMarkerTok{)} \KeywordTok{\}.}\NormalTok{ r}
\KeywordTok{m=.}\NormalTok{ r }\KeywordTok{=} \KeywordTok{a.i.}\StringTok{\textquotesingle{}z\textquotesingle{}}
\NormalTok{r}\KeywordTok{=.}\NormalTok{ r }\KeywordTok{{-}} \DecValTok{33}
\NormalTok{r}\KeywordTok{=.} \DecValTok{0} \RegionMarkerTok{(}\KeywordTok{I.m}\RegionMarkerTok{)} \KeywordTok{\}}\NormalTok{ r}
\NormalTok{r}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{1}\KeywordTok{+}\DecValTok{4}\KeywordTok{*m}\RegionMarkerTok{)} \KeywordTok{\#}\NormalTok{ r}
\NormalTok{b}\KeywordTok{=.} \DecValTok{5} \KeywordTok{|} \KeywordTok{\#}\NormalTok{r}
\NormalTok{r}\KeywordTok{=.}\NormalTok{ r}\KeywordTok{,}\DecValTok{84} \KeywordTok{\#\textasciitilde{}}\NormalTok{ b}\KeywordTok{\{} \DecValTok{0} \DecValTok{4} \DecValTok{3} \DecValTok{2} \DecValTok{1}
\NormalTok{r}\KeywordTok{=.} \KeywordTok{a.\{\textasciitilde{}} \KeywordTok{,}\RegionMarkerTok{(}\DecValTok{4}\KeywordTok{\#}\DecValTok{256}\RegionMarkerTok{)} \KeywordTok{\#:} \DecValTok{85} \KeywordTok{\#.} \DecValTok{\_5} \KeywordTok{[\textbackslash{}}\NormalTok{ r}
\NormalTok{r }\KeywordTok{\}.\textasciitilde{}} \KeywordTok{{-}}\NormalTok{ b }\KeywordTok{\{} \DecValTok{0} \DecValTok{0} \DecValTok{3} \DecValTok{2} \DecValTok{1}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{getallts}\AlertTok{=:}\index{getallts@\texttt{getallts}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*getallts v{-}{-} gets all timestamps.}
\CommentTok{NB.}
\CommentTok{NB. Returns a boxed table of  all object timestamps. The creation}
\CommentTok{NB. and lastput dates are fractional  day yyyymmdd.fd floats. The}
\CommentTok{NB. (5!:5)  representation  of  floats  includes  all significant}
\CommentTok{NB. decimals which can bloat up linear representations. This verb}
\CommentTok{NB. applies a simple run  length encoding compression scheme that}
\CommentTok{NB. can significantly reduce the  number of (5!:5) bytes when the}
\CommentTok{NB. same timestamp value occurs frequently.}
\CommentTok{NB.}
\CommentTok{NB. monad:  btCts =. getallts uuIgnore}
\CommentTok{NB.}
\CommentTok{NB.   getallts\_\_MK\_\_JODobj 0}

\CommentTok{NB. last row of (cts) indicates compression scheme (0=none, 1=rle)}
\NormalTok{cts}\KeywordTok{=.} \RegionMarkerTok{((}\KeywordTok{\#}\NormalTok{OBJECTNC}\RegionMarkerTok{)}\KeywordTok{\#<}\DecValTok{0}\RegionMarkerTok{)} \RegionMarkerTok{(}\DecValTok{2}\RegionMarkerTok{)}\KeywordTok{\}} \RegionMarkerTok{(}\DecValTok{3}\KeywordTok{,\#}\NormalTok{OBJECTNC}\RegionMarkerTok{)}\KeywordTok{$a:}
\NormalTok{inc}\KeywordTok{=.} \KeywordTok{{-}}\NormalTok{INPUT}

\KeywordTok{for\_obj.}\NormalTok{ OBJECTNC }\KeywordTok{do.}

  \CommentTok{NB. fetch timestamps {-} ignore empty object lists}
  \KeywordTok{if.}\NormalTok{ badrc nts}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{obj}\KeywordTok{,}\NormalTok{inc}\RegionMarkerTok{)}\NormalTok{ get }\KeywordTok{\}.}\NormalTok{ obj dnl }\StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{do.} \KeywordTok{continue.} \KeywordTok{end.}
\NormalTok{  nts}\KeywordTok{=.}\NormalTok{ rv nts}

  \CommentTok{NB. object names and uncompressed timestamps}
\NormalTok{  cts}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<;}\DecValTok{0}\KeywordTok{\{}\NormalTok{nts}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{<}\DecValTok{0}\KeywordTok{;}\NormalTok{obj\_index}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ cts}
\NormalTok{  cts}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<;}\DecValTok{1}\KeywordTok{\{}\NormalTok{nts}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{<}\DecValTok{1}\KeywordTok{;}\NormalTok{obj\_index}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ cts}

\NormalTok{  ets}\KeywordTok{=.}\NormalTok{ rlefrnl }\KeywordTok{,}\NormalTok{ sts}\KeywordTok{=.} \KeywordTok{;}\DecValTok{1}\KeywordTok{\{}\NormalTok{nts}
  \CommentTok{NB. insure rle timestamps decode properly}
  \KeywordTok{if.} \RegionMarkerTok{(}\KeywordTok{,}\NormalTok{sts}\RegionMarkerTok{)} \KeywordTok{{-}:}\NormalTok{ nlfrrle ets }\KeywordTok{do.}
    \CommentTok{NB. if run encoded timestamps are smaller use them}
    \KeywordTok{if.} \RegionMarkerTok{(}\KeywordTok{*/$}\NormalTok{ets}\RegionMarkerTok{)} \KeywordTok{<:} \KeywordTok{*/$}\NormalTok{sts }\KeywordTok{do.}
\NormalTok{      cts}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{ets}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{<}\DecValTok{1}\KeywordTok{;}\NormalTok{obj\_index}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ cts}
\NormalTok{      cts}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\DecValTok{1}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{<}\DecValTok{2}\KeywordTok{;}\NormalTok{obj\_index}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ cts}
    \KeywordTok{end.}
  \KeywordTok{end.}

\KeywordTok{end.}

\NormalTok{ok }\KeywordTok{<}\NormalTok{cts}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{getascii85}\AlertTok{=:}\index{getascii85@\texttt{getascii85}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*getascii85 v{-}{-} returns ASCII85 setting (1=On, 0=Off).}
\CommentTok{NB.}
\CommentTok{NB. monad:  getascii85 uuIgnore}

\NormalTok{ascii85}\KeywordTok{=.} \DecValTok{0} \CommentTok{NB. do not use ascii85 default}

\CommentTok{NB. if setting exists in class use it}
\KeywordTok{if.} \DecValTok{0}\KeywordTok{=}\NormalTok{nc}\KeywordTok{<}\StringTok{\textquotesingle{}ASCII85\textquotesingle{}}   \KeywordTok{do.}\NormalTok{ ascii85}\KeywordTok{=.} \DecValTok{1}\KeywordTok{{-}:}\NormalTok{ASCII85}
\KeywordTok{elseif.}
  \CommentTok{NB. if ASCII85 setting exists in put dictionary directory use it}
\NormalTok{  do}\KeywordTok{=.} \KeywordTok{\{:} \KeywordTok{\{.}\NormalTok{DPATH}\DecValTok{\_\_}\NormalTok{ST}
  \DecValTok{0}\KeywordTok{=}\NormalTok{nc}\KeywordTok{<}\StringTok{\textquotesingle{}ASCII85\_\_do\textquotesingle{}} \KeywordTok{do.}\NormalTok{ ascii85}\KeywordTok{=.} \DecValTok{1}\KeywordTok{{-}:}\NormalTok{ASCII85\_\_do}
\KeywordTok{end.}

\NormalTok{ascii85}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. 0\textquotesingle{}s every other 1 in even groups of 1\textquotesingle{}s}
\NormalTok{halfbits}\AlertTok{=:}\index{halfbits@\texttt{halfbits}} \KeywordTok{]} \RegionMarkerTok{(}\KeywordTok{*.}\RegionMarkerTok{)} \DecValTok{1} \DecValTok{0}\KeywordTok{"}\NormalTok{\_ }\KeywordTok{$\textasciitilde{}} \KeywordTok{\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. clips head and tail delimited lists {-} see long documentation}
\NormalTok{htclip}\AlertTok{=:}\index{htclip@\texttt{htclip}} \KeywordTok{[} \RegionMarkerTok{(}\KeywordTok{]} \KeywordTok{\}.\textasciitilde{}} \KeywordTok{[:} \KeywordTok{>:} \KeywordTok{]} \KeywordTok{i.} \KeywordTok{[}\RegionMarkerTok{)} \KeywordTok{]} \KeywordTok{\}.\textasciitilde{}} \KeywordTok{[:} \KeywordTok{{-}} \KeywordTok{[:} \KeywordTok{>:} \KeywordTok{[} \KeywordTok{i.\textasciitilde{}} \KeywordTok{[:} \KeywordTok{|.} \KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{jnb}\AlertTok{=:}\index{jnb@\texttt{jnb}} \DecValTok{3} \RegionMarkerTok{: 0}
\CommentTok{NB.*jnb v{-}{-} blanks out J code leaving only comments}
\KeywordTok{y}\NormalTok{ jnb}\KeywordTok{\textasciitilde{}}\NormalTok{ masknb }\KeywordTok{y}
\KeywordTok{:}
\RegionMarkerTok{(}\KeywordTok{x} \KeywordTok{*} \KeywordTok{>:} \KeywordTok{i.} \KeywordTok{$} \KeywordTok{x}\RegionMarkerTok{)}\KeywordTok{\{}\StringTok{\textquotesingle{} \textquotesingle{}}\KeywordTok{,,y}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. definition table to script text}
\NormalTok{jscript}\AlertTok{=:}\index{jscript@\texttt{jscript}} \KeywordTok{[:} \KeywordTok{;} \RegionMarkerTok{((}\KeywordTok{[:} \KeywordTok{<"}\DecValTok{0} \KeywordTok{[}\RegionMarkerTok{)} \KeywordTok{\#\&.>} \RegionMarkerTok{(}\DecValTok{10}\KeywordTok{\{a.}\RegionMarkerTok{)}\KeywordTok{"}\NormalTok{\_}\RegionMarkerTok{)} \KeywordTok{,\&.>} \KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. name, class, definition table to assigned name table}
\NormalTok{jscriptdefs}\AlertTok{=:}\index{jscriptdefs@\texttt{jscriptdefs}} \RegionMarkerTok{((}\KeywordTok{[:} \KeywordTok{\{."}\DecValTok{1} \KeywordTok{]}\RegionMarkerTok{)} \KeywordTok{,\&.>} \RegionMarkerTok{(}\KeywordTok{<}\StringTok{\textquotesingle{}=:\textquotesingle{}}\RegionMarkerTok{)}\KeywordTok{"}\NormalTok{\_}\RegionMarkerTok{)} \KeywordTok{,\&.>} \KeywordTok{[:} \KeywordTok{\{:"}\DecValTok{1} \KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{makedump}\AlertTok{=:}\index{makedump@\texttt{makedump}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*makedump  v{-}{-} dumps the current path as a J  script file. The}
\CommentTok{NB. dump script can be run back  into  JOD  to rebuild  a  single}
\CommentTok{NB. dictionary that contains all objects on the current path. The}
\CommentTok{NB. dump script is a simple ASCII file  that is intended for long}
\CommentTok{NB. term storage of J  words in a form that is immune to  changes}
\CommentTok{NB. in binary storage formats.}
\CommentTok{NB.}
\CommentTok{NB. monad:  makedump uuIgnore}

\CommentTok{NB. do we have a dictionary open?}
\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ checkopen}\DecValTok{\_\_}\NormalTok{ST }\DecValTok{0} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. create dump file in put dump directory !(*)=. DL}
\NormalTok{DL}\KeywordTok{=.\{:\{.}\NormalTok{DPATH}\DecValTok{\_\_}\NormalTok{ST}

\CommentTok{NB. dumpfactor is set from the put dictionary}
\NormalTok{df}\KeywordTok{=.}\NormalTok{ DUMPFACTOR}\DecValTok{\_\_}\NormalTok{DL}

\CommentTok{NB. default dump file name is the put dictionary name}
\KeywordTok{if.}\NormalTok{ isempty }\KeywordTok{y}   \KeywordTok{do.}\NormalTok{ dumpfile}\KeywordTok{=.}\NormalTok{ DMP}\DecValTok{\_\_}\NormalTok{DL}\KeywordTok{,}\NormalTok{DNAME}\DecValTok{\_\_}\NormalTok{DL}\KeywordTok{,}\NormalTok{IJS}
\KeywordTok{elseif.}\NormalTok{ badcl }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ jderr ERR0158 }\KeywordTok{return.} \CommentTok{NB. error msg: invalid dump file}
\KeywordTok{elseif.do.}\NormalTok{ dumpfile}\KeywordTok{=.} \KeywordTok{y}
\KeywordTok{end.}

\CommentTok{NB. HARDCODE: are we retaining object age?}
\KeywordTok{if.} \DecValTok{0}\KeywordTok{=}\NormalTok{nc}\KeywordTok{<}\StringTok{\textquotesingle{}RETAINAGE\_\_DL\textquotesingle{}} \KeywordTok{do.}\NormalTok{ rag}\KeywordTok{=.} \DecValTok{1} \KeywordTok{{-}:}\NormalTok{ RETAINAGE}\DecValTok{\_\_}\NormalTok{DL  }\KeywordTok{else.}\NormalTok{ rag}\KeywordTok{=.} \DecValTok{0} \KeywordTok{end.}

\CommentTok{NB. standardize path character}
\NormalTok{dumpfile}\KeywordTok{=.}\NormalTok{ jpathsep dumpfile}

\KeywordTok{if.}\NormalTok{     badrc uv}\KeywordTok{=.}\NormalTok{ dumpheader dumpfile        }\KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ df dumpwords dumpfile      }\KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{df}\KeywordTok{,}\NormalTok{TEST}\RegionMarkerTok{)}\NormalTok{ dumptm dumpfile  }\KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{df}\KeywordTok{,}\NormalTok{MACRO}\RegionMarkerTok{)}\NormalTok{ dumptm dumpfile }\KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{df}\KeywordTok{,}\NormalTok{GROUP}\RegionMarkerTok{)}\NormalTok{ dumpgs dumpfile }\KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{df}\KeywordTok{,}\NormalTok{SUITE}\RegionMarkerTok{)}\NormalTok{ dumpgs dumpfile }\KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ dumpdictdoc dumpfile       }\KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ rag dumpntstamps dumpfile  }\KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ dumptrailer dumpfile       }\KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.do.}
  \RegionMarkerTok{(}\NormalTok{ok OK0151}\RegionMarkerTok{)}\KeywordTok{,<}\NormalTok{dumpfile}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{makegs}\AlertTok{=:}\index{makegs@\texttt{makegs}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*makegs  v{-}{-}  make  group   and  suite  scripts.  Objects  are}
\CommentTok{NB. assembled by name class and within class alphabetically.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaObject makegs clName}
\CommentTok{NB.}
\CommentTok{NB.   2 makegs \textquotesingle{}group\textquotesingle{}}

\StringTok{\textquotesingle{}obj wf\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}
\NormalTok{DL}\KeywordTok{=.\{:\{.}\NormalTok{DPATH}\DecValTok{\_\_}\NormalTok{ST}

\CommentTok{NB. for postive option codes generate files only if the object}
\CommentTok{NB. is in the put dictionary for negative codes generate files}
\CommentTok{NB. regardless of where on the path it occurs. Generated files}
\CommentTok{NB. are ALWAYS written to the put dictionary script directory}
\NormalTok{wf}\KeywordTok{=.} \KeywordTok{|}\NormalTok{wf }\KeywordTok{[}\NormalTok{ po}\KeywordTok{=.} \DecValTok{0}\KeywordTok{<}\NormalTok{wf}

\CommentTok{NB. errmsg: invalid group/suite name}
\KeywordTok{if.} \RegionMarkerTok{(}\NormalTok{isempty }\KeywordTok{+.}\NormalTok{ badcl}\RegionMarkerTok{)} \KeywordTok{y} \KeywordTok{do.}\NormalTok{ jderr ERR0154 }\KeywordTok{return.} \KeywordTok{end.}
\KeywordTok{if.}\NormalTok{ badrc head}\KeywordTok{=.}\NormalTok{ obj getgstext}\DecValTok{\_\_}\NormalTok{ST }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ head }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. generate files for dictionary objects}
\KeywordTok{if.} \RegionMarkerTok{(}\DecValTok{1}\KeywordTok{=}\NormalTok{wf}\RegionMarkerTok{)} \KeywordTok{*.}\NormalTok{ po }\KeywordTok{do.}
  \KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{obj}\KeywordTok{;<}\NormalTok{DL}\RegionMarkerTok{)}\NormalTok{ inputdict}\DecValTok{\_\_}\NormalTok{ST }\KeywordTok{<y=.} \KeywordTok{y{-}.}\StringTok{\textquotesingle{} \textquotesingle{}} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{end.}
\KeywordTok{end.}

\CommentTok{NB. get group or suite list and generate text}
\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ obj gslistnl}\DecValTok{\_\_}\NormalTok{ST }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{end.}
\KeywordTok{if.}\NormalTok{ isempty }\KeywordTok{>}\DecValTok{1}\KeywordTok{\{}\NormalTok{uv }\KeywordTok{do.}\NormalTok{ uv}\KeywordTok{=.}\StringTok{\textquotesingle{}\textquotesingle{}}
\KeywordTok{else.}
  \KeywordTok{if.}\NormalTok{ DODEPENDENTS }\KeywordTok{do.}
    \CommentTok{NB. process any dependent sections in headers and adjust lists}
    \KeywordTok{if.}\NormalTok{ badrc deps}\KeywordTok{=.}\NormalTok{ obj gdeps }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ deps }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ deps}\KeywordTok{=.\}.}\NormalTok{ deps }\KeywordTok{end.}
  \KeywordTok{else.}
\NormalTok{    deps}\KeywordTok{=.}\StringTok{\textquotesingle{}\textquotesingle{}}
  \KeywordTok{end.}
  \CommentTok{NB. dependents may empty group/suite list}
  \KeywordTok{if.} \KeywordTok{\#}\NormalTok{uv}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\}.}\NormalTok{uv}\RegionMarkerTok{)}\KeywordTok{{-}.}\NormalTok{deps }\KeywordTok{do.}
    \KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{((}\NormalTok{obj}\KeywordTok{{-}}\DecValTok{2}\RegionMarkerTok{)}\KeywordTok{,}\DecValTok{0}\RegionMarkerTok{)}\NormalTok{ getobjects}\DecValTok{\_\_}\NormalTok{ST uv }\KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{end.}
    \KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{((}\NormalTok{obj}\KeywordTok{{-}}\DecValTok{2}\RegionMarkerTok{)}\KeywordTok{,}\DecValTok{0}\RegionMarkerTok{)}\NormalTok{ wttext rv uv }\KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{    uv}\KeywordTok{=.}\NormalTok{rv uv}
  \KeywordTok{else.}\NormalTok{ uv}\KeywordTok{=.}\StringTok{\textquotesingle{}\textquotesingle{}}
  \KeywordTok{end.}
\KeywordTok{end.}

\CommentTok{NB. trim any header and append to word or test text}
\KeywordTok{if.} \KeywordTok{\#}\NormalTok{head}\KeywordTok{=.}\NormalTok{ alltrim}\KeywordTok{@:}\NormalTok{lfcrtrim }\RegionMarkerTok{(}\DecValTok{1}\KeywordTok{;}\DecValTok{0} \DecValTok{1}\RegionMarkerTok{)} \KeywordTok{\{::}\NormalTok{ head }\KeywordTok{do.}\NormalTok{ uv}\KeywordTok{=.}\NormalTok{ head}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{HEADEND}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{uv }\KeywordTok{end.}

\CommentTok{NB. write file or return character list result}
\KeywordTok{if.} \DecValTok{1}\KeywordTok{=}\NormalTok{wf }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{obj}\KeywordTok{;y}\RegionMarkerTok{)}\NormalTok{ writeijs uv }\KeywordTok{else.}\NormalTok{ ok uv }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{masknb}\AlertTok{=:}\index{masknb@\texttt{masknb}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*masknb v{-}{-} bit mask of unquoted comment starts.}
\CommentTok{NB.}
\CommentTok{NB. monad:  masknb ct}
\CommentTok{NB. dyad:  cl masknb ct}

\StringTok{\textquotesingle{}NB.\textquotesingle{}}\NormalTok{ masknb }\KeywordTok{y}
\KeywordTok{:}
\NormalTok{c }\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{$y}\RegionMarkerTok{)}\KeywordTok{$x} \KeywordTok{E.} \KeywordTok{,y}
\KeywordTok{+./\textbackslash{}"}\DecValTok{1}\NormalTok{ c }\KeywordTok{>} \KeywordTok{\textasciitilde{}:/\textbackslash{}"}\DecValTok{1} \KeywordTok{y} \KeywordTok{e.} \StringTok{\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{namecats}\AlertTok{=:}\index{namecats@\texttt{namecats}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*namecats v{-}{-} extracts and classifies names in J code.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  pa namecats ctJcode}
\CommentTok{NB.}
\CommentTok{NB. name classifications}
\CommentTok{NB.   global           global reference or assignment}
\CommentTok{NB.   local            local reference of assignment}
\CommentTok{NB.   declared global  names marked with global comment tag (*)=:}
\CommentTok{NB.   declared local   names marked with local command tag (*)=.}
\CommentTok{NB.   override mixed   allow mixed assignments (<:)=:}
\CommentTok{NB.   for. local       implicit for. locals}
\CommentTok{NB.}
\CommentTok{NB.  0 namecats jcr \textquotesingle{}wordname\textquotesingle{} NB. only globals}
\CommentTok{NB.  1 namecats jcr \textquotesingle{}wordname\textquotesingle{} NB. full classification}

\KeywordTok{if.}\NormalTok{ badrc parsed}\KeywordTok{=.}\NormalTok{ parsecode }\KeywordTok{y} \KeywordTok{do.}
\NormalTok{  parsed  }\CommentTok{NB. parse error}
\KeywordTok{else.}
  \StringTok{\textquotesingle{}dgbls dlocs parsed\textquotesingle{}}\KeywordTok{=.} \KeywordTok{\}.}\NormalTok{ parsed}

  \CommentTok{NB. handle quoted assignments and implicit for. locals}
  \StringTok{\textquotesingle{}mgbls mlocs flocs\textquotesingle{}}\KeywordTok{=.}\NormalTok{ extscopes parsed}

  \CommentTok{NB. declarations override other scopes}
\NormalTok{  mgbls}\KeywordTok{=.}\NormalTok{ mgbls }\KeywordTok{{-}.}\NormalTok{ dlocs }\KeywordTok{[}\NormalTok{ mlocs}\KeywordTok{=.}\NormalTok{ mlocs }\KeywordTok{{-}.}\NormalTok{ dgbls}
\NormalTok{  gbls}\KeywordTok{=.}\NormalTok{ dgbls}\KeywordTok{,}\NormalTok{mgbls }\KeywordTok{[}\NormalTok{ locs}\KeywordTok{=.}\NormalTok{ dlocs}\KeywordTok{,}\NormalTok{mlocs}

  \CommentTok{NB. pick out assignments}
\NormalTok{  parsed}\KeywordTok{=.}\NormalTok{ parsed }\KeywordTok{{-}.} \KeywordTok{;:}\StringTok{\textquotesingle{})\textquotesingle{}}
\NormalTok{  uv0}\KeywordTok{=.}\NormalTok{ parsed }\KeywordTok{\#\textasciitilde{}} \DecValTok{1}\KeywordTok{|.}\NormalTok{parsed }\KeywordTok{=} \KeywordTok{<}\StringTok{\textquotesingle{}=.\textquotesingle{}}
\NormalTok{  uv1}\KeywordTok{=.}\NormalTok{ parsed }\KeywordTok{\#\textasciitilde{}} \DecValTok{1}\KeywordTok{|.}\NormalTok{parsed }\KeywordTok{=} \KeywordTok{<}\StringTok{\textquotesingle{}=:\textquotesingle{}}

  \CommentTok{NB. forbid names from being both local and global}
\NormalTok{  uv1}\KeywordTok{=.}\NormalTok{ uv0 }\KeywordTok{{-}.}\NormalTok{ uv0 }\KeywordTok{{-}.}\NormalTok{ uv1}

  \CommentTok{NB. errmsg: mixed scopes}
  \KeywordTok{if.} \DecValTok{0} \KeywordTok{<} \KeywordTok{\#}\NormalTok{uv1 }\KeywordTok{do.}
    \CommentTok{NB. check for mixed assignment override}
    \KeywordTok{if.} \KeywordTok{{-}.}\NormalTok{MIXEDOVER }\KeywordTok{+./@E.} \KeywordTok{,y} \KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR0159}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{uv1 }\KeywordTok{return.} \KeywordTok{end.}
  \KeywordTok{end.}

\NormalTok{  uv1}\KeywordTok{=.}\NormalTok{ parsed }\KeywordTok{{-}.}\NormalTok{ uv0}
\NormalTok{  gbls}\KeywordTok{=.}\NormalTok{ gbls }\KeywordTok{,} \RegionMarkerTok{(}\NormalTok{jnfrblcl uv1}\RegionMarkerTok{)} \KeywordTok{{-}.}\NormalTok{ locs}\KeywordTok{,}\NormalTok{JARGS}

  \KeywordTok{if.} \KeywordTok{x} \KeywordTok{do.}
    \CommentTok{NB. complete name classification}
\NormalTok{    locs}\KeywordTok{=.}\NormalTok{ locs}\KeywordTok{,}\NormalTok{jnfrblcl uv0}
\NormalTok{    uv1}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{gbls}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{<}\NormalTok{locs}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{<}\NormalTok{dgbls}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{<}\NormalTok{dlocs}\RegionMarkerTok{)}\KeywordTok{,<}\NormalTok{flocs}
\NormalTok{    ok }\KeywordTok{<}\NormalTok{GLOBCATS }\KeywordTok{,.} \RegionMarkerTok{(}\KeywordTok{/:\textasciitilde{}}\RegionMarkerTok{)}\KeywordTok{@:\textasciitilde{}.} \KeywordTok{\&.>}\NormalTok{ uv1}
  \KeywordTok{else.}
    \CommentTok{NB. return only unique sorted globals}
\NormalTok{    ok }\KeywordTok{/:\textasciitilde{}} \KeywordTok{\textasciitilde{}.}\NormalTok{ gbls}
  \KeywordTok{end.}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. numeric list from run length encoding table {-} see (rlefrnl) long document}
\NormalTok{nlfrrle}\AlertTok{=:}\index{nlfrrle@\texttt{nlfrrle}} \KeywordTok{\#\textasciitilde{}/@:|:}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nounlrep}\AlertTok{=:}\index{nounlrep@\texttt{nounlrep}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*nounlrep v{-}{-} converts nouns stored as binary  to linear  text}
\CommentTok{NB. representations. Uses  a  scratch locale to temporarily define}
\CommentTok{NB. nouns.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaNoex nounlrep bt}

\CommentTok{NB. override mixed assignments (<:)=:}
\KeywordTok{if.} \KeywordTok{\#y} \KeywordTok{do.}
\NormalTok{  clearso }\DecValTok{0}
\NormalTok{  names}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{errnames}\KeywordTok{=.} \KeywordTok{\{."}\DecValTok{1} \KeywordTok{y}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ locsfx SO  }\CommentTok{NB. !(*)=. SO}
  \KeywordTok{try.}
    \RegionMarkerTok{(}\NormalTok{names}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}  \RegionMarkerTok{(}\DecValTok{3}\KeywordTok{!:}\DecValTok{2}\RegionMarkerTok{)}\KeywordTok{\&.>} \KeywordTok{\{:"}\DecValTok{1} \KeywordTok{y}
\NormalTok{    names}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{5}\KeywordTok{!:}\DecValTok{5}\KeywordTok{@<}\RegionMarkerTok{)}\KeywordTok{\&.>}\NormalTok{ names}
  \KeywordTok{catch.} \RegionMarkerTok{(}\NormalTok{jderr ERR016}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{errnames }\KeywordTok{return.} \KeywordTok{end.} \CommentTok{NB. retain scratch on failure}
  \KeywordTok{if.} \KeywordTok{x} \KeywordTok{do.}\NormalTok{ names}\KeywordTok{=.}\NormalTok{ names }\KeywordTok{,\&.>}\NormalTok{ LF }\KeywordTok{end.}
  \KeywordTok{y=.}\NormalTok{ names }\RegionMarkerTok{(}\KeywordTok{<a:;}\DecValTok{2}\RegionMarkerTok{)}\KeywordTok{\}} \KeywordTok{y}
\NormalTok{  clearso }\DecValTok{0}
\KeywordTok{end.}
\NormalTok{ok }\KeywordTok{<y}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{opaqnames}\AlertTok{=:}\index{opaqnames@\texttt{opaqnames}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*opaqnames v{-}{-} extract  opaque names  from J  code.  An opaque}
\CommentTok{NB. name is a declared reference.}
\CommentTok{NB.}
\CommentTok{NB. dyad:}

\NormalTok{b}\KeywordTok{=.}  \KeywordTok{+./"}\DecValTok{1} \KeywordTok{x}        \CommentTok{NB. text mask}
\KeywordTok{x=.}\NormalTok{ b }\KeywordTok{\#} \KeywordTok{x} \KeywordTok{[} \KeywordTok{y=.}\NormalTok{ b }\KeywordTok{\#} \KeywordTok{y}
\KeywordTok{y=.} \KeywordTok{x}\NormalTok{ jnb }\KeywordTok{y}         \CommentTok{NB. search only comment text}
\KeywordTok{if.} \KeywordTok{+./} \StringTok{\textquotesingle{}(*)=\textquotesingle{}} \KeywordTok{E.} \KeywordTok{,} \KeywordTok{y} \KeywordTok{do.}

  \CommentTok{NB. replace any single quotes \textquotesingle{} with blanks}
  \CommentTok{NB. quotes will confuse (masknb) below}
  \KeywordTok{y=.} \RegionMarkerTok{(}\KeywordTok{$y}\RegionMarkerTok{)}\KeywordTok{$} \StringTok{\textquotesingle{} \textquotesingle{}} \RegionMarkerTok{(} \KeywordTok{I.} \RegionMarkerTok{(}\KeywordTok{,y}\RegionMarkerTok{)} \KeywordTok{=} \StringTok{\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}}\RegionMarkerTok{)}\KeywordTok{\}} \KeywordTok{,y}

  \CommentTok{NB. this is a rare instance of where HARDCODE is}
  \CommentTok{NB. beneficial.  The tags used to mark declared}
  \CommentTok{NB. globals and locals in J code are sprinkled}
  \CommentTok{NB. throughout many programs.  If the tags where}
  \CommentTok{NB. ever changed in this verb it would not properly}
  \CommentTok{NB. process changed tags. By hardcoding the tags}
  \CommentTok{NB. they are difficult to change which is what I want!}
\NormalTok{  locals}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{,y}\RegionMarkerTok{)} \KeywordTok{\#\textasciitilde{}} \KeywordTok{,} \StringTok{\textquotesingle{}(*)=.\textquotesingle{}}\NormalTok{ masknb }\KeywordTok{y}
\NormalTok{  locals}\KeywordTok{=.} \KeywordTok{\textasciitilde{}.} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} \textquotesingle{}}\KeywordTok{,}\NormalTok{locals }\KeywordTok{\#\textasciitilde{}} \KeywordTok{{-}.} \StringTok{\textquotesingle{}  \textquotesingle{}} \KeywordTok{E.}\NormalTok{ locals}
\NormalTok{  locals}\KeywordTok{=.} \KeywordTok{<}\NormalTok{jnfrblcl locals}
\NormalTok{  globals}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{,y}\RegionMarkerTok{)} \KeywordTok{\#\textasciitilde{}} \KeywordTok{,} \StringTok{\textquotesingle{}(*)=:\textquotesingle{}}\NormalTok{ masknb }\KeywordTok{y}
\NormalTok{  globals}\KeywordTok{=.} \KeywordTok{\textasciitilde{}.} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} \textquotesingle{}}\KeywordTok{,}\NormalTok{globals }\KeywordTok{\#\textasciitilde{}} \KeywordTok{{-}.} \StringTok{\textquotesingle{}  \textquotesingle{}} \KeywordTok{E.}\NormalTok{ globals}
\NormalTok{  globals}\KeywordTok{=.} \KeywordTok{<}\NormalTok{jnfrblcl globals}
\NormalTok{  locals}\KeywordTok{,}\NormalTok{globals}
\KeywordTok{else.}
  \StringTok{\textquotesingle{}\textquotesingle{}}\KeywordTok{;}\StringTok{\textquotesingle{}\textquotesingle{}}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{parsecode}\AlertTok{=:}\index{parsecode@\texttt{parsecode}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*parsecode v{-}{-} parses J word code.  Normal result  is a  three}
\CommentTok{NB. item boxed list of boxed lists containing declared  names and}
\CommentTok{NB. parsed tokens. Will return  an  error if  given syntactically}
\CommentTok{NB. invalid J code.}
\CommentTok{NB.}
\CommentTok{NB. monad:  parsecode cl|ctJcr}
\CommentTok{NB.}
\CommentTok{NB.   parsecode jcr \textquotesingle{}wordname\textquotesingle{}}

\KeywordTok{if.} \DecValTok{0} \KeywordTok{e.} \KeywordTok{$}\NormalTok{parsed}\KeywordTok{=.}\NormalTok{ tabit }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ ok}\StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{return.}
\CommentTok{NB. possible quoted single line explicit}
\KeywordTok{elseif.} \DecValTok{1}\KeywordTok{=\#}\NormalTok{parsed }\KeywordTok{do.}\NormalTok{ parsed}\KeywordTok{=.}\NormalTok{ uqtsingle parsed}
\KeywordTok{end.}

\CommentTok{NB. end with a blank and compute comment mask}
\NormalTok{parsed}\KeywordTok{=.}\NormalTok{ parsed }\KeywordTok{,"}\DecValTok{1} \StringTok{\textquotesingle{} \textquotesingle{}}
\NormalTok{mask}\KeywordTok{=.}\NormalTok{ masknb parsed}
\NormalTok{locs}\KeywordTok{=.}\NormalTok{ gbls}\KeywordTok{=.} \StringTok{\textquotesingle{}\textquotesingle{}}

\CommentTok{NB. if any declared names extract them}
\KeywordTok{if.} \DecValTok{1} \KeywordTok{e.} \StringTok{\textquotesingle{}(*)=\textquotesingle{}} \KeywordTok{E.} \KeywordTok{,}\NormalTok{ parsed }\KeywordTok{do.}
  \StringTok{\textquotesingle{}locs gbls\textquotesingle{}}\KeywordTok{=.}\NormalTok{ mask opaqnames parsed}
\NormalTok{  olap}\KeywordTok{=.}\NormalTok{ locs }\KeywordTok{{-}.}\NormalTok{ locs }\KeywordTok{{-}.}\NormalTok{ gbls  }\CommentTok{NB. intersection}
  \CommentTok{NB. errmsg: confused declarations}
  \KeywordTok{if.} \DecValTok{0}\KeywordTok{<\#}\NormalTok{ olap }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR0150}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{olap }\KeywordTok{return.} \KeywordTok{end.}
\KeywordTok{end.}

\CommentTok{NB. blank comments, clear mask and remove blank rows}
\NormalTok{mask}\KeywordTok{=.} \DecValTok{0} \KeywordTok{[}\NormalTok{ parsed}\KeywordTok{=.}\NormalTok{ parsed jnb}\KeywordTok{\textasciitilde{}} \KeywordTok{{-}.}\NormalTok{ mask}
\NormalTok{parsed}\KeywordTok{=.}\NormalTok{ parsed }\KeywordTok{\#\textasciitilde{}}\NormalTok{ parsed }\KeywordTok{+./} \KeywordTok{.} \KeywordTok{\textasciitilde{}:} \StringTok{\textquotesingle{} \textquotesingle{}}
\NormalTok{parsed}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{;:} \KeywordTok{::} \KeywordTok{0:}\RegionMarkerTok{)}\KeywordTok{\&.>} \KeywordTok{<"}\DecValTok{1}\NormalTok{ parsed  }\CommentTok{NB. parse code}
\KeywordTok{if.}\NormalTok{ parsed }\KeywordTok{e.\textasciitilde{}} \KeywordTok{<}\DecValTok{0} \KeywordTok{do.}
\NormalTok{  jderr ERR0151  }\CommentTok{NB. errmsg: word syntax}
\KeywordTok{else.}
\NormalTok{  parsed}\KeywordTok{=.}\NormalTok{ ok}\RegionMarkerTok{(}\KeywordTok{<}\NormalTok{gbls}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{<}\NormalTok{locs}\RegionMarkerTok{)}\KeywordTok{,<;}\NormalTok{parsed}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{putallts}\AlertTok{=:}\index{putallts@\texttt{putallts}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*putallts v{-}{-} puts all timestamps {-} see (getallts).}
\CommentTok{NB.}
\CommentTok{NB. monad:  putallts btCts}
\CommentTok{NB.}
\CommentTok{NB.   cts=. getallts\_\_MK\_\_JODobj 0}
\CommentTok{NB.   putallts\_\_MK\_\_JODobj cts}

\CommentTok{NB. insure dictionaries are open}
\KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{ checkopen}\DecValTok{\_\_}\NormalTok{ST }\DecValTok{0} \KeywordTok{do.}\NormalTok{ msg }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. HARDCODE: errmsg: invalid object timestamp table}
\KeywordTok{if.} \KeywordTok{{-}.}\RegionMarkerTok{(}\DecValTok{3}\KeywordTok{,\#}\NormalTok{OBJECTNC}\RegionMarkerTok{)} \KeywordTok{{-}:} \KeywordTok{$y} \KeywordTok{do.}\NormalTok{ jderr ERR0160 }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. put dictionary name and object names}
\NormalTok{do}\KeywordTok{=.} \KeywordTok{\{:\{.}\NormalTok{DPATH}\DecValTok{\_\_}\NormalTok{ST}
\NormalTok{onames}\KeywordTok{=.}\NormalTok{ DIRNMS\_\_do }\KeywordTok{[}\NormalTok{ dname}\KeywordTok{=.}\NormalTok{ DNAME\_\_do}

\CommentTok{NB. HARDCODE: shapes}
\NormalTok{inc}\KeywordTok{=.} \KeywordTok{{-}}\NormalTok{INPUT }\KeywordTok{[}\NormalTok{ ecb}\KeywordTok{=.} \KeywordTok{;}\DecValTok{2}\KeywordTok{\{y} \KeywordTok{[}\NormalTok{ nots}\KeywordTok{=.} \DecValTok{0} \KeywordTok{=} \KeywordTok{\#\&>} \DecValTok{0}\KeywordTok{\{y} \KeywordTok{[}\NormalTok{ msg}\KeywordTok{=.} \KeywordTok{i.} \DecValTok{0} \DecValTok{4}

\KeywordTok{for\_obj.}\NormalTok{ OBJECTNC }\KeywordTok{do.}

  \CommentTok{NB. empty object timestamps}
  \KeywordTok{if.}\NormalTok{ obj\_index}\KeywordTok{\{}\NormalTok{nots }\KeywordTok{do.} \KeywordTok{continue.} \KeywordTok{end.}

  \CommentTok{NB. object name timestamps}
\NormalTok{  nts}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\DecValTok{0} \DecValTok{1}\KeywordTok{;} \KeywordTok{,}\NormalTok{obj\_index}\RegionMarkerTok{)}\KeywordTok{\{y}
\NormalTok{  uv}\KeywordTok{=.} \DecValTok{2} \KeywordTok{,} \KeywordTok{\#\&>} \DecValTok{0}\KeywordTok{\{}\NormalTok{nts}

  \CommentTok{NB. decode any run encodings}
  \KeywordTok{if.}\NormalTok{ obj\_index}\KeywordTok{\{}\NormalTok{ecb }\KeywordTok{do.}\NormalTok{ nts}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{uv }\KeywordTok{$}\NormalTok{ nlfrrle }\KeywordTok{;}\DecValTok{1}\KeywordTok{\{}\NormalTok{nts}\RegionMarkerTok{)} \RegionMarkerTok{(}\DecValTok{1}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ nts }\KeywordTok{end.}

  \CommentTok{NB. store timestamps {-} note errors but proceed}
\NormalTok{  msg}\KeywordTok{=.}\NormalTok{ msg }\KeywordTok{,} \RegionMarkerTok{(}\DecValTok{2} \KeywordTok{\{.} \RegionMarkerTok{(}\NormalTok{obj}\KeywordTok{,}\NormalTok{inc}\RegionMarkerTok{)}\NormalTok{ put nts}\RegionMarkerTok{)} \KeywordTok{,} \RegionMarkerTok{(}\NormalTok{obj\_index}\KeywordTok{\{}\NormalTok{onames}\RegionMarkerTok{)} \KeywordTok{,} \KeywordTok{<}\NormalTok{dname}

\KeywordTok{end.}

\NormalTok{msg}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. run list encoding from numeric list {-} see long document}
\NormalTok{rlefrnl}\AlertTok{=:}\index{rlefrnl@\texttt{rlefrnl}} \RegionMarkerTok{(}\DecValTok{1} \KeywordTok{,\textasciitilde{}} \DecValTok{2}\KeywordTok{\&}\RegionMarkerTok{(}\KeywordTok{\textasciitilde{}:/\textbackslash{}}\RegionMarkerTok{))} \RegionMarkerTok{(}\KeywordTok{\{.} \KeywordTok{,} \KeywordTok{\#}\RegionMarkerTok{)}\KeywordTok{;.}\DecValTok{2} \KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sexpin}\AlertTok{=:}\index{sexpin@\texttt{sexpin}} \DecValTok{3} \RegionMarkerTok{: 0}
\CommentTok{NB.*sexpin v{-}{-} single line explicit definition test.}
\KeywordTok{if.}\NormalTok{      EXPPFX0 }\KeywordTok{e.\textasciitilde{}} \DecValTok{5} \KeywordTok{\{.}\NormalTok{ hd}\KeywordTok{=.}\NormalTok{ alltrim }\DecValTok{20} \KeywordTok{\{.} \KeywordTok{,y}  \KeywordTok{do.} \DecValTok{1}
\KeywordTok{elseif.}\NormalTok{  EXPPFX1 }\KeywordTok{e.\textasciitilde{}} \DecValTok{8} \KeywordTok{\{.}\NormalTok{ hd  }\KeywordTok{do.} \DecValTok{1}  \CommentTok{NB. monad null}
\KeywordTok{elseif.} \KeywordTok{do.} \DecValTok{0}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sonl}\AlertTok{=:}\index{sonl@\texttt{sonl}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*sonl v{-}{-} scratch object namelist.}
\CommentTok{NB.}
\CommentTok{NB. monad:  sonl il}

\NormalTok{nl}\DecValTok{\_\_}\NormalTok{SO }\KeywordTok{y}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. promotes only atoms and lists to tables}
\NormalTok{tabit}\AlertTok{=:}\index{tabit@\texttt{tabit}} \KeywordTok{]\textasciigrave{},:@.}\RegionMarkerTok{(}\DecValTok{1}\KeywordTok{\&>:@}\RegionMarkerTok{(}\KeywordTok{\#@$}\RegionMarkerTok{))}\KeywordTok{\^{}:}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{toascii85}\AlertTok{=:}\index{toascii85@\texttt{toascii85}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*toascii85 v{-}{-} to ascii85 representation.}
\CommentTok{NB.}
\CommentTok{NB. From convert/misc/ascii85 addon.}
\CommentTok{NB.}
\CommentTok{NB. Converts  a  list  of  bytes to  an  ASCII85  representation:}
\CommentTok{NB. essentially all the  "visible" ASCII characters.  Useful  for}
\CommentTok{NB. encoding arbitrary byte  lists as a  portable stream. Returns}
\CommentTok{NB. lines of length no more than 75 + LF}
\CommentTok{NB.}
\CommentTok{NB. The encoding does not begin with <\textasciitilde{}, though sometimes this is}
\CommentTok{NB. allowed.  However  PDF  files  do  not  accept  this  prefix.}
\CommentTok{NB. Decoding does support the prefix.}
\CommentTok{NB.}
\CommentTok{NB. monad:  clA85 =. toascii85 cl}

\NormalTok{r}\KeywordTok{=.} \KeywordTok{,y}
\NormalTok{len}\KeywordTok{=.} \KeywordTok{\#}\NormalTok{r}
\KeywordTok{assert.} \DecValTok{4} \KeywordTok{<:}\NormalTok{ len  }\CommentTok{NB. fails on short cl}
\NormalTok{r}\KeywordTok{=.} \DecValTok{256} \KeywordTok{\#.} \DecValTok{\_4}\KeywordTok{[\textbackslash{}} \KeywordTok{a.i.}\NormalTok{r}
\KeywordTok{m=.} \DecValTok{0} \RegionMarkerTok{(}\NormalTok{\_}\DecValTok{1}\RegionMarkerTok{)} \KeywordTok{\}}\NormalTok{ r }\KeywordTok{=} \DecValTok{0}
\KeywordTok{n=.} \DecValTok{5} \KeywordTok{*} \KeywordTok{I.m}
\NormalTok{r}\KeywordTok{=.} \KeywordTok{a.} \KeywordTok{\{\textasciitilde{}} \DecValTok{33} \KeywordTok{+} \KeywordTok{,}\RegionMarkerTok{(}\DecValTok{5}\KeywordTok{\#}\DecValTok{85}\RegionMarkerTok{)} \KeywordTok{\#:}\NormalTok{ r}
\NormalTok{r}\KeywordTok{=.} \StringTok{\textquotesingle{}z\textquotesingle{}} \KeywordTok{n} \KeywordTok{\}}\NormalTok{ r}
\KeywordTok{m=.} \DecValTok{1} \KeywordTok{n} \KeywordTok{\}} \DecValTok{5} \KeywordTok{\#} \KeywordTok{{-}.} \KeywordTok{m}
\NormalTok{r}\KeywordTok{=.} \KeywordTok{m} \KeywordTok{\#}\NormalTok{ r}
\NormalTok{r}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{{-}} \RegionMarkerTok{(}\DecValTok{4}\KeywordTok{|}\NormalTok{len}\RegionMarkerTok{)} \KeywordTok{\{} \DecValTok{0} \DecValTok{3} \DecValTok{2} \DecValTok{1}\RegionMarkerTok{)} \KeywordTok{\}.}\NormalTok{ r}
\NormalTok{r}\KeywordTok{=.} \KeywordTok{\}:} \KeywordTok{,}\RegionMarkerTok{(}\NormalTok{\_}\DecValTok{75} \KeywordTok{[\textbackslash{}}\NormalTok{ r}\RegionMarkerTok{)}\KeywordTok{,.}\NormalTok{LF}
\RegionMarkerTok{(}\StringTok{\textquotesingle{}\textasciitilde{}>\textquotesingle{}}\KeywordTok{,}\NormalTok{LF}\RegionMarkerTok{)} \KeywordTok{,\textasciitilde{}} \RegionMarkerTok{(}\NormalTok{r }\KeywordTok{i:} \StringTok{\textquotesingle{} \textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{\{.}\NormalTok{ r}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{uqtsingle}\AlertTok{=:}\index{uqtsingle@\texttt{uqtsingle}} \DecValTok{3} \RegionMarkerTok{: 0}
\CommentTok{NB.*uqtsingle v{-}{-} unquotes single line explicit definitions}
\KeywordTok{if.}\NormalTok{ sexpin }\KeywordTok{y} \KeywordTok{do.}
\NormalTok{  m99}\KeywordTok{=.} \StringTok{\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}}\NormalTok{ htclip alltrim }\KeywordTok{,y}
\NormalTok{  m99}\KeywordTok{=.}\NormalTok{ tabit m99 }\KeywordTok{\#\textasciitilde{}} \KeywordTok{{-}.}\NormalTok{ halfbits }\StringTok{\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}} \KeywordTok{=}\NormalTok{ m99}
  \KeywordTok{]\textasciigrave{}}\RegionMarkerTok{(}\StringTok{\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}}\KeywordTok{\&,"}\DecValTok{1}\RegionMarkerTok{)}\KeywordTok{@.}\RegionMarkerTok{(}\StringTok{\textquotesingle{}:\textquotesingle{}\textquotesingle{}\textquotesingle{}}\KeywordTok{\&{-}:@}\RegionMarkerTok{(}\DecValTok{2}\KeywordTok{\&\{.@,}\RegionMarkerTok{))}\NormalTok{ m99  }\CommentTok{NB. correct dyad}
\KeywordTok{else.}
  \KeywordTok{y}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wraplinear}\AlertTok{=:}\index{wraplinear@\texttt{wraplinear}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*wraplinear  v{-}{-}  wraps the linear representation of  large  J}
\CommentTok{NB. objects into a series of script lines.}
\CommentTok{NB.}
\CommentTok{NB. The linear form  of large  J  objects  can produce  very long}
\CommentTok{NB. lines  in  script files. Many editors cannot deal  with  very}
\CommentTok{NB. long lines. This verb  produces  an equivalent representation}
\CommentTok{NB. that can always be edited.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  (clTempName ; iaWidth) wraplinear clLinear}
\CommentTok{NB.        (clTempName ; iaWidth ; paAscii85) wraplinear clLinear}
\CommentTok{NB.}
\CommentTok{NB.   (\textquotesingle{}z\textquotesingle{};67) wraplinear 5!:5 <\textquotesingle{}bighonkingarray\textquotesingle{}}
\CommentTok{NB.   (\textquotesingle{}z\textquotesingle{};67;1) wraplinear btcl}
\CommentTok{NB.   (\textquotesingle{}z\textquotesingle{};67;1;1) wraplinear cl}

\CommentTok{NB. temporary noun name, line length, ascii85 representation}
\StringTok{\textquotesingle{}temp width ascii85 tablst\textquotesingle{}}\KeywordTok{=.} \DecValTok{4} \KeywordTok{\{.} \KeywordTok{x,}\DecValTok{0}\KeywordTok{;<}\DecValTok{0}

\KeywordTok{if.}\NormalTok{ ascii85 }\KeywordTok{do.}
  \CommentTok{NB. use ASCII85 encoding.  This representation is}
  \CommentTok{NB. about three times more compact than the default}
  \CommentTok{NB. representation but requires roughly three times}
  \CommentTok{NB. the CPU with current algorithms to encode/decode}
\NormalTok{  decoder}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{;}\NormalTok{tablst}\KeywordTok{\{}\StringTok{\textquotesingle{}dec85\textquotesingle{}}\KeywordTok{;}\StringTok{\textquotesingle{}fromascii85\textquotesingle{}}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_\_MK\_\_JODobj 0 :\textquotesingle{}}
\NormalTok{  temp}\KeywordTok{,}\StringTok{\textquotesingle{}=:\textquotesingle{}}\KeywordTok{,}\NormalTok{decoder}\KeywordTok{,}\StringTok{\textquotesingle{} 0\textquotesingle{}}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\StringTok{\textquotesingle{})\textquotesingle{}} \KeywordTok{,\textasciitilde{}}\NormalTok{ toascii85 }\KeywordTok{y}
\KeywordTok{else.}
\NormalTok{  head}\KeywordTok{=.}\NormalTok{ temp}\KeywordTok{,}\StringTok{\textquotesingle{}=:\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}}                \CommentTok{NB. null header}
\NormalTok{  tail}\KeywordTok{=.}\NormalTok{ temp}\KeywordTok{,}\StringTok{\textquotesingle{}=:\textquotesingle{}}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{":\#y}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\{.\textquotesingle{}}\KeywordTok{,}\NormalTok{temp   }\CommentTok{NB. trim to correct length}
\NormalTok{  line}\KeywordTok{=.}\NormalTok{ temp}\KeywordTok{,}\StringTok{\textquotesingle{}=:\textquotesingle{}}\KeywordTok{,}\NormalTok{temp}\KeywordTok{,}\StringTok{\textquotesingle{},\textquotesingle{}}           \CommentTok{NB. next line}

  \CommentTok{NB. wrap text and insure each line is properly quoted}
\NormalTok{  body}\KeywordTok{=.}\NormalTok{ ctl line }\KeywordTok{,"}\DecValTok{1}\NormalTok{ quote}\KeywordTok{"}\DecValTok{1} \RegionMarkerTok{(}\KeywordTok{{-}}\NormalTok{width}\RegionMarkerTok{)} \KeywordTok{]\textbackslash{}} \KeywordTok{y}
\NormalTok{  head}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{body}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{tail}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wrdglobals}\AlertTok{=:}\index{wrdglobals@\texttt{wrdglobals}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*wrdglobals v{-}{-}  extracts names from J  words. Assumes name is}
\CommentTok{NB. valid.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  pa wrdglobals clName}
\CommentTok{NB.}
\CommentTok{NB.  0 wrdglobals \textquotesingle{}wordname\textquotesingle{}  NB. only globals}
\CommentTok{NB.  1 wrdglobals \textquotesingle{}wordname\textquotesingle{}  NB. full name classification}

\NormalTok{code}\KeywordTok{=.}\NormalTok{ jcr }\KeywordTok{::} \KeywordTok{0:} \KeywordTok{y}
\CommentTok{NB. errmsg: no definition}
\KeywordTok{if.}\NormalTok{ code }\KeywordTok{{-}:} \DecValTok{0} \KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR0152}\RegionMarkerTok{)}\KeywordTok{,<y} \KeywordTok{else.} \KeywordTok{x}\NormalTok{ namecats code }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{writeijs}\AlertTok{=:}\index{writeijs@\texttt{writeijs}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*writeijs v{-}{-} writes file to put dictionary directory}
\CommentTok{NB.}
\CommentTok{NB. dyad:  (iaObject ; clFile) writeijs clText}

\StringTok{\textquotesingle{}obj file\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}
\NormalTok{DL}\KeywordTok{=.\{:\{.}\NormalTok{DPATH}\DecValTok{\_\_}\NormalTok{ST}
\CommentTok{NB. get put dictionary script directory}
\NormalTok{path}\KeywordTok{=.}\NormalTok{jpathsep dfp}\DecValTok{\_\_}\NormalTok{DL obj}
\KeywordTok{m=.} \RegionMarkerTok{(}\NormalTok{toHOST }\KeywordTok{y}\RegionMarkerTok{)} \RegionMarkerTok{(}\NormalTok{write }\KeywordTok{::} \KeywordTok{\_1:}\RegionMarkerTok{)}\NormalTok{ path}\KeywordTok{=.}\NormalTok{path}\KeywordTok{,}\NormalTok{file}\KeywordTok{,}\NormalTok{IJS}
\CommentTok{NB. errmsg: file write failure with target path and file appended}
\KeywordTok{if.} \KeywordTok{m} \KeywordTok{{-}:} \DecValTok{\_1} \KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR0153}\RegionMarkerTok{)}\KeywordTok{,<}\NormalTok{path }\KeywordTok{else.} \RegionMarkerTok{(}\NormalTok{ok OK0150}\RegionMarkerTok{)}\KeywordTok{,<}\NormalTok{path }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wttext}\AlertTok{=:}\index{wttext@\texttt{wttext}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*wttext v{-}{-} returns annotated word or test text.}
\CommentTok{NB.}
\CommentTok{NB. This  verb converts dictionary  words and  tests to formatted}
\CommentTok{NB. script   text.  (y)   is   a  boxed   (name,class,value)   or}
\CommentTok{NB. (name,value) table.  The result is either  a single cl script}
\CommentTok{NB. or a btcl of object scripts.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  (paRc ; blcl) =. iaObjExFtab wttext bt}
\CommentTok{NB.        (paRc ; btcl) =. iaObjExFtab wttext bt}

\CommentTok{NB. object code, explanation bit, formatted table bit}
\CommentTok{NB. default table bit is off {-} this verb is frequently}
\CommentTok{NB. called with a two item (x) argument}
\StringTok{\textquotesingle{}obj noex nftab\textquotesingle{}}\KeywordTok{=.} \DecValTok{3}\KeywordTok{\{.x,}\DecValTok{0}

\KeywordTok{if.}\NormalTok{ WORD}\KeywordTok{=}\NormalTok{obj }\KeywordTok{do.}
  \KeywordTok{y=.} \RegionMarkerTok{(}\KeywordTok{/:} \KeywordTok{;} \DecValTok{1} \KeywordTok{\{"}\DecValTok{1} \KeywordTok{y}\RegionMarkerTok{)}\KeywordTok{\{y}      \CommentTok{NB. sort words by name class}
\NormalTok{  nr}\KeywordTok{=.} \RegionMarkerTok{((}\KeywordTok{;} \DecValTok{1} \KeywordTok{\{"}\DecValTok{1} \KeywordTok{y}\RegionMarkerTok{)}\KeywordTok{>}\DecValTok{0}\RegionMarkerTok{)} \KeywordTok{i.} \DecValTok{1}
  \CommentTok{NB. convert noun values to linear representations}
  \KeywordTok{if.}\NormalTok{ badrc m2}\KeywordTok{=.}\NormalTok{ noex nounlrep nr}\KeywordTok{\{.y} \KeywordTok{do.}\NormalTok{ m2 }\KeywordTok{return.} \KeywordTok{end.}
  \KeywordTok{y=.} \RegionMarkerTok{(}\NormalTok{rv m2}\RegionMarkerTok{)} \KeywordTok{,}\NormalTok{ nr}\KeywordTok{\}.y}
\KeywordTok{end.}

\KeywordTok{if.}\NormalTok{ nftab }\KeywordTok{do.}\NormalTok{ nms}\KeywordTok{=.} \DecValTok{0} \KeywordTok{\{"}\DecValTok{1} \KeywordTok{y} \KeywordTok{end.}  \CommentTok{NB. retain sorted names}

\KeywordTok{if.}\NormalTok{ noex }\KeywordTok{do.}
  \CommentTok{NB. no explanations and no LF\textquotesingle{}s depends on caller}
  \KeywordTok{m=.} \RegionMarkerTok{(}\KeywordTok{\#y}\RegionMarkerTok{)}\KeywordTok{\#}\DecValTok{0}
\KeywordTok{elseif.} \KeywordTok{+./m=.} \KeywordTok{{-}.}\NormalTok{LF }\KeywordTok{e.\&>} \KeywordTok{\{:"}\DecValTok{1} \KeywordTok{y} \KeywordTok{do.}
  \CommentTok{NB. prefix any short explanations for single line definitions}
\NormalTok{  m2}\KeywordTok{=.} \KeywordTok{m\#\{."}\DecValTok{1} \KeywordTok{y}
  \KeywordTok{if.}\NormalTok{ badrc et}\KeywordTok{=.}\NormalTok{ obj getexplain}\DecValTok{\_\_}\NormalTok{ST m2 }\KeywordTok{do.}\NormalTok{ et }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{  m2}\KeywordTok{=.} \DecValTok{0}\KeywordTok{<\#\&>}\NormalTok{ et}\KeywordTok{=.} \KeywordTok{\{:"}\DecValTok{1}\NormalTok{ rv et}
\NormalTok{  et}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<"}\DecValTok{0}\NormalTok{ m2}\RegionMarkerTok{)} \KeywordTok{\#\&.>} \RegionMarkerTok{(}\KeywordTok{<}\StringTok{\textquotesingle{}NB. \textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ et }\KeywordTok{,\&.>}\NormalTok{ LF}
  \KeywordTok{y=.} \RegionMarkerTok{(}\NormalTok{et }\KeywordTok{,\&.>} \KeywordTok{m\#\{."}\DecValTok{1} \KeywordTok{y}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{<}\RegionMarkerTok{(}\KeywordTok{I.} \KeywordTok{m}\RegionMarkerTok{)}\KeywordTok{;}\DecValTok{0}\RegionMarkerTok{)}\KeywordTok{\}} \KeywordTok{y}
  \CommentTok{NB. number of LF\textquotesingle{}s between corresponding objects}
  \KeywordTok{m=.} \RegionMarkerTok{(}\KeywordTok{>:}\DecValTok{2}\KeywordTok{*{-}.m}\RegionMarkerTok{)} \KeywordTok{+} \KeywordTok{m} \RegionMarkerTok{(}\KeywordTok{\#\^{}:}\NormalTok{\_}\DecValTok{1}\RegionMarkerTok{)}\NormalTok{ m2}
  \KeywordTok{m=.} \KeywordTok{m} \KeywordTok{+} \DecValTok{2}\KeywordTok{*}\NormalTok{firstone }\DecValTok{1}\KeywordTok{=m}
\KeywordTok{elseif.do.}
  \CommentTok{NB. 3 LF\textquotesingle{}s between all multi{-}line defs HARDCODE}
  \KeywordTok{m=.} \RegionMarkerTok{(}\KeywordTok{\#y}\RegionMarkerTok{)}\KeywordTok{\#}\DecValTok{3}
\KeywordTok{end.}

\CommentTok{NB. construct J object scripts}
\KeywordTok{if.}\NormalTok{ WORD}\KeywordTok{=}\NormalTok{obj }\KeywordTok{do.} \KeywordTok{y=.}\NormalTok{jscriptdefs }\KeywordTok{y} \KeywordTok{else.} \KeywordTok{y=.} \KeywordTok{\{:"}\DecValTok{1} \KeywordTok{y} \KeywordTok{end.}

\CommentTok{NB. return formated (name,script) table or cl script}
\KeywordTok{if.}\NormalTok{ nftab }\KeywordTok{do.}\NormalTok{ ok }\KeywordTok{<}\NormalTok{nms }\KeywordTok{,.} \KeywordTok{y} \KeywordTok{else.}\NormalTok{ ok }\RegionMarkerTok{(}\KeywordTok{\{.m}\RegionMarkerTok{)}\KeywordTok{\}.m}\NormalTok{ jscript }\KeywordTok{y} \KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}
