\section{\texttt{sunmoon} Source Code}

\begin{JODGroupHeader}
\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB.*sunmoon s{-}{-} computes sun rise/set times and full new moon dates.}
\CommentTok{NB.}
\CommentTok{NB. verbatim:}
\CommentTok{NB.}
\CommentTok{NB. interface word(s): }
\CommentTok{NB. {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}                                 }
\CommentTok{NB.  calmoons    {-} calendar dates of new and full moons}
\CommentTok{NB.  moons       {-} times of new and full moons for n calendar years}
\CommentTok{NB.  sunriseset0 {-} computes sun rise and set times {-} see group documentation}
\CommentTok{NB.  sunriseset1 {-} computes sun rise and set times {-} see group documentation                                 }
\CommentTok{NB.                                                         }
\CommentTok{NB. author:  John D. Baker {-}{-} bakerjd99@gmail.com  }
\CommentTok{NB. created: 2010feb12}
\CommentTok{NB. {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\CommentTok{NB. 2010feb12 sunmoon group converted to class}
\CommentTok{NB. 2012oct03 documentation adjusted for (jodliterate)}

\NormalTok{coclass }\StringTok{\textquotesingle{}sunmoon\textquotesingle{}} 

\CommentTok{NB.*end{-}header}
\end{Highlighting}
\end{Shaded}
\end{JODGroupHeader}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. interface words (IFACEWORDSsunmoon) group}
\NormalTok{IFACEWORDSsunmoon}\AlertTok{=:}\index{IFACEWORDSsunmoon@\texttt{IFACEWORDSsunmoon}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} calmoons moons sunriseset0 sunriseset1\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. indicates sun never rises or sets in (sunriseset0) and (sunriseset1) results}
\NormalTok{NORISESET}\AlertTok{=:}\index{NORISESET@\texttt{NORISESET}} \DecValTok{99}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. root words (ROOTWORDSsunmoon) group}
\NormalTok{ROOTWORDSsunmoon}\AlertTok{=:}\index{ROOTWORDSsunmoon@\texttt{ROOTWORDSsunmoon}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} IFACEWORDSsunmoon ROOTWORDSsunmoon calmoons sunriseset0 sunriseset1 today yeardates\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. arc tangent}
\NormalTok{arctan}\AlertTok{=:}\index{arctan@\texttt{arctan}} \DecValTok{\_3}\KeywordTok{\&o.}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\hypertarget{calmoons}{\NormalTok{calmoons}}\AlertTok{=:}\index{calmoons@\texttt{calmoons}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*calmoons v{-}{-} calendar dates of new and full moons. 0\textquotesingle{}s denote}
\CommentTok{NB. new moons and 1\textquotesingle{}s denote full moons.}
\CommentTok{NB.}
\CommentTok{NB. monad:  it =. calmoons ilYears}
\CommentTok{NB.}
\CommentTok{NB.   calmoons 1900 2000}

\CommentTok{NB. compute Julian dates and convert to calendar}
\NormalTok{j}\KeywordTok{=.}\NormalTok{ moons }\KeywordTok{y}
\NormalTok{t}\KeywordTok{=.}\NormalTok{ fromjulian }\KeywordTok{<.} \KeywordTok{\{.}\NormalTok{ j}

\CommentTok{NB. attach new (0) and full (1) bits}
\NormalTok{j}\KeywordTok{=.} \DecValTok{0} \KeywordTok{[}\NormalTok{ t}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{,} \KeywordTok{|:} \KeywordTok{\{:}\NormalTok{ j}\RegionMarkerTok{)} \KeywordTok{,"}\DecValTok{0} \DecValTok{1} \KeywordTok{,/}\NormalTok{ t}

\CommentTok{NB. eliminate year overlap and duplicate dates}
\KeywordTok{\textasciitilde{}.}\NormalTok{ t }\KeywordTok{\#\textasciitilde{}}  \RegionMarkerTok{(}\DecValTok{1} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ t}\RegionMarkerTok{)} \KeywordTok{e.} \KeywordTok{y}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. cosine radians}
\NormalTok{cos}\AlertTok{=:}\index{cos@\texttt{cos}} \DecValTok{2}\KeywordTok{\&o.}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fromjulian}\AlertTok{=:}\index{fromjulian@\texttt{fromjulian}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*fromjulian v{-}{-} converts Julian day numbers to dates, converse}
\CommentTok{NB. (tojulian).}
\CommentTok{NB.}
\CommentTok{NB. monad:  itYYYYMMDD =. fromjulian nlJulian}
\CommentTok{NB.}
\CommentTok{NB.   juldayno=. 1 tojulian 17770704 19530702 20000101 20331225}
\CommentTok{NB.   fromjulian juldayno}
\CommentTok{NB.}
\CommentTok{NB. dyad:  i[1,2]YYYYMMDD =. fromjulian nlJulian}
\CommentTok{NB.}
\CommentTok{NB.   0 fromjulian juldayno   NB. monad}
\CommentTok{NB.   1 fromjulian juldayno}

\DecValTok{0}\NormalTok{ fromjulian }\KeywordTok{y}
\KeywordTok{:}
\CommentTok{NB. Gregorian Calendar correction}
\NormalTok{b}\KeywordTok{=.}      \DecValTok{2299161} \KeywordTok{<:} \KeywordTok{y}
\NormalTok{jalpha}\KeywordTok{=.} \KeywordTok{<.} \DecValTok{36524.25} \KeywordTok{\%\textasciitilde{}} \DecValTok{\_0.25} \KeywordTok{+} \KeywordTok{y} \KeywordTok{{-}} \DecValTok{1867216}
\NormalTok{ja}\KeywordTok{=.}     \RegionMarkerTok{(}\KeywordTok{y} \KeywordTok{*} \KeywordTok{{-}.}\NormalTok{ b}\RegionMarkerTok{)} \KeywordTok{+}\NormalTok{ b }\KeywordTok{*} \KeywordTok{y} \KeywordTok{+} \DecValTok{1} \KeywordTok{+}\NormalTok{ jalpha }\KeywordTok{{-}} \KeywordTok{<.} \DecValTok{0.25} \KeywordTok{*}\NormalTok{ jalpha}

\NormalTok{jb}\KeywordTok{=.}\NormalTok{ ja }\KeywordTok{+} \DecValTok{1524}
\NormalTok{jc}\KeywordTok{=.} \KeywordTok{<.} \DecValTok{6680.0} \KeywordTok{+} \RegionMarkerTok{((}\NormalTok{jb }\KeywordTok{{-}} \DecValTok{2439870}\RegionMarkerTok{)} \KeywordTok{{-}} \DecValTok{122.1}\RegionMarkerTok{)} \KeywordTok{\%} \DecValTok{365.25}
\NormalTok{jd}\KeywordTok{=.} \KeywordTok{<.} \RegionMarkerTok{(}\DecValTok{365} \KeywordTok{*}\NormalTok{ jc}\RegionMarkerTok{)} \KeywordTok{+} \DecValTok{0.25} \KeywordTok{*}\NormalTok{ jc}
\NormalTok{je}\KeywordTok{=.} \KeywordTok{<.} \RegionMarkerTok{(}\NormalTok{jb }\KeywordTok{{-}}\NormalTok{ jd}\RegionMarkerTok{)} \KeywordTok{\%} \DecValTok{30.6001}

\NormalTok{id}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{jb }\KeywordTok{{-}}\NormalTok{ jd}\RegionMarkerTok{)} \KeywordTok{{-}} \KeywordTok{<.} \DecValTok{30.6001} \KeywordTok{*}\NormalTok{ je}
\NormalTok{mm}\KeywordTok{=.}\NormalTok{ je }\KeywordTok{{-}} \DecValTok{1}
\NormalTok{mm}\KeywordTok{=.}\NormalTok{ mm }\KeywordTok{{-}} \DecValTok{12} \KeywordTok{*}\NormalTok{ mm }\KeywordTok{>} \DecValTok{12}

\NormalTok{iyyy}\KeywordTok{=.}\NormalTok{ jc }\KeywordTok{{-}} \DecValTok{4715}
\NormalTok{iyyy}\KeywordTok{=.}\NormalTok{ iyyy }\KeywordTok{{-}}\NormalTok{ mm }\KeywordTok{>} \DecValTok{2}
\NormalTok{iyyy}\KeywordTok{=.}\NormalTok{ iyyy }\KeywordTok{{-}}\NormalTok{ iyyy }\KeywordTok{<:} \DecValTok{0}

\CommentTok{NB. convert result format}
\KeywordTok{if.} \KeywordTok{x} \KeywordTok{do.} \DecValTok{100} \KeywordTok{\#.} \KeywordTok{|:}\NormalTok{ iyyy }\KeywordTok{,}\NormalTok{ mm }\KeywordTok{,:}\NormalTok{ id  }\KeywordTok{else.} \KeywordTok{|:}\NormalTok{ iyyy }\KeywordTok{,}\NormalTok{ mm }\KeywordTok{,:}\NormalTok{ id }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\hypertarget{moons}{\NormalTok{moons}}\AlertTok{=:}\index{moons@\texttt{moons}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*moons v{-}{-} times of new and full moons for n calendar years.}
\CommentTok{NB.}
\CommentTok{NB. The  result  is  rank 3 numeric array  where  (\{.  moons) are}
\CommentTok{NB. Julian day numbers and (\{: moons)  is  a  logical  mask  with}
\CommentTok{NB. (0)\textquotesingle{}s denoting new moons and (1)\textquotesingle{}s denoting full moons.}
\CommentTok{NB.}
\CommentTok{NB. monad:  ftJulian=. moons ilYears}
\CommentTok{NB.}
\CommentTok{NB.        moons 1996 1997 2002}

\CommentTok{NB.  vector J                         scalar Basic}
\KeywordTok{y=.} \KeywordTok{,} \KeywordTok{y}
\NormalTok{r1}\KeywordTok{=.}\NormalTok{ 1r180p1                          }\CommentTok{NB.  R1=3.14159265/180}
\NormalTok{k0}\KeywordTok{=.} \KeywordTok{<.} \DecValTok{12.3685} \KeywordTok{*} \KeywordTok{y} \KeywordTok{{-}} \DecValTok{1900}            \CommentTok{NB.  K0=INT((Y{-}1900)*12.3685)}
\NormalTok{t}\KeywordTok{=.}  \RegionMarkerTok{(}\KeywordTok{y} \KeywordTok{{-}} \DecValTok{1899.5}\RegionMarkerTok{)} \KeywordTok{\%} \DecValTok{100}               \CommentTok{NB.  T=(Y{-}1899.5)/100}
\NormalTok{t2}\KeywordTok{=.} \KeywordTok{*:}\NormalTok{ t }\KeywordTok{[}\NormalTok{ t3}\KeywordTok{=.}\NormalTok{ t}\KeywordTok{\^{}}\DecValTok{3}                  \CommentTok{NB.  T2=T*T: T3=T*T*T}
\NormalTok{j0}\KeywordTok{=.} \DecValTok{2415020} \KeywordTok{+} \DecValTok{29} \KeywordTok{*}\NormalTok{ k0                }\CommentTok{NB.  J0=2415020+29*K0}
\NormalTok{f0}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{0.0001178}\KeywordTok{*}\NormalTok{t2}\RegionMarkerTok{)} \KeywordTok{{-}} \DecValTok{0.000000155}\KeywordTok{*}\NormalTok{t3  }\CommentTok{NB.  F0=0.0001178*T2{-}0.000000155*T3}
\NormalTok{f0}\KeywordTok{=.}\NormalTok{ f0 }\KeywordTok{+} \DecValTok{0.75933} \KeywordTok{+} \DecValTok{0.53058868}\KeywordTok{*}\NormalTok{k0     }\CommentTok{NB.  F0=F0+0.75933+0.53058868*K0}
\NormalTok{f0}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{f0}\KeywordTok{{-}}\RegionMarkerTok{(}\DecValTok{0.000837}\KeywordTok{*}\NormalTok{t}\RegionMarkerTok{))}\KeywordTok{{-}}\DecValTok{0.000335}\KeywordTok{*}\NormalTok{t2    }\CommentTok{NB.  F0=F0{-}0.000837*T{-}0.000335*T2}
\NormalTok{m0}\KeywordTok{=.}\NormalTok{ k0 }\KeywordTok{*} \DecValTok{0.08084821133}               \CommentTok{NB.  M0=K0*0.08084821133}
\NormalTok{m0}\KeywordTok{=.} \DecValTok{359.2242} \KeywordTok{+} \DecValTok{360} \KeywordTok{*} \DecValTok{1} \KeywordTok{|}\NormalTok{ m0          }\CommentTok{NB.  M0=360*(M0{-}INT(M0))+359.2242}
\NormalTok{m0}\KeywordTok{=.}\NormalTok{ m0 }\KeywordTok{{-}} \DecValTok{0.0000333}\KeywordTok{*}\NormalTok{t2                }\CommentTok{NB.  M0=M0{-}0.0000333*T2}
\NormalTok{m0}\KeywordTok{=.}\NormalTok{ m0 }\KeywordTok{{-}} \DecValTok{0.00000347}\KeywordTok{*}\NormalTok{t3               }\CommentTok{NB.  M0=M0{-}0.00000347*T3}
\NormalTok{m1}\KeywordTok{=.}\NormalTok{ k0 }\KeywordTok{*} \DecValTok{0.07171366128}               \CommentTok{NB.  M1=K0*0.07171366128}
\NormalTok{m1}\KeywordTok{=.} \DecValTok{306.0253} \KeywordTok{+} \DecValTok{360} \KeywordTok{*} \DecValTok{1} \KeywordTok{|}\NormalTok{ m1          }\CommentTok{NB.  M1=360*(M1{-}INT(M1))+306.0253}
\NormalTok{m1}\KeywordTok{=.}\NormalTok{ m1 }\KeywordTok{+} \DecValTok{0.0107306}\KeywordTok{*}\NormalTok{t2                }\CommentTok{NB.  M1=M1+0.0107306*T2}
\NormalTok{m1}\KeywordTok{=.}\NormalTok{ m1 }\KeywordTok{+} \DecValTok{0.00001236}\KeywordTok{*}\NormalTok{t3               }\CommentTok{NB.  M1=M1+0.00001236*T3}
\NormalTok{b1}\KeywordTok{=.}\NormalTok{ k0 }\KeywordTok{*} \DecValTok{0.08519585128}               \CommentTok{NB.  B1=K0*0.08519585128}
\NormalTok{b1}\KeywordTok{=.} \DecValTok{21.2964} \KeywordTok{+} \DecValTok{360} \KeywordTok{*} \DecValTok{1} \KeywordTok{|}\NormalTok{ b1           }\CommentTok{NB.  B1=360*(B1{-}INT(B1))+21.2964}
\NormalTok{b1}\KeywordTok{=.}\NormalTok{ b1 }\KeywordTok{{-}} \DecValTok{0.0016528}\KeywordTok{*}\NormalTok{t2                }\CommentTok{NB.  B1=B1{-}0.0016528*T2}
\NormalTok{b1}\KeywordTok{=.}\NormalTok{ b1 }\KeywordTok{{-}} \DecValTok{0.00000239}\KeywordTok{*}\NormalTok{t3               }\CommentTok{NB.  B1=B1{-}0.00000239*T3}

\CommentTok{NB. rank conjuntion vectorizes BASIC loop}
\NormalTok{k9}\KeywordTok{=.} \KeywordTok{i.} \DecValTok{29}                            \CommentTok{NB.  FOR K9=0 TO 28}
\NormalTok{j}\KeywordTok{=.}\NormalTok{  j0 }\KeywordTok{+"}\DecValTok{1} \DecValTok{0} \KeywordTok{]} \DecValTok{14}\KeywordTok{*}\NormalTok{k9                 }\CommentTok{NB.  J=J0+14*K9}
\NormalTok{f}\KeywordTok{=.}\NormalTok{  f0 }\KeywordTok{+"}\DecValTok{1} \DecValTok{0} \KeywordTok{]} \DecValTok{0.765294}\KeywordTok{*}\NormalTok{k9           }\CommentTok{NB.  F=F0+0.765294*K9}
\NormalTok{k}\KeywordTok{=.}\NormalTok{  k9 }\KeywordTok{\%} \DecValTok{2}                           \CommentTok{NB.  K=K9/2}
\NormalTok{m5}\KeywordTok{=.}\NormalTok{ r1 }\KeywordTok{*}\NormalTok{ m0 }\KeywordTok{+"}\DecValTok{1} \DecValTok{0}\NormalTok{ k}\KeywordTok{*}\DecValTok{29.10535608}      \CommentTok{NB.  M5=(M0+K*29.10535608)*R1}
\NormalTok{m6}\KeywordTok{=.}\NormalTok{ r1 }\KeywordTok{*}\NormalTok{ m1 }\KeywordTok{+"}\DecValTok{1} \DecValTok{0}\NormalTok{ k}\KeywordTok{*}\DecValTok{385.81691806}     \CommentTok{NB.  M6=(M1+K*385.81691806)*R1}
\NormalTok{b6}\KeywordTok{=.}\NormalTok{ r1 }\KeywordTok{*}\NormalTok{ b1 }\KeywordTok{+"}\DecValTok{1} \DecValTok{0}\NormalTok{ k}\KeywordTok{*}\DecValTok{390.67050646}     \CommentTok{NB.  B6=(B1+K*390.67050646)*R1}
\NormalTok{f}\KeywordTok{=.}\NormalTok{  f }\KeywordTok{{-}} \DecValTok{0.4068} \KeywordTok{*}\NormalTok{ sin m6              }\CommentTok{NB.  F=F{-}0.4068*SIN(M6)}
\NormalTok{f}\KeywordTok{=.}\NormalTok{  f }\KeywordTok{+} \RegionMarkerTok{(}\DecValTok{0.1734} \KeywordTok{{-}} \DecValTok{0.000393}\KeywordTok{*}\NormalTok{t}\RegionMarkerTok{)} \KeywordTok{*"}\DecValTok{1} \DecValTok{1}\NormalTok{ sin m5   }\CommentTok{NB. F=F+(0.1734{-}0.000393*T)*SIN(M5)}
\NormalTok{f}\KeywordTok{=.}\NormalTok{  f }\KeywordTok{+} \DecValTok{0.0161} \KeywordTok{*}\NormalTok{ sin }\DecValTok{2}\KeywordTok{*}\NormalTok{m6            }\CommentTok{NB.  F=F+0.0161*SIN(2*M6)}
\NormalTok{f}\KeywordTok{=.}\NormalTok{  f }\KeywordTok{+} \DecValTok{0.0104} \KeywordTok{*}\NormalTok{ sin }\DecValTok{2}\KeywordTok{*}\NormalTok{b6            }\CommentTok{NB.  F=F+0.0104*SIN(2*B6)}
\NormalTok{f}\KeywordTok{=.}\NormalTok{  f }\KeywordTok{{-}} \DecValTok{0.0074} \KeywordTok{*}\NormalTok{ sin m5}\KeywordTok{{-}}\NormalTok{m6           }\CommentTok{NB.  F=F{-}0.0074*SIN(M5{-}M6)}
\NormalTok{f}\KeywordTok{=.}\NormalTok{  f }\KeywordTok{{-}} \DecValTok{0.0051} \KeywordTok{*}\NormalTok{ sin m5}\KeywordTok{+}\NormalTok{m6           }\CommentTok{NB.  F=F{-}0.0051*SIN(M5+M6)}
\NormalTok{f}\KeywordTok{=.}\NormalTok{  f }\KeywordTok{+} \DecValTok{0.0021} \KeywordTok{*}\NormalTok{ sin }\DecValTok{2}\KeywordTok{*}\NormalTok{m5            }\CommentTok{NB.  F=F+0.0021*SIN(2*M5)}
\NormalTok{f}\KeywordTok{=.}\NormalTok{  f }\KeywordTok{+} \DecValTok{0.0010} \KeywordTok{*}\NormalTok{ sin m6 }\KeywordTok{{-}\textasciitilde{}} \DecValTok{2}\KeywordTok{*}\NormalTok{b6      }\CommentTok{NB.  F=F+0.0010*SIN(2*B6{-}M6)}
\NormalTok{j}\KeywordTok{=.}\NormalTok{  j }\KeywordTok{+}\NormalTok{ f                            }\CommentTok{NB.  J=J+INT(F): F=F{-}INT(F)}
\KeywordTok{u=.}  \DecValTok{0} \DecValTok{1} \KeywordTok{$\textasciitilde{}} \KeywordTok{\#}\NormalTok{ k9                      }\CommentTok{NB. IF U=0 THEN PRINT " NEW MOON ";}
\NormalTok{j }\KeywordTok{,:} \KeywordTok{|:} \RegionMarkerTok{(}\KeywordTok{\#y}\RegionMarkerTok{)} \KeywordTok{\#} \KeywordTok{,:} \KeywordTok{u}                   \CommentTok{NB. IF U=1 THEN PRINT "FULL MOON ";}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. round (y) to nearest (x) (e.g. 1000 round 12345)}
\NormalTok{round}\AlertTok{=:}\index{round@\texttt{round}} \KeywordTok{[} \KeywordTok{*} \KeywordTok{[:} \RegionMarkerTok{(}\KeywordTok{<.}\RegionMarkerTok{)} \DecValTok{0.5} \KeywordTok{+} \KeywordTok{\%\textasciitilde{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. sine radians}
\NormalTok{sin}\AlertTok{=:}\index{sin@\texttt{sin}} \DecValTok{1}\KeywordTok{\&o.}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\hypertarget{sunriseset0}{\NormalTok{sunriseset0}}\AlertTok{=:}\index{sunriseset0@\texttt{sunriseset0}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*sunriseset0 v{-}{-} computes sun rise and set times {-} see group documentation.}
\CommentTok{NB.}
\CommentTok{NB. monad:  itHM =. sunriseset0 ilBLHMD | ftBLHMD}

\CommentTok{NB. latitude, longitude, time{-}zone, month, day !(*)=. b l h m d}
\KeywordTok{y=.} \KeywordTok{\#}\NormalTok{ b }\KeywordTok{[} \StringTok{\textquotesingle{}b l h m d\textquotesingle{}}\KeywordTok{=.} \KeywordTok{|:}\NormalTok{ tabit }\KeywordTok{y}
\NormalTok{b}\KeywordTok{=.}\NormalTok{ dr }\KeywordTok{*}\NormalTok{ b }\KeywordTok{[}\NormalTok{ rd }\KeywordTok{=.} \KeywordTok{\%}\NormalTok{ dr}\KeywordTok{=.}\NormalTok{ 1r180p1}

\CommentTok{NB. day number within year}
\KeywordTok{n=.} \DecValTok{\_30} \KeywordTok{+}\NormalTok{ d }\KeywordTok{+} \RegionMarkerTok{(}\KeywordTok{<.}\DecValTok{9} \KeywordTok{\%\textasciitilde{}} \DecValTok{275} \KeywordTok{*} \KeywordTok{m}\RegionMarkerTok{)} \KeywordTok{{-}} \DecValTok{2} \KeywordTok{*} \KeywordTok{<.} \DecValTok{12} \KeywordTok{\%\textasciitilde{}} \KeywordTok{m} \KeywordTok{+} \DecValTok{9}

\CommentTok{NB. sun\textquotesingle{}s mean longitude}
\NormalTok{lg0}\KeywordTok{=.} \DecValTok{4.8771} \KeywordTok{+} \DecValTok{0.0172} \KeywordTok{*} \RegionMarkerTok{(}\KeywordTok{n} \KeywordTok{+} \DecValTok{0.5}\RegionMarkerTok{)} \KeywordTok{{-}}\NormalTok{ l }\KeywordTok{\%} \DecValTok{360}

\CommentTok{NB. equation of time}
\NormalTok{c}\KeywordTok{=.} \DecValTok{0.03342} \KeywordTok{*}\NormalTok{ sin lg0 }\KeywordTok{+} \DecValTok{1.345}
\NormalTok{c2}\KeywordTok{=.}\NormalTok{ rd }\KeywordTok{*}\NormalTok{ c }\KeywordTok{{-}\textasciitilde{}} \RegionMarkerTok{(}\NormalTok{arctan tan lg0 }\KeywordTok{+}\NormalTok{ c}\RegionMarkerTok{)} \KeywordTok{{-}}\NormalTok{ arctan }\DecValTok{0.9175} \KeywordTok{*}\NormalTok{ tan lg0 }\KeywordTok{+}\NormalTok{ c}
\NormalTok{cd}\KeywordTok{=.} \KeywordTok{\%:} \DecValTok{1} \KeywordTok{{-}} \KeywordTok{*:}\NormalTok{ sd}\KeywordTok{=.} \DecValTok{0.3978} \KeywordTok{*}\NormalTok{ sin lg0 }\KeywordTok{+}\NormalTok{ c}
\NormalTok{sc}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{0.0145} \KeywordTok{+}\NormalTok{ sd }\KeywordTok{*}\NormalTok{ sin b}\RegionMarkerTok{)} \KeywordTok{\%}\NormalTok{ cd }\KeywordTok{*}\NormalTok{ cos b}

\CommentTok{NB. to handle the three cases enmass without redundant calculations}
\CommentTok{NB. a boolean table is computed.  1\textquotesingle{}s in each row satisfy a case.}
\NormalTok{items}\KeywordTok{=.} \KeywordTok{i.} \KeywordTok{\#}\NormalTok{sc }\KeywordTok{[}\NormalTok{ cases}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<\&}\NormalTok{\_}\DecValTok{1} \KeywordTok{,} \DecValTok{1}\KeywordTok{\&>:@|} \KeywordTok{,:} \DecValTok{1}\KeywordTok{\&<}\RegionMarkerTok{)}\NormalTok{ sc}

\CommentTok{NB. set result table to sun never sets}
\NormalTok{hrmn}\KeywordTok{=.} \KeywordTok{|:} \RegionMarkerTok{(}\KeywordTok{y} \KeywordTok{,} \DecValTok{4}\RegionMarkerTok{)}\KeywordTok{$}\NormalTok{ NORISESET }\KeywordTok{,} \DecValTok{1} \DecValTok{0} \DecValTok{0}

\CommentTok{NB. adjust for the sun\textquotesingle{}s declination and atmospheric refraction}
\NormalTok{pos}\KeywordTok{=.}\NormalTok{ items }\KeywordTok{\#\textasciitilde{}} \DecValTok{1} \KeywordTok{\{}\NormalTok{ cases}
\NormalTok{c3}\KeywordTok{=.}\NormalTok{ rd }\KeywordTok{*}\NormalTok{ arctan }\RegionMarkerTok{(}\NormalTok{pos}\KeywordTok{\{}\NormalTok{sc}\RegionMarkerTok{)} \KeywordTok{\%} \KeywordTok{\%:} \DecValTok{1} \KeywordTok{{-}} \KeywordTok{*:}\NormalTok{ pos}\KeywordTok{\{}\NormalTok{sc}
\NormalTok{lc}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{pos}\KeywordTok{\{}\NormalTok{l}\RegionMarkerTok{)} \KeywordTok{+}\NormalTok{ pos}\KeywordTok{\{}\NormalTok{c2}

\CommentTok{NB. time zone adjusted sunrise times}
\NormalTok{st}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{6} \KeywordTok{{-}}\NormalTok{ pos}\KeywordTok{\{}\NormalTok{h}\RegionMarkerTok{)} \KeywordTok{{-}} \RegionMarkerTok{(}\NormalTok{lc }\KeywordTok{+}\NormalTok{ c3}\RegionMarkerTok{)} \KeywordTok{\%} \DecValTok{15}
\NormalTok{mn}\KeywordTok{=.} \KeywordTok{<.}\RegionMarkerTok{(}\NormalTok{st }\KeywordTok{{-}}\NormalTok{ hr}\RegionMarkerTok{)} \KeywordTok{*} \DecValTok{60} \KeywordTok{[}\NormalTok{ hr}\KeywordTok{=.} \KeywordTok{<.}\NormalTok{ st}
\NormalTok{hrmn}\KeywordTok{=.}\NormalTok{ hr }\RegionMarkerTok{(}\KeywordTok{<}\DecValTok{0}\KeywordTok{;}\NormalTok{pos}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ hrmn}
\NormalTok{hrmn}\KeywordTok{=.}\NormalTok{ mn }\RegionMarkerTok{(}\KeywordTok{<}\DecValTok{1}\KeywordTok{;}\NormalTok{pos}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ hrmn}

\CommentTok{NB. time zone adjusted sunset times}
\NormalTok{st}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{18} \KeywordTok{{-}}\NormalTok{ pos}\KeywordTok{\{}\NormalTok{h}\RegionMarkerTok{)} \KeywordTok{{-}} \RegionMarkerTok{(}\NormalTok{lc }\KeywordTok{{-}}\NormalTok{ c3}\RegionMarkerTok{)} \KeywordTok{\%} \DecValTok{15}
\NormalTok{mn}\KeywordTok{=.} \KeywordTok{<.}\RegionMarkerTok{(}\NormalTok{st }\KeywordTok{{-}}\NormalTok{ hr}\RegionMarkerTok{)} \KeywordTok{*} \DecValTok{60} \KeywordTok{[}\NormalTok{ hr}\KeywordTok{=.} \KeywordTok{<.}\NormalTok{ st}
\NormalTok{hrmn}\KeywordTok{=.}\NormalTok{ hr }\RegionMarkerTok{(}\KeywordTok{<}\DecValTok{2}\KeywordTok{;}\NormalTok{pos}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ hrmn}
\NormalTok{hrmn}\KeywordTok{=.}\NormalTok{ mn }\RegionMarkerTok{(}\KeywordTok{<}\DecValTok{3}\KeywordTok{;}\NormalTok{pos}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ hrmn}

\CommentTok{NB. sun never rises and result table with rows hr,mr,hs,ms}
\NormalTok{pos}\KeywordTok{=.}\NormalTok{ items }\KeywordTok{\#\textasciitilde{}} \DecValTok{0} \KeywordTok{\{}\NormalTok{cases}
\DecValTok{0} \RegionMarkerTok{(}\KeywordTok{<}\DecValTok{1}\KeywordTok{;}\NormalTok{pos}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ hrmn}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\hypertarget{sunriseset1}{\NormalTok{sunriseset1}}\AlertTok{=:}\index{sunriseset1@\texttt{sunriseset1}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*sunriseset1 v{-}{-} computes sun rise and set times {-} see group documentation.}
\CommentTok{NB.}
\CommentTok{NB. monad:  itHM =. sunriseset1 flBLHMDY | ftBHMDY}

\CommentTok{NB. latitude, longitude, time{-}zone, month, day, year !(*)=. la lo tz m d y}
\KeywordTok{y=.} \KeywordTok{\#}\NormalTok{ la }\KeywordTok{[} \StringTok{\textquotesingle{}la lo tz m d y\textquotesingle{}}\KeywordTok{=.} \KeywordTok{|:}\NormalTok{ tabit }\KeywordTok{y}
\NormalTok{dr}\KeywordTok{=.}\NormalTok{ 1r180p1 }\KeywordTok{[}\NormalTok{ dd}\KeywordTok{=.} \DecValTok{360} \KeywordTok{\%} \DecValTok{365.25636} \KeywordTok{[}\NormalTok{ rt}\KeywordTok{=.} \DecValTok{50r60}

\CommentTok{NB. days into year with leap year adjustment}
\NormalTok{dm}\KeywordTok{=.} \DecValTok{0} \DecValTok{31} \DecValTok{59} \DecValTok{90} \DecValTok{120} \DecValTok{151} \DecValTok{181} \DecValTok{212} \DecValTok{243} \DecValTok{273} \DecValTok{304} \DecValTok{334}
\NormalTok{dl}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{2} \KeywordTok{\{.}\NormalTok{ dm}\RegionMarkerTok{)} \KeywordTok{,} \KeywordTok{>:} \DecValTok{2} \KeywordTok{\}.}\NormalTok{ dm}
\NormalTok{bl}\KeywordTok{=.} \DecValTok{0} \KeywordTok{=} \DecValTok{4} \KeywordTok{|} \KeywordTok{y} \KeywordTok{[} \KeywordTok{m=.} \KeywordTok{<:} \KeywordTok{m}
\NormalTok{dy}\KeywordTok{=.}\NormalTok{ d }\KeywordTok{+} \RegionMarkerTok{((}\KeywordTok{{-}.}\NormalTok{bl}\RegionMarkerTok{)} \KeywordTok{*} \KeywordTok{m} \KeywordTok{\{}\NormalTok{ dm}\RegionMarkerTok{)} \KeywordTok{+}\NormalTok{ bl }\KeywordTok{*} \KeywordTok{m} \KeywordTok{\{}\NormalTok{ dl}
\NormalTok{dy}\KeywordTok{=.} \DecValTok{0.5} \KeywordTok{+}\NormalTok{ dy }\KeywordTok{{-}}\NormalTok{ lo }\KeywordTok{\%} \DecValTok{360}

\CommentTok{NB. (th) angle Earth has moved since winter solstice}
\NormalTok{th}\KeywordTok{=.} \DecValTok{9.357001} \KeywordTok{+} \RegionMarkerTok{(}\NormalTok{dd }\KeywordTok{*}\NormalTok{ dy}\RegionMarkerTok{)} \KeywordTok{+} \DecValTok{1.914} \KeywordTok{*}\NormalTok{ sin dr }\KeywordTok{*} \RegionMarkerTok{(}\NormalTok{dd }\KeywordTok{*}\NormalTok{ dy}\RegionMarkerTok{)} \KeywordTok{{-}} \DecValTok{3.97}
\NormalTok{c3}\KeywordTok{=.} \DecValTok{0.3978} \KeywordTok{*}\NormalTok{ cos dr }\KeywordTok{*}\NormalTok{ th}
\NormalTok{dc}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{{-}} \KeywordTok{\%}\NormalTok{ dr}\RegionMarkerTok{)} \KeywordTok{*}\NormalTok{ arctan c3 }\KeywordTok{\%} \KeywordTok{\%:} \DecValTok{1} \KeywordTok{{-}}\NormalTok{ c3 }\KeywordTok{\^{}} \DecValTok{2}

\CommentTok{NB. adjust for positive and negative latitudes}
\NormalTok{bl}\KeywordTok{=.}\NormalTok{ la }\KeywordTok{<} \DecValTok{0}
\NormalTok{a1}\KeywordTok{=.} \RegionMarkerTok{((}\KeywordTok{{-}.}\NormalTok{bl}\RegionMarkerTok{)} \KeywordTok{*} \RegionMarkerTok{(}\DecValTok{90} \KeywordTok{{-}}\NormalTok{ la}\RegionMarkerTok{)} \KeywordTok{+}\NormalTok{ dc}\RegionMarkerTok{)} \KeywordTok{+}\NormalTok{ bl }\KeywordTok{*} \RegionMarkerTok{(}\DecValTok{90} \KeywordTok{+}\NormalTok{ la}\RegionMarkerTok{)} \KeywordTok{{-}}\NormalTok{ dc}
\NormalTok{a2}\KeywordTok{=.} \RegionMarkerTok{((}\KeywordTok{{-}.}\NormalTok{bl}\RegionMarkerTok{)} \KeywordTok{*} \RegionMarkerTok{(}\NormalTok{la }\KeywordTok{{-}} \DecValTok{90}\RegionMarkerTok{)} \KeywordTok{+}\NormalTok{ dc}\RegionMarkerTok{)} \KeywordTok{+}\NormalTok{ bl }\KeywordTok{*} \RegionMarkerTok{(}\NormalTok{\_}\DecValTok{90} \KeywordTok{{-}}\NormalTok{ la}\RegionMarkerTok{)} \KeywordTok{{-}}\NormalTok{ dc}

\CommentTok{NB. sun never rises or sets masks}
\NormalTok{nvset }\KeywordTok{=.}\NormalTok{ a2 }\KeywordTok{>:} \KeywordTok{{-}}\NormalTok{ rt }\KeywordTok{[}\NormalTok{ nvrise}\KeywordTok{=.}\NormalTok{ a1 }\KeywordTok{<} \KeywordTok{{-}}\NormalTok{ rt}

\CommentTok{NB. corrections}
\NormalTok{drla}\KeywordTok{=.}\NormalTok{ dr }\KeywordTok{*}\NormalTok{ la   }\KeywordTok{[}\NormalTok{ drdc}\KeywordTok{=.}\NormalTok{ dr }\KeywordTok{*}\NormalTok{ dc}
\NormalTok{c1}\KeywordTok{=.} \RegionMarkerTok{((}\NormalTok{sin }\KeywordTok{{-}}\NormalTok{ dr }\KeywordTok{*}\NormalTok{ rt}\RegionMarkerTok{)} \KeywordTok{{-}} \RegionMarkerTok{(}\NormalTok{sin drdc}\RegionMarkerTok{)} \KeywordTok{*}\NormalTok{ sin drla}\RegionMarkerTok{)} \KeywordTok{\%} \RegionMarkerTok{(}\NormalTok{cos drdc}\RegionMarkerTok{)} \KeywordTok{*}\NormalTok{ cos drla}
\NormalTok{t2}\KeywordTok{=.}\NormalTok{ dr }\KeywordTok{\%\textasciitilde{}}\NormalTok{ arctan }\RegionMarkerTok{(}\KeywordTok{\%:} \DecValTok{1} \KeywordTok{{-}}\NormalTok{ c1 }\KeywordTok{\^{}} \DecValTok{2}\RegionMarkerTok{)} \KeywordTok{\%}\NormalTok{ c1}
\NormalTok{t1}\KeywordTok{=.} \DecValTok{360} \KeywordTok{{-}}\NormalTok{ t2 }\KeywordTok{[}\NormalTok{ bl}\KeywordTok{=.}\NormalTok{ c1 }\KeywordTok{<} \DecValTok{0}
\NormalTok{t2}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{t2 }\KeywordTok{*} \KeywordTok{{-}.}\NormalTok{bl}\RegionMarkerTok{)} \KeywordTok{+}\NormalTok{ bl }\KeywordTok{*} \DecValTok{180} \KeywordTok{+}\NormalTok{ t2}
\NormalTok{t1}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{t1 }\KeywordTok{*} \KeywordTok{{-}.}\NormalTok{bl}\RegionMarkerTok{)} \KeywordTok{+}\NormalTok{ bl }\KeywordTok{*} \DecValTok{360} \KeywordTok{{-}}\NormalTok{ t2}

\CommentTok{NB. first order equation of time}
\NormalTok{et}\KeywordTok{=.} \DecValTok{0.1511} \KeywordTok{*}\NormalTok{ sin dr }\KeywordTok{*} \DecValTok{17.86} \KeywordTok{+} \DecValTok{2} \KeywordTok{*}\NormalTok{ dddy}\KeywordTok{=.}\NormalTok{ dd }\KeywordTok{*}\NormalTok{ dy}
\NormalTok{et}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{\_}\DecValTok{0.1276} \KeywordTok{*}\NormalTok{ sin dr }\KeywordTok{*}\NormalTok{ dddy }\KeywordTok{{-}} \DecValTok{3.97}\RegionMarkerTok{)} \KeywordTok{{-}}\NormalTok{ et}
\NormalTok{drla}\KeywordTok{=.}\NormalTok{ drdc}\KeywordTok{=.}\NormalTok{ dddy}\KeywordTok{=.} \DecValTok{0}

\CommentTok{NB. time zone adjusted rise and set times}
\NormalTok{tr}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{t1 }\KeywordTok{\%} \DecValTok{15}\RegionMarkerTok{)} \KeywordTok{{-}} \DecValTok{12} \KeywordTok{[}\NormalTok{ ts}\KeywordTok{=.}\NormalTok{ t2 }\KeywordTok{\%} \DecValTok{15}
\NormalTok{tr}\KeywordTok{=.}\NormalTok{ tr }\KeywordTok{{-}}\NormalTok{ et }\KeywordTok{[}\NormalTok{ ts}\KeywordTok{=.}\NormalTok{ ts }\KeywordTok{{-}}\NormalTok{ et}
\NormalTok{s}\KeywordTok{=.}\NormalTok{ ts }\KeywordTok{+}\NormalTok{ tc }\KeywordTok{[}\NormalTok{ r}\KeywordTok{=.}\NormalTok{tr }\KeywordTok{+}\NormalTok{ tc }\KeywordTok{[}\NormalTok{ tc}\KeywordTok{=.}\RegionMarkerTok{(}\KeywordTok{{-}}\NormalTok{tz}\RegionMarkerTok{)} \KeywordTok{{-}}\NormalTok{ lo }\KeywordTok{\%} \DecValTok{15}
\NormalTok{hrmn}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<.}\NormalTok{ r}\RegionMarkerTok{)} \KeywordTok{,:} \DecValTok{1}\NormalTok{ round }\DecValTok{60} \KeywordTok{*} \DecValTok{1}\KeywordTok{|}\NormalTok{r}
\NormalTok{hrmn}\KeywordTok{=.}\NormalTok{ hrmn }\KeywordTok{,} \RegionMarkerTok{(}\KeywordTok{<.}\DecValTok{12} \KeywordTok{+}\NormalTok{ s}\RegionMarkerTok{)} \KeywordTok{,:} \DecValTok{1}\NormalTok{ round }\DecValTok{60} \KeywordTok{*} \DecValTok{1}\KeywordTok{|}\NormalTok{s}

\CommentTok{NB. adjust for when sun never rises or sets}
\NormalTok{hrmn}\KeywordTok{=.}\NormalTok{ hrmn }\KeywordTok{*"}\DecValTok{1} \KeywordTok{{-}.}\NormalTok{ bl }\KeywordTok{[}\NormalTok{ bl}\KeywordTok{=.}\NormalTok{ nvset }\KeywordTok{+.}\NormalTok{ nvrise}
\NormalTok{hrmn}\KeywordTok{=.}\NormalTok{ NORISESET }\RegionMarkerTok{(}\KeywordTok{<}\DecValTok{0}\KeywordTok{;}\NormalTok{bl }\KeywordTok{\#}\NormalTok{ pos}\RegionMarkerTok{)} \KeywordTok{\}}\NormalTok{ hrmn }\KeywordTok{[}\NormalTok{ pos}\KeywordTok{=.} \KeywordTok{i.} \KeywordTok{\{:} \KeywordTok{$}\NormalTok{ hrmn}
\DecValTok{1} \RegionMarkerTok{(}\KeywordTok{<}\DecValTok{1}\KeywordTok{;}\NormalTok{nvset }\KeywordTok{\#}\NormalTok{ pos}\RegionMarkerTok{)} \KeywordTok{\}}\NormalTok{ hrmn}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. promotes only atoms and lists to tables}
\NormalTok{tabit}\AlertTok{=:}\index{tabit@\texttt{tabit}} \KeywordTok{]\textasciigrave{},:@.}\RegionMarkerTok{(}\DecValTok{1}\KeywordTok{\&>:@}\RegionMarkerTok{(}\KeywordTok{\#@$}\RegionMarkerTok{))}\KeywordTok{\^{}:}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. tan radians}
\NormalTok{tan}\AlertTok{=:}\index{tan@\texttt{tan}} \DecValTok{3}\KeywordTok{\&o.}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{today}\AlertTok{=:}\index{today@\texttt{today}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*today v{-}{-} returns todays date.}
\CommentTok{NB.}
\CommentTok{NB. monad:  ilYYYYMMDD =. today uu}
\CommentTok{NB.}
\CommentTok{NB.   today 0    NB. ignores argument}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaYYYYMMDD =. uu today uu}
\CommentTok{NB.}
\CommentTok{NB.   0 today 0}

\DecValTok{3}\KeywordTok{\&\{.@}\RegionMarkerTok{(}\DecValTok{6}\KeywordTok{!:}\DecValTok{0}\RegionMarkerTok{)} \StringTok{\textquotesingle{}\textquotesingle{}}
\KeywordTok{:}
\DecValTok{0} \DecValTok{100} \DecValTok{100} \KeywordTok{\#.} \KeywordTok{<.} \DecValTok{3}\KeywordTok{\&\{.@}\RegionMarkerTok{(}\DecValTok{6}\KeywordTok{!:}\DecValTok{0}\RegionMarkerTok{)} \StringTok{\textquotesingle{}\textquotesingle{}}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{yeardates}\AlertTok{=:}\index{yeardates@\texttt{yeardates}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*yeardates v{-}{-} returns all valid dates for n calendar years.}
\CommentTok{NB.}
\CommentTok{NB. The monad returns an integer table with YYYY MM DD rows.  The}
\CommentTok{NB. dyad returns dates as a list of YYYYMMDD integers.}
\CommentTok{NB.}
\CommentTok{NB. This algorithm  uses  a  series of outer{-}products  and  ravel}
\CommentTok{NB. reductions to form a cross  product rather  than  the  direct}
\CommentTok{NB. catalog verb (\{).}
\CommentTok{NB.}
\CommentTok{NB. monad:  itYYYYMMDD =. yeardates ilYears}
\CommentTok{NB.}
\CommentTok{NB.   yeardates 2000}
\CommentTok{NB.}
\CommentTok{NB.   yeardates 2001 + i. 100  NB. all dates in 21st century}
\CommentTok{NB.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  ilYYYYMMDD =. uu yeardates ilYears}
\CommentTok{NB.}
\CommentTok{NB.   0 yeardates 2001}
\CommentTok{NB.}
\CommentTok{NB.   yeardates\textasciitilde{}  1999 2000 2001   NB. useful idiom}

\CommentTok{NB. generate all possible dates in years}
\NormalTok{days }\KeywordTok{=.} \KeywordTok{,/} \RegionMarkerTok{(}\KeywordTok{,y}\RegionMarkerTok{)} \KeywordTok{,"}\DecValTok{0} \DecValTok{1}\KeywordTok{/} \KeywordTok{,/} \RegionMarkerTok{(}\KeywordTok{>:} \KeywordTok{i.} \DecValTok{12}\RegionMarkerTok{)} \KeywordTok{,"}\DecValTok{0}\KeywordTok{/} \KeywordTok{>:} \KeywordTok{i.} \DecValTok{31}

\CommentTok{NB. remove invalid dates}
\NormalTok{days }\KeywordTok{\#\textasciitilde{}}\NormalTok{ valdate days}
\KeywordTok{:}
\CommentTok{NB. convert to yyyy mm dd format}
\DecValTok{0} \DecValTok{100} \DecValTok{100} \KeywordTok{\#.}\NormalTok{ yeardates }\KeywordTok{y}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}
\begin{JODPostProcessor}
\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB.POST\_sunmoon post processor.}

\NormalTok{smoutput IFACE}\AlertTok{=:}\index{IFACE@\texttt{IFACE}}  \RegionMarkerTok{(}\DecValTok{0} \RegionMarkerTok{: 0)}
\CommentTok{NB. (sunmoon) interface word(s):}
\CommentTok{NB. {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{NB. calmoons     NB. calendar dates of new and full moons}
\CommentTok{NB. moons        NB. times of new and full moons for n calendar years}
\CommentTok{NB. sunriseset0  NB. computes sun rise and set times {-} see long documentation}
\CommentTok{NB. sunriseset1  NB. computes sun rise and set times {-} see long documentation}
\RegionMarkerTok{)}

\NormalTok{cocurrent }\StringTok{\textquotesingle{}base\textquotesingle{}}
\NormalTok{coinsert  }\StringTok{\textquotesingle{}sunmoon\textquotesingle{}}
\end{Highlighting}
\end{Shaded}
\end{JODPostProcessor}
