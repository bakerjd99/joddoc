\section{\texttt{jodon} Source Code}

\begin{JODGroupHeader}
\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB.*jodon s{-}{-} places (jodon) and (jodoff) in z locale.}

\NormalTok{cocurrent }\StringTok{\textquotesingle{}z\textquotesingle{}}

\CommentTok{NB.*end{-}header}
\end{Highlighting}
\end{Shaded}
\end{JODGroupHeader}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{jodoff}\AlertTok{=:}\index{jodoff@\texttt{jodoff}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*jodoff v{-}{-} turns JOD off  result is  1  if  successful and  0}
\CommentTok{NB. otherwise.}
\CommentTok{NB.}
\CommentTok{NB. Destroys dictionary objects, clears JOD classes and drops the}
\CommentTok{NB. (ijod) interface. This  verb plus (jodon) and (jodsystempath)}
\CommentTok{NB. remain in the (z) locale after off\textquotesingle{}ing JOD and can be used to}
\CommentTok{NB. reload the system.}
\CommentTok{NB.}
\CommentTok{NB. monad:  jodoff uuIgnore}

\CommentTok{NB. HARDCODE: JODobj\_ijod\_ ajod ijod base}
\KeywordTok{try.}
\NormalTok{  jo}\KeywordTok{=.} \KeywordTok{<}\StringTok{\textquotesingle{}JODobj\_ijod\_\textquotesingle{}}
  \KeywordTok{if.} \DecValTok{0} \KeywordTok{=} \RegionMarkerTok{(}\DecValTok{4}\KeywordTok{!:}\DecValTok{0}\RegionMarkerTok{)}\NormalTok{ jo }\KeywordTok{do.} \RegionMarkerTok{(}\DecValTok{4}\KeywordTok{!:}\DecValTok{55}\RegionMarkerTok{)}\NormalTok{ jo }\KeywordTok{[} \RegionMarkerTok{(}\DecValTok{18}\KeywordTok{!:}\DecValTok{55}\RegionMarkerTok{)}\NormalTok{ destroyjod}\DecValTok{\_\_}\NormalTok{JODobj }\DecValTok{0} \KeywordTok{end.}

  \CommentTok{NB. erase jod classes}
  \RegionMarkerTok{(}\DecValTok{18}\KeywordTok{!:}\DecValTok{55}\RegionMarkerTok{)}\NormalTok{ w }\KeywordTok{\#\textasciitilde{}} \StringTok{\textquotesingle{}ajod\textquotesingle{}}\KeywordTok{\&{-}:@:}\RegionMarkerTok{(}\DecValTok{4}\KeywordTok{\&\{.}\RegionMarkerTok{)}\KeywordTok{\&>}\NormalTok{ w}\KeywordTok{=.} \DecValTok{18}\KeywordTok{!:}\DecValTok{1} \KeywordTok{]} \DecValTok{0}

  \CommentTok{NB. erase (ijod) interface and clear base path}
  \RegionMarkerTok{((}\DecValTok{18}\KeywordTok{!:}\DecValTok{2}\KeywordTok{<}\StringTok{\textquotesingle{}base\textquotesingle{}}\RegionMarkerTok{)}\KeywordTok{{-}.<}\StringTok{\textquotesingle{}ijod\textquotesingle{}}\RegionMarkerTok{)} \DecValTok{18}\KeywordTok{!:}\DecValTok{2} \KeywordTok{<}\StringTok{\textquotesingle{}base\textquotesingle{}}
  \RegionMarkerTok{(}\DecValTok{18}\KeywordTok{!:}\DecValTok{55}\RegionMarkerTok{)}\KeywordTok{<}\StringTok{\textquotesingle{}ijod\textquotesingle{}}

  \DecValTok{\_1}\KeywordTok{=}\RegionMarkerTok{(}\DecValTok{4}\KeywordTok{!:}\DecValTok{0}\RegionMarkerTok{)}\NormalTok{ jo}
\KeywordTok{catchd.}
   \DecValTok{0}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{jodon}\AlertTok{=:}\index{jodon@\texttt{jodon}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*jodon v{-}{-}  turn  JOD on  result  is 1  if  successful  and  0}
\CommentTok{NB. otherwise.}
\CommentTok{NB.}
\CommentTok{NB. Tests the  current J environment and creates or activates JOD}
\CommentTok{NB. objects.}
\CommentTok{NB.}
\CommentTok{NB. monad:  paRc =. jodon uuIgnore}

\CommentTok{NB. format of (9!:14) has changed without warning in the past}
\NormalTok{jvn}\KeywordTok{=.} \DecValTok{9}\KeywordTok{!:}\DecValTok{14} \StringTok{\textquotesingle{}\textquotesingle{}}

\CommentTok{NB. first value before \textquotesingle{}/\textquotesingle{} is the version number (we hope).}
\NormalTok{jvn}\KeywordTok{=.} \KeywordTok{,} \RegionMarkerTok{(}\NormalTok{jvn }\KeywordTok{i.} \StringTok{\textquotesingle{}/\textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{\{.}\NormalTok{ jvn}
\KeywordTok{if.} \KeywordTok{\#}\NormalTok{jvn }\KeywordTok{do.}\NormalTok{ jvn}\KeywordTok{=.} \DecValTok{0} \KeywordTok{".}\NormalTok{ jvn }\KeywordTok{\#\textasciitilde{}}\NormalTok{ jvn }\KeywordTok{e.} \StringTok{\textquotesingle{}0123456789\textquotesingle{}} \KeywordTok{else.}\NormalTok{ jvn}\KeywordTok{=.} \DecValTok{0} \KeywordTok{end.}

\NormalTok{sp}\KeywordTok{=.} \KeywordTok{]} \KeywordTok{[} \DecValTok{1}\KeywordTok{!:}\DecValTok{2}\KeywordTok{\&}\DecValTok{2}
\KeywordTok{if.}\NormalTok{ jvn }\KeywordTok{<} \DecValTok{602} \KeywordTok{do.}
\NormalTok{  msg}\KeywordTok{=.} \StringTok{\textquotesingle{}JOD requires J 6.02 or later.\textquotesingle{}}
\NormalTok{  msg}\KeywordTok{=.}\NormalTok{ msg}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,} \StringTok{\textquotesingle{}J is freely available at www.jsoftware.com\textquotesingle{}}
  \DecValTok{0} \KeywordTok{[}\NormalTok{ sp msg}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,} \StringTok{\textquotesingle{}Download and install J 6.0x{-}8.0x and then reinstall JOD.\textquotesingle{}}
  \KeywordTok{return.}
\KeywordTok{end.}

\NormalTok{nc}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{4}\KeywordTok{!:}\DecValTok{0}\RegionMarkerTok{)}\KeywordTok{@<}
\NormalTok{ex}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{4}\KeywordTok{!:}\DecValTok{55}\RegionMarkerTok{)}\KeywordTok{@<}

\CommentTok{NB. spot check of J environment {-} we need core J utilities}
\CommentTok{NB. if the following are not present JOD will not work}
\KeywordTok{if.} \DecValTok{\_1} \KeywordTok{e.} \RegionMarkerTok{(}\DecValTok{4}\KeywordTok{!:}\DecValTok{0}\RegionMarkerTok{)}\KeywordTok{;:}\StringTok{\textquotesingle{}load conew coclass coerase coinsert cocurrent copath jpath UNAME IFWIN\textquotesingle{}} \KeywordTok{do.}
\NormalTok{  msg}\KeywordTok{=.} \StringTok{\textquotesingle{}JOD depends on core J load and class utilities.\textquotesingle{}}
  \DecValTok{0} \KeywordTok{[}\NormalTok{ sp msg}\KeywordTok{=.}\NormalTok{ msg}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\StringTok{\textquotesingle{}Load J with a standard profile to use JOD.\textquotesingle{}}
  \KeywordTok{return.}
\KeywordTok{end.}

\CommentTok{NB. HARDCODE: JODobj\_ijod\_ ijod ajod}
\NormalTok{jodob}\KeywordTok{=.}\NormalTok{ nc }\StringTok{\textquotesingle{}JODobj\_ijod\_\textquotesingle{}}          \CommentTok{NB. name class of JOD object pointer}
\NormalTok{jodco}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\StringTok{\textquotesingle{}ajod\textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{e.} \DecValTok{18}\KeywordTok{!:}\DecValTok{1} \KeywordTok{]} \DecValTok{0}     \CommentTok{NB. JOD class status}

\KeywordTok{if.} \RegionMarkerTok{(}\DecValTok{0}\KeywordTok{=}\NormalTok{jodob}\RegionMarkerTok{)} \KeywordTok{*.}\NormalTok{ jodco      }\KeywordTok{do.} \DecValTok{1}  \CommentTok{NB. JOD is loaded}
\KeywordTok{elseif.} \RegionMarkerTok{(}\NormalTok{\_}\DecValTok{1}\KeywordTok{=}\NormalTok{jodob}\RegionMarkerTok{)} \KeywordTok{*.}\NormalTok{ jodco }\KeywordTok{do.}
  \CommentTok{NB. jod is off and classes are loaded {-} create objects !(*)=. conew}
\NormalTok{  JODobj\_ijod}\DecValTok{\_}\AlertTok{=:}\index{JODobj\_ijod\_@\texttt{JODobj\_ijod\_}}\NormalTok{  conew }\StringTok{\textquotesingle{}ajod\textquotesingle{}}
  \KeywordTok{if.}\NormalTok{ jodcs}\KeywordTok{=.}\NormalTok{ createjod}\DecValTok{\_\_}\NormalTok{JODobj JODobj\_ijod}\DecValTok{\_} \KeywordTok{do.} \DecValTok{1} \KeywordTok{else.} \DecValTok{0} \KeywordTok{[}\NormalTok{ ex }\StringTok{\textquotesingle{}JODobj\_ijod\_\textquotesingle{}} \KeywordTok{end.}
\KeywordTok{elseif.} \KeywordTok{{-}.}\NormalTok{ jodco }\KeywordTok{do.}
  \CommentTok{NB. JOD classes absent load and start system !(*)=. load}
\NormalTok{  ex }\StringTok{\textquotesingle{}JODobj\_ijod\_\textquotesingle{}}
  \CommentTok{NB. JOD load now requires addon path}
\NormalTok{  load }\StringTok{\textquotesingle{}general/jod\textquotesingle{}}
  \DecValTok{0} \KeywordTok{=}\NormalTok{ nc }\StringTok{\textquotesingle{}JODobj\_ijod\_\textquotesingle{}}
\KeywordTok{elseif.do.} \DecValTok{0} \CommentTok{NB. utterly screwed up system state}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}
