\section{\texttt{jodutil} Source Code}

\begin{JODGroupHeader}
\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. *jodutil c{-}{-} a collection of JOD utility words: extension of (jod).}
\CommentTok{NB.}
\CommentTok{NB. This subclass defines a set of handy utilites that use the core}
\CommentTok{NB. facilities of JOD to perform tasks of general use to J programmers.}
\CommentTok{NB.}
\CommentTok{NB. Interface nouns \& verbs:}
\CommentTok{NB.   compj    extreme compression of dictionary words}
\CommentTok{NB.   de       drop error code from JOD results}
\CommentTok{NB.   disp     display dictionary objects}
\CommentTok{NB.   doc      format comments in words and documents}
\CommentTok{NB.   ed       edit objects from JOD}
\CommentTok{NB.   et       edit text}
\CommentTok{NB.   gt       get text out of edit windows}
\CommentTok{NB.   revo     list recently revised objects}
\CommentTok{NB.   rm       run macros}
\CommentTok{NB.   rtt      run tautology tests}
\CommentTok{NB.   jodhelp  browse PDF online help}
\CommentTok{NB.}
\CommentTok{NB. Notes:}
\CommentTok{NB.   error \& ok messages (jodutil range 00250{-}00399)}

\NormalTok{coclass }\StringTok{\textquotesingle{}ajodutil\textquotesingle{}}
\NormalTok{coinsert }\StringTok{\textquotesingle{}ajod\textquotesingle{}}

\CommentTok{NB.*dependents d{-}{-} dependent words}

\CommentTok{NB. documentation mark for assumes}
\NormalTok{ASSUMESMARK}\AlertTok{=:}\index{ASSUMESMARK@\texttt{ASSUMESMARK}} \StringTok{\textquotesingle{}assumes:\textquotesingle{}}

\CommentTok{NB. documentation mark for author}
\NormalTok{AUTHORMARK}\AlertTok{=:}\index{AUTHORMARK@\texttt{AUTHORMARK}} \StringTok{\textquotesingle{}author:\textquotesingle{}}

\CommentTok{NB. documentation mark for created}
\NormalTok{CREATEDMARK}\AlertTok{=:}\index{CREATEDMARK@\texttt{CREATEDMARK}} \StringTok{\textquotesingle{}created:\textquotesingle{}}

\CommentTok{NB. documentation mark for dyad hungarian and examples}
\NormalTok{DYADMARK}\AlertTok{=:}\index{DYADMARK@\texttt{DYADMARK}} \StringTok{\textquotesingle{}dyad:\textquotesingle{}}

\CommentTok{NB. documentation mark for monad hungarian and examples}
\NormalTok{MONADMARK}\AlertTok{=:}\index{MONADMARK@\texttt{MONADMARK}} \StringTok{\textquotesingle{}monad:\textquotesingle{}}

\CommentTok{NB. documentation mark for verbatim}
\NormalTok{VERBATIMMARK}\AlertTok{=:}\index{VERBATIMMARK@\texttt{VERBATIMMARK}} \StringTok{\textquotesingle{}verbatim:\textquotesingle{}}

\CommentTok{NB. documentation mark for root words}
\NormalTok{ROOTWORDSMARK}\AlertTok{=:}\index{ROOTWORDSMARK@\texttt{ROOTWORDSMARK}} \StringTok{\textquotesingle{}rootwords:\textquotesingle{}}

\CommentTok{NB. documentation marks {-} depends on other marks}
\NormalTok{DOCUMENTMARKS}\AlertTok{=:}\index{DOCUMENTMARKS@\texttt{DOCUMENTMARKS}}\NormalTok{  ASSUMESMARK}\KeywordTok{;}\NormalTok{AUTHORMARK}\KeywordTok{;}\NormalTok{CREATEDMARK}\KeywordTok{;}\NormalTok{DYADMARK}\KeywordTok{;}\NormalTok{MONADMARK}\KeywordTok{;}\NormalTok{VERBATIMMARK}\KeywordTok{;}\NormalTok{ROOTWORDSMARK}

\CommentTok{NB. command line quotes OS dependent: jod !(*)=. dblquote}
\NormalTok{qt}\AlertTok{=:}\index{qt@\texttt{qt}}  \KeywordTok{]\textasciigrave{}}\NormalTok{dblquote}\KeywordTok{@.}\NormalTok{IFWIN}

\CommentTok{NB.*enddependents}

\CommentTok{NB.*end{-}header}
\end{Highlighting}
\end{Shaded}
\end{JODGroupHeader}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. remove only white space tag}
\NormalTok{CWSONLY}\AlertTok{=:}\index{CWSONLY@\texttt{CWSONLY}} \StringTok{\textquotesingle{}({-}.)=:\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. text editor to use when running JOD in jconsole on Windows systems}
\NormalTok{EDCONSOLE}\AlertTok{=:}\index{EDCONSOLE@\texttt{EDCONSOLE}} \StringTok{\textquotesingle{}"c:\textbackslash{}Program Files\textbackslash{}Microsoft VS Code\textbackslash{}code.exe"\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. default edit file name}
\NormalTok{EDTEMP}\AlertTok{=:}\index{EDTEMP@\texttt{EDTEMP}} \StringTok{\textquotesingle{}99\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0250}\AlertTok{=:}\index{ERR0250@\texttt{ERR0250}} \StringTok{\textquotesingle{} is a noun no internal document\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0251}\AlertTok{=:}\index{ERR0251@\texttt{ERR0251}} \StringTok{\textquotesingle{}not loaded {-} load\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0252}\AlertTok{=:}\index{ERR0252@\texttt{ERR0252}} \StringTok{\textquotesingle{}not J script(s) {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0253}\AlertTok{=:}\index{ERR0253@\texttt{ERR0253}} \StringTok{\textquotesingle{}invalid locale name\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0254}\AlertTok{=:}\index{ERR0254@\texttt{ERR0254}} \StringTok{\textquotesingle{}unable to get TEMP/*.ijs text\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0255}\AlertTok{=:}\index{ERR0255@\texttt{ERR0255}} \StringTok{\textquotesingle{}unable to open TEMP/*.ijs for editing\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0256}\AlertTok{=:}\index{ERR0256@\texttt{ERR0256}} \StringTok{\textquotesingle{}J error in script {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0260}\AlertTok{=:}\index{ERR0260@\texttt{ERR0260}} \StringTok{\textquotesingle{}PDF reader not found\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0261}\AlertTok{=:}\index{ERR0261@\texttt{ERR0261}} \StringTok{\textquotesingle{}macro is not a J script {-} not formatted\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR0262}\AlertTok{=:}\index{ERR0262@\texttt{ERR0262}} \StringTok{\textquotesingle{}not supported on current J system\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. jodutil interface words}
\NormalTok{IzJODutinterface}\AlertTok{=:}\index{IzJODutinterface@\texttt{IzJODutinterface}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} compj de disp doc ed et gt jodhelp revo rm rtt\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. valid characters in J names}
\NormalTok{NAMEALPHA}\AlertTok{=:}\index{NAMEALPHA@\texttt{NAMEALPHA}} \StringTok{\textquotesingle{}abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\_\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. obfuscate local identifiers tag}
\NormalTok{OBFUSCATE}\AlertTok{=:}\index{OBFUSCATE@\texttt{OBFUSCATE}} \StringTok{\textquotesingle{}(/:)=:\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. name obfuscation limit {-} higher values less likely to clash}
\NormalTok{OBFUSCCNT}\AlertTok{=:}\index{OBFUSCCNT@\texttt{OBFUSCCNT}} \DecValTok{100000}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. obfuscation local identifier prefix}
\NormalTok{OBFUSCPFX}\AlertTok{=:}\index{OBFUSCPFX@\texttt{OBFUSCPFX}} \StringTok{\textquotesingle{}o\_\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK0250}\AlertTok{=:}\index{OK0250@\texttt{OK0250}} \StringTok{\textquotesingle{} documented in {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK0251}\AlertTok{=:}\index{OK0251@\texttt{OK0251}} \StringTok{\textquotesingle{}edit locale cleared\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK0252}\AlertTok{=:}\index{OK0252@\texttt{OK0252}} \StringTok{\textquotesingle{}edit locale {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK0255}\AlertTok{=:}\index{OK0255@\texttt{OK0255}} \StringTok{\textquotesingle{}starting PDF reader\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK0256}\AlertTok{=:}\index{OK0256@\texttt{OK0256}} \StringTok{\textquotesingle{}jod.pdf not installed {-} use JAL to install the addon general/joddocument\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. PDF document indicator}
\NormalTok{PDF}\AlertTok{=:}\index{PDF@\texttt{PDF}} \StringTok{\textquotesingle{}PDF\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. PDF reader {-} must accept command line argument}
\NormalTok{PDFREADER}\AlertTok{=:}\index{PDFREADER@\texttt{PDFREADER}} \StringTok{\textquotesingle{}C:\textbackslash{}Program Files\textbackslash{}Adobe\textbackslash{}Reader 8.0\textbackslash{}Reader\textbackslash{}acrord32.exe\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. on Mac\textquotesingle{}s use the OS open command for PDFs}
\NormalTok{PDFREADERMAC}\AlertTok{=:}\index{PDFREADERMAC@\texttt{PDFREADERMAC}} \StringTok{\textquotesingle{}open\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. character used to mark scriptdoc headers {-} currently a \textquotesingle{}*\textquotesingle{}}
\NormalTok{SCRIPTDOCCHAR}\AlertTok{=:}\index{SCRIPTDOCCHAR@\texttt{SCRIPTDOCCHAR}} \StringTok{\textquotesingle{}*\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{blkaft}\AlertTok{=:}\index{blkaft@\texttt{blkaft}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*blkaft v{-}{-} appends necessary blanks to J tokens.}
\CommentTok{NB.}
\CommentTok{NB. This verb appends some  necessary blanks to  J tokens so that}
\CommentTok{NB. raising  a token list and reparsing  produces  the same token}
\CommentTok{NB. list. A few unecessary blanks may be inserted.}
\CommentTok{NB.}
\CommentTok{NB. monad:  blkaft blcl}
\CommentTok{NB.}
\CommentTok{NB.   NB. line of J code}
\CommentTok{NB.   line=. \textquotesingle{}c=. +./\textbackslash{}"1 c > \textasciitilde{}:/\textbackslash{}"1 y. e. \textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}\textquotesingle{}}
\CommentTok{NB.   tokens=.  ;: line}
\CommentTok{NB.}
\CommentTok{NB.   NB. compare}
\CommentTok{NB.   (;: ; tokens) {-}: tokens}
\CommentTok{NB.   (;: ; blkaft tokens) {-}: tokens}

\CommentTok{NB. assume no blanks are required}
\NormalTok{r}\KeywordTok{=.} \DecValTok{0} \KeywordTok{\#\textasciitilde{}} \KeywordTok{\#} \KeywordTok{y}
\NormalTok{t}\KeywordTok{=.} \KeywordTok{y}

\KeywordTok{while.do.}
 \KeywordTok{u=.} \KeywordTok{;:} \KeywordTok{;\textbackslash{}}\NormalTok{ t}
 \KeywordTok{v=.} \KeywordTok{\textasciitilde{}.\&.>}  \RegionMarkerTok{(} \KeywordTok{<"}\DecValTok{1} \KeywordTok{|:} \KeywordTok{u}\RegionMarkerTok{)} \KeywordTok{{-}.} \KeywordTok{L:} \DecValTok{1}  \KeywordTok{a:}
\NormalTok{ r}\KeywordTok{=.}\NormalTok{ r }\KeywordTok{+.} \KeywordTok{y} \KeywordTok{e.} \KeywordTok{;} \KeywordTok{\{.\&.>} \RegionMarkerTok{(}\DecValTok{1} \KeywordTok{<} \KeywordTok{\#\&>} \KeywordTok{v}\RegionMarkerTok{)}\KeywordTok{\#v}

 \KeywordTok{if.} \KeywordTok{y} \KeywordTok{{-}:} \KeywordTok{\{:} \KeywordTok{u} \KeywordTok{do.}
   \CommentTok{NB. last tokenized row matches original}
   \KeywordTok{break.}
 \KeywordTok{else.}
   \CommentTok{NB. insert required blanks and reparse}
\NormalTok{   t}\KeywordTok{=.} \RegionMarkerTok{((}\NormalTok{r}\KeywordTok{\#}\NormalTok{t}\RegionMarkerTok{)}\KeywordTok{,\&.>}\StringTok{\textquotesingle{} \textquotesingle{}}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{I.}\NormalTok{ r}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ t}
 \KeywordTok{end.}

\KeywordTok{end.}

\CommentTok{NB. insert required blanks and raise tokens}
\KeywordTok{;} \RegionMarkerTok{((}\NormalTok{r}\KeywordTok{\#y}\RegionMarkerTok{)}\KeywordTok{,\&.>}\StringTok{\textquotesingle{} \textquotesingle{}}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{I.}\NormalTok{ r}\RegionMarkerTok{)}\KeywordTok{\}} \KeywordTok{y}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{changetok}\AlertTok{=:}\index{changetok@\texttt{changetok}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*changetok  v{-}{-}  replaces  J name tokens within  a string. See}
\CommentTok{NB. long documentation.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  clChanged =. clTokens changetok clStr}
\CommentTok{NB.}
\CommentTok{NB.   \textquotesingle{}/boo/hoo\textquotesingle{} changetok \textquotesingle{}boo boo boohoo boohoo\textquotesingle{}}

\KeywordTok{if.} \KeywordTok{\#}\NormalTok{pairs}\KeywordTok{=.} \DecValTok{2} \KeywordTok{\{."}\RegionMarkerTok{(}\DecValTok{1}\RegionMarkerTok{)} \DecValTok{\_2} \KeywordTok{[\textbackslash{}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \KeywordTok{x} \KeywordTok{do.}
\NormalTok{  pairs}\KeywordTok{=.}\NormalTok{ pairs }\KeywordTok{\#\textasciitilde{}} \DecValTok{\_2} \KeywordTok{\textasciitilde{}:} \RegionMarkerTok{(}\DecValTok{4}\KeywordTok{!:}\DecValTok{0}\RegionMarkerTok{)} \KeywordTok{\{."}\DecValTok{1}\NormalTok{ pairs  }\CommentTok{NB. eliminate non{-}token pairs}
\KeywordTok{end.}
\NormalTok{cnt}\KeywordTok{=.}\NormalTok{\_}\DecValTok{1} \KeywordTok{[}\NormalTok{ lim}\KeywordTok{=.} \KeywordTok{\#}\NormalTok{ pairs}
\KeywordTok{while.}\NormalTok{ lim }\KeywordTok{>}\NormalTok{ cnt}\KeywordTok{=.} \KeywordTok{>:}\NormalTok{cnt }\KeywordTok{do.}         \CommentTok{NB. process each change pair}
  \StringTok{\textquotesingle{}t c\textquotesingle{}}\KeywordTok{=.}\NormalTok{ cnt }\KeywordTok{\{}\NormalTok{ pairs                }\CommentTok{NB. /target/change (*)=. t c}
  \KeywordTok{if.} \KeywordTok{+./}\NormalTok{b}\KeywordTok{=.}\NormalTok{ t }\KeywordTok{E.} \KeywordTok{y} \KeywordTok{do.}              \CommentTok{NB. next if no targets}
\NormalTok{    w}\KeywordTok{=.} \KeywordTok{I.}\NormalTok{ b                         }\CommentTok{NB. target starts}
    \StringTok{\textquotesingle{}l o\textquotesingle{}}\KeywordTok{=.} \KeywordTok{\#\&>}\NormalTok{ cnt }\KeywordTok{\{}\NormalTok{ pairs          }\CommentTok{NB. lengths (*)=. l o}
\NormalTok{    q}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{w }\KeywordTok{\{} \StringTok{\textquotesingle{} \textquotesingle{}} \KeywordTok{,} \KeywordTok{y}\RegionMarkerTok{)} \KeywordTok{e.}\NormalTok{ NAMEALPHA        }\CommentTok{NB. head chars}
\NormalTok{    r}\KeywordTok{=.} \RegionMarkerTok{((}\NormalTok{w }\KeywordTok{+}\NormalTok{ l}\RegionMarkerTok{)} \KeywordTok{\{} \KeywordTok{y} \KeywordTok{,} \StringTok{\textquotesingle{} \textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{e.}\NormalTok{ NAMEALPHA  }\CommentTok{NB. tail chars}
\NormalTok{    w}\KeywordTok{=.}\NormalTok{ w }\KeywordTok{\#\textasciitilde{}} \KeywordTok{{-}.}\NormalTok{ q }\KeywordTok{+.}\NormalTok{ r               }\CommentTok{NB. eliminate embedded tokens}
    \KeywordTok{if.} \DecValTok{0} \KeywordTok{=} \KeywordTok{\#}\NormalTok{w }\KeywordTok{do.} \KeywordTok{continue.} \KeywordTok{end.}    \CommentTok{NB. next if no targets}
\NormalTok{    b}\KeywordTok{=.} \DecValTok{1}\NormalTok{ w}\KeywordTok{\}} \DecValTok{0} \KeywordTok{\#\textasciitilde{}} \KeywordTok{\#}\NormalTok{ b                }\CommentTok{NB. reset target mask}
\NormalTok{    p}\KeywordTok{=.}\NormalTok{ w }\KeywordTok{+} \DecValTok{0}\KeywordTok{,+/\textbackslash{}}\RegionMarkerTok{(}\KeywordTok{<:\#}\NormalTok{ w}\RegionMarkerTok{)}\KeywordTok{$}\NormalTok{ d }\KeywordTok{=.}\NormalTok{ o }\KeywordTok{{-}}\NormalTok{ l   }\CommentTok{NB. change starts}
\NormalTok{    s}\KeywordTok{=.} \KeywordTok{*}\NormalTok{ d                          }\CommentTok{NB. reduce < and > to =}
    \KeywordTok{if.}\NormalTok{ s }\KeywordTok{=} \DecValTok{\_1} \KeywordTok{do.}
\NormalTok{      b}\KeywordTok{=.} \DecValTok{1} \KeywordTok{\#\textasciitilde{}} \KeywordTok{\#}\NormalTok{ b}
\NormalTok{      b}\KeywordTok{=.} \RegionMarkerTok{((}\NormalTok{l }\KeywordTok{*} \KeywordTok{\#}\NormalTok{ w}\RegionMarkerTok{)}\KeywordTok{$} \DecValTok{1} \DecValTok{0} \KeywordTok{\#\textasciitilde{}}\NormalTok{ o}\KeywordTok{,}\NormalTok{l}\KeywordTok{{-}}\NormalTok{o}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{,}\NormalTok{w }\KeywordTok{+/} \KeywordTok{i.}\NormalTok{ l}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ b}
      \KeywordTok{y=.}\NormalTok{ b }\KeywordTok{\#} \KeywordTok{y}
      \KeywordTok{if.}\NormalTok{ o }\KeywordTok{=} \DecValTok{0} \KeywordTok{do.} \KeywordTok{continue.} \KeywordTok{end.}   \CommentTok{NB. next for deletions}
    \KeywordTok{elseif.}\NormalTok{ s }\KeywordTok{=} \DecValTok{1} \KeywordTok{do.}
      \KeywordTok{y=.} \KeywordTok{y} \KeywordTok{\#\textasciitilde{}} \KeywordTok{>:}\NormalTok{ d w}\KeywordTok{\}}\NormalTok{ b             }\CommentTok{NB. first target char replicated}
    \KeywordTok{end.}
    \KeywordTok{y=.} \RegionMarkerTok{(}\NormalTok{c }\KeywordTok{$\textasciitilde{}}\NormalTok{ o }\KeywordTok{*\#}\NormalTok{ w}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{,}\NormalTok{p }\KeywordTok{+/i.}\NormalTok{ o}\RegionMarkerTok{)}\KeywordTok{\}} \KeywordTok{y}  \CommentTok{NB. insert replacements}
  \KeywordTok{end.}
\KeywordTok{end.} \KeywordTok{y}                               \CommentTok{NB. altered string}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{compclut}\AlertTok{=:}\index{compclut@\texttt{compclut}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*compclut  v{-}{-} removes  comments and  reduces  multiple  blank}
\CommentTok{NB. lines to singles.}
\CommentTok{NB.}
\CommentTok{NB. This  verb removes  all  comments  from  J code  and  reduces}
\CommentTok{NB. multiple blank  lines  to  one.  All  leading  whitespace  is}
\CommentTok{NB. preserved.  This representation  is surprisingly  useful when}
\CommentTok{NB. debugging and reading  code as it removes  annoying "literary}
\CommentTok{NB. artifacts" while preserving the structure of code.}
\CommentTok{NB.}
\CommentTok{NB. monad:  cl =. compclut ctJcr}
\CommentTok{NB.}
\CommentTok{NB.  complut jcr \textquotesingle{}compclut\textquotesingle{}}

\NormalTok{t}\KeywordTok{=.} \DecValTok{0}\NormalTok{ decomm }\KeywordTok{y}
\NormalTok{LF }\KeywordTok{,\textasciitilde{}}\NormalTok{ ctl t }\KeywordTok{\#\textasciitilde{}} \RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{b}\RegionMarkerTok{)} \KeywordTok{+.}\NormalTok{ firstone b}\KeywordTok{=.} \KeywordTok{*./"}\DecValTok{1} \StringTok{\textquotesingle{} \textquotesingle{}}\KeywordTok{=}\NormalTok{t}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{compj}\AlertTok{=:}\index{compj@\texttt{compj}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*compj v{-}{-} compresses nonnouns  by removing  white  space and}
\CommentTok{NB. shortening local identifiers.}
\CommentTok{NB.}
\CommentTok{NB. (compj)  does not shorten  global identifiers, object or  locale}
\CommentTok{NB. names  and implicit local (for.) names. The names  changed  by}
\CommentTok{NB. (compj) are labeled local by (11 globs).}
\CommentTok{NB.}
\CommentTok{NB. WARNING: code compression requires that all ambigous names in}
\CommentTok{NB. J  code  are properly declared  using  (globs) scope tags. If}
\CommentTok{NB. such names are not properly identified compression will break}
\CommentTok{NB. your code.}
\CommentTok{NB.}
\CommentTok{NB. monad:  cl =. compj blclNames}
\CommentTok{NB.}
\CommentTok{NB.   compj ;:\textquotesingle{}the byte diet\textquotesingle{}}
\CommentTok{NB.}
\CommentTok{NB. dyad:  cl =. iaOption compj blclNames}
\CommentTok{NB.}
\CommentTok{NB.   1 compj ;:\textquotesingle{}remove comments preserving leading whitespace\textquotesingle{}}

\DecValTok{0}\NormalTok{ compj }\KeywordTok{y}
\KeywordTok{:}
\KeywordTok{if.}\NormalTok{ badil }\KeywordTok{x} \KeywordTok{do.}\NormalTok{ jderr ERR001 }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. get word definitions}
\KeywordTok{if.}\NormalTok{ badrc dat}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{WORD}\KeywordTok{,}\NormalTok{NVTABLE}\RegionMarkerTok{)}\NormalTok{ get }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ dat }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ dat}\KeywordTok{=.}\NormalTok{ rv dat }\KeywordTok{end.}

\CommentTok{NB. mask of non{-}nouns}
\NormalTok{b}\KeywordTok{=.} \DecValTok{0} \KeywordTok{<} \KeywordTok{;} \DecValTok{1} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ dat}

\CommentTok{NB. set compression}
\NormalTok{cv}\KeywordTok{=.}\NormalTok{ compressj}\KeywordTok{\textasciigrave{}}\NormalTok{compclut }\KeywordTok{@.} \RegionMarkerTok{(}\DecValTok{1} \KeywordTok{{-}:} \KeywordTok{x}\RegionMarkerTok{)}

\CommentTok{NB. compress non{-}nouns {-} remove any embedded tabs}
\NormalTok{dat}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{cv}\KeywordTok{@:}\NormalTok{ctit}\KeywordTok{\&.>} \RegionMarkerTok{(}\NormalTok{b}\KeywordTok{\#\{:"}\DecValTok{1}\NormalTok{ dat}\RegionMarkerTok{)} \KeywordTok{{-}.\&.>}\NormalTok{ TAB}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{<}\RegionMarkerTok{(}\KeywordTok{I.}\NormalTok{ b}\RegionMarkerTok{)}\KeywordTok{;}\DecValTok{2}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ dat}

\CommentTok{NB. generate packed script}
\RegionMarkerTok{(}\NormalTok{WORD}\KeywordTok{,}\DecValTok{1}\RegionMarkerTok{)}\NormalTok{ wttext}\DecValTok{\_\_}\NormalTok{MK dat}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{compressj}\AlertTok{=:}\index{compressj@\texttt{compressj}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*compressj v{-}{-}  removes  all  white  space  from  J words  and}
\CommentTok{NB. shortens local names. This process reduces the readability of}
\CommentTok{NB. code and should only be applied to production code.}
\CommentTok{NB.}
\CommentTok{NB. monad:  cl =. compressj ct}
\CommentTok{NB.}
\CommentTok{NB.   compressj jcr \textquotesingle{}verbname\textquotesingle{}}
\CommentTok{NB.}
\CommentTok{NB.   NB. call in object context}
\CommentTok{NB.   compressj\_\_UT\_\_JODobj jcr\_ajod\_ \textquotesingle{}compressj\_base\_\textquotesingle{}}

\CommentTok{NB. check for presence of white space only removal tag}
\NormalTok{w}\KeywordTok{=.} \DecValTok{1} \KeywordTok{e.}\NormalTok{ CWSONLY }\KeywordTok{E.} \KeywordTok{,y}

\CommentTok{NB. always remove white space}
\KeywordTok{u=.}\NormalTok{ dewhitejcr }\KeywordTok{y}
\KeywordTok{if.}\NormalTok{ w }\KeywordTok{do.} \KeywordTok{u} \KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. do not compress identifiers in code that cannot be}
\CommentTok{NB. reliably classified by the namecats verb.}

\CommentTok{NB. BUG: j 8.05 win64 can lose y shapes {-} sy$,y recovers y\textquotesingle{}s shape}

\KeywordTok{if.}\NormalTok{ badrc }\KeywordTok{m=.} \DecValTok{1}\NormalTok{ namecats}\DecValTok{\_\_}\NormalTok{MK }\KeywordTok{y} \KeywordTok{do.} \KeywordTok{u} \KeywordTok{return.} \KeywordTok{end.}
\NormalTok{d}\KeywordTok{=.} \KeywordTok{\textasciitilde{}.} \KeywordTok{;}\RegionMarkerTok{(}\KeywordTok{<}\DecValTok{2} \DecValTok{3} \DecValTok{4}\KeywordTok{;}\DecValTok{1}\RegionMarkerTok{)}\KeywordTok{\{m=.}\NormalTok{ rv }\KeywordTok{m}

\CommentTok{NB. check for presence of obfuscation tag}
\KeywordTok{if.}\NormalTok{ o}\KeywordTok{=.} \DecValTok{1} \KeywordTok{e.}\NormalTok{ OBFUSCATE }\KeywordTok{E.} \KeywordTok{,y} \KeywordTok{do.}
  \CommentTok{NB. local names less J arguments}
\NormalTok{  l}\KeywordTok{=.} \KeywordTok{;}\RegionMarkerTok{(}\KeywordTok{<}\DecValTok{1}\KeywordTok{;}\DecValTok{1}\RegionMarkerTok{)}\KeywordTok{\{m}
\NormalTok{  l}\KeywordTok{=.}\NormalTok{ l }\KeywordTok{{-}.}\NormalTok{ JARGS}\DecValTok{\_\_}\NormalTok{MK}
\KeywordTok{else.}
  \CommentTok{NB. local names less any single char names}
\NormalTok{  l}\KeywordTok{=.} \KeywordTok{;}\RegionMarkerTok{(}\KeywordTok{<}\DecValTok{1}\KeywordTok{;}\DecValTok{1}\RegionMarkerTok{)}\KeywordTok{\{m}
\NormalTok{  s}\KeywordTok{=.}\NormalTok{ l }\KeywordTok{\#\textasciitilde{}} \DecValTok{1} \KeywordTok{=} \KeywordTok{\#\&>}\NormalTok{ l}
\NormalTok{  l}\KeywordTok{=.}\NormalTok{ l }\KeywordTok{{-}.}\NormalTok{ s}
\KeywordTok{end.}

\CommentTok{NB. remove object references}
\NormalTok{l}\KeywordTok{=.}\NormalTok{ l }\KeywordTok{{-}.}\NormalTok{ exobrefs l}\KeywordTok{,;}\RegionMarkerTok{(}\KeywordTok{<}\DecValTok{0}\KeywordTok{;}\DecValTok{1}\RegionMarkerTok{)}\KeywordTok{\{m}

\CommentTok{NB. local names less any declared and for. names}
\KeywordTok{if.} \DecValTok{0}\KeywordTok{=\#m=.}\NormalTok{ l }\KeywordTok{{-}.}\NormalTok{ d }\KeywordTok{do.} \KeywordTok{u} \KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. remove any names with embedded locale references}
\KeywordTok{if.} \DecValTok{0}\KeywordTok{=\#m=.} \KeywordTok{m} \KeywordTok{\#\textasciitilde{}} \KeywordTok{{-}.}\NormalTok{ islocref}\KeywordTok{\&>} \KeywordTok{m} \KeywordTok{do.} \KeywordTok{u} \KeywordTok{return.} \KeywordTok{end.}

\KeywordTok{if.}\NormalTok{ o }\KeywordTok{do.}
  \CommentTok{NB. form obsfucated name replacements {-} drop trailing \_ in (NAMEALPHA)}
\NormalTok{  bnr}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<:\#}\NormalTok{NAMEALPHA}\RegionMarkerTok{)}\KeywordTok{\&\#.@}\RegionMarkerTok{((}\KeywordTok{\}:}\NormalTok{NAMEALPHA}\RegionMarkerTok{)}\KeywordTok{\&i.}\RegionMarkerTok{)}\KeywordTok{\^{}:}\NormalTok{\_}\DecValTok{1}
\NormalTok{  r}\KeywordTok{=.} \StringTok{\textquotesingle{} \textquotesingle{}} \KeywordTok{{-}.\textasciitilde{}} \KeywordTok{,}\StringTok{\textquotesingle{}/\textquotesingle{}} \KeywordTok{,"}\DecValTok{1}  \RegionMarkerTok{(}\KeywordTok{>m}\RegionMarkerTok{)} \KeywordTok{,"}\DecValTok{1} \StringTok{\textquotesingle{}/\textquotesingle{}} \KeywordTok{,"}\DecValTok{1}\NormalTok{ OBFUSCPFX }\KeywordTok{,"}\DecValTok{1}\NormalTok{ bnr }\RegionMarkerTok{(}\KeywordTok{\#m}\RegionMarkerTok{)}\KeywordTok{?}\NormalTok{OBFUSCCNT}
\KeywordTok{else.}
  \CommentTok{NB. form replacements from any remaining chars !(*)=. SHORTNAMES}
  \CommentTok{NB. J arguments m n x y u v are not on SHORTNAMES}
  \KeywordTok{if.} \DecValTok{0}\KeywordTok{=\#}\NormalTok{r}\KeywordTok{=.}\NormalTok{ SHORTNAMES }\KeywordTok{{-}.} \KeywordTok{,\&.>}\NormalTok{ s }\KeywordTok{do.} \KeywordTok{u} \KeywordTok{return.} \KeywordTok{end.}
  \KeywordTok{if.} \RegionMarkerTok{(}\KeywordTok{\#}\NormalTok{r}\RegionMarkerTok{)} \KeywordTok{<} \KeywordTok{\#m} \KeywordTok{do.}
    \CommentTok{NB. we have more replacements than available SHORTNAMES}
    \CommentTok{NB. form base (\#r) numbers using SHORTNAMES digits}
\NormalTok{    bnr}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\#}\NormalTok{r}\RegionMarkerTok{)}\KeywordTok{\&\#.@}\RegionMarkerTok{((}\KeywordTok{;}\NormalTok{r}\RegionMarkerTok{)}\KeywordTok{\&i.}\RegionMarkerTok{)}\KeywordTok{\^{}:}\NormalTok{\_}\DecValTok{1}
\NormalTok{    r}\KeywordTok{=.}\NormalTok{ r}\KeywordTok{,<"}\DecValTok{1}\RegionMarkerTok{(}\KeywordTok{\#}\NormalTok{r}\RegionMarkerTok{)} \KeywordTok{\}.}\NormalTok{ bnr }\KeywordTok{i.} \KeywordTok{\#m}
  \KeywordTok{end.}
\NormalTok{  r}\KeywordTok{=.} \KeywordTok{;} \StringTok{\textquotesingle{}/\textquotesingle{}} \KeywordTok{,\&.>} \KeywordTok{m} \KeywordTok{,.} \RegionMarkerTok{(}\KeywordTok{\#m}\RegionMarkerTok{)} \KeywordTok{\{.}\NormalTok{ r}
\KeywordTok{end.}

\CommentTok{NB. replace tokens}
\NormalTok{r changetok }\KeywordTok{u}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{createut}\AlertTok{=:}\index{createut@\texttt{createut}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*createut v{-}{-} initializes utility objects.}
\CommentTok{NB.}
\CommentTok{NB. monad:  createut blObrefs}
\CommentTok{NB.}
\CommentTok{NB.   createut\_\_UT JOD;ST;MK;UT;<S0}

\CommentTok{NB. object references !(*)=. JOD ST MK UT SO}
\StringTok{\textquotesingle{}JOD ST MK UT SO\textquotesingle{}}\AlertTok{=:}\index{\textquotesingle{}@\texttt{\textquotesingle{}}}  \KeywordTok{y}

\CommentTok{NB. set shortnames !(*)=. SHORTNAMES}
\NormalTok{SHORTNAMES}\AlertTok{=:}\index{SHORTNAMES@\texttt{SHORTNAMES}}  \KeywordTok{,\&.>} \KeywordTok{<"}\DecValTok{0} \KeywordTok{[} \DecValTok{52} \KeywordTok{\{.}\NormalTok{ NAMEALPHA}
\NormalTok{SHORTNAMES}\AlertTok{=:}\index{SHORTNAMES@\texttt{SHORTNAMES}}\NormalTok{  SHORTNAMES }\KeywordTok{{-}.} \KeywordTok{;:}\StringTok{\textquotesingle{}m n x y u v\textquotesingle{}}

\CommentTok{NB. add to overall jod interface}
\NormalTok{IZJODALL}\DecValTok{\_\_}\NormalTok{JOD}\AlertTok{=:}\index{IZJODALL\_\_JOD@\texttt{IZJODALL\_\_JOD}}\NormalTok{  IZJODALL}\DecValTok{\_\_}\NormalTok{JOD}\KeywordTok{,}\NormalTok{IzJODutinterface}

\CommentTok{NB. define direct (ijod) locale interface for utilities}
\KeywordTok{".\&.>}\NormalTok{ UT defzface IzJODutinterface}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. convert LF delimited character lists to character tables}
\NormalTok{ctit}\AlertTok{=:}\index{ctit@\texttt{ctit}} \KeywordTok{[:} \KeywordTok{];.}\NormalTok{\_}\DecValTok{2} \KeywordTok{]} \KeywordTok{,} \RegionMarkerTok{(}\DecValTok{10}\KeywordTok{\{a.}\RegionMarkerTok{)}\KeywordTok{"}\NormalTok{\_}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. display JOD result without return code}
\NormalTok{de}\AlertTok{=:}\index{de@\texttt{de}}\NormalTok{ list}\KeywordTok{@:\}.}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dewhitejcr}\AlertTok{=:}\index{dewhitejcr@\texttt{dewhitejcr}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dewhitejcr  v{-}{-}  removes  all redundant  blanks from  J code.}
\CommentTok{NB. Result is a character list in linear representation format.}
\CommentTok{NB.}
\CommentTok{NB. monad:  cl =. dewhitejcr ct}
\CommentTok{NB.}
\CommentTok{NB.   dewhitejcr jcr \textquotesingle{}anyword\textquotesingle{}}

\NormalTok{tt}\KeywordTok{=.} \KeywordTok{;:\&.>} \KeywordTok{<"}\DecValTok{1} \RegionMarkerTok{(}\NormalTok{ljust}\KeywordTok{@:}\NormalTok{decomm}\RegionMarkerTok{)} \KeywordTok{y}  \CommentTok{NB. list of tokenized lines}
\KeywordTok{;} \RegionMarkerTok{(}\NormalTok{blkaft}\KeywordTok{\&.>}\NormalTok{ tt}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ LF          }\CommentTok{NB. insert blanks, LF\textquotesingle{}s and raise}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dewhitejscript}\AlertTok{=:}\index{dewhitejscript@\texttt{dewhitejscript}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dewhitejscript  v{-}{-}  removes  all  redundant  blanks  from  J}
\CommentTok{NB. scripts.}
\CommentTok{NB.}
\CommentTok{NB. monad:  dewhitejscript cl}
\CommentTok{NB.}
\CommentTok{NB.   dewhitejscript read \textquotesingle{}c:\textbackslash{}any\textbackslash{}j\textbackslash{}script.ijs\textquotesingle{}}

\CommentTok{NB. replace any tabs with single blanks}
\KeywordTok{y=.} \StringTok{\textquotesingle{} \textquotesingle{}} \RegionMarkerTok{(}\KeywordTok{I.} \KeywordTok{y=}\NormalTok{TAB}\RegionMarkerTok{)}\KeywordTok{\}} \KeywordTok{y}

\CommentTok{NB. remove blank lines and all comments from script}
\KeywordTok{y=.} \KeywordTok{;:\&.>} \KeywordTok{<"}\DecValTok{1}\NormalTok{ decomm }\KeywordTok{];.} \DecValTok{\_1}\NormalTok{ LF}\KeywordTok{,y{-}.}\NormalTok{CR}

\CommentTok{NB. remove redundant blanks in code}
\KeywordTok{;} \RegionMarkerTok{(}\NormalTok{blkaft}\KeywordTok{\&.>} \KeywordTok{y}\RegionMarkerTok{)} \KeywordTok{,\&.>} \KeywordTok{<}\NormalTok{CRLF}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{disp}\AlertTok{=:}\index{disp@\texttt{disp}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*disp  v{-}{-}  display  dictionary  objects  as text.  This  verb}
\CommentTok{NB. returns  a character  list instead of  a the usual (rc;values}
\CommentTok{NB. ...) boxed list.}
\CommentTok{NB.}
\CommentTok{NB. monad:  disp cl|blcl}
\CommentTok{NB. dyad:  iaObject disp cl|blcl}

\DecValTok{0}\NormalTok{ disp }\KeywordTok{y}
\KeywordTok{:}
\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \KeywordTok{x}\NormalTok{ obtext }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{else.} \KeywordTok{>\{:}\NormalTok{uv }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{doc}\AlertTok{=:}\index{doc@\texttt{doc}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*doc v{-}{-} formats document text  using  the conventions  of the}
\CommentTok{NB. (docct) verb.}
\CommentTok{NB.}
\CommentTok{NB. monad:  doc clName}
\CommentTok{NB.}
\CommentTok{NB.   doc \textquotesingle{}word\textquotesingle{}    NB. format leading block of explicit defn comments}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaObject doc clName}
\CommentTok{NB.}
\CommentTok{NB.   1 doc \textquotesingle{}test\textquotesingle{}       NB. format test document text}
\CommentTok{NB.   0 9 doc \textquotesingle{}longdoc\textquotesingle{}  NB. format long word documentation text}

\NormalTok{docword }\KeywordTok{y}
\KeywordTok{:}
\KeywordTok{x}\NormalTok{ doctext }\KeywordTok{y}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{docct2}\AlertTok{=:}\index{docct2@\texttt{docct2}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*docct2 v{-}{-} formats leading comments.}
\CommentTok{NB.}
\CommentTok{NB. This verb formats the  leading comments in a character table.}
\CommentTok{NB. There  are  three   basic  types  of  tables:  (1)  character}
\CommentTok{NB. representations  of  explicit  words with  leading  contigous}
\CommentTok{NB. comment blocks, (2) general J  scripts with leading contigous}
\CommentTok{NB. comment  blocks,  (3)  long  JOD documentation  text  without}
\CommentTok{NB. leading comments (no \textquotesingle{}NB.\textquotesingle{}s).  Long documentation follows the}
\CommentTok{NB. same formatting conventions without the leading \textquotesingle{}NB.\textquotesingle{}s}
\CommentTok{NB.}
\CommentTok{NB. Result is a character table.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  ctFormatted =. (iaWidth;iaStarPos;iaBlockIdx;clPfx) docct2 ctText}
\CommentTok{NB.}
\CommentTok{NB.   (41;0;1;\textquotesingle{}NB.\textquotesingle{}) docct2\_\_UT\_\_JODobj ];.\_1 LF,disp \textquotesingle{}docct2\textquotesingle{}             NB.(1)}
\CommentTok{NB.   (40;0;0;\textquotesingle{}NB.\textquotesingle{}) docct2\_\_UT\_\_JODobj ];.\_1 LF,(4 disp \textquotesingle{}scriptstub\textquotesingle{}){-}.CR NB.(2)}
\CommentTok{NB.   (57;0;0;\textquotesingle{}\textquotesingle{}) docct2\_\_UT\_\_JODobj ];.\_1 LF,(4 disp \textquotesingle{}docstub\textquotesingle{}){-}.CR       NB.(3)}

\CommentTok{NB. width, star{-}row, block{-}index, prefix}
\StringTok{\textquotesingle{}wid star blidx pfx\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}
\NormalTok{plen}\KeywordTok{=.} \KeywordTok{\#}\NormalTok{pfx}

\CommentTok{NB. get any first block of comments}
\KeywordTok{if.}\NormalTok{ plen }\KeywordTok{do.}
  \KeywordTok{if.} \KeywordTok{{-}.} \KeywordTok{+./}\NormalTok{b1}\KeywordTok{=.} \KeywordTok{+./"}\DecValTok{1} \RegionMarkerTok{(}\KeywordTok{,:}\NormalTok{ pfx}\RegionMarkerTok{)} \KeywordTok{E.} \KeywordTok{y} \KeywordTok{do.} \KeywordTok{y} \KeywordTok{return.} \KeywordTok{end.}
\NormalTok{  txt}\KeywordTok{=.} \RegionMarkerTok{((}\NormalTok{firstone b1}\RegionMarkerTok{)} \KeywordTok{+.}\NormalTok{ firstone }\KeywordTok{{-}.}\NormalTok{b1}\RegionMarkerTok{)} \KeywordTok{<;.}\DecValTok{1} \KeywordTok{y}
\KeywordTok{else.}
  \CommentTok{NB. the prefix is null {-} the first comment block is all text}
\NormalTok{  txt}\KeywordTok{=.} \KeywordTok{<y}
\KeywordTok{end.}

\KeywordTok{if.}\NormalTok{ blidx }\KeywordTok{>:} \KeywordTok{\#}\NormalTok{txt }\KeywordTok{do.} \KeywordTok{y} \KeywordTok{return.} \KeywordTok{else.}\NormalTok{ blk}\KeywordTok{=.} \KeywordTok{>}\NormalTok{ blidx }\KeywordTok{\{}\NormalTok{ txt }\KeywordTok{end.}
\KeywordTok{if.} \KeywordTok{+./} \RegionMarkerTok{(}\NormalTok{star}\KeywordTok{,}\NormalTok{plen}\RegionMarkerTok{)} \KeywordTok{>:} \KeywordTok{$}\NormalTok{blk }\KeywordTok{do.} \KeywordTok{y} \KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. apply formatting only to scriptdoc\textquotesingle{}ed text}
\KeywordTok{if.}\NormalTok{ SCRIPTDOCCHAR}\KeywordTok{=}\RegionMarkerTok{(}\KeywordTok{<}\NormalTok{star}\KeywordTok{;}\NormalTok{plen}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{blk }\KeywordTok{do.}

  \CommentTok{NB. clear scriptdoc mark remove any prefixes}
\NormalTok{  blk}\KeywordTok{=.} \StringTok{\textquotesingle{} \textquotesingle{}} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{star}\KeywordTok{;}\NormalTok{plen}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ blk}
  \KeywordTok{if.}\NormalTok{ plen }\KeywordTok{do.}\NormalTok{ blk}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\#}\NormalTok{pfx}\RegionMarkerTok{)} \KeywordTok{\}."}\DecValTok{1}\NormalTok{ ljust blk }\KeywordTok{end.}

  \CommentTok{NB. format comments remark for scriptdoc}
  \StringTok{\textquotesingle{}head tail\textquotesingle{}}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{wid}\KeywordTok{;}\NormalTok{DOCUMENTMARKS}\RegionMarkerTok{)}\NormalTok{ docfmt2 blk}
\NormalTok{  head}\KeywordTok{=.}\NormalTok{ SCRIPTDOCCHAR }\RegionMarkerTok{(}\KeywordTok{<}\NormalTok{star}\KeywordTok{;}\NormalTok{plen}\RegionMarkerTok{)}\KeywordTok{\}} \RegionMarkerTok{(}\NormalTok{pfx}\KeywordTok{,}\StringTok{\textquotesingle{} \textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{,"}\DecValTok{1}\NormalTok{ head}
\NormalTok{  tail}\KeywordTok{=.}\NormalTok{ pfx }\KeywordTok{,"}\DecValTok{1}\NormalTok{ tail}

  \CommentTok{NB. return formatted text}
  \KeywordTok{;} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{head}\KeywordTok{,}\NormalTok{tail}\RegionMarkerTok{)} \RegionMarkerTok{(}\NormalTok{blidx}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ txt}
\KeywordTok{else.}
  \KeywordTok{y}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{docfmt2}\AlertTok{=:}\index{docfmt2@\texttt{docfmt2}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*docfmt2 v{-}{-} formats comment region.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  (iaWid ; blclMarks) docfmt2 ct}
\CommentTok{NB.}
\CommentTok{NB.  (67;MONADMARK;DYADMARK) docfmt2 5\#,:\textquotesingle{}to comment or not to comment\textquotesingle{}}

\CommentTok{NB. text width and n marks}
\NormalTok{width}\KeywordTok{=.} \KeywordTok{>\{.} \KeywordTok{x}
\NormalTok{marks}\KeywordTok{=.} \KeywordTok{\}.} \KeywordTok{x}

\CommentTok{NB. leave all text following any marks alone}
\NormalTok{b}\KeywordTok{=.} \KeywordTok{+./"}\DecValTok{1} \KeywordTok{+./} \RegionMarkerTok{(}\KeywordTok{,:\&.>}\NormalTok{ marks}\RegionMarkerTok{)} \KeywordTok{E.\&>} \KeywordTok{<y}
\NormalTok{b}\KeywordTok{=.} \DecValTok{1} \RegionMarkerTok{(}\DecValTok{0}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ firstone }\KeywordTok{+./\textbackslash{}}\NormalTok{ b}
\StringTok{\textquotesingle{}head tail\textquotesingle{}} \KeywordTok{=.} \DecValTok{2} \KeywordTok{\{.} \RegionMarkerTok{(}\NormalTok{b }\KeywordTok{<;.}\DecValTok{1} \KeywordTok{y}\RegionMarkerTok{)}\KeywordTok{,<i.}\DecValTok{0} \DecValTok{0}

\CommentTok{NB. format paragraphs of head}
\NormalTok{head}\KeywordTok{=.}\NormalTok{ ljust head}
\NormalTok{head}\KeywordTok{=.}\NormalTok{ width textform2}\KeywordTok{\&.>} \RegionMarkerTok{(}\DecValTok{1}\RegionMarkerTok{(}\DecValTok{0}\RegionMarkerTok{)}\KeywordTok{\}*./"}\DecValTok{1}\StringTok{\textquotesingle{} \textquotesingle{}}\KeywordTok{=}\NormalTok{head}\RegionMarkerTok{)}\KeywordTok{<;.}\DecValTok{1}\NormalTok{ head}

\CommentTok{NB. remove null paragraphs, remerge and mark for scriptdoc}
\NormalTok{head}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{0} \KeywordTok{<} \KeywordTok{\#\&>}\NormalTok{ head}\RegionMarkerTok{)}\KeywordTok{\#}\NormalTok{head}
\NormalTok{head}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{{-}}\DecValTok{0}\KeywordTok{=\#}\NormalTok{tail}\RegionMarkerTok{)} \KeywordTok{\}.} \KeywordTok{;}\NormalTok{head}\KeywordTok{,\&.>} \StringTok{\textquotesingle{} \textquotesingle{}}

\CommentTok{NB. return formatted text and unformatted tail}
\NormalTok{head}\KeywordTok{;}\NormalTok{tail}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{doctext}\AlertTok{=:}\index{doctext@\texttt{doctext}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*doctext v{-}{-} formats long document, object and header text.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaObject doctext clName}
\CommentTok{NB.}
\CommentTok{NB.   0 doctext \textquotesingle{}word\textquotesingle{}}
\CommentTok{NB.   1 doctext \textquotesingle{}test\textquotesingle{}}

\KeywordTok{if.}\NormalTok{ badcl }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ jderr ERR001  }\CommentTok{NB. errmsg: invalid options}
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ checkput}\DecValTok{\_\_}\NormalTok{ST }\KeywordTok{y}   \KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ checknames}\DecValTok{\_\_}\NormalTok{ST }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.} \RegionMarkerTok{((}\DecValTok{1}\KeywordTok{=\#x}\RegionMarkerTok{)} \KeywordTok{*.} \RegionMarkerTok{(}\KeywordTok{\{.x}\RegionMarkerTok{)} \KeywordTok{e.}\NormalTok{ TEST}\KeywordTok{,}\NormalTok{MACRO}\RegionMarkerTok{)} \KeywordTok{+.} \KeywordTok{x} \KeywordTok{e.} \RegionMarkerTok{(}\NormalTok{GROUP}\KeywordTok{,}\NormalTok{SUITE}\RegionMarkerTok{)} \KeywordTok{,.} \DecValTok{1}  \KeywordTok{do.}
        \KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \KeywordTok{x}\NormalTok{ obtext }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ uv}\KeywordTok{=.} \KeywordTok{>\{:}\NormalTok{uv }\KeywordTok{end.}
        \CommentTok{NB. format leading comments of test, macro and group/suite header scripts}
\NormalTok{        DL}\KeywordTok{=.\{:\{.}\NormalTok{DPATH}\DecValTok{\_\_}\NormalTok{ST}
\NormalTok{        uv}\KeywordTok{=.}\NormalTok{ ctl }\RegionMarkerTok{(}\NormalTok{DOCUMENTWIDTH}\DecValTok{\_\_}\NormalTok{DL}\KeywordTok{;}\DecValTok{0}\KeywordTok{;}\DecValTok{0}\KeywordTok{;}\StringTok{\textquotesingle{}NB.\textquotesingle{}}\RegionMarkerTok{)}\NormalTok{ docct2 }\KeywordTok{];.}\NormalTok{\_}\DecValTok{1}\NormalTok{ LF}\KeywordTok{,}\NormalTok{uv}\KeywordTok{{-}.}\NormalTok{CR}
        \KeywordTok{if.} \KeywordTok{x{-}:}\NormalTok{MACRO }\KeywordTok{do.}
          \CommentTok{NB. format only J script macros}
          \KeywordTok{if.}\NormalTok{ badrc uv2}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{MACRO}\KeywordTok{,}\NormalTok{INCLASS}\RegionMarkerTok{)}\NormalTok{ get }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv2 }\KeywordTok{return.} \KeywordTok{end.}
          \CommentTok{NB. errmsg: macro is not a J script {-} not formatted}
          \KeywordTok{if.}\NormalTok{ JSCRIPT}\KeywordTok{=>\{:}\NormalTok{uv2 }\KeywordTok{do.} \KeywordTok{x}\NormalTok{ put }\KeywordTok{y;}\NormalTok{JSCRIPT}\KeywordTok{;}\NormalTok{uv }\KeywordTok{else.}\NormalTok{ jderr ERR0261 }\KeywordTok{end.}
        \KeywordTok{else.}
          \KeywordTok{x}\NormalTok{ put }\KeywordTok{y;}\NormalTok{uv}
        \KeywordTok{end.}
\KeywordTok{elseif.} \KeywordTok{{-}.} \RegionMarkerTok{(}\KeywordTok{<x}\RegionMarkerTok{)} \KeywordTok{e.} \KeywordTok{\{}\NormalTok{OBJECTNC}\KeywordTok{;}\NormalTok{DOCUMENT }\KeywordTok{do.}\NormalTok{ jderr ERR001}
\KeywordTok{elseif.} \KeywordTok{y=.} \KeywordTok{\}.}\NormalTok{ uv}
\NormalTok{        DL}\KeywordTok{=.\{:\{.}\NormalTok{DPATH}\DecValTok{\_\_}\NormalTok{ST}
\NormalTok{        badrc uv}\KeywordTok{=.} \RegionMarkerTok{((}\KeywordTok{x=.\{.x}\RegionMarkerTok{)}\KeywordTok{;<}\NormalTok{DL}\RegionMarkerTok{)}\NormalTok{ inputdict}\DecValTok{\_\_}\NormalTok{ST }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.} \KeywordTok{x}\NormalTok{ getdocument}\DecValTok{\_\_}\NormalTok{ST }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.do.}
  \CommentTok{NB. document text using same formatting}
  \CommentTok{NB. conventions applied to words.}
\NormalTok{  uv}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{1}\KeywordTok{;}\DecValTok{0} \DecValTok{1}\RegionMarkerTok{)}\KeywordTok{\{::}\NormalTok{ uv}
\NormalTok{  uv}\KeywordTok{=.} \KeywordTok{];.} \DecValTok{\_2} \RegionMarkerTok{(}\NormalTok{uv }\KeywordTok{{-}.}\NormalTok{ CR}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{LF}
\NormalTok{  uv}\KeywordTok{=.}\NormalTok{ ctl }\KeywordTok{;} \RegionMarkerTok{(}\NormalTok{DOCUMENTWIDTH}\DecValTok{\_\_}\NormalTok{DL}\KeywordTok{;}\NormalTok{DOCUMENTMARKS}\RegionMarkerTok{)}\NormalTok{ docfmt2 uv}
  \RegionMarkerTok{(}\KeywordTok{x,}\NormalTok{DOCUMENT}\RegionMarkerTok{)}\NormalTok{ put }\KeywordTok{y,<}\NormalTok{uv}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{docword}\AlertTok{=:}\index{docword@\texttt{docword}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*docword v{-}{-} formats the leading  comment block  in dictionary}
\CommentTok{NB. verbs, adverbs and conjunctions.  Nouns do not have  internal}
\CommentTok{NB. documentation. Attempts  to  document  a noun  results in  an}
\CommentTok{NB. error.}
\CommentTok{NB.}
\CommentTok{NB. Note: nouns do have  external  documentation in  the form  of}
\CommentTok{NB. short explanations and supplemental document text. See  (put)}
\CommentTok{NB. and (get).}
\CommentTok{NB.}
\CommentTok{NB. monad:  docword clName}

\KeywordTok{if.}\NormalTok{ badcl }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ jderr ERR001}
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ checkput}\DecValTok{\_\_}\NormalTok{ST }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ checknames}\DecValTok{\_\_}\NormalTok{ST }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.} \KeywordTok{y=.} \KeywordTok{\}.}\NormalTok{ uv}
\NormalTok{        DL}\KeywordTok{=.\{:\{.}\NormalTok{DPATH}\DecValTok{\_\_}\NormalTok{ST}
\NormalTok{        badrc uv}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{WORD}\KeywordTok{;<}\NormalTok{DL}\RegionMarkerTok{)}\NormalTok{ inputdict}\DecValTok{\_\_}\NormalTok{ST }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{WORD}\KeywordTok{,}\DecValTok{0}\RegionMarkerTok{)}\NormalTok{ getobjects}\DecValTok{\_\_}\NormalTok{ST }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv}
\KeywordTok{elseif.} \DecValTok{0} \KeywordTok{=} \RegionMarkerTok{(}\DecValTok{1}\KeywordTok{;}\DecValTok{0} \DecValTok{1}\RegionMarkerTok{)}\KeywordTok{\{::}\NormalTok{ uv }\KeywordTok{do.}
  \CommentTok{NB. errmsg: is a noun no internal document}
\NormalTok{  jderr }\StringTok{\textquotesingle{}<\textquotesingle{}}\KeywordTok{,}\RegionMarkerTok{(}\StringTok{\textquotesingle{} \textquotesingle{}} \KeywordTok{{-}.\textasciitilde{}} \KeywordTok{,>y}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}>\textquotesingle{}} \KeywordTok{,}\NormalTok{ ERR0250}
\KeywordTok{elseif.}\NormalTok{ cr}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{1}\KeywordTok{;}\DecValTok{0} \DecValTok{2}\RegionMarkerTok{)}\KeywordTok{\{::}\NormalTok{ uv}
\NormalTok{        cr}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{{-}}\NormalTok{LF }\KeywordTok{=} \KeywordTok{\{:}\NormalTok{cr}\RegionMarkerTok{)} \KeywordTok{\}.}\NormalTok{ cr}\KeywordTok{,}\NormalTok{LF}
        \CommentTok{NB. cr=. ctl DOCUMENTWIDTH\_\_DL docct ];.\_2 cr  NB. OLDCODE}
\NormalTok{        cr}\KeywordTok{=.}\NormalTok{ ctl }\RegionMarkerTok{(}\NormalTok{DOCUMENTWIDTH}\DecValTok{\_\_}\NormalTok{DL}\KeywordTok{;}\DecValTok{0}\KeywordTok{;}\DecValTok{1}\KeywordTok{;}\StringTok{\textquotesingle{}NB.\textquotesingle{}}\RegionMarkerTok{)}\NormalTok{ docct2 }\KeywordTok{];.}\NormalTok{\_}\DecValTok{2}\NormalTok{ cr}
\NormalTok{        uv}\KeywordTok{=.} \KeywordTok{,} \DecValTok{1} \KeywordTok{\{::}\NormalTok{ uv}
\NormalTok{        uv}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{cr}\RegionMarkerTok{)} \DecValTok{2}\KeywordTok{\}}\NormalTok{ uv}
\NormalTok{        badrc msg}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{WORD}\KeywordTok{,}\NormalTok{NVTABLE}\RegionMarkerTok{)}\NormalTok{ put uv }\KeywordTok{do.}\NormalTok{ msg}
\KeywordTok{elseif.do.}
  \RegionMarkerTok{(}\NormalTok{ok }\StringTok{\textquotesingle{}<\textquotesingle{}}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{>\{.}\NormalTok{uv}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}>\textquotesingle{}}\KeywordTok{,}\NormalTok{OK0250}\RegionMarkerTok{)}\KeywordTok{,\{:}\NormalTok{msg}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ed}\AlertTok{=:}\index{ed@\texttt{ed}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*ed v{-}{-} edit dictionary objects.}
\CommentTok{NB.}
\CommentTok{NB. (ed) typically fetches, formats and places object(s) in an edit window.}
\CommentTok{NB.}
\CommentTok{NB. monad:  ed cl|blcl|bt}
\CommentTok{NB.}
\CommentTok{NB.   ed \textquotesingle{}wordname\textquotesingle{}}
\CommentTok{NB.}
\CommentTok{NB.   ed ;:\textquotesingle{}many words mashed into one edit script\textquotesingle{}}
\CommentTok{NB.}
\CommentTok{NB.   NB. edit contents of (name,value) and (name,class,value) tables}
\CommentTok{NB.   ed ; \}. 0 10 get \}. dnl \textquotesingle{}re\textquotesingle{}}
\CommentTok{NB.   ed ; \}. 4 get \}. 4 dnl \textquotesingle{}build\textquotesingle{}}
\CommentTok{NB.}
\CommentTok{NB.   NB. place many backup versions in edit window}
\CommentTok{NB.   ed ; \}. bget <;.\_1 \textquotesingle{} word.12 word.11 word.09 word.02\textquotesingle{}}
\CommentTok{NB.   ed ; \}. 4 bget <;.\_1 \textquotesingle{}macro.9 macro.7 macro.2\textquotesingle{}}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaObject|ilObjOpt ed cl|blcl}
\CommentTok{NB.}
\CommentTok{NB.   1 ed \textquotesingle{}testname\textquotesingle{}           NB. edit test}
\CommentTok{NB.   0 9 ed \textquotesingle{}worddocument\textquotesingle{}     NB. document text associated with word}
\CommentTok{NB.   2 ed \textquotesingle{}group\textquotesingle{}              NB. generate entire group script and edit}
\CommentTok{NB.   2 1 ed \textquotesingle{}grouptext\textquotesingle{}        NB. edit only group text}

\DecValTok{0}\NormalTok{ ed }\KeywordTok{y}
\KeywordTok{:}
\KeywordTok{if.} \DecValTok{2}\KeywordTok{=\#$} \KeywordTok{y} \KeywordTok{do.}
  \KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ checknttab3 }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.}
  \KeywordTok{elseif.} \DecValTok{3} \KeywordTok{=} \KeywordTok{\{:$}\NormalTok{ uv}\KeywordTok{=.}\NormalTok{ rv uv   }\KeywordTok{do.}
    \KeywordTok{if.} \DecValTok{3} \KeywordTok{>:} \KeywordTok{<./}\NormalTok{ jc}\KeywordTok{=.} \KeywordTok{;}\DecValTok{1}\KeywordTok{\{"}\DecValTok{1}\NormalTok{ uv }\KeywordTok{do.}
      \CommentTok{NB. convert binary nouns to linear representations}
\NormalTok{      jc}\KeywordTok{=.} \KeywordTok{I.} \DecValTok{0}\KeywordTok{=}\NormalTok{jc}
      \KeywordTok{if.}\NormalTok{ badrc nv}\KeywordTok{=.} \DecValTok{0}\NormalTok{ nounlrep}\DecValTok{\_\_}\NormalTok{MK jc}\KeywordTok{\{}\NormalTok{uv }\KeywordTok{do.}\NormalTok{ nv }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{      uv}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{rv nv}\RegionMarkerTok{)}\NormalTok{ jc}\KeywordTok{\}}\NormalTok{ uv}
      \CommentTok{NB. format words for editing}
\NormalTok{      text}\KeywordTok{=.} \DecValTok{\_2} \KeywordTok{\}.} \KeywordTok{;} \RegionMarkerTok{(}\DecValTok{0} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ uv}\RegionMarkerTok{)} \KeywordTok{,.} \RegionMarkerTok{(}\KeywordTok{<}\StringTok{\textquotesingle{}=:\textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{,.} \RegionMarkerTok{(}\DecValTok{2} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ uv}\RegionMarkerTok{)} \KeywordTok{,.} \KeywordTok{<}\DecValTok{2}\KeywordTok{\#}\NormalTok{LF}
    \KeywordTok{else.}
      \CommentTok{NB. format non words for editing}
\NormalTok{      text}\KeywordTok{=.} \DecValTok{\_2} \KeywordTok{\}.} \KeywordTok{;} \RegionMarkerTok{(}\KeywordTok{\{:"}\DecValTok{1}\NormalTok{ uv}\RegionMarkerTok{)} \KeywordTok{,\&.>}  \KeywordTok{<}\DecValTok{2}\KeywordTok{\#}\NormalTok{LF}
    \KeywordTok{end.}
  \KeywordTok{elseif.do.}
    \CommentTok{NB. format non words for editing}
\NormalTok{    text}\KeywordTok{=.} \DecValTok{\_2} \KeywordTok{\}.} \KeywordTok{;} \RegionMarkerTok{(}\KeywordTok{\{:"}\DecValTok{1}\NormalTok{ uv}\RegionMarkerTok{)} \KeywordTok{,\&.>}  \KeywordTok{<}\DecValTok{2}\KeywordTok{\#}\NormalTok{LF}
  \KeywordTok{end.}
  \CommentTok{NB. set default object name {-} if there is more than one}
  \CommentTok{NB. object reset (x) to prevent affixing document command}
\NormalTok{  oname}\KeywordTok{=.} \KeywordTok{;}\DecValTok{0}\KeywordTok{\{}\DecValTok{0}\KeywordTok{\{}\NormalTok{uv }\KeywordTok{[} \KeywordTok{x=.}  \DecValTok{1} \KeywordTok{<} \KeywordTok{\#}\NormalTok{uv    }
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.} \KeywordTok{x}\NormalTok{ obtext }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.}
\KeywordTok{elseif.do.}
  \StringTok{\textquotesingle{}oname text\textquotesingle{}}\KeywordTok{=.} \KeywordTok{\}.}\NormalTok{uv}
\KeywordTok{end.}

\CommentTok{NB. append user defined document command}
\CommentTok{NB. the pattern \{\textasciitilde{}N\textasciitilde{}\} is a name placeholder, e.g.}
\CommentTok{NB.   DOCUMENTCOMMAND\_ijod\_ =: \textquotesingle{}showpass pr \textquotesingle{}\textquotesingle{}\{\textasciitilde{}N\textasciitilde{}\}\textquotesingle{}\textquotesingle{}\textquotesingle{}}
\CommentTok{NB. append only when editing single words}
\KeywordTok{if.} \RegionMarkerTok{(}\KeywordTok{x} \KeywordTok{{-}:} \DecValTok{0}\RegionMarkerTok{)} \KeywordTok{*.}\NormalTok{ wex }\KeywordTok{<}\StringTok{\textquotesingle{}DOCUMENTCOMMAND\_ijod\_\textquotesingle{}} \KeywordTok{do.}
\NormalTok{  text}\KeywordTok{=.}\NormalTok{ text}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\NormalTok{LF}\KeywordTok{,}\RegionMarkerTok{(}\StringTok{\textquotesingle{}/\{\textasciitilde{}N\textasciitilde{}\}/\textquotesingle{}}\KeywordTok{,}\NormalTok{oname}\RegionMarkerTok{)}\NormalTok{ changestr DOCUMENTCOMMAND\_ijod}\DecValTok{\_}
\KeywordTok{end.}

\NormalTok{oname et text}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{et}\AlertTok{=:}\index{et@\texttt{et}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*et v{-}{-} edit text}
\CommentTok{NB.}
\CommentTok{NB. monad:  et clText}
\CommentTok{NB. dyad:  clFile et clText}

\NormalTok{EDTEMP et }\KeywordTok{y}  \CommentTok{NB. default edit file}
\KeywordTok{:}
\CommentTok{NB. write to J temp directory {-} created by J install}
\KeywordTok{try.}

  \RegionMarkerTok{(}\NormalTok{toHOST }\KeywordTok{y}\RegionMarkerTok{)}\NormalTok{ write file}\KeywordTok{=.}\NormalTok{ jpath }\StringTok{\textquotesingle{}\textasciitilde{}temp/\textquotesingle{}} \KeywordTok{,} \KeywordTok{x} \KeywordTok{,}\NormalTok{ IJS}

  \CommentTok{NB. open in various editors !(*)=. IFJ6 IFWIN IFJHS IFQT IFIOS IFGTK open}
  \KeywordTok{if.} \KeywordTok{*/}\NormalTok{ wex }\KeywordTok{;:}\StringTok{\textquotesingle{}IFJ6 IFWIN\textquotesingle{}}  \KeywordTok{do.}
    \KeywordTok{if.}\NormalTok{ IFJ6 }\KeywordTok{*}\NormalTok{ IFWIN }\KeywordTok{do.}\NormalTok{ smopen\_jijs}\DecValTok{\_}\NormalTok{ file }\KeywordTok{return.} \KeywordTok{end.} \CommentTok{NB. J 6.0x win systems}
  \KeywordTok{end.}

  \KeywordTok{if.}\NormalTok{ IFQT }\KeywordTok{do.}\NormalTok{ open file  }\CommentTok{NB. jqt ide}

  \CommentTok{NB. JHS on macs {-} not tested recently}
  \CommentTok{NB. elseif. IFJHS *. wex <\textquotesingle{}wwd\_qjide\_\textquotesingle{} do. 0 0$(1!:2\&2) \textquotesingle{}$$$edit$$$\textquotesingle{},file  NB. qjide}

  \CommentTok{NB. JHS on win}
  \KeywordTok{elseif.}\NormalTok{ IFJHS }\KeywordTok{do.}\NormalTok{ edit\_jhs}\DecValTok{\_}\NormalTok{ file}

  \CommentTok{NB. running in jconsole on Windows systems}
  \CommentTok{NB. WARNING: there is no indication of fork failures}
  \CommentTok{NB. testing the existence of (EDCONSOLE) and the alleged}
  \CommentTok{NB. (file) for every edit operation would slow down normal use}
  \KeywordTok{elseif.}\NormalTok{ IFWIN }\KeywordTok{*.}\NormalTok{ IFJHS }\KeywordTok{+:}\NormalTok{ IFQT }\KeywordTok{do.}\NormalTok{ fork\_jtask}\DecValTok{\_}\NormalTok{ EDCONSOLE}\KeywordTok{,}\StringTok{\textquotesingle{} \textquotesingle{}}\KeywordTok{,}\NormalTok{file}

  \CommentTok{NB. remaining editors are marginal, deprecated or rarely used with JOD}

  \CommentTok{NB. iPhone/iPad}
  \KeywordTok{elseif.}\NormalTok{ IFIOS }\KeywordTok{do.}\NormalTok{ je\_z}\DecValTok{\_}\NormalTok{ file}

  \CommentTok{NB. GTK systems are deprecated}
  \KeywordTok{elseif.}\NormalTok{ wex }\KeywordTok{<}\StringTok{\textquotesingle{}IFGTK\textquotesingle{}} \KeywordTok{do.}
    \KeywordTok{if.}\NormalTok{ IFGTK }\KeywordTok{do.}\NormalTok{ open\_jgtk}\DecValTok{\_}\NormalTok{ file  }\KeywordTok{else.}\NormalTok{ jderr ERR0255 }\KeywordTok{end.} \CommentTok{NB. GTK}

  \KeywordTok{elseif.do.}\NormalTok{ jderr ERR0262  }\CommentTok{NB. errmsg: not supported on current J system}
  \KeywordTok{end.}

\KeywordTok{catch.}\NormalTok{ jderr ERR0255  }\CommentTok{NB. errmsg: unable to open TEMP/*.ijs for editing}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. extract object references from blcl of names}
\NormalTok{exobrefs}\AlertTok{=:}\index{exobrefs@\texttt{exobrefs}} \KeywordTok{a:"}\NormalTok{\_ }\KeywordTok{{-}.\textasciitilde{}} \KeywordTok{[:} \KeywordTok{\textasciitilde{}.} \KeywordTok{[:} \KeywordTok{;} \KeywordTok{[:} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1}\KeywordTok{\&.>} \RegionMarkerTok{(}\KeywordTok{[:} \KeywordTok{+./\textbackslash{}\&.>} \RegionMarkerTok{(}\KeywordTok{<}\StringTok{\textquotesingle{}\_\_\textquotesingle{}}\RegionMarkerTok{)}\KeywordTok{"}\NormalTok{\_ }\KeywordTok{E.\&.>} \KeywordTok{]}\RegionMarkerTok{)} \KeywordTok{\#\&.>} \KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gt}\AlertTok{=:}\index{gt@\texttt{gt}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*gt v{-}{-} get J script text from J temp directory.}
\CommentTok{NB.}
\CommentTok{NB. monad:  gt cl|zl}
\CommentTok{NB.}
\CommentTok{NB.   gt \textquotesingle{}\textquotesingle{}  NB. read text in 99 file}
\CommentTok{NB.   gt \textquotesingle{}whatever\textquotesingle{}}

\KeywordTok{if.}\NormalTok{ isempty }\KeywordTok{y} \KeywordTok{do.} \KeywordTok{y=.}\StringTok{\textquotesingle{}99\textquotesingle{}} \KeywordTok{end.}
\CommentTok{NB. use J temporary edit directory}
\CommentTok{NB. (jpath) is a J system utility loaded by standard profile}
\KeywordTok{try.}\NormalTok{   read jpath  }\StringTok{\textquotesingle{}\textasciitilde{}temp\textbackslash{}\textquotesingle{}}  \KeywordTok{,y} \KeywordTok{,}\NormalTok{ IJS}
\KeywordTok{catch.}\NormalTok{ jderr ERR0254}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. formats (jodhelp) command line and spawns browser or pdfreader}
\NormalTok{jodfork}\AlertTok{=:}\index{jodfork@\texttt{jodfork}} \KeywordTok{[:}\NormalTok{ fork\_jtask}\DecValTok{\_} \KeywordTok{[:} \KeywordTok{;} \DecValTok{1} \DecValTok{0} \DecValTok{2} \KeywordTok{\{} \StringTok{\textquotesingle{} \textquotesingle{}} \KeywordTok{;}\NormalTok{ qt}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{jodhelp}\AlertTok{=:}\index{jodhelp@\texttt{jodhelp}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*jodhelp v{-}{-} display JOD help.}
\CommentTok{NB.}
\CommentTok{NB. monad:  jodhelp uuIgnore}
\CommentTok{NB.}
\CommentTok{NB.   jodhelp \textquotesingle{}\textquotesingle{}  NB. display JOD help {-} start PDF browsing}

\NormalTok{jodpdf}\KeywordTok{=.}\NormalTok{ jpath }\StringTok{\textquotesingle{}\textasciitilde{}addons\textbackslash{}general\textbackslash{}joddocument\textbackslash{}pdfdoc\textbackslash{}jod.pdf\textquotesingle{}}
\KeywordTok{if.}\NormalTok{ fex}\KeywordTok{<}\NormalTok{jodpdf }\KeywordTok{do.}
  \CommentTok{NB. jod.pdf is installed and local}
\NormalTok{  pdfrdr}\KeywordTok{=.}\NormalTok{ pdfreader }\DecValTok{0}
  \KeywordTok{if.}\NormalTok{ UNAME}\KeywordTok{{-}:}\StringTok{\textquotesingle{}Darwin\textquotesingle{}} \KeywordTok{do.}
    \CommentTok{NB. require \textquotesingle{}task\textquotesingle{} !(*)=. shell}
\NormalTok{    ok OK0255 }\KeywordTok{[}\NormalTok{ shell pdfrdr}\KeywordTok{,}\StringTok{\textquotesingle{} \textquotesingle{}}\KeywordTok{,}\NormalTok{qt jodpdf }\CommentTok{NB. msg starting PDF reader}
  \KeywordTok{elseif.}\NormalTok{ fex}\KeywordTok{<}\NormalTok{pdfrdr }\KeywordTok{do.}
    \CommentTok{NB. spawn PDF browse task {-} requires configured PDF reader on host}
\NormalTok{    ok OK0255 }\KeywordTok{[}\NormalTok{ jodfork pdfrdr}\KeywordTok{;}\NormalTok{jodpdf}
  \KeywordTok{elseif.do.}
    \RegionMarkerTok{(}\NormalTok{jderr ERR0260}\RegionMarkerTok{)}\KeywordTok{,<}\NormalTok{pdfrdr }\CommentTok{NB. errmsg: PDF reader not found}
  \KeywordTok{end.}
\KeywordTok{else.}
  \CommentTok{NB. jod.pdf is not installed advise user to download joddocument addon}
\NormalTok{  ok OK0256 }\CommentTok{NB. msg: jod.pdf not installed {-} use JAL to install the addon general/joddocument}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. left justify table}
\NormalTok{ljust}\AlertTok{=:}\index{ljust@\texttt{ljust}} \StringTok{\textquotesingle{} \textquotesingle{}}\KeywordTok{\&$:} \KeywordTok{:}\RegionMarkerTok{(}\KeywordTok{]} \KeywordTok{|."}\NormalTok{\_}\DecValTok{1}\KeywordTok{\textasciitilde{}} \KeywordTok{i."}\DecValTok{1}\KeywordTok{\&}\DecValTok{0}\KeywordTok{@}\RegionMarkerTok{(}\KeywordTok{]} \KeywordTok{e.} \KeywordTok{[}\RegionMarkerTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{obtext}\AlertTok{=:}\index{obtext@\texttt{obtext}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*obtext v{-}{-} assembles and returns object text}
\CommentTok{NB.}
\CommentTok{NB. dyad:  bt =. iaObject obtext blcl}

\KeywordTok{if.}\NormalTok{ badrc text}\KeywordTok{=.}\NormalTok{ checkopen}\DecValTok{\_\_}\NormalTok{ST }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ text }\KeywordTok{return.} \KeywordTok{end.}
\KeywordTok{select.} \KeywordTok{x}
\KeywordTok{case.}\NormalTok{ WORD }\KeywordTok{do.}
  \KeywordTok{if.}\NormalTok{ badrc }\KeywordTok{y=.}\NormalTok{ checknames}\DecValTok{\_\_}\NormalTok{ST }\KeywordTok{y} \KeywordTok{do.} \KeywordTok{y} \KeywordTok{return.} \KeywordTok{else.} \KeywordTok{y=.} \KeywordTok{\}.y} \KeywordTok{end.}
  \KeywordTok{if.}\NormalTok{ badrc text}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{WORD}\KeywordTok{,}\NormalTok{NVTABLE}\RegionMarkerTok{)}\NormalTok{ get }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ text }\KeywordTok{return.} \KeywordTok{end.}
  \KeywordTok{if.}\NormalTok{ badrc text}\KeywordTok{=.}\NormalTok{ WORD wttext}\DecValTok{\_\_}\NormalTok{MK rv text }\KeywordTok{do.}\NormalTok{ text }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ text}\KeywordTok{=.}\NormalTok{ rv text }\KeywordTok{end.}
\NormalTok{  file}\KeywordTok{=.} \KeywordTok{>\{.y}
\KeywordTok{case.}\NormalTok{ DICTIONARY }\KeywordTok{do.}
  \KeywordTok{if.}\NormalTok{ badrc text}\KeywordTok{=.}\NormalTok{ DICTIONARY get }\StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{do.}\NormalTok{ text }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ text}\KeywordTok{=.}\NormalTok{ rv text }\KeywordTok{end.}
\NormalTok{  file}\KeywordTok{=.} \RegionMarkerTok{(}\StringTok{\textquotesingle{} \textquotesingle{}} \KeywordTok{{-}.\textasciitilde{}} \KeywordTok{;}\DecValTok{0}\KeywordTok{\{}\DecValTok{0}\KeywordTok{\{}\NormalTok{DPATH}\DecValTok{\_\_}\NormalTok{ST}\DecValTok{\_\_}\NormalTok{JODobj}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}\_DTXT\textquotesingle{}} \CommentTok{NB. HARDCODE document text suffix}
\KeywordTok{case.}\NormalTok{ SUITE}\KeywordTok{;}\NormalTok{GROUP }\KeywordTok{do.}
  \KeywordTok{if.}\NormalTok{ badrc text}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{x,}\DecValTok{2}\RegionMarkerTok{)}\NormalTok{ make }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ text }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ text}\KeywordTok{=.}\NormalTok{ rv text }\KeywordTok{end.}
\NormalTok{  file}\KeywordTok{=.} \KeywordTok{y} \KeywordTok{{-}.} \StringTok{\textquotesingle{} \textquotesingle{}}
\KeywordTok{case.}\NormalTok{ TEST}\KeywordTok{;}\NormalTok{MACRO }\KeywordTok{do.}
  \KeywordTok{if.}\NormalTok{ badrc }\KeywordTok{y=.}\NormalTok{ checknames}\DecValTok{\_\_}\NormalTok{ST }\KeywordTok{y} \KeywordTok{do.} \KeywordTok{y} \KeywordTok{return.} \KeywordTok{else.} \KeywordTok{y=.} \KeywordTok{\}.y} \KeywordTok{end.}
  \KeywordTok{if.}\NormalTok{ badrc text}\KeywordTok{=.} \KeywordTok{x}\NormalTok{ get }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ text }\KeywordTok{return.} \KeywordTok{end.}
  \KeywordTok{if.}\NormalTok{ badrc text}\KeywordTok{=.} \KeywordTok{x}\NormalTok{ wttext}\DecValTok{\_\_}\NormalTok{MK rv text }\KeywordTok{do.}\NormalTok{ text }\KeywordTok{return.} \KeywordTok{else.}\NormalTok{ text}\KeywordTok{=.}\NormalTok{ rv text }\KeywordTok{end.}
\NormalTok{  file}\KeywordTok{=.} \KeywordTok{>\{.y}
\KeywordTok{case.do.}
  \KeywordTok{if.} \RegionMarkerTok{(}\KeywordTok{<x}\RegionMarkerTok{)} \KeywordTok{e.} \KeywordTok{\{}\RegionMarkerTok{(}\NormalTok{SUITE}\KeywordTok{,}\NormalTok{GROUP}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{HEADER  }\KeywordTok{do.}
    \CommentTok{NB. group and suite headers are frequently edited}
    \KeywordTok{if.}\NormalTok{ badcl }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ jderr ERR0154}\DecValTok{\_\_}\NormalTok{MK }\KeywordTok{return.} \KeywordTok{end.}
    \KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\{.x}\RegionMarkerTok{)}\NormalTok{ get }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{else.} \StringTok{\textquotesingle{}file text\textquotesingle{}}\KeywordTok{=.} \KeywordTok{,}\NormalTok{ rv uv }\KeywordTok{end.}
  \KeywordTok{elseif.} \RegionMarkerTok{(}\KeywordTok{<x}\RegionMarkerTok{)} \KeywordTok{e.} \KeywordTok{,\{}\NormalTok{OBJECTNC}\KeywordTok{;}\NormalTok{DOCUMENT}\KeywordTok{,}\NormalTok{EXPLAIN }\KeywordTok{do.}
    \CommentTok{NB. get object documentation text}
    \KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \KeywordTok{x}\NormalTok{ get }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.}
    \KeywordTok{else.}
      \CommentTok{NB. merge all document texts}
\NormalTok{      file}\KeywordTok{=.} \KeywordTok{>\{.\{.}\NormalTok{ uv}\KeywordTok{=.}\NormalTok{ rv uv}
\NormalTok{      text}\KeywordTok{=.} \KeywordTok{;} \RegionMarkerTok{(}\KeywordTok{\{:"}\DecValTok{1}\NormalTok{ uv}\RegionMarkerTok{)} \KeywordTok{,\&.>} \KeywordTok{<}\DecValTok{2}\KeywordTok{\#}\NormalTok{LF  }\CommentTok{NB. HARDCODE 2}
     \KeywordTok{end.}
  \KeywordTok{elseif.do.}
\NormalTok{    jderr ERR001 }\KeywordTok{return.} \CommentTok{NB. errmsg: invalid option(s)}
  \KeywordTok{end.}
\KeywordTok{end.}
\NormalTok{ok file}\KeywordTok{;}\NormalTok{text}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdfreader}\AlertTok{=:}\index{pdfreader@\texttt{pdfreader}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*pdfreader v{-}{-} returns a pdf reader from available options.}
\CommentTok{NB.}
\CommentTok{NB. monad:  clPDFExe =. pdfreader uuIgnore}

\CommentTok{NB. prefer J\textquotesingle{}s pdf readers otherwise take JOD reader !(*)=. PDFREADER}
\KeywordTok{if.}\NormalTok{ wex}\KeywordTok{<}\StringTok{\textquotesingle{}PDFREADER\_\_UT\_\_JODobj\textquotesingle{}} \KeywordTok{do.}\NormalTok{ pdfrdr}\KeywordTok{=.}\NormalTok{ PDFREADER}\DecValTok{\_\_}\NormalTok{UT}\DecValTok{\_\_}\NormalTok{JODobj }\KeywordTok{else.}\NormalTok{ pdfrdr}\KeywordTok{=.}\StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{end.}

\CommentTok{NB. on Mac\textquotesingle{}s use the open command for PDF\textquotesingle{}s}
\KeywordTok{if.}\NormalTok{     UNAME}\KeywordTok{{-}:}\StringTok{\textquotesingle{}Darwin\textquotesingle{}}    \KeywordTok{do.}\NormalTok{ pdfrdr}\KeywordTok{=.}\NormalTok{ PDFREADERMAC}
\KeywordTok{elseif.}\NormalTok{ wex}\KeywordTok{<}\StringTok{\textquotesingle{}PDFReader\_j\_\textquotesingle{}} \KeywordTok{do.} \KeywordTok{if.} \DecValTok{0}\KeywordTok{<\#}\NormalTok{PDFReader}\DecValTok{\_j\_} \KeywordTok{do.}\NormalTok{ pdfrdr}\KeywordTok{=.}\NormalTok{ PDFReader}\DecValTok{\_j\_} \KeywordTok{end.} \CommentTok{NB. J 7.0x}
\KeywordTok{elseif.}\NormalTok{ wex}\KeywordTok{<}\StringTok{\textquotesingle{}PDFREADER\_j\_\textquotesingle{}} \KeywordTok{do.} \KeywordTok{if.} \DecValTok{0}\KeywordTok{<\#}\NormalTok{PDFREADER}\DecValTok{\_j\_} \KeywordTok{do.}\NormalTok{ pdfrdr}\KeywordTok{=.}\NormalTok{ PDFREADER}\DecValTok{\_j\_} \KeywordTok{end.} \CommentTok{NB. J 6.0x}
\KeywordTok{end.}

\NormalTok{pdfrdr}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{reb}\AlertTok{=:}\index{reb@\texttt{reb}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*reb v{-}{-} removes redundant blanks {-} leading, trailing multiple}
\CommentTok{NB.}
\CommentTok{NB. monad:  reb cl}
\CommentTok{NB. dyad:  ua reb ul}

\StringTok{\textquotesingle{} \textquotesingle{}}\NormalTok{ reb }\KeywordTok{y}
\KeywordTok{:}
\KeywordTok{y=.} \KeywordTok{x} \KeywordTok{,} \KeywordTok{y}
\NormalTok{b}\KeywordTok{=.} \KeywordTok{x} \KeywordTok{=} \KeywordTok{y}
\KeywordTok{\}.}\RegionMarkerTok{(}\NormalTok{b}\KeywordTok{*:} \DecValTok{1}\KeywordTok{|.}\NormalTok{b}\RegionMarkerTok{)}\KeywordTok{\#y}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{revo}\AlertTok{=:}\index{revo@\texttt{revo}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*revo v{-}{-} recently revised objects. Lists recently changed put}
\CommentTok{NB. dictionary objects in order of latest to oldest.}
\CommentTok{NB.}
\CommentTok{NB. monad:  revo zl | cl}
\CommentTok{NB.}
\CommentTok{NB.   revo \textquotesingle{}\textquotesingle{}     NB. all put dictionary words in revision order}
\CommentTok{NB.   revo \textquotesingle{}pat\textquotesingle{}  NB. recently changed words beginning with \textquotesingle{}pat\textquotesingle{}}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaObject revo zl | cl}
\CommentTok{NB.}
\CommentTok{NB.   1 revo \textquotesingle{}\textquotesingle{}   NB. all revised tests}
\CommentTok{NB.   2 revo \textquotesingle{}g\textquotesingle{}  NB. recently changed groups beginning with \textquotesingle{}g\textquotesingle{}}

\NormalTok{WORD revo }\KeywordTok{y}  \CommentTok{NB. word default}
\KeywordTok{:}
\KeywordTok{if.}\NormalTok{ badil }\KeywordTok{x} \KeywordTok{do.}\NormalTok{ jderr ERR001}
\KeywordTok{elseif.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{((}\KeywordTok{x=.\{.x}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{\_}\DecValTok{1}\RegionMarkerTok{)}\NormalTok{ dnl }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv  }\CommentTok{NB. HARDCODE \_1}
\KeywordTok{elseif.}\NormalTok{ isempty new}\KeywordTok{=.}\NormalTok{rv uv }\KeywordTok{do.}\NormalTok{ ok new  }\CommentTok{NB. no matches}
\KeywordTok{elseif.do.}
\NormalTok{  age}\KeywordTok{=.}\NormalTok{ rv }\RegionMarkerTok{(}\KeywordTok{x,}\NormalTok{INPUT}\RegionMarkerTok{)}\NormalTok{ get new    }\CommentTok{NB. last put timestamps}
\NormalTok{  ok }\RegionMarkerTok{(}\KeywordTok{\textbackslash{}:}\NormalTok{ age}\RegionMarkerTok{)} \KeywordTok{\{}\NormalTok{ new}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rm}\AlertTok{=:}\index{rm@\texttt{rm}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*rm v{-}{-} runs J macro scripts}
\CommentTok{NB.}
\CommentTok{NB. monad:  rm cl|blcl}
\CommentTok{NB. dyad:  pa rm cl|blcl}

\CommentTok{NB. (/:)=: obfuscate names}
\DecValTok{0}\NormalTok{ rm }\KeywordTok{y}
\KeywordTok{:}
\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ MACRO get }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{uv}\KeywordTok{=.}\NormalTok{ rv uv}

\KeywordTok{if.} \KeywordTok{*./}\NormalTok{um}\KeywordTok{=.}\NormalTok{ JSCRIPT }\KeywordTok{=} \KeywordTok{;} \DecValTok{1} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ uv }\KeywordTok{do.}

\NormalTok{  scr}\KeywordTok{=.} \KeywordTok{;}\RegionMarkerTok{(}\KeywordTok{\{:"}\DecValTok{1}\NormalTok{ uv}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ LF}
\NormalTok{  curr}\KeywordTok{=.} \DecValTok{18}\KeywordTok{!:}\DecValTok{5} \StringTok{\textquotesingle{}\textquotesingle{}}

  \KeywordTok{try.}
    \CommentTok{NB. j profile !(*)=. cocurrent}
    \CommentTok{NB. run from base, (display default, suppress x.{-}:1) stop on errors}
\NormalTok{    cocurrent }\StringTok{\textquotesingle{}base\textquotesingle{}}
    \KeywordTok{if.} \KeywordTok{x{-}:}\DecValTok{1} \KeywordTok{do.} \DecValTok{0}\KeywordTok{!:}\DecValTok{100}\NormalTok{ scr }\KeywordTok{else.} \DecValTok{0}\KeywordTok{!:}\DecValTok{101}\NormalTok{ scr }\KeywordTok{end.}
\NormalTok{    cocurrent curr}
  \KeywordTok{catchd.}
\NormalTok{    cocurrent curr  }\CommentTok{NB. restore locale}
    \RegionMarkerTok{(}\NormalTok{jderr ERR0256}\RegionMarkerTok{)}\KeywordTok{,<}\DecValTok{13}\KeywordTok{!:}\DecValTok{12} \StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{return.}
  \KeywordTok{end.}

\KeywordTok{else.}
  \CommentTok{NB. errmsg: not J script(s)}
  \RegionMarkerTok{(}\NormalTok{jderr ERR0252}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{um}\RegionMarkerTok{)}\KeywordTok{\#\{."}\DecValTok{1}\NormalTok{ uv}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rtt}\AlertTok{=:}\index{rtt@\texttt{rtt}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*rtt v{-}{-} runs J test scripts}
\CommentTok{NB.}
\CommentTok{NB. monad:  rtt cl|blcl}
\CommentTok{NB.}
\CommentTok{NB.   rtt \textquotesingle{}runmytautology\textquotesingle{}}
\CommentTok{NB.   rtt ;: \textquotesingle{}run these tautology tests in order\textquotesingle{}}
\CommentTok{NB.}
\CommentTok{NB. dyad:}
\CommentTok{NB.}
\CommentTok{NB.   0 rtt \textquotesingle{}tautology\textquotesingle{}}
\CommentTok{NB.   1 rtt \textquotesingle{}silenttautology\textquotesingle{}}
\CommentTok{NB.   2 rtt \textquotesingle{}plaintest\textquotesingle{}}
\CommentTok{NB.   3 rtt \textquotesingle{}suite\textquotesingle{}   NB. make and run tautology test suite}
\CommentTok{NB.   4 rtt \textquotesingle{}suite\textquotesingle{}   NB. make suite and run silently}

\DecValTok{0}\NormalTok{ rtt }\KeywordTok{y}
\KeywordTok{:}

\CommentTok{NB. HARDCODE: option codes (/:)=: obfuscate names}
\KeywordTok{if.} \RegionMarkerTok{(}\DecValTok{3}\KeywordTok{{-}:x}\RegionMarkerTok{)} \KeywordTok{+.} \DecValTok{4}\KeywordTok{{-}:x} \KeywordTok{do.}
  \KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{SUITE}\KeywordTok{,}\NormalTok{\_}\DecValTok{2}\RegionMarkerTok{)}\NormalTok{ make }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{  scr}\KeywordTok{=.}\NormalTok{rv uv}
  \KeywordTok{x=.} \KeywordTok{x{-}}\DecValTok{3} \CommentTok{NB. run option}
\KeywordTok{else.}
  \KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ TEST get }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{  uv}\KeywordTok{=.}\NormalTok{ rv uv}
\NormalTok{  scr}\KeywordTok{=.} \KeywordTok{;}\RegionMarkerTok{(}\KeywordTok{\{:"}\DecValTok{1}\NormalTok{ uv}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ LF}
\KeywordTok{end.}

\NormalTok{curr}\KeywordTok{=.} \DecValTok{18}\KeywordTok{!:}\DecValTok{5} \StringTok{\textquotesingle{}\textquotesingle{}}

\CommentTok{NB. j profile !(*)=. cocurrent}
\CommentTok{NB. run from base, (display default, suppress x{-}:1), stop on errors}
\NormalTok{cocurrent }\StringTok{\textquotesingle{}base\textquotesingle{}}
\KeywordTok{try.}
  \KeywordTok{if.} \DecValTok{0}\KeywordTok{{-}:x}     \KeywordTok{do.} \DecValTok{0}\KeywordTok{!:}\DecValTok{2}\NormalTok{ scr}
  \CommentTok{NB. Note: silent execution that fails suppresses all output}
  \KeywordTok{elseif.} \DecValTok{1}\KeywordTok{{-}:x} \KeywordTok{do.} \RegionMarkerTok{(}\KeywordTok{]} \KeywordTok{[} \DecValTok{1}\KeywordTok{!:}\DecValTok{2}\KeywordTok{\&}\DecValTok{2}\RegionMarkerTok{)} \DecValTok{0}\KeywordTok{!:}\DecValTok{3}\NormalTok{ scr}
  \KeywordTok{elseif.} \DecValTok{2}\KeywordTok{{-}:x} \KeywordTok{do.} \DecValTok{0}\KeywordTok{!:}\DecValTok{001}\NormalTok{ scr}
  \KeywordTok{elseif.do.}
\NormalTok{    cocurrent curr}
\NormalTok{    jderr ERR001 }\KeywordTok{return.}
  \KeywordTok{end.}
\KeywordTok{catchd.}
\NormalTok{  cocurrent curr}
  \RegionMarkerTok{(}\NormalTok{jderr ERR0256}\RegionMarkerTok{)}\KeywordTok{,<}\DecValTok{13}\KeywordTok{!:}\DecValTok{12} \StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{return.}
\KeywordTok{end.}

\CommentTok{NB. back to original locale}
\NormalTok{cocurrent curr}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{textform2}\AlertTok{=:}\index{textform2@\texttt{textform2}} \DecValTok{63}\KeywordTok{\&$:} \KeywordTok{:}\RegionMarkerTok{(}\DecValTok{4} \RegionMarkerTok{: 0)}

\CommentTok{NB.*textform2 v{-}{-} wraps and justifies character table (y).}
\CommentTok{NB.}
\CommentTok{NB. This  verb forms an  (n*len)  character matrix. The blanks in}
\CommentTok{NB. each  row of the output matrix are padded so that the line is}
\CommentTok{NB. right  and left justified.  The number  of rows in the output}
\CommentTok{NB. table depends upon how many are needed to hold the input data}
\CommentTok{NB. in the justified format.}
\CommentTok{NB.}
\CommentTok{NB. Note: This verb is  a verbatim translation of  an APL utility}
\CommentTok{NB. and has not been optimized for J.}
\CommentTok{NB.}
\CommentTok{NB. monad:  cmWrap =. textform2 c[0..2]Text}
\CommentTok{NB.}
\CommentTok{NB.   textform2 1000$\textquotesingle{} How can I justify this ehh. \textquotesingle{}}
\CommentTok{NB.}
\CommentTok{NB. dyad:  cmWrap =. iaWidth textform2 c[0..2]Text}
\CommentTok{NB.}
\CommentTok{NB.   50 textform2 10\#,:\textquotesingle{} four score and seven years ago our \textquotesingle{}}

\NormalTok{i}\KeywordTok{=.} \DecValTok{0}
\KeywordTok{v=.}\NormalTok{ reb }\KeywordTok{,} \KeywordTok{y} \KeywordTok{,"}\DecValTok{1} \StringTok{\textquotesingle{} \textquotesingle{}}
\NormalTok{j}\KeywordTok{=.} \KeywordTok{\#v}
\NormalTok{b}\KeywordTok{=.}\NormalTok{ j}\KeywordTok{$}\DecValTok{0}
\KeywordTok{while.}\NormalTok{ j }\KeywordTok{>}\NormalTok{ a}\KeywordTok{=.}\NormalTok{ i }\KeywordTok{+} \KeywordTok{x} \KeywordTok{do.}
\NormalTok{  k}\KeywordTok{=.}\NormalTok{  i }\KeywordTok{+} \KeywordTok{i.} \KeywordTok{>:}\NormalTok{a }\KeywordTok{{-}}\NormalTok{ i}
  \KeywordTok{if.} \KeywordTok{\#}\NormalTok{c}\KeywordTok{=.} \RegionMarkerTok{(}\StringTok{\textquotesingle{} \textquotesingle{}} \KeywordTok{=}\NormalTok{ k}\KeywordTok{\{v}\RegionMarkerTok{)}\KeywordTok{\#}\NormalTok{k }\KeywordTok{do.}
\NormalTok{    i}\KeywordTok{=.} \KeywordTok{>:} \KeywordTok{\{:}\NormalTok{ c}
\NormalTok{    g}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\{:}\NormalTok{k}\RegionMarkerTok{)} \KeywordTok{{-}} \KeywordTok{<:}\NormalTok{i}
\NormalTok{    c}\KeywordTok{=.} \RegionMarkerTok{(}\DecValTok{1} \KeywordTok{>.} \KeywordTok{<:\#}\NormalTok{c}\RegionMarkerTok{)} \KeywordTok{\{.}\NormalTok{ c}
\NormalTok{    f}\KeywordTok{=.} \KeywordTok{\#}\NormalTok{c}
\NormalTok{    d}\KeywordTok{=.}\NormalTok{ f }\KeywordTok{$} \KeywordTok{<.}\NormalTok{ g}\KeywordTok{\%}\NormalTok{f}
\NormalTok{    d}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{>:\{.}\NormalTok{d}\RegionMarkerTok{)} \RegionMarkerTok{(}\KeywordTok{i.}\NormalTok{ f}\KeywordTok{|}\NormalTok{g}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ d}
\NormalTok{    b}\KeywordTok{=.}\NormalTok{ d }\RegionMarkerTok{((}\NormalTok{f}\KeywordTok{?}\NormalTok{f}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{c}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{ b}
  \KeywordTok{else.}
\NormalTok{    b}\KeywordTok{=.} \DecValTok{1}\NormalTok{ a}\KeywordTok{\}}\NormalTok{ b}
\NormalTok{    i}\KeywordTok{=.}\NormalTok{ a}
  \KeywordTok{end.}
\KeywordTok{end.}
\KeywordTok{v=.} \RegionMarkerTok{(}\KeywordTok{>:}\NormalTok{b}\RegionMarkerTok{)} \KeywordTok{\#} \KeywordTok{v}
\NormalTok{e}\KeywordTok{=.} \KeywordTok{>:} \KeywordTok{x}
\NormalTok{r}\KeywordTok{=.} \KeywordTok{>.}\RegionMarkerTok{(}\KeywordTok{\#v}\RegionMarkerTok{)} \KeywordTok{\%}\NormalTok{ e}
\RegionMarkerTok{(}\NormalTok{r}\KeywordTok{,x}\RegionMarkerTok{)} \KeywordTok{\{.} \RegionMarkerTok{(}\NormalTok{r}\KeywordTok{,}\NormalTok{e}\RegionMarkerTok{)}\KeywordTok{$}\RegionMarkerTok{(}\NormalTok{e}\KeywordTok{*}\NormalTok{r}\RegionMarkerTok{)}\KeywordTok{\{.v}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}
