\section{\texttt{joddob} Source Code}

\begin{JODGroupHeader}
\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. *joddob c{-}{-} directory object class: extension of (jodstore).}
\CommentTok{NB.}
\CommentTok{NB. Directory objects are created when dictionaries are opened}
\CommentTok{NB. and destroyed when they are closed.  Directory objects contain}
\CommentTok{NB. a set of nouns and verbs that manage *.ijf file directories.}
\CommentTok{NB.}
\CommentTok{NB. Interface nouns \& verbs:}
\CommentTok{NB.   (many nouns are indirectly \_\_ referenced)}
\CommentTok{NB.   dfclose     close dictionary file}
\CommentTok{NB.   dfopen      open dictionary file}
\CommentTok{NB.   dfp         directory file paths}
\CommentTok{NB.   dncn        name of main directory component noun}
\CommentTok{NB.   dnix        name of main directory index noun}
\CommentTok{NB.   dnnc        name of class noun}
\CommentTok{NB.   dnnm        visible object names}
\CommentTok{NB.   dropdir     erase directory nouns}
\CommentTok{NB.   dropnc      erase class/type nouns}
\CommentTok{NB.   dropref     erase reference nouns}
\CommentTok{NB.   gettstamps  reads creation and lastput date timestamps}
\CommentTok{NB.   loaddir     load directory}
\CommentTok{NB.   loadnc      load word and macro class/types}
\CommentTok{NB.   loadref     load references}
\CommentTok{NB.   loadstamps  load time stamps}
\CommentTok{NB.   packdict    packs dictionary and saves old files as a backup}
\CommentTok{NB.   packspace   tests for sufficient backup space}
\CommentTok{NB.   puttstamps  update inverted creation and lastput timestamps}
\CommentTok{NB.   restdict    restores most recent backup created by (packdict)}
\CommentTok{NB.   restspace   tests for sufficient restore space}
\CommentTok{NB.   savedir     save directory}
\CommentTok{NB.   saveref     save references}
\CommentTok{NB.}
\CommentTok{NB. Notes:}
\CommentTok{NB.   Error messages (JODdob range 200{-}249)}

\NormalTok{coclass }\StringTok{\textquotesingle{}ajoddob\textquotesingle{}}
\NormalTok{coinsert }\StringTok{\textquotesingle{}ajodstore\textquotesingle{}}

\CommentTok{NB.*dependents x{-}{-} JODdob dependent definitions}

\CommentTok{NB. directory noun name prefixes}
\NormalTok{DIRNMS}\AlertTok{=:}\index{DIRNMS@\texttt{DIRNMS}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} WORD TEST GROUP SUITE MACRO\textquotesingle{}}

\CommentTok{NB. directory noun suffixes {-} order matters}
\NormalTok{DTSIXCN}\AlertTok{=:}\index{DTSIXCN@\texttt{DTSIXCN}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} TS IX CN\textquotesingle{}}

\CommentTok{NB. timestamp, index list and component noun names}
\RegionMarkerTok{(}\KeywordTok{;:}\StringTok{\textquotesingle{}DIRTS DIRIX DIRCN\textquotesingle{}}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}  \KeywordTok{<"}\DecValTok{1} \KeywordTok{|:}\NormalTok{ DIRNMS }\KeywordTok{,\&.>/}\NormalTok{ DTSIXCN}

\CommentTok{NB. name class and macro type noun names}
\NormalTok{DIRNC}\AlertTok{=:}\index{DIRNC@\texttt{DIRNC}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} WORDNC MACRONC\textquotesingle{}}

\CommentTok{NB. reference objects}
\NormalTok{DIRRFN}\AlertTok{=:}\index{DIRRFN@\texttt{DIRRFN}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} WORDREF TESTREF\textquotesingle{}}

\CommentTok{NB. reference timestamp, index list and component noun names}
\RegionMarkerTok{(}\KeywordTok{;:}\StringTok{\textquotesingle{}REFTS REFIX REFCN\textquotesingle{}}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}  \KeywordTok{<"}\DecValTok{1} \KeywordTok{|:}\NormalTok{ DIRRFN }\KeywordTok{,\&.>/}\NormalTok{ DTSIXCN}

\CommentTok{NB.*enddependents}
\CommentTok{NB.*end{-}header}
\end{Highlighting}
\end{Shaded}
\end{JODGroupHeader}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. backup directory noun prefix}
\NormalTok{BAKPFX}\AlertTok{=:}\index{BAKPFX@\texttt{BAKPFX}} \StringTok{\textquotesingle{}B\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. database file noun names {-} order matters {-} see long documenation}
\NormalTok{DFILES}\AlertTok{=:}\index{DFILES@\texttt{DFILES}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} WF TF GF SF MF UF\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. database file noun name pointers {-} order matters}
\NormalTok{DFPTRS}\AlertTok{=:}\index{DFPTRS@\texttt{DFPTRS}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} WP TP GP SP MP UP\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. main component list noun names}
\NormalTok{DIRCN}\AlertTok{=:}\index{DIRCN@\texttt{DIRCN}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} WORDCN TESTCN GROUPCN SUITECN MACROCN\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. main index list noun names}
\NormalTok{DIRIX}\AlertTok{=:}\index{DIRIX@\texttt{DIRIX}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} WORDIX TESTIX GROUPIX SUITEIX MACROIX\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. main timestamp noun names}
\NormalTok{DIRTS}\AlertTok{=:}\index{DIRTS@\texttt{DIRTS}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} WORDTS TESTTS GROUPTS SUITETS MACROTS\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. visible object names}
\NormalTok{DIRVNS}\AlertTok{=:}\index{DIRVNS@\texttt{DIRVNS}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} word test group suite macro\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. dictionary subdirectory noun names {-} order matters}
\NormalTok{DSUBDIRS}\AlertTok{=:}\index{DSUBDIRS@\texttt{DSUBDIRS}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} SCR SUI DOC DMP ALI BAK\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR200}\AlertTok{=:}\index{ERR200@\texttt{ERR200}} \StringTok{\textquotesingle{}unable to save directory {-} previous directory restored\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR201}\AlertTok{=:}\index{ERR201@\texttt{ERR201}} \StringTok{\textquotesingle{}unable to save directory {-} unable to restore previous directory\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR202}\AlertTok{=:}\index{ERR202@\texttt{ERR202}} \StringTok{\textquotesingle{}invalid put dictionary name\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR203}\AlertTok{=:}\index{ERR203@\texttt{ERR203}} \StringTok{\textquotesingle{}unable to create temporary file\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR204}\AlertTok{=:}\index{ERR204@\texttt{ERR204}} \StringTok{\textquotesingle{}not enough free disk space for operation\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR205}\AlertTok{=:}\index{ERR205@\texttt{ERR205}} \StringTok{\textquotesingle{}unable to rename files: DLL error {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR206}\AlertTok{=:}\index{ERR206@\texttt{ERR206}} \StringTok{\textquotesingle{}no backups to restore\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR207}\AlertTok{=:}\index{ERR207@\texttt{ERR207}} \StringTok{\textquotesingle{}missing backup files {-} restore aborted\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR208}\AlertTok{=:}\index{ERR208@\texttt{ERR208}} \StringTok{\textquotesingle{}unable to copy files: DLL error {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR209}\AlertTok{=:}\index{ERR209@\texttt{ERR209}} \StringTok{\textquotesingle{}backup dictionary id number invalid {-} restore aborted\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR210}\AlertTok{=:}\index{ERR210@\texttt{ERR210}} \StringTok{\textquotesingle{}unable to copy/move/rename files {-} shell messages {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR211}\AlertTok{=:}\index{ERR211@\texttt{ERR211}} \StringTok{\textquotesingle{}unable to read timestamps\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ERR212}\AlertTok{=:}\index{ERR212@\texttt{ERR212}} \StringTok{\textquotesingle{}timestamp update failure\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. object report header names}
\NormalTok{HEADNMS}\AlertTok{=:}\index{HEADNMS@\texttt{HEADNMS}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} Words Tests Groups* Suites* Macros\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK200}\AlertTok{=:}\index{OK200@\texttt{OK200}} \StringTok{\textquotesingle{}dictionary packed {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{OK201}\AlertTok{=:}\index{OK201@\texttt{OK201}} \StringTok{\textquotesingle{}dictionary restored {-}>\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. reference component list noun names}
\NormalTok{REFCN}\AlertTok{=:}\index{REFCN@\texttt{REFCN}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} WORDREFCN TESTREFCN\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. reference main index list noun names}
\NormalTok{REFIX}\AlertTok{=:}\index{REFIX@\texttt{REFIX}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} WORDREFIX TESTREFIX\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. reference timestamp noun names}
\NormalTok{REFTS}\AlertTok{=:}\index{REFTS@\texttt{REFTS}} \KeywordTok{<;.}\NormalTok{\_}\DecValTok{1} \StringTok{\textquotesingle{} WORDREFTS TESTREFTS\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. temporary file prefix}
\NormalTok{TEMPFX}\AlertTok{=:}\index{TEMPFX@\texttt{TEMPFX}} \StringTok{\textquotesingle{}tmp\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{backnum}\AlertTok{=:}\index{backnum@\texttt{backnum}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*backnum v{-}{-} increments backup pack count and backup/restoration timestamp.}
\CommentTok{NB.}
\CommentTok{NB. monad:  backnum ia}
\CommentTok{NB.}
\CommentTok{NB.   backnum 0 NB. typical call}

\CommentTok{NB. HARDCODE pack counter is in component 1}
\NormalTok{nums}\KeywordTok{=.>}\NormalTok{ jread WF}\KeywordTok{;}\DecValTok{1}  \CommentTok{NB. object noun !(*)=. WF}
\KeywordTok{if.} \KeywordTok{\#}\NormalTok{nums }\KeywordTok{do.}\NormalTok{ nums}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{>:y\{}\NormalTok{nums}\RegionMarkerTok{)} \KeywordTok{y\}}\NormalTok{nums }\KeywordTok{else.}\NormalTok{ nums}\KeywordTok{=.} \DecValTok{0} \KeywordTok{,} \DecValTok{6}\KeywordTok{!:}\DecValTok{0}\StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{end.}
\RegionMarkerTok{((}\DecValTok{0}\KeywordTok{\{}\NormalTok{nums}\RegionMarkerTok{)} \KeywordTok{,} \DecValTok{6}\KeywordTok{!:}\DecValTok{0}\StringTok{\textquotesingle{}\textquotesingle{}}\RegionMarkerTok{)}\NormalTok{ jreplace WF}\KeywordTok{;}\DecValTok{1}
\KeywordTok{<.y\{}\NormalTok{nums }\CommentTok{NB. integer result}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{copydirinv}\AlertTok{=:}\index{copydirinv@\texttt{copydirinv}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*copydirinv v{-}{-} copies directory and inverted data region}
\CommentTok{NB.}
\CommentTok{NB. monad:  copydirinv (clTemp ; clDictionary)}

\StringTok{\textquotesingle{}tfile datfile\textquotesingle{}}\KeywordTok{=.} \KeywordTok{y}

\CommentTok{NB. errmsg: unable to create temporary file}
\KeywordTok{if.} \DecValTok{1}\KeywordTok{\textasciitilde{}:}\NormalTok{jcreate tfile }\KeywordTok{do.}\NormalTok{ jderr ERR203 }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. copy directory and inverted data region}
\CommentTok{NB. errmsg: jfile read failure}
\KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread datfile}\KeywordTok{;i.}\NormalTok{ OFFSET }\KeywordTok{do.}\NormalTok{ jderr ERR088 }\KeywordTok{return.} \KeywordTok{end.}
\CommentTok{NB. errmsg: jfile append failure}
\KeywordTok{if.}\NormalTok{ badappend apcn}\KeywordTok{=.}\NormalTok{ dat jappend tfile }\KeywordTok{do.}\NormalTok{ jderr ERR058 }\KeywordTok{else.}\NormalTok{ OK }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. Win32 procedure that copies files}
\NormalTok{copyfile}\AlertTok{=:}\index{copyfile@\texttt{copyfile}} \StringTok{\textquotesingle{}kernel32 CopyFileA i *c *c i\textquotesingle{}}\KeywordTok{\&}\NormalTok{cd}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{copyfiles}\AlertTok{=:}\index{copyfiles@\texttt{copyfiles}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*copyfiles v{-}{-} copies OS files.}
\CommentTok{NB.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  blclSource copyfiles blclTarget}

\KeywordTok{if.}\NormalTok{ IFWIN }\KeywordTok{do.}
\NormalTok{  rc}\KeywordTok{=.}\NormalTok{copyfile}\KeywordTok{"}\DecValTok{1} \KeywordTok{x} \KeywordTok{,.} \KeywordTok{y} \KeywordTok{,.} \KeywordTok{<}\DecValTok{0}
  \CommentTok{NB. errmsg: unable to copy files}
  \KeywordTok{if.} \KeywordTok{*./}\DecValTok{0} \KeywordTok{<;} \KeywordTok{\{."}\DecValTok{1}\NormalTok{ rc }\KeywordTok{do.}\NormalTok{ OK }\KeywordTok{else.} \RegionMarkerTok{(}\NormalTok{jderr ERR208}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\DecValTok{15}\KeywordTok{!:}\DecValTok{11}\RegionMarkerTok{)}\StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{end.}
\KeywordTok{else.}
  \CommentTok{NB. copy current dictionary files}
  \CommentTok{NB. NOTE: assumes path file names that do not wreak linux (cp) command}
  \KeywordTok{if.}\NormalTok{ isempty rc}\KeywordTok{=.}\NormalTok{ host}\KeywordTok{"}\DecValTok{1}  \KeywordTok{>} \RegionMarkerTok{(}\KeywordTok{<}\StringTok{\textquotesingle{}cp \textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{,\&.>} \KeywordTok{x} \KeywordTok{,\&.>} \StringTok{\textquotesingle{} \textquotesingle{}} \KeywordTok{,\&.>} \KeywordTok{y} \KeywordTok{do.}\NormalTok{ OK}
  \KeywordTok{else.}
    \CommentTok{NB. result not empty probably some OS error}
    \CommentTok{NB. errmsg:  unable to copy/move/rename files {-} shell messages {-}>}
    \RegionMarkerTok{(}\NormalTok{jderr ERR210}\RegionMarkerTok{)}\KeywordTok{,<,}\NormalTok{rc}
  \KeywordTok{end.}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{createdl}\AlertTok{=:}\index{createdl@\texttt{createdl}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*createdl v{-}{-} directory object creation verb.}
\CommentTok{NB.}
\CommentTok{NB. monad:  create bluu}

\CommentTok{NB. object nouns !(*)=. BAKNUM DIDNUM DNAME RPATH RW UF SYS WF LIBSTATUS NPPFX}

\CommentTok{NB. no backup directories exist at creation}
\NormalTok{BAKNUM}\AlertTok{=:}\index{BAKNUM@\texttt{BAKNUM}}  \DecValTok{\_1}

\StringTok{\textquotesingle{}nppfx username dpath readstatus dparms\textquotesingle{}}\KeywordTok{=.} \KeywordTok{y}
\NormalTok{DNAME}\AlertTok{=:}\index{DNAME@\texttt{DNAME}}  \KeywordTok{,>}\NormalTok{username  }\CommentTok{NB. user name for this dictionary}
\NormalTok{DIDNUM}\AlertTok{=:}\index{DIDNUM@\texttt{DIDNUM}}  \KeywordTok{>}\DecValTok{1}\KeywordTok{\{}\NormalTok{dparms  }\CommentTok{NB. unique dictionary id number}
\NormalTok{NPPFX}\AlertTok{=:}\index{NPPFX@\texttt{NPPFX}}\NormalTok{  nppfx       }\CommentTok{NB. master/dictionary file path prefix mismatch}

\CommentTok{NB. set master parameters first and then values specific}
\CommentTok{NB. to this dictionary {-} insures all master parms are defined}
\CommentTok{NB. (MASTERPARMS) is added to the "jod" class by (createjod)}
\RegionMarkerTok{(}\KeywordTok{\{."}\DecValTok{1}\NormalTok{ MASTERPARMS}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}  \KeywordTok{\{:"}\DecValTok{1}\NormalTok{ MASTERPARMS   }\CommentTok{NB. !(*)=. MASTERPARMS}
\RegionMarkerTok{(}\KeywordTok{\{.>\{:}\NormalTok{dparms}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}  \KeywordTok{\{:>\{:}\NormalTok{dparms}

\CommentTok{NB. is this a library?}
\NormalTok{LIBSTATUS}\AlertTok{=:}\index{LIBSTATUS@\texttt{LIBSTATUS}}\NormalTok{  islib dparms}
\NormalTok{RW}\AlertTok{=:}\index{RW@\texttt{RW}}  \RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{LIBSTATUS}\RegionMarkerTok{)} \KeywordTok{*} \DecValTok{1}\KeywordTok{=}\NormalTok{readstatus  }\CommentTok{NB. open read status}

\CommentTok{NB. script, suite, macro, document, dump, backup directories}
\RegionMarkerTok{(}\NormalTok{DSUBDIRS}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}\NormalTok{  PARMDIRS}\KeywordTok{\{}\NormalTok{dparms}

\CommentTok{NB. full dictionary file names (without extensions) and pointers}
\CommentTok{NB. NOTE: the (dpath) does not have to match the paths of (DSUBDIRS)}
\RegionMarkerTok{(}\NormalTok{DFILES}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}\NormalTok{  uv}\KeywordTok{=.}\NormalTok{ dpath }\KeywordTok{,\&.>}\NormalTok{ JDFILES}
\RegionMarkerTok{(}\NormalTok{DFPTRS}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}\NormalTok{  uv}

\CommentTok{NB. dictionary directory {-} NIMP: provide some mechanism for}
\CommentTok{NB. decoupling the word directory from the main dictionary}
\NormalTok{SYS}\AlertTok{=:}\index{SYS@\texttt{SYS}}  \RegionMarkerTok{((}\NormalTok{justdrv WF}\RegionMarkerTok{)} \KeywordTok{,}\StringTok{\textquotesingle{}:\textquotesingle{}}\KeywordTok{,}\NormalTok{ justpath WF}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{PATHDEL}

\CommentTok{NB. tweak for UNC and rooted linux paths}
\NormalTok{SYS}\AlertTok{=:}\index{SYS@\texttt{SYS}}  \RegionMarkerTok{(}\StringTok{\textquotesingle{}:\textquotesingle{}}\KeywordTok{=\{.}\NormalTok{SYS}\RegionMarkerTok{)}\KeywordTok{\}.}\NormalTok{SYS}

\CommentTok{NB. set dictionary\textquotesingle{}s reference path}
\KeywordTok{if.}\NormalTok{ badjr rp}\KeywordTok{=.}\NormalTok{ jread UF}\KeywordTok{;}\NormalTok{CNRPATH }\KeywordTok{do.} \DecValTok{0} \KeywordTok{else.} \DecValTok{1} \KeywordTok{[}\NormalTok{ RPATH}\AlertTok{=:}\index{RPATH@\texttt{RPATH}}  \KeywordTok{>}\NormalTok{ rp }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dbakf}\AlertTok{=:}\index{dbakf@\texttt{dbakf}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*dbakf v{-}{-} fully qualified backup file path.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  clPath =. iaObjectNc dbakf iaBackupNum}
\CommentTok{NB.}
\CommentTok{NB.  0 dbakf 17   NB. backup 17 of jwords.ijf}
\CommentTok{NB.  4 dbakf 5    NB. backup 5 of jmacros.ijf}

\CommentTok{NB. !(*)=. BAK}
\NormalTok{BAK}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{":y}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{;x\{}\NormalTok{JDFILES}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{IJF}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dfclose}\AlertTok{=:}\index{dfclose@\texttt{dfclose}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dfclose v{-}{-} close dictionary file.}
\CommentTok{NB.}
\CommentTok{NB. monad:  dfclose clFilePfx}
\CommentTok{NB.}
\CommentTok{NB.   dfclose\_\_DL \textquotesingle{}U\textquotesingle{}  NB. object noun file pointer prefix}

\CommentTok{NB. allow mixed assignments (<:)=:}
\NormalTok{fp}\KeywordTok{=.} \KeywordTok{y,}\StringTok{\textquotesingle{}P\textquotesingle{}}
\RegionMarkerTok{(}\NormalTok{fp}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}  \KeywordTok{".y,}\StringTok{\textquotesingle{}F\textquotesingle{}} \KeywordTok{[}\NormalTok{ jclose\_jfiles}\DecValTok{\_} \KeywordTok{".}\NormalTok{fp}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. open dictionary file}
\NormalTok{dfopen}\AlertTok{=:}\index{dfopen@\texttt{dfopen}} \DecValTok{3} \KeywordTok{:} \StringTok{\textquotesingle{}(y,\textquotesingle{}\textquotesingle{}P\textquotesingle{}\textquotesingle{})=: jopen\_jfiles\_ ".y,\textquotesingle{}\textquotesingle{}F\textquotesingle{}\textquotesingle{}\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dfp}\AlertTok{=:}\index{dfp@\texttt{dfp}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dfp v{-}{-} directory file path returns the  directory  path  for}
\CommentTok{NB. various objects.}
\CommentTok{NB.}
\CommentTok{NB. monad:  dfp iaObject}

\CommentTok{NB. object nouns !(*)=. SCR SUI DOC DMP BAK}

\KeywordTok{select.} \KeywordTok{y}
  \KeywordTok{case.}\NormalTok{ WORD}\KeywordTok{;}\NormalTok{GROUP }\KeywordTok{do.}\NormalTok{ SCR}
  \KeywordTok{case.}\NormalTok{ TEST}\KeywordTok{;}\NormalTok{SUITE }\KeywordTok{do.}\NormalTok{ SUI}
  \KeywordTok{case.}\NormalTok{ DOCUMENT   }\KeywordTok{do.}\NormalTok{ DOC}
  \KeywordTok{case.}\NormalTok{ DEFAULT    }\KeywordTok{do.}\NormalTok{ DMP}
  \KeywordTok{case.do.}\NormalTok{ BAK}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dncn}\AlertTok{=:}\index{dncn@\texttt{dncn}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dncn v{-}{-} returns  directory  component noun names from object}
\CommentTok{NB. codes.}
\CommentTok{NB.}
\CommentTok{NB. monad:  dncn ilObject}

\RegionMarkerTok{(}\NormalTok{OBJECTNC }\KeywordTok{i.} \KeywordTok{y}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{DIRCN}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dnix}\AlertTok{=:}\index{dnix@\texttt{dnix}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dnix  v{-}{-}  returns directory index  noun  names  from  object}
\CommentTok{NB. codes.}
\CommentTok{NB.}
\CommentTok{NB. monad:  dnix ilObject}

\RegionMarkerTok{(}\NormalTok{OBJECTNC }\KeywordTok{i.} \KeywordTok{y}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{DIRIX}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dnnc}\AlertTok{=:}\index{dnnc@\texttt{dnnc}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dnnc v{-}{-} returns directory name  class noun names from object}
\CommentTok{NB. codes.}
\CommentTok{NB.}
\CommentTok{NB. monad:  dnnc ilObject}

\RegionMarkerTok{((}\NormalTok{WORD}\KeywordTok{,}\NormalTok{MACRO}\RegionMarkerTok{)} \KeywordTok{i.} \KeywordTok{y}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{DIRNC}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dnnm}\AlertTok{=:}\index{dnnm@\texttt{dnnm}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dnnm v{-}{-} returns visible dictionary object names.}
\CommentTok{NB.}
\CommentTok{NB. monad:  dnnm ilObject}

\RegionMarkerTok{(}\NormalTok{OBJECTNC }\KeywordTok{i.} \KeywordTok{y}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{DIRVNS}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dnrn}\AlertTok{=:}\index{dnrn@\texttt{dnrn}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dnrn v{-}{-} returns  directory  reference noun names from object}
\CommentTok{NB. codes.}
\CommentTok{NB.}
\CommentTok{NB. monad:  dnrn iaObject}
\CommentTok{NB. dyad:  uuIgnore dnrn iaObject}

\RegionMarkerTok{((}\NormalTok{WORD}\KeywordTok{,}\NormalTok{TEST}\RegionMarkerTok{)} \KeywordTok{i.} \KeywordTok{y}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{REFIX  }\CommentTok{NB. name list name}
\KeywordTok{:}
\RegionMarkerTok{((}\NormalTok{WORD}\KeywordTok{,}\NormalTok{TEST}\RegionMarkerTok{)} \KeywordTok{i.} \KeywordTok{y}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{REFCN  }\CommentTok{NB. component list name}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dropall}\AlertTok{=:}\index{dropall@\texttt{dropall}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dropall v{-}{-} erases all directory,  inverted  data,  reference}
\CommentTok{NB. nouns}
\CommentTok{NB.}
\CommentTok{NB. monad:  dropall uuIgnore}

\NormalTok{erase DIRNC}\KeywordTok{,}\NormalTok{DIRIX}\KeywordTok{,}\NormalTok{DIRCN}\KeywordTok{,}\NormalTok{DIRTS}\KeywordTok{,}\NormalTok{REFIX}\KeywordTok{,}\NormalTok{REFCN}\KeywordTok{,}\NormalTok{REFTS}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dropbakdir}\AlertTok{=:}\index{dropbakdir@\texttt{dropbakdir}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dropbakdir  v{-}{-}  erases  backup  directory  nouns  loaded  by}
\CommentTok{NB. (loadbakdir).}
\CommentTok{NB.}
\CommentTok{NB. monad:  dropdir uuIgnore}

\NormalTok{erase }\RegionMarkerTok{(}\KeywordTok{<}\NormalTok{BAKPFX}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ DIRIX}\KeywordTok{,}\NormalTok{DIRCN}\KeywordTok{,}\NormalTok{DIRTS}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dropdir}\AlertTok{=:}\index{dropdir@\texttt{dropdir}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dropdir v{-}{-}  erases directory nouns  loaded by  (loaddir) and}
\CommentTok{NB. (loadstamps)}
\CommentTok{NB.}
\CommentTok{NB. monad:  dropdir uuIgnore}

\NormalTok{erase DIRIX}\KeywordTok{,}\NormalTok{DIRCN}\KeywordTok{,}\NormalTok{DIRTS}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dropinv}\AlertTok{=:}\index{dropinv@\texttt{dropinv}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dropinv v{-}{-} erases inverted data nouns.}
\CommentTok{NB.}
\CommentTok{NB. monad:  dropinv uuIgnore}

\NormalTok{erase DIRNC}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dropnc}\AlertTok{=:}\index{dropnc@\texttt{dropnc}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dropnc v{-}{-} erases directory name class nouns}
\CommentTok{NB.}
\CommentTok{NB. monad:  dropnc ilObject}

\NormalTok{erase }\RegionMarkerTok{((}\NormalTok{WORD}\KeywordTok{,}\NormalTok{MACRO}\RegionMarkerTok{)} \KeywordTok{i.} \KeywordTok{y}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{DIRNC}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dropref}\AlertTok{=:}\index{dropref@\texttt{dropref}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*dropref v{-}{-} erases reference data nouns.}
\CommentTok{NB.}
\CommentTok{NB. monad:  dropref uuIgnore}

\NormalTok{erase REFIX}\KeywordTok{,}\NormalTok{REFCN}\KeywordTok{,}\NormalTok{REFTS}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gettstamps}\AlertTok{=:}\index{gettstamps@\texttt{gettstamps}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*gettstamps v{-}{-} reads creation and lastput date timestamps.}
\CommentTok{NB.}
\CommentTok{NB. monad:  blfl =. gettstamps iaObject}

\NormalTok{fp}\KeywordTok{=.} \KeywordTok{".} \RegionMarkerTok{(}\KeywordTok{\{.;}\NormalTok{dnix }\KeywordTok{y}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}F\textquotesingle{}}  \CommentTok{NB. path file name}

\CommentTok{NB. errmsg: unable to read timestamps}
\KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread fp}\KeywordTok{;}\NormalTok{CNCREATION}\KeywordTok{,}\NormalTok{CNPUTDATE }\KeywordTok{do.}\NormalTok{ jderr ERR211 }\KeywordTok{else.}\NormalTok{ ok }\KeywordTok{<} \KeywordTok{>}\NormalTok{dat }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. extract drive and path from qualified file names}
\NormalTok{justdrvpath}\AlertTok{=:}\index{justdrvpath@\texttt{justdrvpath}} \KeywordTok{[:} \KeywordTok{\}:} \KeywordTok{]} \KeywordTok{\#\textasciitilde{}} \KeywordTok{[:} \KeywordTok{+./\textbackslash{}.} \StringTok{\textquotesingle{}\textbackslash{}\textquotesingle{}}\KeywordTok{\&=}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{libstatus}\AlertTok{=:}\index{libstatus@\texttt{libstatus}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*libstatus v{-}{-} changes dictionary library status.}
\CommentTok{NB.}
\CommentTok{NB. monad:  bclObj libstatus pa}
\CommentTok{NB.}
\CommentTok{NB.   libstatus\_\_DL 1  NB. library on}
\CommentTok{NB.   libstatus\_\_DL 0  NB. library off}

\CommentTok{NB. object nouns !(*)=. WF NPPFX DNAME DIDNUM}
\KeywordTok{if.}\NormalTok{ NPPFX }\KeywordTok{do.} \RegionMarkerTok{(}\NormalTok{jderr ERR098}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{DNAME}\KeywordTok{;}\NormalTok{DIDNUM }\KeywordTok{return.} \KeywordTok{end.}

\KeywordTok{if.}\NormalTok{ badjr dpt}\KeywordTok{=.}\NormalTok{ jread WF}\KeywordTok{;}\NormalTok{CNPARMS  }\KeywordTok{do.}\NormalTok{ jderr ERR088 }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. library names marked with * prefix HARDCODE}
\CommentTok{NB. The * prefix is an illegal dictionary name character}
\NormalTok{name}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{,>\{.}\NormalTok{dpt}\KeywordTok{=.} \KeywordTok{>}\NormalTok{dpt}\RegionMarkerTok{)} \KeywordTok{{-}.} \StringTok{\textquotesingle{}*\textquotesingle{}}
\NormalTok{dpt}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\RegionMarkerTok{(}\KeywordTok{y\{.}\StringTok{\textquotesingle{}*\textquotesingle{}}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{name}\RegionMarkerTok{)} \RegionMarkerTok{(}\DecValTok{0}\RegionMarkerTok{)}\KeywordTok{\}}\NormalTok{dpt}

\KeywordTok{if.}\NormalTok{ badreps }\RegionMarkerTok{(}\KeywordTok{<}\NormalTok{dpt}\RegionMarkerTok{)}\NormalTok{ jreplace WF}\KeywordTok{;}\NormalTok{CNPARMS }\KeywordTok{do.}\NormalTok{ jderr ERR017 }\KeywordTok{else.}\NormalTok{ OK }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{loadbakdir}\AlertTok{=:}\index{loadbakdir@\texttt{loadbakdir}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*loadbakdir v{-}{-} loads complete requested backup directory (y).}
\CommentTok{NB.}
\CommentTok{NB. result is 0 for success and 1 for failure.}
\CommentTok{NB.}
\CommentTok{NB. dyad: iaBn loadbakdir iaObject}
\CommentTok{NB.}
\CommentTok{NB.   NB. word directory from backup 25}
\CommentTok{NB.   25 loadbackdir WORD}

\CommentTok{NB. drop backup directory if backup has changed !(*)=. BAKNUM}
\KeywordTok{if.}\NormalTok{ BAKNUM}\KeywordTok{\textasciitilde{}:x} \KeywordTok{do.}\NormalTok{ dropbakdir }\DecValTok{0} \KeywordTok{end.}

\KeywordTok{if.}\NormalTok{ wex ix}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{BAKPFX}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ dnix }\KeywordTok{y} \KeywordTok{do.} \DecValTok{0}  \CommentTok{NB. backup directory loaded}
\KeywordTok{else.}
  \CommentTok{NB. depends on correspondence between (JDFILES) \& object codes !(*)=. BAK}
\NormalTok{  fp}\KeywordTok{=.}\NormalTok{ BAK}\KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{":x}\RegionMarkerTok{)}\KeywordTok{,;y\{}\NormalTok{JDFILES  }\CommentTok{NB. path file name}
  \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread fp}\KeywordTok{;}\NormalTok{CNDIR }\KeywordTok{do.}
    \DecValTok{1}  \CommentTok{NB. cannot load}
  \KeywordTok{else.}
    \CommentTok{NB. allow mixed assignments (<:)=:}
    \CommentTok{NB. HARDCODE: requires two letter TS CN IX suffixes}
\NormalTok{    dn}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{\_}\DecValTok{2}\KeywordTok{\}.>}\NormalTok{ix}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ DTSIXCN}
    \RegionMarkerTok{(}\NormalTok{dn}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}\NormalTok{  dat}
    \CommentTok{NB. reset backup number}
\NormalTok{    BAKNUM}\AlertTok{=:}\index{BAKNUM@\texttt{BAKNUM}}  \KeywordTok{x}
    \CommentTok{NB. test existence of alleged directory nouns}
    \KeywordTok{{-}.} \KeywordTok{*./}\NormalTok{ wex dn}
  \KeywordTok{end.}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{loaddir}\AlertTok{=:}\index{loaddir@\texttt{loaddir}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*loaddir  v{-}{-} loads  the  complete  requested  directory  (y).}
\CommentTok{NB.}
\CommentTok{NB. Result is 0 for success and 1 for failure.}
\CommentTok{NB.}
\CommentTok{NB. monad: loaddir iaObject}
\CommentTok{NB.}
\CommentTok{NB.   loaddir WORD  NB. code specifies directory}

\KeywordTok{if.}\NormalTok{ wex ix}\KeywordTok{=.}\NormalTok{ dnix }\KeywordTok{y} \KeywordTok{do.} \DecValTok{0}   \CommentTok{NB. directory loaded}
\KeywordTok{else.}
\NormalTok{  fp}\KeywordTok{=.} \KeywordTok{".} \RegionMarkerTok{(}\KeywordTok{\{.}\NormalTok{ix}\KeywordTok{=.} \KeywordTok{>}\NormalTok{ix}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}F\textquotesingle{}}  \CommentTok{NB. path file name}
  \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread fp}\KeywordTok{;}\NormalTok{CNDIR }\KeywordTok{do.}
    \DecValTok{1}  \CommentTok{NB. cannot load}
  \KeywordTok{else.}
    \CommentTok{NB. allow mixed assignments (<:)=:}
    \CommentTok{NB. HARDCODE: requires two letter TS CN IX suffixes}
\NormalTok{    dn}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{\_}\DecValTok{2}\KeywordTok{\}.}\NormalTok{ix}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ DTSIXCN}
    \RegionMarkerTok{(}\NormalTok{dn}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}\NormalTok{  dat}
    \CommentTok{NB. test existence of alleged directory nouns}
    \KeywordTok{{-}.} \KeywordTok{*./}\NormalTok{ wex dn}
  \KeywordTok{end.}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{loadnc}\AlertTok{=:}\index{loadnc@\texttt{loadnc}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*loadnc v{-}{-}  load name class for  (y) Result is 0 for success}
\CommentTok{NB. and 1 for failure. Currently only words and  macros have name}
\CommentTok{NB. or type class.}
\CommentTok{NB.}
\CommentTok{NB. monad: loadnc iaObject}
\CommentTok{NB.}
\CommentTok{NB.   loadnc WORD}

\CommentTok{NB. allow mixed assignments (<:)=:}
\KeywordTok{if.}\NormalTok{ wex dn}\KeywordTok{=.}\NormalTok{ dnnc }\KeywordTok{y} \KeywordTok{do.} \DecValTok{0}  \CommentTok{NB. class/type loaded}
\KeywordTok{else.}
\NormalTok{  fp}\KeywordTok{=.} \KeywordTok{".} \RegionMarkerTok{(}\KeywordTok{\{.}\NormalTok{dn}\KeywordTok{=.} \KeywordTok{>}\NormalTok{dn}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}F\textquotesingle{}}  \CommentTok{NB. path file name}
  \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread fp}\KeywordTok{;}\NormalTok{CNCLASS }\KeywordTok{do.}
    \DecValTok{1}  \CommentTok{NB. cannot load}
  \KeywordTok{else.}
    \RegionMarkerTok{(}\NormalTok{dn}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}  \KeywordTok{>}\NormalTok{dat}
    \KeywordTok{{-}.}\NormalTok{ wex }\KeywordTok{<}\NormalTok{dn}
  \KeywordTok{end.}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{loadref}\AlertTok{=:}\index{loadref@\texttt{loadref}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*loadref v{-}{-}  loads word and  test  reference lists from  uses}
\CommentTok{NB. file.}
\CommentTok{NB.}
\CommentTok{NB. Result is 0 for  success and 1  for failure.  Test references}
\CommentTok{NB. are not currently stored but the code providing this facility}
\CommentTok{NB. is  left  in  this  verb  and  (saveref)  to  allow for  easy}
\CommentTok{NB. expansion of reference types in the future.}
\CommentTok{NB.}
\CommentTok{NB. monad: loadref iaObject}
\CommentTok{NB.}
\CommentTok{NB.   loadref WORD}

\CommentTok{NB. allow mixed assignments (<:)=:}
\KeywordTok{if.}\NormalTok{ wex dn}\KeywordTok{=.}\NormalTok{ dnrn }\KeywordTok{y} \KeywordTok{do.} \DecValTok{0}  \CommentTok{NB. references loaded}
\KeywordTok{else.}
\NormalTok{  cn}\KeywordTok{=.} \RegionMarkerTok{((}\NormalTok{WORD}\KeywordTok{,}\NormalTok{TEST}\RegionMarkerTok{)} \KeywordTok{i.} \KeywordTok{y}\RegionMarkerTok{)}\KeywordTok{\{}\NormalTok{CNREF}
  \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread UF}\KeywordTok{;}\NormalTok{CNMARK}\KeywordTok{,}\NormalTok{cn }\KeywordTok{do.} \CommentTok{NB. object noun !(*)=. UF}
    \DecValTok{1}  \CommentTok{NB. cannot load}
  \KeywordTok{else.}
\NormalTok{    dn}\KeywordTok{=.} \KeywordTok{>}\NormalTok{dn}
\NormalTok{    dn}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{\_}\DecValTok{2}\KeywordTok{\}.}\NormalTok{dn}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ DTSIXCN}
    \RegionMarkerTok{(}\NormalTok{dn}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}\NormalTok{  dat}
    \KeywordTok{{-}.} \KeywordTok{*./}\NormalTok{ wex dn}
  \KeywordTok{end.}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{loadstamps}\AlertTok{=:}\index{loadstamps@\texttt{loadstamps}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*loadstamps v{-}{-} loads directory time stamps (y).}
\CommentTok{NB.}
\CommentTok{NB. Result is 0 for success and 1 for failure.}
\CommentTok{NB.}
\CommentTok{NB. monad: loadstamps uuIgnore}

\CommentTok{NB. allow mixed assignments (<:)=:}
\NormalTok{ts}\KeywordTok{=.}\NormalTok{ DIRTS}
\KeywordTok{if.} \KeywordTok{*./}\NormalTok{b}\KeywordTok{=.}\NormalTok{ wex ts }\KeywordTok{do.} \DecValTok{0}  \CommentTok{NB. stamps loaded}
\KeywordTok{else.}
\NormalTok{  ts}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{{-}.}\NormalTok{b}\RegionMarkerTok{)}\KeywordTok{\#}\NormalTok{ts          }\CommentTok{NB. load missing only}
  \KeywordTok{for\_st.}\NormalTok{ ts }\KeywordTok{do.}
\NormalTok{    fp}\KeywordTok{=.} \KeywordTok{".} \RegionMarkerTok{(}\KeywordTok{\{.}\NormalTok{st}\KeywordTok{=.} \KeywordTok{>}\NormalTok{st}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}F\textquotesingle{}}   \CommentTok{NB. path file name}
    \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread fp}\KeywordTok{;}\NormalTok{CNMARK }\KeywordTok{do.}
      \DecValTok{1} \KeywordTok{return.}
    \KeywordTok{else.}
      \RegionMarkerTok{(}\NormalTok{st}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}  \KeywordTok{>}\NormalTok{dat}
    \KeywordTok{end.}
  \KeywordTok{end.}
  \KeywordTok{{-}.} \KeywordTok{*./}\NormalTok{ wex ts  }\CommentTok{NB. check loaded stamps}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. maximum backup prefix number {-} null when no numeric prefixes}
\NormalTok{maxback}\AlertTok{=:}\index{maxback@\texttt{maxback}} \KeywordTok{[:} \KeywordTok{>./} \KeywordTok{[:} \KeywordTok{".\&>} \RegionMarkerTok{(}\KeywordTok{]} \KeywordTok{*./\textbackslash{}@e.\&.>} \RegionMarkerTok{(}\KeywordTok{<}\StringTok{\textquotesingle{}0123456789\textquotesingle{}}\RegionMarkerTok{)}\KeywordTok{"}\NormalTok{\_}\RegionMarkerTok{)} \KeywordTok{\#\&.>} \KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. Win32 procedure that moves/renames files}
\NormalTok{movefile}\AlertTok{=:}\index{movefile@\texttt{movefile}} \StringTok{\textquotesingle{}kernel32 MoveFileA i *c *c\textquotesingle{}}\KeywordTok{\&}\NormalTok{cd}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{NB. bit mask of blcl (y) items with numeric prefix (x)}
\NormalTok{nummask}\AlertTok{=:}\index{nummask@\texttt{nummask}} \RegionMarkerTok{(}\KeywordTok{[:} \KeywordTok{":} \KeywordTok{[}\RegionMarkerTok{)} \KeywordTok{{-}:"}\DecValTok{1} \RegionMarkerTok{(}\KeywordTok{[:} \KeywordTok{\#} \KeywordTok{[:} \KeywordTok{":} \KeywordTok{[}\RegionMarkerTok{)} \KeywordTok{\{.\&>} \KeywordTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{packdict}\AlertTok{=:}\index{packdict@\texttt{packdict}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*packdict v{-}{-} pack the current dictionary.}
\CommentTok{NB.}
\CommentTok{NB. At  the  end  of  a  successful pack  operation  the  current}
\CommentTok{NB. directory object is refreshed and subsequent  operations  are}
\CommentTok{NB. performed on the packed files.}
\CommentTok{NB.}
\CommentTok{NB. monad:  packdict clName}

\CommentTok{NB. object nouns !(*)=. DNAME UF WF}

\KeywordTok{if.} \RegionMarkerTok{(}\KeywordTok{,}\NormalTok{DNAME}\RegionMarkerTok{)} \KeywordTok{{-}:} \KeywordTok{,y} \KeywordTok{do.}
  \CommentTok{NB. clear current object}
\NormalTok{  dropall }\DecValTok{0}
\NormalTok{  path}\KeywordTok{=.}\NormalTok{ SYS   }\CommentTok{NB. object noun !(*)=. SYS}

  \CommentTok{NB. backup number}
\NormalTok{  pfn}\KeywordTok{=.}\NormalTok{backnum }\DecValTok{0}

  \CommentTok{NB. copy object files to tmp files}
  \KeywordTok{for\_obj.}\NormalTok{ OBJECTNC }\KeywordTok{do.}
    \CommentTok{NB. code relies on the fact that (OBJECTNC),}
    \CommentTok{NB. (JDFILES) and (DFILES) have corresponding items}
\NormalTok{    tfile}\KeywordTok{=.}\NormalTok{ path}\KeywordTok{,}\NormalTok{TEMPFX}\KeywordTok{,>}\NormalTok{obj\_index}\KeywordTok{\{}\NormalTok{JDFILES}
\NormalTok{    datfile}\KeywordTok{=.} \KeywordTok{".>}\NormalTok{obj\_index}\KeywordTok{\{}\NormalTok{DFILES}
    \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{ obj tmpdatfile tfile}\KeywordTok{;}\NormalTok{datfile }\KeywordTok{do.}\NormalTok{ msg }\KeywordTok{return.} \KeywordTok{end.}
  \KeywordTok{end.}

  \CommentTok{NB. copy reference file to tmp file HARDCODE file name index}
\NormalTok{  tfile}\KeywordTok{=.}\NormalTok{ path}\KeywordTok{,}\NormalTok{TEMPFX}\KeywordTok{,>}\DecValTok{5}\KeywordTok{\{}\NormalTok{JDFILES}
  \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{ tmpusesfile tfile}\KeywordTok{;}\NormalTok{UF }\KeywordTok{do.}\NormalTok{ msg }\KeywordTok{return.} \KeywordTok{end.}

  \CommentTok{NB. move old data files to backup directory and rename}
  \CommentTok{NB. backup prefix number HARDCODE backup directory index}
\NormalTok{  bckpath}\KeywordTok{=.}\NormalTok{ PATHDEL }\KeywordTok{,\textasciitilde{}}\NormalTok{ path}\KeywordTok{,>}\DecValTok{5}\KeywordTok{\{}\NormalTok{JDSDIRS}
\NormalTok{  dcfiles}\KeywordTok{=.}\NormalTok{ JDFILES }\KeywordTok{,\&.>} \KeywordTok{<}\NormalTok{IJF}
\NormalTok{  source}\KeywordTok{=.}  \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{path}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ dcfiles}
\NormalTok{  target}\KeywordTok{=.}  \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{bckpath}\RegionMarkerTok{)} \KeywordTok{,\&.>} \RegionMarkerTok{(}\KeywordTok{<":}\NormalTok{pfn}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ dcfiles}
  \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{source renamefiles target }\KeywordTok{do.}\NormalTok{ msg }\KeywordTok{return.} \KeywordTok{end.}

  \CommentTok{NB. rename tmp files to standard file names}
\NormalTok{  target}\KeywordTok{=.}\NormalTok{ source}
\NormalTok{  source}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{path}\RegionMarkerTok{)} \KeywordTok{,\&.>} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{TEMPFX}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ dcfiles}
  \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{source renamefiles target }\KeywordTok{do.}\NormalTok{ msg }\KeywordTok{return.} \KeywordTok{end.}

  \CommentTok{NB. insure new directory is reloaded when needed}
\NormalTok{  dropall }\DecValTok{0}

\NormalTok{  ok OK200}\KeywordTok{;}\NormalTok{DNAME}\KeywordTok{;}\NormalTok{pfn  }\CommentTok{NB. return dictionary \& pack count}
\KeywordTok{else.}
\NormalTok{  jderr ERR202}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{packspace}\AlertTok{=:}\index{packspace@\texttt{packspace}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*packspace v{-}{-} determines if there is sufficient free space on}
\CommentTok{NB. the backup volume.}
\CommentTok{NB.}
\CommentTok{NB. The  test  is  conservative  in  that  you  must  have enough}
\CommentTok{NB. freespace to  copy the  current  unpacked dictionary.  Packed}
\CommentTok{NB. dictionaries  are  always  smaller  so this  leaves a  safety}
\CommentTok{NB. margin.}
\CommentTok{NB.}
\CommentTok{NB. monad:  packspace uuIgnore}
\CommentTok{NB.}
\CommentTok{NB.   packspace\_\_DL 0}

\CommentTok{NB. object nouns !(*)=. SYS BAK}
\CommentTok{NB. size of current unpacked dictionary}
\NormalTok{bytes}\KeywordTok{=.} \KeywordTok{+/} \KeywordTok{;} \DecValTok{2} \KeywordTok{\{"}\DecValTok{1} \KeywordTok{]} \DecValTok{1}\KeywordTok{!:}\DecValTok{0} \KeywordTok{<}\NormalTok{SYS}\KeywordTok{,}\StringTok{\textquotesingle{}*\textquotesingle{}}\KeywordTok{,}\NormalTok{IJF}

\CommentTok{NB. errmsg: not enough free disk space for operation}
\KeywordTok{if.}\NormalTok{ bytes}\KeywordTok{<}\NormalTok{volfree BAK }\KeywordTok{do.}\NormalTok{ OK }\KeywordTok{else.}\NormalTok{ jderr ERR204 }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{puttstamps}\AlertTok{=:}\index{puttstamps@\texttt{puttstamps}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*puttstamps v{-}{-} update inverted creation and lastput timestamps.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaObject puttstamps ftTs}

\NormalTok{fp}\KeywordTok{=.} \KeywordTok{".}\RegionMarkerTok{(}\KeywordTok{\{.\&>}\NormalTok{dnix }\KeywordTok{x}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}F\textquotesingle{}} \CommentTok{NB. dictionary file pointer {-} errmsg: timestamp update failure}
\KeywordTok{if.}\NormalTok{ badjr }\RegionMarkerTok{(}\KeywordTok{<"}\DecValTok{1} \KeywordTok{y}\RegionMarkerTok{)}\NormalTok{ jreplace fp}\KeywordTok{;}\NormalTok{CNCREATION}\KeywordTok{,}\NormalTok{CNPUTDATE }\KeywordTok{do.}\NormalTok{ jderr ERR212 }\KeywordTok{else.}\NormalTok{ OK }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{renamefiles}\AlertTok{=:}\index{renamefiles@\texttt{renamefiles}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*renamefiles v{-}{-} moves and renames OS files.}
\CommentTok{NB.}
\CommentTok{NB. NOTE: tested on  Win32  and Linux 32 bit systems  may work on}
\CommentTok{NB. others.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  blclSource renamefiles blclTarget}

\KeywordTok{if.}\NormalTok{ IFWIN }\KeywordTok{do.}
\NormalTok{  rc}\KeywordTok{=.}\NormalTok{movefile}\KeywordTok{"}\DecValTok{1} \KeywordTok{x} \KeywordTok{,.} \KeywordTok{y}
  \CommentTok{NB. errmsg: unable to rename files}
  \KeywordTok{if.} \KeywordTok{*./}\DecValTok{0} \KeywordTok{<;} \KeywordTok{\{."}\DecValTok{1}\NormalTok{ rc }\KeywordTok{do.}\NormalTok{ OK }\KeywordTok{else.} \RegionMarkerTok{(}\NormalTok{jderr ERR205}\RegionMarkerTok{)}\KeywordTok{,}\RegionMarkerTok{(}\DecValTok{15}\KeywordTok{!:}\DecValTok{11}\RegionMarkerTok{)}\StringTok{\textquotesingle{}\textquotesingle{}} \KeywordTok{end.}
\KeywordTok{else.}
  \CommentTok{NB. move current dictionary files to backup location}
  \CommentTok{NB. NOTE: assumes path file names that do not wreak linux (mv) command}
  \KeywordTok{if.}\NormalTok{ isempty rc}\KeywordTok{=.}\NormalTok{ host}\KeywordTok{"}\DecValTok{1}  \KeywordTok{>} \RegionMarkerTok{(}\KeywordTok{<}\StringTok{\textquotesingle{}mv \textquotesingle{}}\RegionMarkerTok{)} \KeywordTok{,\&.>} \KeywordTok{x} \KeywordTok{,\&.>} \StringTok{\textquotesingle{} \textquotesingle{}} \KeywordTok{,\&.>} \KeywordTok{y} \KeywordTok{do.}\NormalTok{ OK}
  \KeywordTok{else.}
    \CommentTok{NB. result not empty probably some OS error}
    \CommentTok{NB. errmsg:  unable to copy/move/rename files {-} shell messages {-}>}
    \RegionMarkerTok{(}\NormalTok{jderr ERR210}\RegionMarkerTok{)}\KeywordTok{,<,}\NormalTok{rc}
  \KeywordTok{end.}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{restdict}\AlertTok{=:}\index{restdict@\texttt{restdict}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*restdict v{-}{-} restore latest backup created by (packd)}
\CommentTok{NB.}
\CommentTok{NB. dyad:  blclFiles restdict clName}

\CommentTok{NB. object nouns !(*)=. DIDNUM DNAME SYS}

\KeywordTok{if.} \RegionMarkerTok{(}\KeywordTok{,}\NormalTok{DNAME}\RegionMarkerTok{)} \KeywordTok{{-}:} \KeywordTok{,y} \KeywordTok{do.}

  \CommentTok{NB. clear current object directory {-} frees space}
\NormalTok{  dropall }\DecValTok{0}

  \CommentTok{NB. NIMP restore comes from the same volume as the}
  \CommentTok{NB. dictionary.  This code depends on the fact we}
  \CommentTok{NB. are dealing with a standard dictionary directory}
  \CommentTok{NB. that is contained on ONE volume.}
\NormalTok{  path}\KeywordTok{=.} \RegionMarkerTok{((}\NormalTok{justpath}\KeywordTok{\textasciigrave{}}\NormalTok{justdrvpath}\KeywordTok{@.}\NormalTok{IFWIN}\RegionMarkerTok{)}\NormalTok{ SYS}\RegionMarkerTok{)}\KeywordTok{,}\NormalTok{PATHDEL}

\NormalTok{  dcfiles}\KeywordTok{=.}\NormalTok{ JDFILES }\KeywordTok{,\&.>} \KeywordTok{<}\NormalTok{IJF            }\CommentTok{NB. dictionary file names with extension}
\NormalTok{  bckpath}\KeywordTok{=.}\NormalTok{ PATHDEL }\KeywordTok{,\textasciitilde{}}\NormalTok{ path}\KeywordTok{,>}\DecValTok{5}\KeywordTok{\{}\NormalTok{JDSDIRS   }\CommentTok{NB. HARDCODE 5 backup directory index}
\NormalTok{  target}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{path}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ dcfiles          }\CommentTok{NB. current dictionary files}
\NormalTok{  source}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{bckpath}\RegionMarkerTok{)} \KeywordTok{,\&.>} \RegionMarkerTok{(}\KeywordTok{<":>x}\RegionMarkerTok{)} \KeywordTok{,\&.>}\NormalTok{ dcfiles  }\CommentTok{NB. lastest backup files}

  \CommentTok{NB. test backup files errmsg: missing backup files {-} restore aborted}
  \KeywordTok{if.} \KeywordTok{{-}.}\NormalTok{fex source }\KeywordTok{do.}\NormalTok{ jderr ERR207 }\KeywordTok{return.} \KeywordTok{end.}

  \CommentTok{NB. Check DIDNUM of backup dictionary against current object}
  \CommentTok{NB. they must match to maintain master/dictionary relationships.}
  \CommentTok{NB. WARNING uses fact that the WORD file is first ON (source) list}
  \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread }\RegionMarkerTok{(}\KeywordTok{>\{.}\NormalTok{source}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{CNPARMS }\KeywordTok{do.}
\NormalTok{      jderr ERR088 }\KeywordTok{return.} \CommentTok{NB. errmsg: jfile read failure}
  \KeywordTok{end.}

  \CommentTok{NB. read alleged backup DIDNUM}
\NormalTok{  dn}\KeywordTok{=.} \RegionMarkerTok{((}\DecValTok{1}\KeywordTok{\&\{::@>}\RegionMarkerTok{)} \KeywordTok{::} \KeywordTok{0:}\RegionMarkerTok{)}\NormalTok{ dat}
  \KeywordTok{if.} \KeywordTok{{-}.}\NormalTok{ dn }\KeywordTok{{-}:}\NormalTok{ DIDNUM }\KeywordTok{do.}\NormalTok{ jderr ERR209 }\KeywordTok{return.} \KeywordTok{end.}

  \CommentTok{NB. erase current dictionary files and copy last backup}
  \RegionMarkerTok{(}\DecValTok{1}\KeywordTok{!:}\DecValTok{55}\RegionMarkerTok{)}\NormalTok{ target}
  \KeywordTok{if.}\NormalTok{ badrc msg}\KeywordTok{=.}\NormalTok{source copyfiles target }\KeywordTok{do.}\NormalTok{ msg }\KeywordTok{return.} \KeywordTok{end.}

  \CommentTok{NB. increment pack count to prevent clash with backup}
  \CommentTok{NB. this causes gaps in the backup count but insures we never clash}
\NormalTok{  pfn}\KeywordTok{=.}\NormalTok{backnum }\DecValTok{0}

  \CommentTok{NB. insure new directory is reloaded when needed}
\NormalTok{  dropall }\DecValTok{0}

\NormalTok{  ok OK201}\KeywordTok{;}\NormalTok{DNAME}\KeywordTok{;<:}\NormalTok{pfn  }\CommentTok{NB. name \& pack count of restored dictionary}
\KeywordTok{else.}
\NormalTok{  jderr ERR202}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{restspace}\AlertTok{=:}\index{restspace@\texttt{restspace}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*restspace v{-}{-} determines  if there is enough space to restore}
\CommentTok{NB. a dictionary.}
\CommentTok{NB.}
\CommentTok{NB. monad:  restspace uuIgnore}

\CommentTok{NB. object nouns !(*)=. BAK SYS}

\CommentTok{NB. all dictionary backup files}
\KeywordTok{if.} \KeywordTok{\#}\NormalTok{back}\KeywordTok{=.} \DecValTok{1}\KeywordTok{!:}\DecValTok{0} \KeywordTok{<}\NormalTok{BAK}\KeywordTok{,}\StringTok{\textquotesingle{}*\textquotesingle{}}\KeywordTok{,}\NormalTok{IJF }\KeywordTok{do.}

  \CommentTok{NB. latest back up number}
\NormalTok{  maxb}\KeywordTok{=.}\NormalTok{ maxback }\KeywordTok{\{."}\DecValTok{1}\NormalTok{ back}

  \CommentTok{NB. select files in latest backup}
\NormalTok{  back}\KeywordTok{=.}\NormalTok{ back }\KeywordTok{\#\textasciitilde{}}\NormalTok{ maxb nummask }\KeywordTok{\{."}\DecValTok{1}\NormalTok{ back}

  \CommentTok{NB. bytes required to store lastest backup}
\NormalTok{  bytes}\KeywordTok{=.} \KeywordTok{+/} \KeywordTok{;} \DecValTok{2} \KeywordTok{\{"}\DecValTok{1}\NormalTok{ back}

  \KeywordTok{if.}\NormalTok{ bytes}\KeywordTok{<}\NormalTok{volfree SYS }\KeywordTok{do.}
\NormalTok{    ok maxb       }\CommentTok{NB. return lastest backup number}
  \KeywordTok{else.}
\NormalTok{    jderr ERR204  }\CommentTok{NB. errmsg: not enough free disk space for operation}
  \KeywordTok{end.}
\KeywordTok{else.}
\NormalTok{  jderr ERR206    }\CommentTok{NB. errmsg: no backups to restore}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{savedir}\AlertTok{=:}\index{savedir@\texttt{savedir}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*savedir  v{-}{-}  saves  the  requested  directory  (x)  in  the}
\CommentTok{NB. appropriate database file.}
\CommentTok{NB.}
\CommentTok{NB. dyad: ilObjFp savedir clFile|iaFp}
\CommentTok{NB.}
\CommentTok{NB.   0 23899923 savedir list;comp  NB. save WORD directory}

\StringTok{\textquotesingle{}dir wp\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}
\KeywordTok{y=.} \DecValTok{0} \KeywordTok{[} \StringTok{\textquotesingle{}list comp\textquotesingle{}}\KeywordTok{=.} \KeywordTok{y}
\NormalTok{dir}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{OBJECTNC }\KeywordTok{i.}\NormalTok{ dir}\RegionMarkerTok{)} \KeywordTok{\{}\NormalTok{ DIRNMS}
\StringTok{\textquotesingle{}dts dix dcn\textquotesingle{}}\KeywordTok{=.}\NormalTok{ dir }\KeywordTok{,\&.>}\NormalTok{ DTSIXCN}
\NormalTok{cn}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{list}\RegionMarkerTok{)}\NormalTok{ jreplace wp }\KeywordTok{;}\NormalTok{ CNLIST}
\NormalTok{cn}\KeywordTok{=.}\NormalTok{ cn}\KeywordTok{,}\NormalTok{ comp jreplace wp }\KeywordTok{;}\NormalTok{ CNCOMPS}
\NormalTok{cn}\KeywordTok{=.}\NormalTok{ cn}\KeywordTok{,} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{uv}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{\#}\NormalTok{list}\RegionMarkerTok{)}\KeywordTok{;}\NormalTok{now }\StringTok{\textquotesingle{}\textquotesingle{}}\RegionMarkerTok{)}\NormalTok{ jreplace wp }\KeywordTok{;}\NormalTok{ CNMARK}
\KeywordTok{if.}\NormalTok{ badreps cn }\KeywordTok{do.}

  \CommentTok{NB. directory write error attempt to restore previous}
\NormalTok{  cn}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<".}\NormalTok{dix}\RegionMarkerTok{)}\NormalTok{ jreplace wp }\KeywordTok{;}\NormalTok{ CNLIST}
\NormalTok{  cn}\KeywordTok{=.}\NormalTok{ cn}\KeywordTok{,} \RegionMarkerTok{(}\KeywordTok{".}\NormalTok{dcn}\RegionMarkerTok{)}\NormalTok{ jreplace wp }\KeywordTok{;}\NormalTok{ CNCOMPS}
\NormalTok{  cn}\KeywordTok{=.}\NormalTok{ cn}\KeywordTok{,} \RegionMarkerTok{(}\KeywordTok{<".}\NormalTok{dts}\RegionMarkerTok{)}\NormalTok{ jreplace wp }\KeywordTok{;}\NormalTok{ CNMARK}
  \KeywordTok{if.}\NormalTok{ badreps cn }\KeywordTok{do.}
\NormalTok{    jderr ERR200}
  \KeywordTok{else.}
\NormalTok{    jderr ERR201}
  \KeywordTok{end.}

\KeywordTok{else.}

  \CommentTok{NB. update object directory}
  \RegionMarkerTok{(}\NormalTok{dix}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}\NormalTok{  list}
  \RegionMarkerTok{(}\NormalTok{dcn}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}\NormalTok{  comp}
  \RegionMarkerTok{(}\NormalTok{dts}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}\NormalTok{  uv}
\NormalTok{  OK}

\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{saveref}\AlertTok{=:}\index{saveref@\texttt{saveref}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*saveref  v{-}{-} saves the requested reference  directory (x) in}
\CommentTok{NB. the appropriate database file.}
\CommentTok{NB.}
\CommentTok{NB. dyad: ilObjFp saveref (blcl ; il)}
\CommentTok{NB.}
\CommentTok{NB.   0 23899923 saveref list;comp  NB. save WORD reference directory}

\StringTok{\textquotesingle{}ref fp\textquotesingle{}}\KeywordTok{=.} \KeywordTok{x}
\KeywordTok{y=.} \DecValTok{0} \KeywordTok{[} \StringTok{\textquotesingle{}list comp\textquotesingle{}}\KeywordTok{=.} \KeywordTok{y}
\NormalTok{type}\KeywordTok{=.} \RegionMarkerTok{(}\NormalTok{WORD}\KeywordTok{,}\NormalTok{TEST}\RegionMarkerTok{)} \KeywordTok{i.}\NormalTok{ ref  }\CommentTok{NB. only words currently stored}
\NormalTok{dir}\KeywordTok{=.}\NormalTok{ type}\KeywordTok{\{}\NormalTok{DIRRFN}
\NormalTok{cnref}\KeywordTok{=.}\NormalTok{ type}\KeywordTok{\{}\NormalTok{CNREF}
\StringTok{\textquotesingle{}dts dix dcn\textquotesingle{}}\KeywordTok{=.}\NormalTok{ dir }\KeywordTok{,\&.>}\NormalTok{ DTSIXCN}
\NormalTok{cn}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{list}\RegionMarkerTok{)}\NormalTok{ jreplace fp }\KeywordTok{;} \DecValTok{0}\KeywordTok{\{}\NormalTok{cnref}
\NormalTok{cn}\KeywordTok{=.}\NormalTok{ cn}\KeywordTok{,}\NormalTok{ comp jreplace fp }\KeywordTok{;} \DecValTok{1}\KeywordTok{\{}\NormalTok{cnref}
\NormalTok{cn}\KeywordTok{=.}\NormalTok{ cn}\KeywordTok{,} \RegionMarkerTok{(}\KeywordTok{<}\NormalTok{uv}\KeywordTok{=.} \DecValTok{0}\KeywordTok{;}\NormalTok{now }\StringTok{\textquotesingle{}\textquotesingle{}}\RegionMarkerTok{)}\NormalTok{ jreplace fp }\KeywordTok{;}\NormalTok{ CNMARK}
\KeywordTok{if.}\NormalTok{ badreps cn }\KeywordTok{do.}

  \CommentTok{NB. directory write error attempt to restore previous}
\NormalTok{  cn}\KeywordTok{=.} \RegionMarkerTok{(}\KeywordTok{<".}\NormalTok{dix}\RegionMarkerTok{)}\NormalTok{ jreplace fp }\KeywordTok{;} \DecValTok{0}\KeywordTok{\{}\NormalTok{cnref}
\NormalTok{  cn}\KeywordTok{=.}\NormalTok{ cn}\KeywordTok{,} \RegionMarkerTok{(}\KeywordTok{".}\NormalTok{dcn}\RegionMarkerTok{)}\NormalTok{ jreplace fp }\KeywordTok{;} \DecValTok{1}\KeywordTok{\{}\NormalTok{cnref}
\NormalTok{  cn}\KeywordTok{=.}\NormalTok{ cn}\KeywordTok{,} \RegionMarkerTok{(}\KeywordTok{<".}\NormalTok{dts}\RegionMarkerTok{)}\NormalTok{ jreplace fp }\KeywordTok{;}\NormalTok{ CNMARK}
  \KeywordTok{if.}\NormalTok{ badreps cn }\KeywordTok{do.}
\NormalTok{    jderr ERR200}
  \KeywordTok{else.}
\NormalTok{    jderr ERR201}
  \KeywordTok{end.}

\KeywordTok{else.}

  \CommentTok{NB. update object directory}
  \RegionMarkerTok{(}\NormalTok{dix}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}\NormalTok{  list}
  \RegionMarkerTok{(}\NormalTok{dcn}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}\NormalTok{  comp}
  \RegionMarkerTok{(}\NormalTok{dts}\RegionMarkerTok{)}\AlertTok{=:}\index{01indirect@\texttt{(...)=:}}\NormalTok{  uv}
\NormalTok{  OK}

\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tmpdatfile}\AlertTok{=:}\index{tmpdatfile@\texttt{tmpdatfile}} \DecValTok{4} \RegionMarkerTok{: 0}

\CommentTok{NB.*tmdatfile v{-}{-} copies  dictionary  object files  to  temporary}
\CommentTok{NB. files.}
\CommentTok{NB.}
\CommentTok{NB. dyad:  iaObject tmpdatfile (clTemp ; clDictionary)}

\StringTok{\textquotesingle{}tfile datfile\textquotesingle{}}\KeywordTok{=.} \KeywordTok{y}

\CommentTok{NB. copy directory and inverted data region}
\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ copydirinv }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. copy data region in chunks no greater than (COPYFACTOR)}
\CommentTok{NB. errmsg: unable to load directory}
\KeywordTok{if.}\NormalTok{ loaddir }\KeywordTok{x} \KeywordTok{do.}\NormalTok{ jderr ERR054 }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{ix}\KeywordTok{=.".>}\NormalTok{dnix }\KeywordTok{x}
\NormalTok{cn}\KeywordTok{=.".>}\NormalTok{dncn }\KeywordTok{x}

\CommentTok{NB. errmsg: directory damaged}
\KeywordTok{if.} \RegionMarkerTok{(}\KeywordTok{\#}\NormalTok{ix}\RegionMarkerTok{)}\KeywordTok{\textasciitilde{}:\#}\NormalTok{cn }\KeywordTok{do.}\NormalTok{ jderr ERR093 }\KeywordTok{return.} \KeywordTok{end.}
\CommentTok{NB. exit if no data to copy}
\KeywordTok{if.} \DecValTok{0}\KeywordTok{=\#}\NormalTok{ix      }\KeywordTok{do.}\NormalTok{ OK }\KeywordTok{return.} \KeywordTok{end.}

\NormalTok{ix}\KeywordTok{=.}\RegionMarkerTok{(}\KeywordTok{{-}}\NormalTok{COPYFACTOR}\RegionMarkerTok{)} \KeywordTok{<\textbackslash{}}\NormalTok{ ix  }\CommentTok{NB. object noun !(*)=. COPYFACTOR}
\NormalTok{cn}\KeywordTok{=.}\RegionMarkerTok{(}\KeywordTok{{-}}\NormalTok{COPYFACTOR}\RegionMarkerTok{)} \KeywordTok{<\textbackslash{}}\NormalTok{ cn}
\NormalTok{dropdir }\KeywordTok{x}

\CommentTok{NB. NIMP opening and closing files for now}
\NormalTok{ncn}\KeywordTok{=.i.}\DecValTok{0}
\KeywordTok{for\_reg.}\NormalTok{ cn }\KeywordTok{do.}

  \CommentTok{NB. data in object files are in pairs of components}
\NormalTok{  uv}\KeywordTok{=.} \KeywordTok{,}\RegionMarkerTok{(}\KeywordTok{>}\NormalTok{reg}\RegionMarkerTok{)} \KeywordTok{,.} \KeywordTok{>:>}\NormalTok{reg}
  \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread datfile}\KeywordTok{;}\NormalTok{uv }\KeywordTok{do.}\NormalTok{ jderr ERR088 }\KeywordTok{return.} \KeywordTok{end.}

  \CommentTok{NB. test components against directory (NIMP handle errors later)}
  \CommentTok{NB. errmsg: directory{-}data inconsistency}
  \KeywordTok{if.} \RegionMarkerTok{(}\DecValTok{2}\KeywordTok{\#>}\NormalTok{reg\_index}\KeywordTok{\{}\NormalTok{ix}\RegionMarkerTok{)}\NormalTok{ badcn dat }\KeywordTok{do.}\NormalTok{ jderr ERR055 }\KeywordTok{return.} \KeywordTok{end.}
  \KeywordTok{if.}\NormalTok{ badappend uv}\KeywordTok{=.}\NormalTok{dat jappend tfile }\KeywordTok{do.}\NormalTok{ jderr ERR058 }\KeywordTok{return.} \KeywordTok{end.}

\NormalTok{  ncn}\KeywordTok{=.}\NormalTok{ncn}\KeywordTok{,}\NormalTok{fod uv  }\CommentTok{NB. new components}
\KeywordTok{end.}

\CommentTok{NB. update file component list}
\CommentTok{NB. errmsg: jfile replace failure}
\KeywordTok{if.}\NormalTok{ badreps ncn jreplace tfile}\KeywordTok{;}\NormalTok{CNCOMPS }\KeywordTok{do.}\NormalTok{ jderr ERR056 }\KeywordTok{else.}\NormalTok{ OK }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tmpusesfile}\AlertTok{=:}\index{tmpusesfile@\texttt{tmpusesfile}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*tmpusesfiles  v{-}{-} copies  reference file.  This  file differs}
\CommentTok{NB. from object data files and may change even more.}
\CommentTok{NB.}
\CommentTok{NB. monad:  tmpusesfile (clTemp ; clDictionary)}

\StringTok{\textquotesingle{}tfile datfile\textquotesingle{}}\KeywordTok{=.} \KeywordTok{y}

\CommentTok{NB. copy directory and inverted data region}
\KeywordTok{if.}\NormalTok{ badrc uv}\KeywordTok{=.}\NormalTok{ copydirinv }\KeywordTok{y} \KeywordTok{do.}\NormalTok{ uv }\KeywordTok{return.} \KeywordTok{end.}

\CommentTok{NB. NIMP only word references are currently stored}
\CommentTok{NB. errmsg: unable to load references}
\KeywordTok{if.}\NormalTok{ loadref WORD }\KeywordTok{do.}\NormalTok{ jderr ERR079 }\KeywordTok{return.} \KeywordTok{end.}
\NormalTok{ix}\KeywordTok{=.".>}\NormalTok{dnrn WORD}
\NormalTok{cn}\KeywordTok{=.".>}\DecValTok{0}\NormalTok{ dnrn WORD}
\NormalTok{dropref }\DecValTok{0}

\CommentTok{NB. errmsg: directory damaged}
\KeywordTok{if.} \RegionMarkerTok{(}\KeywordTok{\#}\NormalTok{ix}\RegionMarkerTok{)}\KeywordTok{\textasciitilde{}:\#}\NormalTok{cn }\KeywordTok{do.}\NormalTok{ jderr ERR093 }\KeywordTok{return.} \KeywordTok{end.}
\CommentTok{NB. exit if no data to copy}
\KeywordTok{if.} \DecValTok{0}\KeywordTok{=\#}\NormalTok{ix      }\KeywordTok{do.}\NormalTok{ OK }\KeywordTok{return.} \KeywordTok{end.}

\NormalTok{ix}\KeywordTok{=.}\RegionMarkerTok{(}\KeywordTok{{-}}\NormalTok{COPYFACTOR}\RegionMarkerTok{)} \KeywordTok{<\textbackslash{}}\NormalTok{ ix  }\CommentTok{NB. object noun !(*)=. COPYFACTOR}
\NormalTok{cn}\KeywordTok{=.}\RegionMarkerTok{(}\KeywordTok{{-}}\NormalTok{COPYFACTOR}\RegionMarkerTok{)} \KeywordTok{<\textbackslash{}}\NormalTok{ cn}

\CommentTok{NB. NIMP opening and closing files for now}
\NormalTok{ncn}\KeywordTok{=.i.}\DecValTok{0}
\KeywordTok{for\_reg.}\NormalTok{ cn }\KeywordTok{do.}

  \KeywordTok{if.}\NormalTok{ badjr dat}\KeywordTok{=.}\NormalTok{ jread datfile}\KeywordTok{;}\NormalTok{reg }\KeywordTok{do.}\NormalTok{ jderr ERR088 }\KeywordTok{return.} \KeywordTok{end.}

  \CommentTok{NB. test components against directory (NIMP handle errors later)}
  \CommentTok{NB. errmsg: directory{-}data inconsistency}
  \KeywordTok{if.} \RegionMarkerTok{(}\KeywordTok{>}\NormalTok{reg\_index}\KeywordTok{\{}\NormalTok{ix}\RegionMarkerTok{)}\NormalTok{ badcn dat }\KeywordTok{do.}\NormalTok{ jderr ERR055 }\KeywordTok{return.} \KeywordTok{end.}
  \KeywordTok{if.}\NormalTok{ badappend uv}\KeywordTok{=.}\NormalTok{ dat jappend tfile }\KeywordTok{do.}\NormalTok{ jderr ERR058 }\KeywordTok{return.} \KeywordTok{end.}

\NormalTok{  ncn}\KeywordTok{=.}\NormalTok{ncn}\KeywordTok{,}\NormalTok{uv}
\KeywordTok{end.}

\CommentTok{NB. update reference component list NIMP words only}
\CommentTok{NB. errmsg: jfile replace failure}
\KeywordTok{if.}\NormalTok{ badreps ncn jreplace tfile}\KeywordTok{;}\DecValTok{1}\KeywordTok{\{}\DecValTok{0}\KeywordTok{\{}\NormalTok{CNREF }\KeywordTok{do.}\NormalTok{ jderr ERR056 }\KeywordTok{else.}\NormalTok{ OK }\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{volfree}\AlertTok{=:}\index{volfree@\texttt{volfree}} \DecValTok{3} \RegionMarkerTok{: 0}

\CommentTok{NB.*volfree v{-}{-} returns free bytes on volume or UNC path.}
\CommentTok{NB.}
\CommentTok{NB. monad: na =. volfree clPathDisk}
\CommentTok{NB.}
\CommentTok{NB.   volfree \textquotesingle{}c\textquotesingle{}}
\CommentTok{NB.   volfree \textquotesingle{}\textbackslash{}\textbackslash{}unc\textbackslash{}share\textbackslash{}\textquotesingle{}}
\CommentTok{NB.   volfree \textquotesingle{}/home/john\textquotesingle{}   NB. NIMP: linux paths ignored for now}

\KeywordTok{if.}\NormalTok{ IFWIN }\KeywordTok{do.}
  \KeywordTok{if.} \RegionMarkerTok{(}\DecValTok{2}\KeywordTok{\#}\NormalTok{PATHDEL}\RegionMarkerTok{)}\KeywordTok{{-}:}\DecValTok{2}\KeywordTok{\{.y} \KeywordTok{do.}\NormalTok{ freediskwin }\KeywordTok{y} \KeywordTok{else.}\NormalTok{ freediskwin }\RegionMarkerTok{(}\NormalTok{justdrv }\KeywordTok{y}\RegionMarkerTok{)}\KeywordTok{,}\StringTok{\textquotesingle{}:\textquotesingle{}}\KeywordTok{,}\NormalTok{PATHDEL }\KeywordTok{end.}
\KeywordTok{else.}
  \KeywordTok{<./}\NormalTok{freedisklinux }\DecValTok{0}
\KeywordTok{end.}
\RegionMarkerTok{)}
\end{Highlighting}
\end{Shaded}
